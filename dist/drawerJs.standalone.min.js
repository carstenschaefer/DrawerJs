/*! drawerjs - 1.11.0
 */

var fabric=fabric||{version:"1.7.1"};"undefined"!=typeof exports&&(exports.fabric=fabric),"undefined"!=typeof document&&"undefined"!=typeof window?(fabric.document=document,fabric.window=window,window.fabric=fabric):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.window=fabric.document.createWindow?fabric.document.createWindow():fabric.document.parentWindow),fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement,fabric.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id"],fabric.DPI=96,fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",fabric.fontPaths={},fabric.charWidthsCache={},fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1,function(){function a(a,b){if(this.__eventListeners[a]){var c=this.__eventListeners[a];b?c[c.indexOf(b)]=!1:fabric.util.array.fill(c,!1)}}function b(a,b){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var c in a)this.on(c,a[c]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(b);return this}function c(b,c){if(this.__eventListeners){if(0===arguments.length)for(b in this.__eventListeners)a.call(this,b);else if(1===arguments.length&&"object"==typeof arguments[0])for(var d in b)a.call(this,d,b[d]);else a.call(this,b,c);return this}}function d(a,b){if(this.__eventListeners){var c=this.__eventListeners[a];if(c){for(var d=0,e=c.length;e>d;d++)c[d]&&c[d].call(this,b||{});return this.__eventListeners[a]=c.filter(function(a){return a!==!1}),this}}}fabric.Observable={observe:b,stopObserving:c,fire:d,on:b,off:c,trigger:d}}(),fabric.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var a=0,b=arguments.length;b>a;a++)this._onObjectAdded(arguments[a]);return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(a,b,c){var d=this.getObjects();return c?d[b]=a:d.splice(b,0,a),this._onObjectAdded&&this._onObjectAdded(a),this.renderOnAddRemove&&this.renderAll(),this},remove:function(){for(var a,b=this.getObjects(),c=!1,d=0,e=arguments.length;e>d;d++)a=b.indexOf(arguments[d]),-1!==a&&(c=!0,b.splice(a,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[d]));return this.renderOnAddRemove&&c&&this.renderAll(),this},forEachObject:function(a,b){for(var c=this.getObjects(),d=0,e=c.length;e>d;d++)a.call(b,c[d],d,c);return this},getObjects:function(a){return"undefined"==typeof a?this._objects:this._objects.filter(function(b){return b.type===a})},item:function(a){return this.getObjects()[a]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(a){return this.getObjects().indexOf(a)>-1},complexity:function(){return this.getObjects().reduce(function(a,b){return a+=b.complexity?b.complexity():0},0)}},function(a){var b=Math.sqrt,c=Math.atan2,d=Math.pow,e=Math.abs,f=Math.PI/180;fabric.util={removeFromArray:function(a,b){var c=a.indexOf(b);return-1!==c&&a.splice(c,1),a},getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},degreesToRadians:function(a){return a*f},radiansToDegrees:function(a){return a/f},rotatePoint:function(a,b,c){a.subtractEquals(b);var d=fabric.util.rotateVector(a,c);return new fabric.Point(d.x,d.y).addEquals(b)},rotateVector:function(a,b){var c=Math.sin(b),d=Math.cos(b),e=a.x*d-a.y*c,f=a.x*c+a.y*d;return{x:e,y:f}},transformPoint:function(a,b,c){return c?new fabric.Point(b[0]*a.x+b[2]*a.y,b[1]*a.x+b[3]*a.y):new fabric.Point(b[0]*a.x+b[2]*a.y+b[4],b[1]*a.x+b[3]*a.y+b[5])},makeBoundingBoxFromPoints:function(a){var b=[a[0].x,a[1].x,a[2].x,a[3].x],c=fabric.util.array.min(b),d=fabric.util.array.max(b),e=Math.abs(c-d),f=[a[0].y,a[1].y,a[2].y,a[3].y],g=fabric.util.array.min(f),h=fabric.util.array.max(f),i=Math.abs(g-h);return{left:c,top:g,width:e,height:i}},invertTransform:function(a){var b=1/(a[0]*a[3]-a[1]*a[2]),c=[b*a[3],-b*a[1],-b*a[2],b*a[0]],d=fabric.util.transformPoint({x:a[4],y:a[5]},c,!0);return c[4]=-d.x,c[5]=-d.y,c},toFixed:function(a,b){return parseFloat(Number(a).toFixed(b))},parseUnit:function(a,b){var c=/\D{0,2}$/.exec(a),d=parseFloat(a);switch(b||(b=fabric.Text.DEFAULT_SVG_FONT_SIZE),c[0]){case"mm":return d*fabric.DPI/25.4;case"cm":return d*fabric.DPI/2.54;case"in":return d*fabric.DPI;case"pt":return d*fabric.DPI/72;case"pc":return d*fabric.DPI/72*12;case"em":return d*b;default:return d}},falseFunction:function(){return!1},getKlass:function(a,b){return a=fabric.util.string.camelize(a.charAt(0).toUpperCase()+a.slice(1)),fabric.util.resolveNamespace(b)[a]},resolveNamespace:function(b){if(!b)return fabric;var c,d=b.split("."),e=d.length,f=a||fabric.window;for(c=0;e>c;++c)f=f[d[c]];return f},loadImage:function(a,b,c,d){if(!a)return void(b&&b.call(c,a));var e=fabric.util.createImage();e.onload=function(){b&&b.call(c,e),e=e.onload=e.onerror=null},e.onerror=function(){fabric.log("Error loading "+e.src),b&&b.call(c,null,!0),e=e.onload=e.onerror=null},0!==a.indexOf("data")&&d&&(e.crossOrigin=d),e.src=a},enlivenObjects:function(a,b,c,d){function e(){++g===h&&b&&b(f)}a=a||[];var f=[],g=0,h=a.length;return h?void a.forEach(function(a,b){if(!a||!a.type)return void e();var g=fabric.util.getKlass(a.type,c);g.async?g.fromObject(a,function(c,g){g||(f[b]=c,d&&d(a,f[b])),e()}):(f[b]=g.fromObject(a),d&&d(a,f[b]),e())}):void(b&&b(f))},groupSVGElements:function(a,b,c){var d;return d=new fabric.PathGroup(a,b),"undefined"!=typeof c&&d.setSourcePath(c),d},populateWithProperties:function(a,b,c){if(c&&"[object Array]"===Object.prototype.toString.call(c))for(var d=0,e=c.length;e>d;d++)c[d]in a&&(b[c[d]]=a[c[d]])},drawDashedLine:function(a,d,e,f,g,h){var i=f-d,j=g-e,k=b(i*i+j*j),l=c(j,i),m=h.length,n=0,o=!0;for(a.save(),a.translate(d,e),a.moveTo(0,0),a.rotate(l),d=0;k>d;)d+=h[n++%m],d>k&&(d=k),a[o?"lineTo":"moveTo"](d,0),o=!o;a.restore()},createCanvasElement:function(a){return a||(a=fabric.document.createElement("canvas")),a.getContext||"undefined"==typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(a),a},createImage:function(){return fabric.isLikelyNode?new(require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(a){var b,c,d,e,f,g=a.prototype;for(b=g.stateProperties.length;b--;)c=g.stateProperties[b],d=c.charAt(0).toUpperCase()+c.slice(1),e="set"+d,f="get"+d,g[f]||(g[f]=function(a){return new Function('return this.get("'+a+'")')}(c)),g[e]||(g[e]=function(a){return new Function("value",'return this.set("'+a+'", value)')}(c))},clipContext:function(a,b){b.save(),b.beginPath(),a.clipTo(b),b.clip()},multiplyTransformMatrices:function(a,b,c){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],c?0:a[0]*b[4]+a[2]*b[5]+a[4],c?0:a[1]*b[4]+a[3]*b[5]+a[5]]},qrDecompose:function(a){var e=c(a[1],a[0]),g=d(a[0],2)+d(a[1],2),h=b(g),i=(a[0]*a[3]-a[2]*a[1])/h,j=c(a[0]*a[2]+a[1]*a[3],g);return{angle:e/f,scaleX:h,scaleY:i,skewX:j/f,skewY:0,translateX:a[4],translateY:a[5]}},customTransformMatrix:function(a,b,c){var d=[1,0,e(Math.tan(c*f)),1],g=[e(a),0,0,e(b)];return fabric.util.multiplyTransformMatrices(g,d,!0)},resetObjectTransform:function(a){a.scaleX=1,a.scaleY=1,a.skewX=0,a.skewY=0,a.flipX=!1,a.flipY=!1,a.setAngle(0)},getFunctionBody:function(a){return(String(a).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(a,b,c,d){d>0&&(b>d?b-=d:b=0,c>d?c-=d:c=0);var e,f,g=!0,h=a.getImageData(b,c,2*d||1,2*d||1),i=h.data.length;for(e=3;i>e&&(f=h.data[e],g=0>=f,g!==!1);e+=4);return h=null,g},parsePreserveAspectRatioAttribute:function(a){var b,c="meet",d="Mid",e="Mid",f=a.split(" ");return f&&f.length&&(c=f.pop(),"meet"!==c&&"slice"!==c?(b=c,c="meet"):f.length&&(b=f.pop())),d="none"!==b?b.slice(1,4):"none",e="none"!==b?b.slice(5,8):"none",{meetOrSlice:c,alignX:d,alignY:e}},clearFabricFontCache:function(a){a?fabric.charWidthsCache[a]&&delete fabric.charWidthsCache[a]:fabric.charWidthsCache={}}}}("undefined"!=typeof exports?exports:this),function(){function a(a,d,f,g,i,j,k){var l=h.call(arguments);if(e[l])return e[l];var m=Math.PI,n=k*m/180,o=Math.sin(n),p=Math.cos(n),q=0,r=0;f=Math.abs(f),g=Math.abs(g);var s=-p*a*.5-o*d*.5,t=-p*d*.5+o*a*.5,u=f*f,v=g*g,w=t*t,x=s*s,y=u*v-u*w-v*x,z=0;if(0>y){var A=Math.sqrt(1-y/(u*v));f*=A,g*=A}else z=(i===j?-1:1)*Math.sqrt(y/(u*w+v*x));var B=z*f*t/g,C=-z*g*s/f,D=p*B-o*C+.5*a,E=o*B+p*C+.5*d,F=c(1,0,(s-B)/f,(t-C)/g),G=c((s-B)/f,(t-C)/g,(-s-B)/f,(-t-C)/g);0===j&&G>0?G-=2*m:1===j&&0>G&&(G+=2*m);for(var H=Math.ceil(Math.abs(G/m*2)),I=[],J=G/H,K=8/3*Math.sin(J/4)*Math.sin(J/4)/Math.sin(J/2),L=F+J,M=0;H>M;M++)I[M]=b(F,L,p,o,f,g,D,E,K,q,r),q=I[M][4],r=I[M][5],F=L,L+=J;return e[l]=I,I}function b(a,b,c,d,e,g,i,j,k,l,m){var n=h.call(arguments);if(f[n])return f[n];var o=Math.cos(a),p=Math.sin(a),q=Math.cos(b),r=Math.sin(b),s=c*e*q-d*g*r+i,t=d*e*q+c*g*r+j,u=l+k*(-c*e*p-d*g*o),v=m+k*(-d*e*p+c*g*o),w=s+k*(c*e*r+d*g*q),x=t+k*(d*e*r-c*g*q);return f[n]=[u,v,w,x,s,t],f[n]}function c(a,b,c,d){var e=Math.atan2(b,a),f=Math.atan2(d,c);return f>=e?f-e:2*Math.PI-(e-f)}function d(a,b,c,d,e,f,i,j){var k=h.call(arguments);if(g[k])return g[k];var l,m,n,o,p,q,r,s,t=Math.sqrt,u=Math.min,v=Math.max,w=Math.abs,x=[],y=[[],[]];m=6*a-12*c+6*e,l=-3*a+9*c-9*e+3*i,n=3*c-3*a;for(var z=0;2>z;++z)if(z>0&&(m=6*b-12*d+6*f,l=-3*b+9*d-9*f+3*j,n=3*d-3*b),w(l)<1e-12){if(w(m)<1e-12)continue;o=-n/m,o>0&&1>o&&x.push(o)}else r=m*m-4*n*l,0>r||(s=t(r),p=(-m+s)/(2*l),p>0&&1>p&&x.push(p),q=(-m-s)/(2*l),q>0&&1>q&&x.push(q));for(var A,B,C,D=x.length,E=D;D--;)o=x[D],C=1-o,A=C*C*C*a+3*C*C*o*c+3*C*o*o*e+o*o*o*i,y[0][D]=A,B=C*C*C*b+3*C*C*o*d+3*C*o*o*f+o*o*o*j,y[1][D]=B;y[0][E]=a,y[1][E]=b,y[0][E+1]=i,y[1][E+1]=j;var F=[{x:u.apply(null,y[0]),y:u.apply(null,y[1])},{x:v.apply(null,y[0]),y:v.apply(null,y[1])}];return g[k]=F,F}var e={},f={},g={},h=Array.prototype.join;fabric.util.drawArc=function(b,c,d,e){for(var f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=[[],[],[],[]],n=a(k-c,l-d,f,g,i,j,h),o=0,p=n.length;p>o;o++)m[o][0]=n[o][0]+c,m[o][1]=n[o][1]+d,m[o][2]=n[o][2]+c,m[o][3]=n[o][3]+d,m[o][4]=n[o][4]+c,m[o][5]=n[o][5]+d,b.bezierCurveTo.apply(b,m[o])},fabric.util.getBoundsOfArc=function(b,c,e,f,g,h,i,j,k){for(var l,m=0,n=0,o=[],p=a(j-b,k-c,e,f,h,i,g),q=0,r=p.length;r>q;q++)l=d(m,n,p[q][0],p[q][1],p[q][2],p[q][3],p[q][4],p[q][5]),o.push({x:l[0].x+b,y:l[0].y+c}),o.push({x:l[1].x+b,y:l[1].y+c}),m=p[q][4],n=p[q][5];return o},fabric.util.getBoundsOfCurve=d}(),function(){function a(a,b){for(var c=f.call(arguments,2),d=[],e=0,g=a.length;g>e;e++)d[e]=c.length?a[e][b].apply(a[e],c):a[e][b].call(a[e]);return d}function b(a,b){return e(a,b,function(a,b){return a>=b})}function c(a,b){return e(a,b,function(a,b){return b>a})}function d(a,b){for(var c=a.length;c--;)a[c]=b;return a}function e(a,b,c){if(a&&0!==a.length){var d=a.length-1,e=b?a[d][b]:a[d];if(b)for(;d--;)c(a[d][b],e)&&(e=a[d][b]);else for(;d--;)c(a[d],e)&&(e=a[d]);return e}}var f=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>0&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&d!==Number.POSITIVE_INFINITY&&d!==Number.NEGATIVE_INFINITY&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length>>>0;d>c;c++)c in this&&a.call(b,this[c],c,this)}),Array.prototype.map||(Array.prototype.map=function(a,b){for(var c=[],d=0,e=this.length>>>0;e>d;d++)d in this&&(c[d]=a.call(b,this[d],d,this));return c}),Array.prototype.every||(Array.prototype.every=function(a,b){for(var c=0,d=this.length>>>0;d>c;c++)if(c in this&&!a.call(b,this[c],c,this))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(a,b){for(var c=0,d=this.length>>>0;d>c;c++)if(c in this&&a.call(b,this[c],c,this))return!0;return!1}),Array.prototype.filter||(Array.prototype.filter=function(a,b){for(var c,d=[],e=0,f=this.length>>>0;f>e;e++)e in this&&(c=this[e],a.call(b,c,e,this)&&d.push(c));return d}),Array.prototype.reduce||(Array.prototype.reduce=function(a){var b,c=this.length>>>0,d=0;if(arguments.length>1)b=arguments[1];else for(;;){if(d in this){b=this[d++];break}if(++d>=c)throw new TypeError}for(;c>d;d++)d in this&&(b=a.call(null,b,this[d],d,this));return b}),fabric.util.array={fill:d,invoke:a,min:c,max:b}}(),function(){function a(b,c,d){if(d)if(!fabric.isLikelyNode&&c instanceof Element)b=c;else if(c instanceof Array){b=[];for(var e=0,f=c.length;f>e;e++)b[e]=a({},c[e],d)}else if(c&&"object"==typeof c)for(var g in c)c.hasOwnProperty(g)&&(b[g]=a({},c[g],d));else b=c;else for(var g in c)b[g]=c[g];return b}function b(b,c){return a({},b,c)}fabric.util.object={extend:a,clone:b}}(),function(){function a(a){return a.replace(/-+(.)?/g,function(a,b){return b?b.toUpperCase():""})}function b(a,b){return a.charAt(0).toUpperCase()+(b?a.slice(1):a.slice(1).toLowerCase())}function c(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}),fabric.util.string={camelize:a,capitalize:b,escapeXml:c}}(),function(){var a=Array.prototype.slice,b=Function.prototype.apply,c=function(){};Function.prototype.bind||(Function.prototype.bind=function(d){var e,f=this,g=a.call(arguments,1);return e=g.length?function(){return b.call(f,this instanceof c?this:d,g.concat(a.call(arguments)))}:function(){return b.call(f,this instanceof c?this:d,arguments)},c.prototype=this.prototype,e.prototype=new c,e})}(),function(){function a(){}function b(a){var b=this.constructor.superclass.prototype[a];return arguments.length>1?b.apply(this,d.call(arguments,1)):b.call(this)}function c(){function c(){this.initialize.apply(this,arguments)}var f=null,h=d.call(arguments,0);"function"==typeof h[0]&&(f=h.shift()),c.superclass=f,c.subclasses=[],f&&(a.prototype=f.prototype,c.prototype=new a,f.subclasses.push(c));for(var i=0,j=h.length;j>i;i++)g(c,h[i],f);return c.prototype.initialize||(c.prototype.initialize=e),c.prototype.constructor=c,c.prototype.callSuper=b,c}var d=Array.prototype.slice,e=function(){},f=function(){for(var a in{toString:1})if("toString"===a)return!1;return!0}(),g=function(a,b,c){for(var d in b)a.prototype[d]=d in a.prototype&&"function"==typeof a.prototype[d]&&(b[d]+"").indexOf("callSuper")>-1?function(a){return function(){var d=this.constructor.superclass;this.constructor.superclass=c;var e=b[a].apply(this,arguments);return this.constructor.superclass=d,"initialize"!==a?e:void 0}}(d):b[d],f&&(b.toString!==Object.prototype.toString&&(a.prototype.toString=b.toString),b.valueOf!==Object.prototype.valueOf&&(a.prototype.valueOf=b.valueOf))};fabric.util.createClass=c}(),function(){function a(a){var b,c,d=Array.prototype.slice.call(arguments,1),e=d.length;for(c=0;e>c;c++)if(b=typeof a[d[c]],!/^(?:function|object|unknown)$/.test(b))return!1;return!0}function b(a,b){return{handler:b,wrappedHandler:c(a,b)}}function c(a,b){return function(c){b.call(g(a),c||fabric.window.event)}}function d(a,b){return function(c){if(p[a]&&p[a][b])for(var d=p[a][b],e=0,f=d.length;f>e;e++)d[e].call(this,c||fabric.window.event)}}function e(a){a||(a=fabric.window.event);var b=a.target||(typeof a.srcElement!==i?a.srcElement:null),c=fabric.util.getScrollLeftTop(b);return{x:q(a)+c.left,y:r(a)+c.top}}function f(a,b,c){var d="touchend"===a.type?"changedTouches":"touches";return a[d]&&a[d][0]?a[d][0][b]-(a[d][0][b]-a[d][0][c])||a[c]:a[c]}var g,h,i="unknown",j=function(){var a=0;return function(b){return b.__uniqueID||(b.__uniqueID="uniqueID__"+a++)}}();!function(){var a={};g=function(b){return a[b]},h=function(b,c){a[b]=c}}();var k,l,m=a(fabric.document.documentElement,"addEventListener","removeEventListener")&&a(fabric.window,"addEventListener","removeEventListener"),n=a(fabric.document.documentElement,"attachEvent","detachEvent")&&a(fabric.window,"attachEvent","detachEvent"),o={},p={};m?(k=function(a,b,c){a.addEventListener(b,c,!1)},l=function(a,b,c){a.removeEventListener(b,c,!1)}):n?(k=function(a,c,d){var e=j(a);h(e,a),o[e]||(o[e]={}),o[e][c]||(o[e][c]=[]);var f=b(e,d);o[e][c].push(f),a.attachEvent("on"+c,f.wrappedHandler)},l=function(a,b,c){var d,e=j(a);if(o[e]&&o[e][b])for(var f=0,g=o[e][b].length;g>f;f++)d=o[e][b][f],d&&d.handler===c&&(a.detachEvent("on"+b,d.wrappedHandler),o[e][b][f]=null)}):(k=function(a,b,c){var e=j(a);if(p[e]||(p[e]={}),!p[e][b]){p[e][b]=[];var f=a["on"+b];f&&p[e][b].push(f),a["on"+b]=d(e,b)}p[e][b].push(c)},l=function(a,b,c){var d=j(a);if(p[d]&&p[d][b])for(var e=p[d][b],f=0,g=e.length;g>f;f++)e[f]===c&&e.splice(f,1)}),fabric.util.addListener=k,fabric.util.removeListener=l;var q=function(a){return typeof a.clientX!==i?a.clientX:0},r=function(a){return typeof a.clientY!==i?a.clientY:0};fabric.isTouchSupported&&(q=function(a){return f(a,"pageX","clientX")},r=function(a){return f(a,"pageY","clientY")}),fabric.util.getPointer=e,fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function a(a,b){var c=a.style;if(!c)return a;if("string"==typeof b)return a.style.cssText+=";"+b,b.indexOf("opacity")>-1?f(a,b.match(/opacity:\s*(\d?\.?\d*)/)[1]):a;for(var d in b)if("opacity"===d)f(a,b[d]);else{var e="float"===d||"cssFloat"===d?"undefined"==typeof c.styleFloat?"cssFloat":"styleFloat":d;c[e]=b[d]}return a}var b=fabric.document.createElement("div"),c="string"==typeof b.style.opacity,d="string"==typeof b.style.filter,e=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,f=function(a){return a};c?f=function(a,b){return a.style.opacity=b,a}:d&&(f=function(a,b){var c=a.style;return a.currentStyle&&!a.currentStyle.hasLayout&&(c.zoom=1),e.test(c.filter)?(b=b>=.9999?"":"alpha(opacity="+100*b+")",c.filter=c.filter.replace(e,b)):c.filter+=" alpha(opacity="+100*b+")",a}),fabric.util.setStyle=a}(),function(){function a(a){return"string"==typeof a?fabric.document.getElementById(a):a}function b(a,b){var c=fabric.document.createElement(a);for(var d in b)"class"===d?c.className=b[d]:"for"===d?c.htmlFor=b[d]:c.setAttribute(d,b[d]);return c}function c(a,b){a&&-1===(" "+a.className+" ").indexOf(" "+b+" ")&&(a.className+=(a.className?" ":"")+b)}function d(a,c,d){return"string"==typeof c&&(c=b(c,d)),a.parentNode&&a.parentNode.replaceChild(c,a),c.appendChild(a),c}function e(a){for(var b=0,c=0,d=fabric.document.documentElement,e=fabric.document.body||{scrollLeft:0,scrollTop:0};a&&(a.parentNode||a.host)&&(a=a.parentNode||a.host,a===fabric.document?(b=e.scrollLeft||d.scrollLeft||0,c=e.scrollTop||d.scrollTop||0):(b+=a.scrollLeft||0,c+=a.scrollTop||0),1!==a.nodeType||"fixed"!==fabric.util.getElementStyle(a,"position")););return{left:b,top:c}}function f(a){var b,c,d=a&&a.ownerDocument,f={left:0,top:0},g={left:0,top:0},h={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!d)return g;for(var i in h)g[h[i]]+=parseInt(k(a,i),10)||0;return b=d.documentElement,"undefined"!=typeof a.getBoundingClientRect&&(f=a.getBoundingClientRect()),c=e(a),{left:f.left+c.left-(b.clientLeft||0)+g.left,top:f.top+c.top-(b.clientTop||0)+g.top}}var g,h=Array.prototype.slice,i=function(a){return h.call(a,0)};try{g=i(fabric.document.childNodes)instanceof Array}catch(j){}g||(i=function(a){for(var b=new Array(a.length),c=a.length;c--;)b[c]=a[c];return b});var k;k=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(a,b){var c=fabric.document.defaultView.getComputedStyle(a,null);return c?c[b]:void 0}:function(a,b){var c=a.style[b];return!c&&a.currentStyle&&(c=a.currentStyle[b]),c},function(){function a(a){return"undefined"!=typeof a.onselectstart&&(a.onselectstart=fabric.util.falseFunction),d?a.style[d]="none":"string"==typeof a.unselectable&&(a.unselectable="on"),a}function b(a){return"undefined"!=typeof a.onselectstart&&(a.onselectstart=null),d?a.style[d]="":"string"==typeof a.unselectable&&(a.unselectable=""),a}var c=fabric.document.documentElement.style,d="userSelect"in c?"userSelect":"MozUserSelect"in c?"MozUserSelect":"WebkitUserSelect"in c?"WebkitUserSelect":"KhtmlUserSelect"in c?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=a,fabric.util.makeElementSelectable=b}(),function(){function a(a,b){var c=fabric.document.getElementsByTagName("head")[0],d=fabric.document.createElement("script"),e=!0;d.onload=d.onreadystatechange=function(a){if(e){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;e=!1,b(a||fabric.window.event),d=d.onload=d.onreadystatechange=null}},d.src=a,c.appendChild(d)}fabric.util.getScript=a}(),fabric.util.getById=a,fabric.util.toArray=i,fabric.util.makeElement=b,fabric.util.addClass=c,fabric.util.wrapElement=d,fabric.util.getScrollLeftTop=e,fabric.util.getElementOffset=f,fabric.util.getElementStyle=k}(),function(){function a(a,b){return a+(/\?/.test(a)?"&":"?")+b}function b(){}function c(c,e){e||(e={});var f=e.method?e.method.toUpperCase():"GET",g=e.onComplete||function(){},h=d(),i=e.body||e.parameters;return h.onreadystatechange=function(){4===h.readyState&&(g(h),h.onreadystatechange=b)},"GET"===f&&(i=null,"string"==typeof e.parameters&&(c=a(c,e.parameters))),h.open(f,c,!0),("POST"===f||"PUT"===f)&&h.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),h.send(i),h}var d=function(){for(var a=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],b=a.length;b--;)try{var c=a[b]();if(c)return a[b]}catch(d){}}();fabric.util.request=c}(),fabric.log=function(){},fabric.warn=function(){},"undefined"!=typeof console&&["log","warn"].forEach(function(a){"undefined"!=typeof console[a]&&"function"==typeof console[a].apply&&(fabric[a]=function(){return console[a].apply(console,arguments)})}),function(){function a(a){b(function(c){a||(a={});var d,e=c||+new Date,f=a.duration||500,g=e+f,h=a.onChange||function(){},i=a.abort||function(){return!1},j=a.easing||function(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b},k="startValue"in a?a.startValue:0,l="endValue"in a?a.endValue:100,m=a.byValue||l-k;a.onStart&&a.onStart(),function n(c){d=c||+new Date;var l=d>g?f:d-e;return i()?void(a.onComplete&&a.onComplete()):(h(j(l,k,m,f)),d>g?void(a.onComplete&&a.onComplete()):void b(n))}(e)})}function b(){return c.apply(fabric.window,arguments)}var c=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(a){fabric.window.setTimeout(a,1e3/60)};fabric.util.animate=a,fabric.util.requestAnimFrame=b}(),function(){function a(a,b,c,d){return a<Math.abs(b)?(a=b,d=c/4):d=0===b&&0===a?c/(2*Math.PI)*Math.asin(1):c/(2*Math.PI)*Math.asin(b/a),{a:a,c:b,p:c,s:d}}function b(a,b,c){return a.a*Math.pow(2,10*(b-=1))*Math.sin(2*(b*c-a.s)*Math.PI/a.p)}function c(a,b,c,d){return c*((a=a/d-1)*a*a+1)+b}function d(a,b,c,d){return a/=d/2,1>a?c/2*a*a*a+b:c/2*((a-=2)*a*a+2)+b}function e(a,b,c,d){return c*(a/=d)*a*a*a+b}function f(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b}function g(a,b,c,d){return a/=d/2,1>a?c/2*a*a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b}function h(a,b,c,d){return c*(a/=d)*a*a*a*a+b}function i(a,b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b}function j(a,b,c,d){return a/=d/2,1>a?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b}function k(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b}function l(a,b,c,d){return c*Math.sin(a/d*(Math.PI/2))+b}function m(a,b,c,d){return-c/2*(Math.cos(Math.PI*a/d)-1)+b}function n(a,b,c,d){return 0===a?b:c*Math.pow(2,10*(a/d-1))+b}function o(a,b,c,d){return a===d?b+c:c*(-Math.pow(2,-10*a/d)+1)+b}function p(a,b,c,d){return 0===a?b:a===d?b+c:(a/=d/2,1>a?c/2*Math.pow(2,10*(a-1))+b:c/2*(-Math.pow(2,-10*--a)+2)+b)}function q(a,b,c,d){return-c*(Math.sqrt(1-(a/=d)*a)-1)+b}function r(a,b,c,d){return c*Math.sqrt(1-(a=a/d-1)*a)+b}function s(a,b,c,d){return a/=d/2,1>a?-c/2*(Math.sqrt(1-a*a)-1)+b:c/2*(Math.sqrt(1-(a-=2)*a)+1)+b}function t(c,d,e,f){var g=1.70158,h=0,i=e;if(0===c)return d;if(c/=f,1===c)return d+e;h||(h=.3*f);var j=a(i,e,h,g);return-b(j,c,f)+d}function u(b,c,d,e){var f=1.70158,g=0,h=d;if(0===b)return c;if(b/=e,1===b)return c+d;g||(g=.3*e);var i=a(h,d,g,f);return i.a*Math.pow(2,-10*b)*Math.sin(2*(b*e-i.s)*Math.PI/i.p)+i.c+c}function v(c,d,e,f){var g=1.70158,h=0,i=e;if(0===c)return d;if(c/=f/2,2===c)return d+e;h||(h=.3*f*1.5);var j=a(i,e,h,g);return 1>c?-.5*b(j,c,f)+d:j.a*Math.pow(2,-10*(c-=1))*Math.sin(2*(c*f-j.s)*Math.PI/j.p)*.5+j.c+d}function w(a,b,c,d,e){return void 0===e&&(e=1.70158),c*(a/=d)*a*((e+1)*a-e)+b}function x(a,b,c,d,e){return void 0===e&&(e=1.70158),c*((a=a/d-1)*a*((e+1)*a+e)+1)+b}function y(a,b,c,d,e){return void 0===e&&(e=1.70158),a/=d/2,1>a?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b}function z(a,b,c,d){return c-A(d-a,0,c,d)+b}function A(a,b,c,d){return(a/=d)<1/2.75?7.5625*c*a*a+b:2/2.75>a?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:2.5/2.75>a?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b}function B(a,b,c,d){return d/2>a?.5*z(2*a,0,c,d)+b:.5*A(2*a-d,0,c,d)+.5*c+b}fabric.util.ease={easeInQuad:function(a,b,c,d){return c*(a/=d)*a+b},easeOutQuad:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeInOutQuad:function(a,b,c,d){return a/=d/2,1>a?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},easeInCubic:function(a,b,c,d){return c*(a/=d)*a*a+b},easeOutCubic:c,easeInOutCubic:d,easeInQuart:e,easeOutQuart:f,easeInOutQuart:g,easeInQuint:h,easeOutQuint:i,easeInOutQuint:j,easeInSine:k,easeOutSine:l,easeInOutSine:m,easeInExpo:n,easeOutExpo:o,easeInOutExpo:p,easeInCirc:q,easeOutCirc:r,easeInOutCirc:s,easeInElastic:t,easeOutElastic:u,easeInOutElastic:v,easeInBack:w,easeOutBack:x,easeInOutBack:y,easeInBounce:z,easeOutBounce:A,easeInOutBounce:B}}(),function(a){"use strict";function b(a){return a in B?B[a]:a}function c(a,b,c,d){var e,f="[object Array]"===Object.prototype.toString.call(b);return"fill"!==a&&"stroke"!==a||"none"!==b?"strokeDashArray"===a?b="none"===b?null:b.replace(/,/g," ").split(/\s+/).map(function(a){return parseFloat(a)}):"transformMatrix"===a?b=c&&c.transformMatrix?w(c.transformMatrix,q.parseTransformAttribute(b)):q.parseTransformAttribute(b):"visible"===a?(b="none"===b||"hidden"===b?!1:!0,c&&c.visible===!1&&(b=!1)):"originX"===a?b="start"===b?"left":"end"===b?"right":"center":e=f?b.map(v):v(b,d):b="",!f&&isNaN(e)?b:e}function d(a){for(var b in C)if("undefined"!=typeof a[C[b]]&&""!==a[b]){if("undefined"==typeof a[b]){if(!q.Object.prototype[b])continue;a[b]=q.Object.prototype[b]}if(0!==a[b].indexOf("url(")){var c=new q.Color(a[b]);a[b]=c.setAlpha(u(c.getAlpha()*a[C[b]],2)).toRgba()}}return a}function e(a,b){for(var c,d,e=[],f=0;f<b.length;f++)c=b[f],d=a.getElementsByTagName(c),e=e.concat(Array.prototype.slice.call(d));return e}function f(a,d){var e,f;a.replace(/;\s*$/,"").split(";").forEach(function(a){var g=a.split(":");e=b(g[0].trim().toLowerCase()),f=c(e,g[1].trim()),d[e]=f})}function g(a,d){var e,f;for(var g in a)"undefined"!=typeof a[g]&&(e=b(g.toLowerCase()),f=c(e,a[g]),d[e]=f)}function h(a,b){var c={};for(var d in q.cssRules[b])if(i(a,d.split(" ")))for(var e in q.cssRules[b][d])c[e]=q.cssRules[b][d][e];return c}function i(a,b){var c,d=!0;return c=k(a,b.pop()),c&&b.length&&(d=j(a,b)),c&&d&&0===b.length}function j(a,b){for(var c,d=!0;a.parentNode&&1===a.parentNode.nodeType&&b.length;)d&&(c=b.pop()),a=a.parentNode,d=k(a,c);return 0===b.length}function k(a,b){var c,d=a.nodeName,e=a.getAttribute("class"),f=a.getAttribute("id");if(c=new RegExp("^"+d,"i"),b=b.replace(c,""),f&&b.length&&(c=new RegExp("#"+f+"(?![a-zA-Z\\-]+)","i"),b=b.replace(c,"")),e&&b.length){e=e.split(" ");for(var g=e.length;g--;)c=new RegExp("\\."+e[g]+"(?![a-zA-Z\\-]+)","i"),b=b.replace(c,"")}return 0===b.length}function l(a,b){var c;if(a.getElementById&&(c=a.getElementById(b)),c)return c;var d,e,f=a.getElementsByTagName("*");for(e=0;e<f.length;e++)if(d=f[e],b===d.getAttribute("id"))return d}function m(a){for(var b=e(a,["use","svg:use"]),c=0;b.length&&c<b.length;){var d,f,g,h,i,j=b[c],k=j.getAttribute("xlink:href").substr(1),m=j.getAttribute("x")||0,o=j.getAttribute("y")||0,p=l(a,k).cloneNode(!0),q=(p.getAttribute("transform")||"")+" translate("+m+", "+o+")",r=b.length;if(n(p),/^svg$/i.test(p.nodeName)){var s=p.ownerDocument.createElement("g");for(g=0,h=p.attributes,i=h.length;i>g;g++)f=h.item(g),s.setAttribute(f.nodeName,f.nodeValue);for(;p.firstChild;)s.appendChild(p.firstChild);p=s}for(g=0,h=j.attributes,i=h.length;i>g;g++)f=h.item(g),"x"!==f.nodeName&&"y"!==f.nodeName&&"xlink:href"!==f.nodeName&&("transform"===f.nodeName?q=f.nodeValue+" "+q:p.setAttribute(f.nodeName,f.nodeValue));p.setAttribute("transform",q),p.setAttribute("instantiated_by_use","1"),p.removeAttribute("id"),d=j.parentNode,d.replaceChild(p,j),b.length===r&&c++}}function n(a){var b,c,d,e,f=a.getAttribute("viewBox"),g=1,h=1,i=0,j=0,k=a.getAttribute("width"),l=a.getAttribute("height"),m=a.getAttribute("x")||0,n=a.getAttribute("y")||0,o=a.getAttribute("preserveAspectRatio")||"",p=!f||!y.test(a.nodeName)||!(f=f.match(D)),r=!k||!l||"100%"===k||"100%"===l,s=p&&r,t={},u="";if(t.width=0,t.height=0,t.toBeParsed=s,s)return t;if(p)return t.width=v(k),t.height=v(l),t;if(i=-parseFloat(f[1]),j=-parseFloat(f[2]),b=parseFloat(f[3]),c=parseFloat(f[4]),r?(t.width=b,t.height=c):(t.width=v(k),t.height=v(l),g=t.width/b,h=t.height/c),o=q.util.parsePreserveAspectRatioAttribute(o),"none"!==o.alignX&&(h=g=g>h?h:g),1===g&&1===h&&0===i&&0===j&&0===m&&0===n)return t;if((m||n)&&(u=" translate("+v(m)+" "+v(n)+") "),d=u+" matrix("+g+" 0 0 "+h+" "+i*g+" "+j*h+") ","svg"===a.nodeName){for(e=a.ownerDocument.createElement("g");a.firstChild;)e.appendChild(a.firstChild);a.appendChild(e)}else e=a,d=e.getAttribute("transform")+d;return e.setAttribute("transform",d),t}function o(a){var b=a.objects,c=a.options;return b=b.map(function(a){return q[s(a.type)].fromObject(a)}),{objects:b,options:c}}function p(a,b,c){b[c]&&b[c].toSVG&&a.push('	<pattern x="0" y="0" id="',c,'Pattern" ','width="',b[c].source.width,'" height="',b[c].source.height,'" patternUnits="userSpaceOnUse">\n','		<image x="0" y="0" ','width="',b[c].source.width,'" height="',b[c].source.height,'" xlink:href="',b[c].source.src,'"></image>\n	</pattern>\n')}var q=a.fabric||(a.fabric={}),r=q.util.object.extend,s=q.util.string.capitalize,t=q.util.object.clone,u=q.util.toFixed,v=q.util.parseUnit,w=q.util.multiplyTransformMatrices,x=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/i,y=/^(symbol|image|marker|pattern|view|svg)$/i,z=/^(?:pattern|defs|symbol|metadata)$/i,A=/^(symbol|g|a|svg)$/i,B={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},C={stroke:"strokeOpacity",fill:"fillOpacity"};q.cssRules={},q.gradientDefs={},q.parseTransformAttribute=function(){function a(a,b){var c=b[0],d=3===b.length?b[1]:0,e=3===b.length?b[2]:0;a[0]=Math.cos(c),a[1]=Math.sin(c),a[2]=-Math.sin(c),a[3]=Math.cos(c),a[4]=d-(a[0]*d+a[2]*e),a[5]=e-(a[1]*d+a[3]*e)}function b(a,b){var c=b[0],d=2===b.length?b[1]:b[0];a[0]=c,a[3]=d}function c(a,b){
a[2]=Math.tan(q.util.degreesToRadians(b[0]))}function d(a,b){a[1]=Math.tan(q.util.degreesToRadians(b[0]))}function e(a,b){a[4]=b[0],2===b.length&&(a[5]=b[1])}var f=[1,0,0,1,0,0],g=q.reNum,h="(?:\\s+,?\\s*|,\\s*)",i="(?:(skewX)\\s*\\(\\s*("+g+")\\s*\\))",j="(?:(skewY)\\s*\\(\\s*("+g+")\\s*\\))",k="(?:(rotate)\\s*\\(\\s*("+g+")(?:"+h+"("+g+")"+h+"("+g+"))?\\s*\\))",l="(?:(scale)\\s*\\(\\s*("+g+")(?:"+h+"("+g+"))?\\s*\\))",m="(?:(translate)\\s*\\(\\s*("+g+")(?:"+h+"("+g+"))?\\s*\\))",n="(?:(matrix)\\s*\\(\\s*("+g+")"+h+"("+g+")"+h+"("+g+")"+h+"("+g+")"+h+"("+g+")"+h+"("+g+")\\s*\\))",o="(?:"+n+"|"+m+"|"+l+"|"+k+"|"+i+"|"+j+")",p="(?:"+o+"(?:"+h+"*"+o+")*)",r="^\\s*(?:"+p+"?)\\s*$",s=new RegExp(r),t=new RegExp(o,"g");return function(g){var h=f.concat(),i=[];if(!g||g&&!s.test(g))return h;g.replace(t,function(g){var j=new RegExp(o).exec(g).filter(function(a){return!!a}),k=j[1],l=j.slice(2).map(parseFloat);switch(k){case"translate":e(h,l);break;case"rotate":l[0]=q.util.degreesToRadians(l[0]),a(h,l);break;case"scale":b(h,l);break;case"skewX":c(h,l);break;case"skewY":d(h,l);break;case"matrix":h=l}i.push(h.concat()),h=f.concat()});for(var j=i[0];i.length>1;)i.shift(),j=q.util.multiplyTransformMatrices(j,i[0]);return j}}();var D=new RegExp("^\\s*("+q.reNum+"+)\\s*,?\\s*("+q.reNum+"+)\\s*,?\\s*("+q.reNum+"+)\\s*,?\\s*("+q.reNum+"+)\\s*$");q.parseSVGDocument=function(){function a(a,b){for(;a&&(a=a.parentNode);)if(a.nodeName&&b.test(a.nodeName.replace("svg:",""))&&!a.getAttribute("instantiated_by_use"))return!0;return!1}return function(b,c,d){if(b){m(b);var e=new Date,f=q.Object.__uid++,g=n(b),h=q.util.toArray(b.getElementsByTagName("*"));if(g.svgUid=f,0===h.length&&q.isLikelyNode){h=b.selectNodes('//*[name(.)!="svg"]');for(var i=[],j=0,k=h.length;k>j;j++)i[j]=h[j];h=i}var l=h.filter(function(b){return n(b),x.test(b.nodeName.replace("svg:",""))&&!a(b,z)});if(!l||l&&!l.length)return void(c&&c([],{}));q.gradientDefs[f]=q.getGradientDefs(b),q.cssRules[f]=q.getCSSRules(b),q.parseElements(l,function(a){q.documentParsingTime=new Date-e,c&&c(a,g)},t(g),d)}}}();var E={has:function(a,b){b(!1)},get:function(){},set:function(){}},F=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+q.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+q.reNum+"))?\\s+(.*)");r(q,{parseFontDeclaration:function(a,b){var c=a.match(F);if(c){var d=c[1],e=c[3],f=c[4],g=c[5],h=c[6];d&&(b.fontStyle=d),e&&(b.fontWeight=isNaN(parseFloat(e))?e:parseFloat(e)),f&&(b.fontSize=v(f)),h&&(b.fontFamily=h),g&&(b.lineHeight="normal"===g?1:g)}},getGradientDefs:function(a){var b,c,d,f=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],g=e(a,f),h=0,i={},j={};for(h=g.length;h--;)b=g[h],d=b.getAttribute("xlink:href"),c=b.getAttribute("id"),d&&(j[c]=d.substr(1)),i[c]=b;for(c in j){var k=i[j[c]].cloneNode(!0);for(b=i[c];k.firstChild;)b.appendChild(k.firstChild)}return i},parseAttributes:function(a,e,f){if(a){var g,i,j={};"undefined"==typeof f&&(f=a.getAttribute("svgUid")),a.parentNode&&A.test(a.parentNode.nodeName)&&(j=q.parseAttributes(a.parentNode,e,f)),i=j&&j.fontSize||a.getAttribute("font-size")||q.Text.DEFAULT_SVG_FONT_SIZE;var k=e.reduce(function(d,e){return g=a.getAttribute(e),g&&(e=b(e),g=c(e,g,j,i),d[e]=g),d},{});return k=r(k,r(h(a,f),q.parseStyleAttribute(a))),k.font&&q.parseFontDeclaration(k.font,k),d(r(j,k))}},parseElements:function(a,b,c,d){new q.ElementsParser(a,b,c,d).parse()},parseStyleAttribute:function(a){var b={},c=a.getAttribute("style");return c?("string"==typeof c?f(c,b):g(c,b),b):b},parsePointsAttribute:function(a){if(!a)return null;a=a.replace(/,/g," ").trim(),a=a.split(/\s+/);var b,c,d=[];for(b=0,c=a.length;c>b;b+=2)d.push({x:parseFloat(a[b]),y:parseFloat(a[b+1])});return d},getCSSRules:function(a){for(var d,e=a.getElementsByTagName("style"),f={},g=0,h=e.length;h>g;g++){var i=e[g].textContent||e[g].text;i=i.replace(/\/\*[\s\S]*?\*\//g,""),""!==i.trim()&&(d=i.match(/[^{]*\{[\s\S]*?\}/g),d=d.map(function(a){return a.trim()}),d.forEach(function(a){for(var d=a.match(/([\s\S]*?)\s*\{([^}]*)\}/),e={},g=d[2].trim(),h=g.replace(/;$/,"").split(/\s*;\s*/),i=0,j=h.length;j>i;i++){var k=h[i].split(/\s*:\s*/),l=b(k[0]),m=c(l,k[1],k[0]);e[l]=m}a=d[1],a.split(",").forEach(function(a){a=a.replace(/^svg/i,"").trim(),""!==a&&(f[a]?q.util.object.extend(f[a],e):f[a]=q.util.object.clone(e))})}))}return f},loadSVGFromURL:function(a,b,c){function d(d){var e=d.responseXML;e&&!e.documentElement&&q.window.ActiveXObject&&d.responseText&&(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(d.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),e&&e.documentElement||b&&b(null),q.parseSVGDocument(e.documentElement,function(c,d){E.set(a,{objects:q.util.array.invoke(c,"toObject"),options:d}),b&&b(c,d)},c)}a=a.replace(/^\n\s*/,"").trim(),E.has(a,function(c){c?E.get(a,function(a){var c=o(a);b(c.objects,c.options)}):new q.util.request(a,{method:"get",onComplete:d})})},loadSVGFromString:function(a,b,c){a=a.trim();var d;if("undefined"!=typeof DOMParser){var e=new DOMParser;e&&e.parseFromString&&(d=e.parseFromString(a,"text/xml"))}else q.window.ActiveXObject&&(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(a.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));q.parseSVGDocument(d.documentElement,function(a,c){b(a,c)},c)},createSVGFontFacesMarkup:function(a){for(var b,c,d,e,f,g,h,i="",j={},k=q.fontPaths,l=0,m=a.length;m>l;l++)if(b=a[l],c=b.fontFamily,-1!==b.type.indexOf("text")&&!j[c]&&k[c]&&(j[c]=!0,b.styles)){d=b.styles;for(f in d){e=d[f];for(h in e)g=e[h],c=g.fontFamily,!j[c]&&k[c]&&(j[c]=!0)}}for(var n in j)i+=["		@font-face {\n","			font-family: '",n,"';\n","			src: url('",k[n],"');\n","		}\n"].join("");return i&&(i=['	<style type="text/css">',"<![CDATA[\n",i,"]]>","</style>\n"].join("")),i},createSVGRefElementsMarkup:function(a){var b=[];return p(b,a,"backgroundColor"),p(b,a,"overlayColor"),b.join("")}})}("undefined"!=typeof exports?exports:this),fabric.ElementsParser=function(a,b,c,d){this.elements=a,this.callback=b,this.options=c,this.reviver=d,this.svgUid=c&&c.svgUid||0},fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},fabric.ElementsParser.prototype.createObjects=function(){for(var a=0,b=this.elements.length;b>a;a++)this.elements[a].setAttribute("svgUid",this.svgUid),function(a,b){setTimeout(function(){a.createObject(a.elements[b],b)},0)}(this,a)},fabric.ElementsParser.prototype.createObject=function(a,b){var c=fabric[fabric.util.string.capitalize(a.tagName.replace("svg:",""))];if(c&&c.fromElement)try{this._createObject(c,a,b)}catch(d){fabric.log(d)}else this.checkIfDone()},fabric.ElementsParser.prototype._createObject=function(a,b,c){if(a.async)a.fromElement(b,this.createCallback(c,b),this.options);else{var d=a.fromElement(b,this.options);this.resolveGradient(d,"fill"),this.resolveGradient(d,"stroke"),this.reviver&&this.reviver(b,d),this.instances[c]=d,this.checkIfDone()}},fabric.ElementsParser.prototype.createCallback=function(a,b){var c=this;return function(d){c.resolveGradient(d,"fill"),c.resolveGradient(d,"stroke"),c.reviver&&c.reviver(b,d),c.instances[a]=d,c.checkIfDone()}},fabric.ElementsParser.prototype.resolveGradient=function(a,b){var c=a.get(b);if(/^url\(/.test(c)){var d=c.slice(5,c.length-1);fabric.gradientDefs[this.svgUid][d]&&a.set(b,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][d],a))}},fabric.ElementsParser.prototype.checkIfDone=function(){0===--this.numElements&&(this.instances=this.instances.filter(function(a){return null!=a}),this.callback(this.instances))},function(a){"use strict";function b(a,b){this.x=a,this.y=b}var c=a.fabric||(a.fabric={});return c.Point?void c.warn("fabric.Point is already defined"):(c.Point=b,void(b.prototype={type:"point",constructor:b,add:function(a){return new b(this.x+a.x,this.y+a.y)},addEquals:function(a){return this.x+=a.x,this.y+=a.y,this},scalarAdd:function(a){return new b(this.x+a,this.y+a)},scalarAddEquals:function(a){return this.x+=a,this.y+=a,this},subtract:function(a){return new b(this.x-a.x,this.y-a.y)},subtractEquals:function(a){return this.x-=a.x,this.y-=a.y,this},scalarSubtract:function(a){return new b(this.x-a,this.y-a)},scalarSubtractEquals:function(a){return this.x-=a,this.y-=a,this},multiply:function(a){return new b(this.x*a,this.y*a)},multiplyEquals:function(a){return this.x*=a,this.y*=a,this},divide:function(a){return new b(this.x/a,this.y/a)},divideEquals:function(a){return this.x/=a,this.y/=a,this},eq:function(a){return this.x===a.x&&this.y===a.y},lt:function(a){return this.x<a.x&&this.y<a.y},lte:function(a){return this.x<=a.x&&this.y<=a.y},gt:function(a){return this.x>a.x&&this.y>a.y},gte:function(a){return this.x>=a.x&&this.y>=a.y},lerp:function(a,c){return"undefined"==typeof c&&(c=.5),c=Math.max(Math.min(1,c),0),new b(this.x+(a.x-this.x)*c,this.y+(a.y-this.y)*c)},distanceFrom:function(a){var b=this.x-a.x,c=this.y-a.y;return Math.sqrt(b*b+c*c)},midPointFrom:function(a){return this.lerp(a)},min:function(a){return new b(Math.min(this.x,a.x),Math.min(this.y,a.y))},max:function(a){return new b(Math.max(this.x,a.x),Math.max(this.y,a.y))},toString:function(){return this.x+","+this.y},setXY:function(a,b){return this.x=a,this.y=b,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setFromPoint:function(a){return this.x=a.x,this.y=a.y,this},swap:function(a){var b=this.x,c=this.y;this.x=a.x,this.y=a.y,a.x=b,a.y=c},clone:function(){return new b(this.x,this.y)}}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";function b(a){this.status=a,this.points=[]}var c=a.fabric||(a.fabric={});return c.Intersection?void c.warn("fabric.Intersection is already defined"):(c.Intersection=b,c.Intersection.prototype={constructor:b,appendPoint:function(a){return this.points.push(a),this},appendPoints:function(a){return this.points=this.points.concat(a),this}},c.Intersection.intersectLineLine=function(a,d,e,f){var g,h=(f.x-e.x)*(a.y-e.y)-(f.y-e.y)*(a.x-e.x),i=(d.x-a.x)*(a.y-e.y)-(d.y-a.y)*(a.x-e.x),j=(f.y-e.y)*(d.x-a.x)-(f.x-e.x)*(d.y-a.y);if(0!==j){var k=h/j,l=i/j;k>=0&&1>=k&&l>=0&&1>=l?(g=new b("Intersection"),g.appendPoint(new c.Point(a.x+k*(d.x-a.x),a.y+k*(d.y-a.y)))):g=new b}else g=new b(0===h||0===i?"Coincident":"Parallel");return g},c.Intersection.intersectLinePolygon=function(a,c,d){for(var e,f,g,h=new b,i=d.length,j=0;i>j;j++)e=d[j],f=d[(j+1)%i],g=b.intersectLineLine(a,c,e,f),h.appendPoints(g.points);return h.points.length>0&&(h.status="Intersection"),h},c.Intersection.intersectPolygonPolygon=function(a,c){for(var d=new b,e=a.length,f=0;e>f;f++){var g=a[f],h=a[(f+1)%e],i=b.intersectLinePolygon(g,h,c);d.appendPoints(i.points)}return d.points.length>0&&(d.status="Intersection"),d},void(c.Intersection.intersectPolygonRectangle=function(a,d,e){var f=d.min(e),g=d.max(e),h=new c.Point(g.x,f.y),i=new c.Point(f.x,g.y),j=b.intersectLinePolygon(f,h,a),k=b.intersectLinePolygon(h,g,a),l=b.intersectLinePolygon(g,i,a),m=b.intersectLinePolygon(i,f,a),n=new b;return n.appendPoints(j.points),n.appendPoints(k.points),n.appendPoints(l.points),n.appendPoints(m.points),n.points.length>0&&(n.status="Intersection"),n}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";function b(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}function c(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a}var d=a.fabric||(a.fabric={});return d.Color?void d.warn("fabric.Color is already defined."):(d.Color=b,d.Color.prototype={_tryParsingColor:function(a){var c;a in b.colorNameMap&&(a=b.colorNameMap[a]),"transparent"===a&&(c=[255,255,255,0]),c||(c=b.sourceFromHex(a)),c||(c=b.sourceFromRgb(a)),c||(c=b.sourceFromHsl(a)),c||(c=[0,0,0,1]),c&&this.setSource(c)},_rgbToHsl:function(a,b,c){a/=255,b/=255,c/=255;var e,f,g,h=d.util.array.max([a,b,c]),i=d.util.array.min([a,b,c]);if(g=(h+i)/2,h===i)e=f=0;else{var j=h-i;switch(f=g>.5?j/(2-h-i):j/(h+i),h){case a:e=(b-c)/j+(c>b?6:0);break;case b:e=(c-a)/j+2;break;case c:e=(a-b)/j+4}e/=6}return[Math.round(360*e),Math.round(100*f),Math.round(100*g)]},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+","+a[2]+")"},toRgba:function(){var a=this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+b[0]+","+b[1]+"%,"+b[2]+"%)"},toHsla:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+b[0]+","+b[1]+"%,"+b[2]+"%,"+a[3]+")"},toHex:function(){var a,b,c,d=this.getSource();return a=d[0].toString(16),a=1===a.length?"0"+a:a,b=d[1].toString(16),b=1===b.length?"0"+b:b,c=d[2].toString(16),c=1===c.length?"0"+c:c,a.toUpperCase()+b.toUpperCase()+c.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var b=this.getSource();return b[3]=a,this.setSource(b),this},toGrayscale:function(){var a=this.getSource(),b=parseInt((.3*a[0]+.59*a[1]+.11*a[2]).toFixed(0),10),c=a[3];return this.setSource([b,b,b,c]),this},toBlackWhite:function(a){var b=this.getSource(),c=(.3*b[0]+.59*b[1]+.11*b[2]).toFixed(0),d=b[3];return a=a||127,c=Number(c)<Number(a)?0:255,this.setSource([c,c,c,d]),this},overlayWith:function(a){a instanceof b||(a=new b(a));for(var c=[],d=this.getAlpha(),e=.5,f=this.getSource(),g=a.getSource(),h=0;3>h;h++)c.push(Math.round(f[h]*(1-e)+g[h]*e));return c[3]=d,this.setSource(c),this}},d.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,d.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,d.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,d.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",grey:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},d.Color.fromRgb=function(a){return b.fromSource(b.sourceFromRgb(a))},d.Color.sourceFromRgb=function(a){var c=a.match(b.reRGBa);if(c){var d=parseInt(c[1],10)/(/%$/.test(c[1])?100:1)*(/%$/.test(c[1])?255:1),e=parseInt(c[2],10)/(/%$/.test(c[2])?100:1)*(/%$/.test(c[2])?255:1),f=parseInt(c[3],10)/(/%$/.test(c[3])?100:1)*(/%$/.test(c[3])?255:1);return[parseInt(d,10),parseInt(e,10),parseInt(f,10),c[4]?parseFloat(c[4]):1]}},d.Color.fromRgba=b.fromRgb,d.Color.fromHsl=function(a){return b.fromSource(b.sourceFromHsl(a))},d.Color.sourceFromHsl=function(a){var d=a.match(b.reHSLa);if(d){var e,f,g,h=(parseFloat(d[1])%360+360)%360/360,i=parseFloat(d[2])/(/%$/.test(d[2])?100:1),j=parseFloat(d[3])/(/%$/.test(d[3])?100:1);if(0===i)e=f=g=j;else{var k=.5>=j?j*(i+1):j+i-j*i,l=2*j-k;e=c(l,k,h+1/3),f=c(l,k,h),g=c(l,k,h-1/3)}return[Math.round(255*e),Math.round(255*f),Math.round(255*g),d[4]?parseFloat(d[4]):1]}},d.Color.fromHsla=b.fromHsl,d.Color.fromHex=function(a){return b.fromSource(b.sourceFromHex(a))},d.Color.sourceFromHex=function(a){if(a.match(b.reHex)){var c=a.slice(a.indexOf("#")+1),d=3===c.length||4===c.length,e=8===c.length||4===c.length,f=d?c.charAt(0)+c.charAt(0):c.substring(0,2),g=d?c.charAt(1)+c.charAt(1):c.substring(2,4),h=d?c.charAt(2)+c.charAt(2):c.substring(4,6),i=e?d?c.charAt(3)+c.charAt(3):c.substring(6,8):"FF";return[parseInt(f,16),parseInt(g,16),parseInt(h,16),parseFloat((parseInt(i,16)/255).toFixed(2))]}},void(d.Color.fromSource=function(a){var c=new b;return c.setSource(a),c}))}("undefined"!=typeof exports?exports:this),function(){function a(a){var b,c,d,e=a.getAttribute("style"),f=a.getAttribute("offset")||0;if(f=parseFloat(f)/(/%$/.test(f)?100:1),f=0>f?0:f>1?1:f,e){var g=e.split(/\s*;\s*/);""===g[g.length-1]&&g.pop();for(var h=g.length;h--;){var i=g[h].split(/\s*:\s*/),j=i[0].trim(),k=i[1].trim();"stop-color"===j?b=k:"stop-opacity"===j&&(d=k)}}return b||(b=a.getAttribute("stop-color")||"rgb(0,0,0)"),d||(d=a.getAttribute("stop-opacity")),b=new fabric.Color(b),c=b.getAlpha(),d=isNaN(parseFloat(d))?1:parseFloat(d),d*=c,{offset:f,color:b.toRgb(),opacity:d}}function b(a){return{x1:a.getAttribute("x1")||0,y1:a.getAttribute("y1")||0,x2:a.getAttribute("x2")||"100%",y2:a.getAttribute("y2")||0}}function c(a){return{x1:a.getAttribute("fx")||a.getAttribute("cx")||"50%",y1:a.getAttribute("fy")||a.getAttribute("cy")||"50%",r1:0,x2:a.getAttribute("cx")||"50%",y2:a.getAttribute("cy")||"50%",r2:a.getAttribute("r")||"50%"}}function d(a,b,c){var d,e=0,f=1,g="";for(var h in b)"Infinity"===b[h]?b[h]=1:"-Infinity"===b[h]&&(b[h]=0),d=parseFloat(b[h],10),f="string"==typeof b[h]&&/^\d+%$/.test(b[h])?.01:1,"x1"===h||"x2"===h||"r2"===h?(f*="objectBoundingBox"===c?a.width:1,e="objectBoundingBox"===c?a.left||0:0):("y1"===h||"y2"===h)&&(f*="objectBoundingBox"===c?a.height:1,e="objectBoundingBox"===c?a.top||0:0),b[h]=d*f+e;if("ellipse"===a.type&&null!==b.r2&&"objectBoundingBox"===c&&a.rx!==a.ry){var i=a.ry/a.rx;g=" scale(1, "+i+")",b.y1&&(b.y1/=i),b.y2&&(b.y2/=i)}return g}fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(a){a||(a={});var b={};this.id=fabric.Object.__uid++,this.type=a.type||"linear",b={x1:a.coords.x1||0,y1:a.coords.y1||0,x2:a.coords.x2||0,y2:a.coords.y2||0},"radial"===this.type&&(b.r1=a.coords.r1||0,b.r2=a.coords.r2||0),this.coords=b,this.colorStops=a.colorStops.slice(),a.gradientTransform&&(this.gradientTransform=a.gradientTransform),this.offsetX=a.offsetX||this.offsetX,this.offsetY=a.offsetY||this.offsetY},addColorStop:function(a){for(var b in a){var c=new fabric.Color(a[b]);this.colorStops.push({offset:b,color:c.toRgb(),opacity:c.getAlpha()})}return this},toObject:function(a){var b={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return fabric.util.populateWithProperties(this,b,a),b},toSVG:function(a){var b,c,d=fabric.util.object.clone(this.coords);if(this.colorStops.sort(function(a,b){return a.offset-b.offset}),!a.group||"path-group"!==a.group.type)for(var e in d)"x1"===e||"x2"===e||"r2"===e?d[e]+=this.offsetX-a.width/2:("y1"===e||"y2"===e)&&(d[e]+=this.offsetY-a.height/2);c='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"',this.gradientTransform&&(c+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" '),"linear"===this.type?b=["<linearGradient ",c,' x1="',d.x1,'" y1="',d.y1,'" x2="',d.x2,'" y2="',d.y2,'">\n']:"radial"===this.type&&(b=["<radialGradient ",c,' cx="',d.x2,'" cy="',d.y2,'" r="',d.r2,'" fx="',d.x1,'" fy="',d.y1,'">\n']);for(var f=0;f<this.colorStops.length;f++)b.push("<stop ",'offset="',100*this.colorStops[f].offset+"%",'" style="stop-color:',this.colorStops[f].color,null!==this.colorStops[f].opacity?";stop-opacity: "+this.colorStops[f].opacity:";",'"/>\n');return b.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),b.join("")},toLive:function(a,b){var c,d,e=fabric.util.object.clone(this.coords);if(this.type){if(b.group&&"path-group"===b.group.type)for(d in e)"x1"===d||"x2"===d?e[d]+=-this.offsetX+b.width/2:("y1"===d||"y2"===d)&&(e[d]+=-this.offsetY+b.height/2);"linear"===this.type?c=a.createLinearGradient(e.x1,e.y1,e.x2,e.y2):"radial"===this.type&&(c=a.createRadialGradient(e.x1,e.y1,e.r1,e.x2,e.y2,e.r2));for(var f=0,g=this.colorStops.length;g>f;f++){var h=this.colorStops[f].color,i=this.colorStops[f].opacity,j=this.colorStops[f].offset;"undefined"!=typeof i&&(h=new fabric.Color(h).setAlpha(i).toRgba()),c.addColorStop(parseFloat(j),h)}return c}}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(e,f){var g,h,i,j=e.getElementsByTagName("stop"),k=e.getAttribute("gradientUnits")||"objectBoundingBox",l=e.getAttribute("gradientTransform"),m=[];g="linearGradient"===e.nodeName||"LINEARGRADIENT"===e.nodeName?"linear":"radial","linear"===g?h=b(e):"radial"===g&&(h=c(e));for(var n=j.length;n--;)m.push(a(j[n]));i=d(f,h,k);var o=new fabric.Gradient({type:g,coords:h,colorStops:m,offsetX:-f.left,offsetY:-f.top});return(l||""!==i)&&(o.gradientTransform=fabric.parseTransformAttribute((l||"")+i)),o},forObject:function(a,b){return b||(b={}),d(a,b.coords,"userSpaceOnUse"),new fabric.Gradient(b)}})}(),fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(a){if(a||(a={}),this.id=fabric.Object.__uid++,a.source)if("string"==typeof a.source)if("undefined"!=typeof fabric.util.getFunctionBody(a.source))this.source=new Function(fabric.util.getFunctionBody(a.source));else{var b=this;this.source=fabric.util.createImage(),fabric.util.loadImage(a.source,function(a){b.source=a})}else this.source=a.source;a.repeat&&(this.repeat=a.repeat),a.offsetX&&(this.offsetX=a.offsetX),a.offsetY&&(this.offsetY=a.offsetY)},toObject:function(a){var b,c;return"function"==typeof this.source?b=String(this.source):"string"==typeof this.source.src?b=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(b=this.source.toDataURL()),c={source:b,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY},fabric.util.populateWithProperties(this,c,a),c},toSVG:function(a){var b="function"==typeof this.source?this.source():this.source,c=b.width/a.getWidth(),d=b.height/a.getHeight(),e=this.offsetX/a.getWidth(),f=this.offsetY/a.getHeight(),g="";return("repeat-x"===this.repeat||"no-repeat"===this.repeat)&&(d=1),("repeat-y"===this.repeat||"no-repeat"===this.repeat)&&(c=1),b.src?g=b.src:b.toDataURL&&(g=b.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+e+'" y="'+f+'" width="'+c+'" height="'+d+'">\n<image x="0" y="0" width="'+b.width+'" height="'+b.height+'" xlink:href="'+g+'"></image>\n</pattern>\n'},toLive:function(a){var b="function"==typeof this.source?this.source():this.source;if(!b)return"";if("undefined"!=typeof b.src){if(!b.complete)return"";if(0===b.naturalWidth||0===b.naturalHeight)return""}return a.createPattern(b,this.repeat)}}),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.toFixed;return b.Shadow?void b.warn("fabric.Shadow is already defined."):(b.Shadow=b.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(a){"string"==typeof a&&(a=this._parseShadow(a));for(var c in a)this[c]=a[c];this.id=b.Object.__uid++},_parseShadow:function(a){var c=a.trim(),d=b.Shadow.reOffsetsAndBlur.exec(c)||[],e=c.replace(b.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:e.trim(),offsetX:parseInt(d[1],10)||0,offsetY:parseInt(d[2],10)||0,blur:parseInt(d[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(a){var d=40,e=40,f=b.Object.NUM_FRACTION_DIGITS,g=b.util.rotateVector({x:this.offsetX,y:this.offsetY},b.util.degreesToRadians(-a.angle)),h=20;return a.width&&a.height&&(d=100*c((Math.abs(g.x)+this.blur)/a.width,f)+h,e=100*c((Math.abs(g.y)+this.blur)/a.height,f)+h),a.flipX&&(g.x*=-1),a.flipY&&(g.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+e+'%" height="'+(100+2*e)+'%" x="-'+d+'%" width="'+(100+2*d)+'%" >\n	<feGaussianBlur in="SourceAlpha" stdDeviation="'+c(this.blur?this.blur/2:0,f)+'"></feGaussianBlur>\n	<feOffset dx="'+c(g.x,f)+'" dy="'+c(g.y,f)+'" result="oBlur" ></feOffset>\n	<feFlood flood-color="'+this.color+'"/>\n	<feComposite in2="oBlur" operator="in" />\n	<feMerge>\n		<feMergeNode></feMergeNode>\n		<feMergeNode in="SourceGraphic"></feMergeNode>\n	</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke};var a={},c=b.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke"].forEach(function(b){this[b]!==c[b]&&(a[b]=this[b])},this),a}}),void(b.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/))}("undefined"!=typeof exports?exports:this),function(){"use strict";if(fabric.StaticCanvas)return void fabric.warn("fabric.StaticCanvas is already defined.");var a=fabric.util.object.extend,b=fabric.util.getElementOffset,c=fabric.util.removeFromArray,d=fabric.util.toFixed,e=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(a,b){b||(b={}),this._initStatic(a,b)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:[1,0,0,1,0,0],backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,_initStatic:function(a,b){var c=fabric.StaticCanvas.prototype.renderAll.bind(this);this._objects=[],this._createLowerCanvas(a),this._initOptions(b),this._setImageSmoothing(),this.interactive||this._initRetinaScaling(),b.overlayImage&&this.setOverlayImage(b.overlayImage,c),b.backgroundImage&&this.setBackgroundImage(b.backgroundImage,c),b.backgroundColor&&this.setBackgroundColor(b.backgroundColor,c),b.overlayColor&&this.setOverlayColor(b.overlayColor,c),this.calcOffset()},_isRetinaScaling:function(){return 1!==fabric.devicePixelRatio&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?fabric.devicePixelRatio:1},_initRetinaScaling:function(){this._isRetinaScaling()&&(this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio))},calcOffset:function(){return this._offset=b(this.lowerCanvasEl),this},setOverlayImage:function(a,b,c){return this.__setBgOverlayImage("overlayImage",a,b,c)},setBackgroundImage:function(a,b,c){return this.__setBgOverlayImage("backgroundImage",a,b,c)},setOverlayColor:function(a,b){return this.__setBgOverlayColor("overlayColor",a,b)},setBackgroundColor:function(a,b){return this.__setBgOverlayColor("backgroundColor",a,b)},_setImageSmoothing:function(){var a=this.getContext();a.imageSmoothingEnabled=a.imageSmoothingEnabled||a.webkitImageSmoothingEnabled||a.mozImageSmoothingEnabled||a.msImageSmoothingEnabled||a.oImageSmoothingEnabled,a.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(a,b,c,d){return"string"==typeof b?fabric.util.loadImage(b,function(b){b&&(this[a]=new fabric.Image(b,d)),c&&c(b)},this,d&&d.crossOrigin):(d&&b.setOptions(d),this[a]=b,c&&c(b)),this},__setBgOverlayColor:function(a,b,c){if(b&&b.source){var d=this;fabric.util.loadImage(b.source,function(e){d[a]=new fabric.Pattern({source:e,repeat:b.repeat,offsetX:b.offsetX,offsetY:b.offsetY}),c&&c()})}else this[a]=b,c&&c();return this},_createCanvasElement:function(a){var b=fabric.util.createCanvasElement(a);if(b.style||(b.style={}),!b)throw e;if("undefined"==typeof b.getContext)throw e;return b},_initOptions:function(a){for(var b in a)this[b]=a[b];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(a){this.lowerCanvasEl=fabric.util.getById(a)||this._createCanvasElement(a),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a,b){return this.setDimensions({width:a},b)},setHeight:function(a,b){return this.setDimensions({height:a},b)},setDimensions:function(a,b){var c;b=b||{};for(var d in a)c=a[d],b.cssOnly||(this._setBackstoreDimension(d,a[d]),c+="px"),b.backstoreOnly||this._setCssDimension(d,c);return this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),b.cssOnly||this.renderAll(),this},_setBackstoreDimension:function(a,b){return this.lowerCanvasEl[a]=b,this.upperCanvasEl&&(this.upperCanvasEl[a]=b),this.cacheCanvasEl&&(this.cacheCanvasEl[a]=b),this[a]=b,this},_setCssDimension:function(a,b){return this.lowerCanvasEl.style[a]=b,this.upperCanvasEl&&(this.upperCanvasEl.style[a]=b),this.wrapperEl&&(this.wrapperEl.style[a]=b),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(a){var b,c=this._activeGroup;this.viewportTransform=a;for(var d=0,e=this._objects.length;e>d;d++)b=this._objects[d],b.group||b.setCoords();return c&&c.setCoords(),this.renderAll(),this},zoomToPoint:function(a,b){var c=a,d=this.viewportTransform.slice(0);a=fabric.util.transformPoint(a,fabric.util.invertTransform(this.viewportTransform)),d[0]=b,d[3]=b;var e=fabric.util.transformPoint(a,d);return d[4]+=c.x-e.x,d[5]+=c.y-e.y,this.setViewportTransform(d)},setZoom:function(a){return this.zoomToPoint(new fabric.Point(0,0),a),this},absolutePan:function(a){var b=this.viewportTransform.slice(0);return b[4]=-a.x,b[5]=-a.y,this.setViewportTransform(b)},relativePan:function(a){return this.absolutePan(new fabric.Point(-a.x-this.viewportTransform[4],-a.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(a){this.stateful&&a.setupState(),a._set("canvas",this),a.setCoords(),this.fire("object:added",{target:a}),a.fire("added")},_onObjectRemoved:function(a){this.fire("object:removed",{target:a}),a.fire("removed"),delete a.canvas},clearContext:function(a){return a.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("selection:cleared",this._canvasITextSelectionClearedHanlder),this.off("object:selected",this._canvasITextSelectionClearedHanlder),this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderAll(),this},renderAll:function(){var a=this.contextContainer;return this.renderCanvas(a,this._objects),this},renderCanvas:function(a,b){this.clearContext(a),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,a),this._renderBackground(a),a.save(),a.transform.apply(a,this.viewportTransform),this._renderObjects(a,b),a.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(a),this.clipTo&&a.restore(),this._renderOverlay(a),this.controlsAboveOverlay&&this.interactive&&this.drawControls(a),this.fire("after:render")},_renderObjects:function(a,b){for(var c=0,d=b.length;d>c;++c)b[c]&&b[c].render(a)},_renderBackgroundOrOverlay:function(a,b){var c=this[b+"Color"];c&&(a.fillStyle=c.toLive?c.toLive(a):c,a.fillRect(c.offsetX||0,c.offsetY||0,this.width,this.height)),c=this[b+"Image"],c&&(this[b+"Vpt"]&&(a.save(),a.transform.apply(a,this.viewportTransform)),c.render(a),this[b+"Vpt"]&&a.restore())},_renderBackground:function(a){this._renderBackgroundOrOverlay(a,"background")},_renderOverlay:function(a){this._renderBackgroundOrOverlay(a,"overlay")},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(a){return this._centerObject(a,new fabric.Point(this.getCenter().left,a.getCenterPoint().y))},centerObjectV:function(a){return this._centerObject(a,new fabric.Point(a.getCenterPoint().x,this.getCenter().top))},centerObject:function(a){var b=this.getCenter();return this._centerObject(a,new fabric.Point(b.left,b.top))},viewportCenterObject:function(a){var b=this.getVpCenter();

return this._centerObject(a,b)},viewportCenterObjectH:function(a){var b=this.getVpCenter();return this._centerObject(a,new fabric.Point(b.x,a.getCenterPoint().y)),this},viewportCenterObjectV:function(a){var b=this.getVpCenter();return this._centerObject(a,new fabric.Point(a.getCenterPoint().x,b.y))},getVpCenter:function(){var a=this.getCenter(),b=fabric.util.invertTransform(this.viewportTransform);return fabric.util.transformPoint({x:a.left,y:a.top},b)},_centerObject:function(a,b){return a.setPositionByOrigin(b,"center","center"),this.renderAll(),this},toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(b,c){var d={objects:this._toObjects(b,c)};return a(d,this.__serializeBgOverlay(b,c)),fabric.util.populateWithProperties(this,d,c),d},_toObjects:function(a,b){return this.getObjects().filter(function(a){return!a.excludeFromExport}).map(function(c){return this._toObject(c,a,b)},this)},_toObject:function(a,b,c){var d;this.includeDefaultValues||(d=a.includeDefaultValues,a.includeDefaultValues=!1);var e=a[b](c);return this.includeDefaultValues||(a.includeDefaultValues=d),e},__serializeBgOverlay:function(a,b){var c={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject(b):this.backgroundColor};return this.overlayColor&&(c.overlay=this.overlayColor.toObject?this.overlayColor.toObject(b):this.overlayColor),this.backgroundImage&&(c.backgroundImage=this._toObject(this.backgroundImage,a,b)),this.overlayImage&&(c.overlayImage=this._toObject(this.overlayImage,a,b)),c},svgViewportTransformation:!0,toSVG:function(a,b){a||(a={});var c=[];return this._setSVGPreamble(c,a),this._setSVGHeader(c,a),this._setSVGBgOverlayColor(c,"backgroundColor"),this._setSVGBgOverlayImage(c,"backgroundImage",b),this._setSVGObjects(c,b),this._setSVGBgOverlayColor(c,"overlayColor"),this._setSVGBgOverlayImage(c,"overlayImage",b),c.push("</svg>"),c.join("")},_setSVGPreamble:function(a,b){b.suppressPreamble||a.push('<?xml version="1.0" encoding="',b.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(a,b){var c,e=b.width||this.width,f=b.height||this.height,g='viewBox="0 0 '+this.width+" "+this.height+'" ',h=fabric.Object.NUM_FRACTION_DIGITS;b.viewBox?g='viewBox="'+b.viewBox.x+" "+b.viewBox.y+" "+b.viewBox.width+" "+b.viewBox.height+'" ':this.svgViewportTransformation&&(c=this.viewportTransform,g='viewBox="'+d(-c[4]/c[0],h)+" "+d(-c[5]/c[3],h)+" "+d(this.width/c[0],h)+" "+d(this.height/c[3],h)+'" '),a.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',e,'" ','height="',f,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,g,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",fabric.version,"</desc>\n","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>\n")},_setSVGObjects:function(a,b){for(var c,d=0,e=this.getObjects(),f=e.length;f>d;d++)c=e[d],c.excludeFromExport||this._setSVGObject(a,c,b)},_setSVGObject:function(a,b,c){a.push(b.toSVG(c))},_setSVGBgOverlayImage:function(a,b,c){this[b]&&this[b].toSVG&&a.push(this[b].toSVG(c))},_setSVGBgOverlayColor:function(a,b){this[b]&&this[b].source?a.push('<rect x="',this[b].offsetX,'" y="',this[b].offsetY,'" ','width="',"repeat-y"===this[b].repeat||"no-repeat"===this[b].repeat?this[b].source.width:this.width,'" height="',"repeat-x"===this[b].repeat||"no-repeat"===this[b].repeat?this[b].source.height:this.height,'" fill="url(#'+b+'Pattern)"',"></rect>\n"):this[b]&&"overlayColor"===b&&a.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[b],'"',"></rect>\n")},sendToBack:function(a){if(!a)return this;var b,d,e,f=this._activeGroup;if(a===f)for(e=f._objects,b=e.length;b--;)d=e[b],c(this._objects,d),this._objects.unshift(d);else c(this._objects,a),this._objects.unshift(a);return this.renderAll&&this.renderAll()},bringToFront:function(a){if(!a)return this;var b,d,e,f=this._activeGroup;if(a===f)for(e=f._objects,b=0;b<e.length;b++)d=e[b],c(this._objects,d),this._objects.push(d);else c(this._objects,a),this._objects.push(a);return this.renderAll&&this.renderAll()},sendBackwards:function(a,b){if(!a)return this;var d,e,f,g,h,i=this._activeGroup;if(a===i)for(h=i._objects,d=0;d<h.length;d++)e=h[d],f=this._objects.indexOf(e),0!==f&&(g=f-1,c(this._objects,e),this._objects.splice(g,0,e));else f=this._objects.indexOf(a),0!==f&&(g=this._findNewLowerIndex(a,f,b),c(this._objects,a),this._objects.splice(g,0,a));return this.renderAll&&this.renderAll(),this},_findNewLowerIndex:function(a,b,c){var d;if(c){d=b;for(var e=b-1;e>=0;--e){var f=a.intersectsWithObject(this._objects[e])||a.isContainedWithinObject(this._objects[e])||this._objects[e].isContainedWithinObject(a);if(f){d=e;break}}}else d=b-1;return d},bringForward:function(a,b){if(!a)return this;var d,e,f,g,h,i=this._activeGroup;if(a===i)for(h=i._objects,d=h.length;d--;)e=h[d],f=this._objects.indexOf(e),f!==this._objects.length-1&&(g=f+1,c(this._objects,e),this._objects.splice(g,0,e));else f=this._objects.indexOf(a),f!==this._objects.length-1&&(g=this._findNewUpperIndex(a,f,b),c(this._objects,a),this._objects.splice(g,0,a));return this.renderAll&&this.renderAll(),this},_findNewUpperIndex:function(a,b,c){var d;if(c){d=b;for(var e=b+1;e<this._objects.length;++e){var f=a.intersectsWithObject(this._objects[e])||a.isContainedWithinObject(this._objects[e])||this._objects[e].isContainedWithinObject(a);if(f){d=e;break}}}else d=b+1;return d},moveTo:function(a,b){return c(this._objects,a),this._objects.splice(b,0,a),this.renderAll&&this.renderAll()},dispose:function(){return this.clear(),this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}}),a(fabric.StaticCanvas.prototype,fabric.Observable),a(fabric.StaticCanvas.prototype,fabric.Collection),a(fabric.StaticCanvas.prototype,fabric.DataURLExporter),a(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(a){var b=fabric.util.createCanvasElement();if(!b||!b.getContext)return null;var c=b.getContext("2d");if(!c)return null;switch(a){case"getImageData":return"undefined"!=typeof c.getImageData;case"setLineDash":return"undefined"!=typeof c.setLineDash;case"toDataURL":return"undefined"!=typeof b.toDataURL;case"toDataURLWithQuality":try{return b.toDataURL("image/jpeg",0),!0}catch(d){}return!1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeDashArray:null,setShadow:function(a){return this.shadow=new fabric.Shadow(a),this},_setBrushStyles:function(){var a=this.canvas.contextTop;a.strokeStyle=this.color,a.lineWidth=this.width,a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin,this.strokeDashArray&&fabric.StaticCanvas.supports("setLineDash")&&a.setLineDash(this.strokeDashArray)},_setShadow:function(){if(this.shadow){var a=this.canvas.contextTop,b=this.canvas.getZoom();a.shadowColor=this.shadow.color,a.shadowBlur=this.shadow.blur*b,a.shadowOffsetX=this.shadow.offsetX*b,a.shadowOffsetY=this.shadow.offsetY*b}},_resetShadow:function(){var a=this.canvas.contextTop;a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0}}),function(){fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(a){this.canvas=a,this._points=[]},onMouseDown:function(a){this._prepareForDrawing(a),this._captureDrawingPath(a),this._render()},onMouseMove:function(a){this._captureDrawingPath(a),this.canvas.clearContext(this.canvas.contextTop),this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(a){var b=new fabric.Point(a.x,a.y);this._reset(),this._addPoint(b),this.canvas.contextTop.moveTo(b.x,b.y)},_addPoint:function(a){this._points.push(a)},_reset:function(){this._points.length=0,this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(a){var b=new fabric.Point(a.x,a.y);this._addPoint(b)},_render:function(){var a=this.canvas.contextTop,b=this.canvas.viewportTransform,c=this._points[0],d=this._points[1];a.save(),a.transform(b[0],b[1],b[2],b[3],b[4],b[5]),a.beginPath(),2===this._points.length&&c.x===d.x&&c.y===d.y&&(c.x-=.5,d.x+=.5),a.moveTo(c.x,c.y);for(var e=1,f=this._points.length;f>e;e++){var g=c.midPointFrom(d);a.quadraticCurveTo(c.x,c.y,g.x,g.y),c=this._points[e],d=this._points[e+1]}a.lineTo(c.x,c.y),a.stroke(),a.restore()},convertPointsToSVGPath:function(a){var b=[],c=new fabric.Point(a[0].x,a[0].y),d=new fabric.Point(a[1].x,a[1].y);b.push("M ",a[0].x," ",a[0].y," ");for(var e=1,f=a.length;f>e;e++){var g=c.midPointFrom(d);b.push("Q ",c.x," ",c.y," ",g.x," ",g.y," "),c=new fabric.Point(a[e].x,a[e].y),e+1<a.length&&(d=new fabric.Point(a[e+1].x,a[e+1].y))}return b.push("L ",c.x," ",c.y," "),b},createPath:function(a){var b=new fabric.Path(a,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,b.setShadow(this.shadow)),b},_finalizeAndAddPath:function(){var a=this.canvas.contextTop;a.closePath();var b=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"===b)return void this.canvas.renderAll();var c=this.createPath(b);this.canvas.add(c),c.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:c})}})}(),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(a){this.canvas=a,this.points=[]},drawDot:function(a){var b=this.addPoint(a),c=this.canvas.contextTop,d=this.canvas.viewportTransform;c.save(),c.transform(d[0],d[1],d[2],d[3],d[4],d[5]),c.fillStyle=b.fill,c.beginPath(),c.arc(b.x,b.y,b.radius,0,2*Math.PI,!1),c.closePath(),c.fill(),c.restore()},onMouseDown:function(a){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(a)},onMouseMove:function(a){this.drawDot(a)},onMouseUp:function(){var a=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var b=[],c=0,d=this.points.length;d>c;c++){var e=this.points[c],f=new fabric.Circle({radius:e.radius,left:e.x,top:e.y,originX:"center",originY:"center",fill:e.fill});this.shadow&&f.setShadow(this.shadow),b.push(f)}var g=new fabric.Group(b,{originX:"center",originY:"center"});g.canvas=this.canvas,this.canvas.add(g),this.canvas.fire("path:created",{path:g}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=a,this.canvas.renderAll()},addPoint:function(a){var b=new fabric.Point(a.x,a.y),c=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,d=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return b.radius=c,b.fill=d,this.points.push(b),b}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(a){this.canvas=a,this.sprayChunks=[]},onMouseDown:function(a){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(a),this.render()},onMouseMove:function(a){this.addSprayChunk(a),this.render()},onMouseUp:function(){var a=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var b=[],c=0,d=this.sprayChunks.length;d>c;c++)for(var e=this.sprayChunks[c],f=0,g=e.length;g>f;f++){var h=new fabric.Rect({width:e[f].width,height:e[f].width,left:e[f].x+1,top:e[f].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&h.setShadow(this.shadow),b.push(h)}this.optimizeOverlapping&&(b=this._getOptimizedRects(b));var i=new fabric.Group(b,{originX:"center",originY:"center"});i.canvas=this.canvas,this.canvas.add(i),this.canvas.fire("path:created",{path:i}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=a,this.canvas.renderAll()},_getOptimizedRects:function(a){for(var b,c={},d=0,e=a.length;e>d;d++)b=a[d].left+""+a[d].top,c[b]||(c[b]=a[d]);var f=[];for(b in c)f.push(c[b]);return f},render:function(){var a=this.canvas.contextTop;a.fillStyle=this.color;var b=this.canvas.viewportTransform;a.save(),a.transform(b[0],b[1],b[2],b[3],b[4],b[5]);for(var c=0,d=this.sprayChunkPoints.length;d>c;c++){var e=this.sprayChunkPoints[c];"undefined"!=typeof e.opacity&&(a.globalAlpha=e.opacity),a.fillRect(e.x,e.y,e.width,e.width)}a.restore()},addSprayChunk:function(a){this.sprayChunkPoints=[];for(var b,c,d,e=this.width/2,f=0;f<this.density;f++){b=fabric.util.getRandomInt(a.x-e,a.x+e),c=fabric.util.getRandomInt(a.y-e,a.y+e),d=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var g=new fabric.Point(b,c);g.width=d,this.randomOpacity&&(g.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(g)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var a=20,b=5,c=fabric.document.createElement("canvas"),d=c.getContext("2d");return c.width=c.height=a+b,d.fillStyle=this.color,d.beginPath(),d.arc(a/2,a/2,a/2,0,2*Math.PI,!1),d.closePath(),d.fill(),c},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(a){var b=this.callSuper("createPath",a),c=b._getLeftTopCoords().scalarAdd(b.strokeWidth/2);return b.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-c.x,offsetY:-c.y}),b}}),function(){var a=fabric.util.getPointer,b=fabric.util.degreesToRadians,c=fabric.util.radiansToDegrees,d=Math.atan2,e=Math.abs,f=fabric.StaticCanvas.supports("setLineDash"),g=.5;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(a,b){b||(b={}),this._initStatic(a,b),this._initInteractive(),this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var a,b=this.getActiveGroup(),c=this.getActiveObject(),d=[],e=[];if(!b&&!c||this.preserveObjectStacking)d=this._objects;else{for(var f=0,g=this._objects.length;g>f;f++)a=this._objects[f],b&&b.contains(a)||a===c?e.push(a):d.push(a);b&&(b._set("_objects",e),d.push(b)),c&&d.push(c)}return d},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1);var a=this.contextContainer;return this.renderCanvas(a,this._chooseObjectsToRender()),this},renderTop:function(){var a=this.contextTop;return this.clearContext(a),this.selection&&this._groupSelector&&this._drawSelection(a),this.fire("after:render"),this.contextTopDirty=!0,this},_resetCurrentTransform:function(){var a=this._currentTransform;a.target.set({scaleX:a.original.scaleX,scaleY:a.original.scaleY,skewX:a.original.skewX,skewY:a.original.skewY,left:a.original.left,top:a.original.top}),this._shouldCenterTransform(a.target)?"rotate"===a.action?this._setOriginToCenter(a.target):("center"!==a.originX&&(a.mouseXSign="right"===a.originX?-1:1),"center"!==a.originY&&(a.mouseYSign="bottom"===a.originY?-1:1),a.originX="center",a.originY="center"):(a.originX=a.original.originX,a.originY=a.original.originY)},containsPoint:function(a,b,c){var d,e=!0,f=c||this.getPointer(a,e);return d=b.group&&b.group===this.getActiveGroup()?this._normalizePointer(b.group,f):{x:f.x,y:f.y},b.containsPoint(d)||b._findTargetCorner(f)},_normalizePointer:function(a,b){var c=a.calcTransformMatrix(),d=fabric.util.invertTransform(c),e=this.restorePointerVpt(b);return fabric.util.transformPoint(e,d)},isTargetTransparent:function(a,b,c){var d=a.hasBorders,e=a.transparentCorners,f=this.contextCache,g=a.selectionBackgroundColor;a.hasBorders=a.transparentCorners=!1,a.selectionBackgroundColor="",f.save(),f.transform.apply(f,this.viewportTransform),a.render(f),f.restore(),a.active&&a._renderControls(f),a.hasBorders=d,a.transparentCorners=e,a.selectionBackgroundColor=g;var h=fabric.util.isTransparent(f,b,c,this.targetFindTolerance);return this.clearContext(f),h},_shouldClearSelection:function(a,b){var c=this.getActiveGroup(),d=this.getActiveObject();return!b||b&&c&&!c.contains(b)&&c!==b&&!a[this.selectionKey]||b&&!b.evented||b&&!b.selectable&&d&&d!==b},_shouldCenterTransform:function(a){if(a){var b,c=this._currentTransform;return"scale"===c.action||"scaleX"===c.action||"scaleY"===c.action?b=this.centeredScaling||a.centeredScaling:"rotate"===c.action&&(b=this.centeredRotation||a.centeredRotation),b?!c.altKey:c.altKey}},_getOriginFromCorner:function(a,b){var c={x:a.originX,y:a.originY};return"ml"===b||"tl"===b||"bl"===b?c.x="right":("mr"===b||"tr"===b||"br"===b)&&(c.x="left"),"tl"===b||"mt"===b||"tr"===b?c.y="bottom":("bl"===b||"mb"===b||"br"===b)&&(c.y="top"),c},_getActionFromCorner:function(a,b,c){if(!b)return"drag";switch(b){case"mtr":return"rotate";case"ml":case"mr":return c[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return c[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(a,c){if(c){var d=this.getPointer(a),e=c._findTargetCorner(this.getPointer(a,!0)),f=this._getActionFromCorner(c,e,a),g=this._getOriginFromCorner(c,e);this._currentTransform={target:c,action:f,corner:e,scaleX:c.scaleX,scaleY:c.scaleY,skewX:c.skewX,skewY:c.skewY,offsetX:d.x-c.left,offsetY:d.y-c.top,originX:g.x,originY:g.y,ex:d.x,ey:d.y,lastX:d.x,lastY:d.y,left:c.left,top:c.top,theta:b(c.angle),width:c.width*c.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:a.shiftKey,altKey:a[this.centeredKey]},this._currentTransform.original={left:c.left,top:c.top,scaleX:c.scaleX,scaleY:c.scaleY,skewX:c.skewX,skewY:c.skewY,originX:g.x,originY:g.y},this._resetCurrentTransform()}},_translateObject:function(a,b){var c=this._currentTransform,d=c.target,e=a-c.offsetX,f=b-c.offsetY,g=!d.get("lockMovementX")&&d.left!==e,h=!d.get("lockMovementY")&&d.top!==f;return g&&d.set("left",e),h&&d.set("top",f),g||h},_changeSkewTransformOrigin:function(a,b,c){var d="originX",e={0:"center"},f=b.target.skewX,g="left",h="right",i="mt"===b.corner||"ml"===b.corner?1:-1,j=1;a=a>0?1:-1,"y"===c&&(f=b.target.skewY,g="top",h="bottom",d="originY"),e[-1]=g,e[1]=h,b.target.flipX&&(j*=-1),b.target.flipY&&(j*=-1),0===f?(b.skewSign=-i*a*j,b[d]=e[-a]):(f=f>0?1:-1,b.skewSign=f,b[d]=e[f*i*j])},_skewObject:function(a,b,c){var d=this._currentTransform,e=d.target,f=!1,g=e.get("lockSkewingX"),h=e.get("lockSkewingY");if(g&&"x"===c||h&&"y"===c)return!1;var i,j,k=e.getCenterPoint(),l=e.toLocalPoint(new fabric.Point(a,b),"center","center")[c],m=e.toLocalPoint(new fabric.Point(d.lastX,d.lastY),"center","center")[c],n=e._getTransformedDimensions();return this._changeSkewTransformOrigin(l-m,d,c),i=e.toLocalPoint(new fabric.Point(a,b),d.originX,d.originY)[c],j=e.translateToOriginPoint(k,d.originX,d.originY),f=this._setObjectSkew(i,d,c,n),d.lastX=a,d.lastY=b,e.setPositionByOrigin(j,d.originX,d.originY),f},_setObjectSkew:function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n=b.target,o=!1,p=b.skewSign;return"x"===c?(h="y",i="Y",j="X",l=0,m=n.skewY):(h="x",i="X",j="Y",l=n.skewX,m=0),g=n._getTransformedDimensions(l,m),k=2*Math.abs(a)-g[c],2>=k?e=0:(e=p*Math.atan(k/n["scale"+j]/(g[h]/n["scale"+i])),e=fabric.util.radiansToDegrees(e)),o=n["skew"+j]!==e,n.set("skew"+j,e),0!==n["skew"+i]&&(f=n._getTransformedDimensions(),e=d[h]/f[h]*n["scale"+i],n.set("scale"+i,e)),o},_scaleObject:function(a,b,c){var d=this._currentTransform,e=d.target,f=e.get("lockScalingX"),g=e.get("lockScalingY"),h=e.get("lockScalingFlip");if(f&&g)return!1;var i=e.translateToOriginPoint(e.getCenterPoint(),d.originX,d.originY),j=e.toLocalPoint(new fabric.Point(a,b),d.originX,d.originY),k=e._getTransformedDimensions(),l=!1;return this._setLocalMouse(j,d),l=this._setObjectScale(j,d,f,g,c,h,k),e.setPositionByOrigin(i,d.originX,d.originY),l},_setObjectScale:function(a,b,c,d,e,f,g){var h,i,j,k,l=b.target,m=!1,n=!1,o=!1;return j=a.x*l.scaleX/g.x,k=a.y*l.scaleY/g.y,h=l.scaleX!==j,i=l.scaleY!==k,f&&0>=j&&j<l.scaleX&&(m=!0),f&&0>=k&&k<l.scaleY&&(n=!0),"equally"!==e||c||d?e?"x"!==e||l.get("lockUniScaling")?"y"!==e||l.get("lockUniScaling")||n||d||l.set("scaleY",k)&&(o=o||i):m||c||l.set("scaleX",j)&&(o=o||h):(m||c||l.set("scaleX",j)&&(o=o||h),n||d||l.set("scaleY",k)&&(o=o||i)):m||n||(o=this._scaleObjectEqually(a,l,b,g)),b.newScaleX=j,b.newScaleY=k,m||n||this._flipObject(b,e),o},_scaleObjectEqually:function(a,b,c,d){var e,f=a.y+a.x,g=d.y*c.original.scaleY/b.scaleY+d.x*c.original.scaleX/b.scaleX;return c.newScaleX=c.original.scaleX*f/g,c.newScaleY=c.original.scaleY*f/g,e=c.newScaleX!==b.scaleX||c.newScaleY!==b.scaleY,b.set("scaleX",c.newScaleX),b.set("scaleY",c.newScaleY),e},_flipObject:function(a,b){a.newScaleX<0&&"y"!==b&&("left"===a.originX?a.originX="right":"right"===a.originX&&(a.originX="left")),a.newScaleY<0&&"x"!==b&&("top"===a.originY?a.originY="bottom":"bottom"===a.originY&&(a.originY="top"))},_setLocalMouse:function(a,b){var c=b.target;"right"===b.originX?a.x*=-1:"center"===b.originX&&(a.x*=2*b.mouseXSign,a.x<0&&(b.mouseXSign=-b.mouseXSign)),"bottom"===b.originY?a.y*=-1:"center"===b.originY&&(a.y*=2*b.mouseYSign,a.y<0&&(b.mouseYSign=-b.mouseYSign)),e(a.x)>c.padding?a.x<0?a.x+=c.padding:a.x-=c.padding:a.x=0,e(a.y)>c.padding?a.y<0?a.y+=c.padding:a.y-=c.padding:a.y=0},_rotateObject:function(a,b){var e=this._currentTransform;if(e.target.get("lockRotation"))return!1;var f=d(e.ey-e.top,e.ex-e.left),g=d(b-e.top,a-e.left),h=c(g-f+e.theta),i=!0;if(0>h&&(h=360+h),h%=360,e.target.snapAngle>0){var j=e.target.snapAngle,k=e.target.snapThreshold||j,l=Math.ceil(h/j)*j,m=Math.floor(h/j)*j;Math.abs(h-m)<k?h=m:Math.abs(h-l)<k&&(h=l),e.target.angle===h&&(i=!1)}return e.target.angle=h,i},setCursor:function(a){this.upperCanvasEl.style.cursor=a},_resetObjectTransform:function(a){a.scaleX=1,a.scaleY=1,a.skewX=0,a.skewY=0,a.setAngle(0)},_drawSelection:function(a){var b=this._groupSelector,c=b.left,d=b.top,h=e(c),i=e(d);if(this.selectionColor&&(a.fillStyle=this.selectionColor,a.fillRect(b.ex-(c>0?0:-c),b.ey-(d>0?0:-d),h,i)),this.selectionLineWidth&&this.selectionBorderColor)if(a.lineWidth=this.selectionLineWidth,a.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1&&!f){var j=b.ex+g-(c>0?0:h),k=b.ey+g-(d>0?0:i);a.beginPath(),fabric.util.drawDashedLine(a,j,k,j+h,k,this.selectionDashArray),fabric.util.drawDashedLine(a,j,k+i-1,j+h,k+i-1,this.selectionDashArray),fabric.util.drawDashedLine(a,j,k,j,k+i,this.selectionDashArray),fabric.util.drawDashedLine(a,j+h-1,k,j+h-1,k+i,this.selectionDashArray),a.closePath(),a.stroke()}else fabric.Object.prototype._setLineDash.call(this,a,this.selectionDashArray),a.strokeRect(b.ex+g-(c>0?0:h),b.ey+g-(d>0?0:i),h,i)},findTarget:function(a,b){if(!this.skipTargetFind){var c,d=!0,e=this.getPointer(a,d),f=this.getActiveGroup(),g=this.getActiveObject();if(f&&!b&&this._checkTarget(e,f))return this._fireOverOutEvents(f,a),f;if(g&&g._findTargetCorner(e))return this._fireOverOutEvents(g,a),g;if(g&&this._checkTarget(e,g)){if(!this.preserveObjectStacking)return this._fireOverOutEvents(g,a),g;c=g}this.targets=[];var h=this._searchPossibleTargets(this._objects,e);return a[this.altSelectionKey]&&h&&c&&h!==c&&(h=c),this._fireOverOutEvents(h,a),h}},_fireOverOutEvents:function(a,b){a?this._hoveredTarget!==a&&(this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:b}),this._hoveredTarget.fire("mouseout")),this.fire("mouse:over",{target:a,e:b}),a.fire("mouseover"),this._hoveredTarget=a):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:b}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(a,b){if(b&&b.visible&&b.evented&&this.containsPoint(null,b,a)){if(!this.perPixelTargetFind&&!b.perPixelTargetFind||b.isEditing)return!0;var c=this.isTargetTransparent(b,a.x,a.y);if(!c)return!0}},_searchPossibleTargets:function(a,b){for(var c,d,e,f=a.length;f--;)if(this._checkTarget(b,a[f])){c=a[f],"group"===c.type&&c.subTargetCheck&&(d=this._normalizePointer(c,b),e=this._searchPossibleTargets(c._objects,d),e&&this.targets.push(e));break}return c},restorePointerVpt:function(a){return fabric.util.transformPoint(a,fabric.util.invertTransform(this.viewportTransform))},getPointer:function(b,c,d){d||(d=this.upperCanvasEl);var e,f=a(b),g=d.getBoundingClientRect(),h=g.width||0,i=g.height||0;return h&&i||("top"in g&&"bottom"in g&&(i=Math.abs(g.top-g.bottom)),"right"in g&&"left"in g&&(h=Math.abs(g.right-g.left))),this.calcOffset(),f.x=f.x-this._offset.left,f.y=f.y-this._offset.top,c||(f=this.restorePointerVpt(f)),e=0===h||0===i?{width:1,height:1}:{width:d.width/h,height:d.height/i},{x:f.x*e.width,y:f.y*e.height}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+a),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(a){var b=this.getWidth()||a.width,c=this.getHeight()||a.height;fabric.util.setStyle(a,{position:"absolute",width:b+"px",height:c+"px",left:0,top:0}),a.width=b,a.height=c,fabric.util.makeElementUnselectable(a)},_copyCanvasStyle:function(a,b){b.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(a){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=a,a.set("active",!0)},setActiveObject:function(a,b){return this._setActiveObject(a),this.renderAll(),this.fire("object:selected",{target:a,e:b}),a.fire("selected",{e:b}),this},getActiveObject:function(){return this._activeObject},_onObjectRemoved:function(a){this.getActiveObject()===a&&(this.fire("before:selection:cleared",{target:a}),this._discardActiveObject(),this.fire("selection:cleared",{target:a}),a.fire("deselected")),this.callSuper("_onObjectRemoved",a)},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=null},discardActiveObject:function(a){var b=this._activeObject;return this.fire("before:selection:cleared",{target:b,e:a}),this._discardActiveObject(),this.fire("selection:cleared",{e:a}),b&&b.fire("deselected",{e:a}),this},_setActiveGroup:function(a){this._activeGroup=a,a&&a.set("active",!0)},setActiveGroup:function(a,b){return this._setActiveGroup(a),a&&(this.fire("object:selected",{target:a,e:b}),a.fire("selected",{e:b})),this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var a=this.getActiveGroup();a&&a.destroy(),this.setActiveGroup(null)},discardActiveGroup:function(a){var b=this.getActiveGroup();return this.fire("before:selection:cleared",{e:a,target:b}),this._discardActiveGroup(),this.fire("selection:cleared",{e:a}),this},deactivateAll:function(){for(var a,b=this.getObjects(),c=0,d=b.length;d>c;c++)a=b[c],a&&a.set("active",!1);return this._discardActiveGroup(),this._discardActiveObject(),this},deactivateAllWithDispatch:function(a){var b=this.getActiveGroup(),c=this.getActiveObject();return(c||b)&&this.fire("before:selection:cleared",{target:c||b,e:a}),this.deactivateAll(),(c||b)&&(this.fire("selection:cleared",{e:a,target:c}),c&&c.fire("deselected")),this},dispose:function(){this.callSuper("dispose");var a=this.wrapperEl;return this.removeListeners(),a.removeChild(this.upperCanvasEl),a.removeChild(this.lowerCanvasEl),delete this.upperCanvasEl,a.parentNode&&a.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,this},clear:function(){return this.discardActiveGroup(),this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(a){var b=this.getActiveGroup();b?b._renderControls(a):this._drawObjectsControls(a)},_drawObjectsControls:function(a){for(var b=0,c=this._objects.length;c>b;++b)this._objects[b]&&this._objects[b].active&&this._objects[b]._renderControls(a)},_toObject:function(a,b,c){var d=this._realizeGroupTransformOnObject(a),e=this.callSuper("_toObject",a,b,c);return this._unwindGroupTransformOnObject(a,d),e},_realizeGroupTransformOnObject:function(a){var b=["angle","flipX","flipY","height","left","scaleX","scaleY","top","width"];if(a.group&&a.group===this.getActiveGroup()){var c={};return b.forEach(function(b){c[b]=a[b]}),this.getActiveGroup().realizeTransform(a),c}return null},_unwindGroupTransformOnObject:function(a,b){b&&a.set(b)},_setSVGObject:function(a,b,c){var d;d=this._realizeGroupTransformOnObject(b),this.callSuper("_setSVGObject",a,b,c),this._unwindGroupTransformOnObject(b,d)}});for(var h in fabric.StaticCanvas)"prototype"!==h&&(fabric.Canvas[h]=fabric.StaticCanvas[h]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){}),fabric.Element=fabric.Canvas}(),function(){var a={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},b=fabric.util.addListener,c=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this._bindEvents(),b(fabric.window,"resize",this._onResize),b(this.upperCanvasEl,"mousedown",this._onMouseDown),b(this.upperCanvasEl,"mousemove",this._onMouseMove),b(this.upperCanvasEl,"mouseout",this._onMouseOut),b(this.upperCanvasEl,"mouseenter",this._onMouseEnter),b(this.upperCanvasEl,"wheel",this._onMouseWheel),b(this.upperCanvasEl,"contextmenu",this._onContextMenu),b(this.upperCanvasEl,"touchstart",this._onMouseDown),b(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),
eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this)},removeListeners:function(){c(fabric.window,"resize",this._onResize),c(this.upperCanvasEl,"mousedown",this._onMouseDown),c(this.upperCanvasEl,"mousemove",this._onMouseMove),c(this.upperCanvasEl,"mouseout",this._onMouseOut),c(this.upperCanvasEl,"mouseenter",this._onMouseEnter),c(this.upperCanvasEl,"wheel",this._onMouseWheel),c(this.upperCanvasEl,"contextmenu",this._onContextMenu),c(this.upperCanvasEl,"touchstart",this._onMouseDown),c(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(a,b){this.__onTransformGesture&&this.__onTransformGesture(a,b)},_onDrag:function(a,b){this.__onDrag&&this.__onDrag(a,b)},_onMouseWheel:function(a){this.__onMouseWheel(a)},_onMouseOut:function(a){var b=this._hoveredTarget;this.fire("mouse:out",{target:b,e:a}),this._hoveredTarget=null,b&&b.fire("mouseout",{e:a})},_onMouseEnter:function(a){this.findTarget(a)||(this.fire("mouse:over",{target:null,e:a}),this._hoveredTarget=null)},_onOrientationChange:function(a,b){this.__onOrientationChange&&this.__onOrientationChange(a,b)},_onShake:function(a,b){this.__onShake&&this.__onShake(a,b)},_onLongPress:function(a,b){this.__onLongPress&&this.__onLongPress(a,b)},_onContextMenu:function(a){return this.stopContextMenu&&(a.stopPropagation(),a.preventDefault()),!1},_onMouseDown:function(a){this.__onMouseDown(a),b(fabric.document,"touchend",this._onMouseUp),b(fabric.document,"touchmove",this._onMouseMove),c(this.upperCanvasEl,"mousemove",this._onMouseMove),c(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchstart"===a.type?c(this.upperCanvasEl,"mousedown",this._onMouseDown):(b(fabric.document,"mouseup",this._onMouseUp),b(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(a){if(this.__onMouseUp(a),c(fabric.document,"mouseup",this._onMouseUp),c(fabric.document,"touchend",this._onMouseUp),c(fabric.document,"mousemove",this._onMouseMove),c(fabric.document,"touchmove",this._onMouseMove),b(this.upperCanvasEl,"mousemove",this._onMouseMove),b(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchend"===a.type){var d=this;setTimeout(function(){b(d.upperCanvasEl,"mousedown",d._onMouseDown)},400)}},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault(),this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(a,b){var c=this.getActiveGroup()||this.getActiveObject();return!!(a&&(a.isMoving||a!==c)||!a&&c||!a&&!c&&!this._groupSelector||b&&this._previousPointer&&this.selection&&(b.x!==this._previousPointer.x||b.y!==this._previousPointer.y))},__onMouseUp:function(a){var b,c=!0,d=this._currentTransform,e=this._groupSelector,f=!e||0===e.left&&0===e.top;if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(a);d&&(this._finalizeCurrentTransform(),c=!d.actionPerformed),b=c?this.findTarget(a,!0):d.target;var g=this._shouldRender(b,this.getPointer(a));b||!f?this._maybeGroupObjects(a):(this._groupSelector=null,this._currentTransform=null),b&&(b.isMoving=!1),this._handleCursorAndEvent(a,b,"up"),b&&(b.__corner=0),g&&this.renderAll()},_handleCursorAndEvent:function(a,b,c){this._setCursorFromEvent(a,b),this._handleEvent(a,c,b?b:null)},_handleEvent:function(a,b,c){var d=void 0===typeof c?this.findTarget(a):c,e=this.targets||[],f={e:a,target:d,subTargets:e};this.fire("mouse:"+b,f),d&&d.fire("mouse"+b,f);for(var g=0;g<e.length;g++)e[g].fire("mouse"+b,f)},_finalizeCurrentTransform:function(){var a=this._currentTransform,b=a.target;b._scaling&&(b._scaling=!1),b.setCoords(),this._restoreOriginXY(b),(a.actionPerformed||this.stateful&&b.hasStateChanged())&&(this.fire("object:modified",{target:b}),b.fire("modified"))},_restoreOriginXY:function(a){if(this._previousOriginX&&this._previousOriginY){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX,a.originY=this._previousOriginY,a.left=b.x,a.top=b.y,this._previousOriginX=null,this._previousOriginY=null}},_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0,this.discardActiveObject(a).renderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var b=this.getPointer(a);this.freeDrawingBrush.onMouseDown(b),this._handleEvent(a,"down")},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var b=this.getPointer(a);this.freeDrawingBrush.onMouseMove(b)}this.setCursor(this.freeDrawingCursor),this._handleEvent(a,"move")},_onMouseUpInDrawingMode:function(a){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this._handleEvent(a,"up")},__onMouseDown:function(a){var b=this.findTarget(a),c=this.getPointer(a,!0),d="which"in a?3===a.which:2===a.button;if(d)return void(this.fireRightClick&&this._handleEvent(a,"down",b?b:null));if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(a);if(!this._currentTransform){this._previousPointer=c;var e=this._shouldRender(b,c),f=this._shouldGroup(a,b);this._shouldClearSelection(a,b)?this._clearSelection(a,b,c):f&&(this._handleGrouping(a,b),b=this.getActiveGroup()),b&&(!b.selectable||!b.__corner&&f||(this._beforeTransform(a,b),this._setupCurrentTransform(a,b)),b!==this.getActiveGroup()&&b!==this.getActiveObject()&&(this.deactivateAll(),b.selectable&&this.setActiveObject(b,a))),this._handleEvent(a,"down",b?b:null),e&&this.renderAll()}},_beforeTransform:function(a,b){this.stateful&&b.saveState(),b._findTargetCorner(this.getPointer(a))&&this.onBeforeScaleRotate(b)},_clearSelection:function(a,b,c){this.deactivateAllWithDispatch(a),b&&b.selectable?this.setActiveObject(b,a):this.selection&&(this._groupSelector={ex:c.x,ey:c.y,top:0,left:0})},_setOriginToCenter:function(a){this._previousOriginX=this._currentTransform.target.originX,this._previousOriginY=this._currentTransform.target.originY;var b=a.getCenterPoint();a.originX="center",a.originY="center",a.left=b.x,a.top=b.y,this._currentTransform.left=a.left,this._currentTransform.top=a.top},_setCenterToOrigin:function(a){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX,a.originY=this._previousOriginY,a.left=b.x,a.top=b.y,this._previousOriginX=null,this._previousOriginY=null},__onMouseMove:function(a){var b,c;if(this.isDrawingMode)return void this._onMouseMoveInDrawingMode(a);if(!("undefined"!=typeof a.touches&&a.touches.length>1)){var d=this._groupSelector;d?(c=this.getPointer(a,!0),d.left=c.x-d.ex,d.top=c.y-d.ey,this.renderTop()):this._currentTransform?this._transformObject(a):(b=this.findTarget(a),this._setCursorFromEvent(a,b)),this._handleEvent(a,"move",b?b:null)}},__onMouseWheel:function(a){this.fire("mouse:wheel",{e:a})},_transformObject:function(a){var b=this.getPointer(a),c=this._currentTransform;c.reset=!1,c.target.isMoving=!0,this._beforeScaleTransform(a,c),this._performTransformAction(a,c,b),c.actionPerformed&&this.renderAll()},_performTransformAction:function(a,b,c){var d=c.x,e=c.y,f=b.target,g=b.action,h=!1;"rotate"===g?(h=this._rotateObject(d,e))&&this._fire("rotating",f,a):"scale"===g?(h=this._onScale(a,b,d,e))&&this._fire("scaling",f,a):"scaleX"===g?(h=this._scaleObject(d,e,"x"))&&this._fire("scaling",f,a):"scaleY"===g?(h=this._scaleObject(d,e,"y"))&&this._fire("scaling",f,a):"skewX"===g?(h=this._skewObject(d,e,"x"))&&this._fire("skewing",f,a):"skewY"===g?(h=this._skewObject(d,e,"y"))&&this._fire("skewing",f,a):(h=this._translateObject(d,e),h&&(this._fire("moving",f,a),this.setCursor(f.moveCursor||this.moveCursor))),b.actionPerformed=h},_fire:function(a,b,c){this.fire("object:"+a,{target:b,e:c}),b.fire(a,{e:c})},_beforeScaleTransform:function(a,b){if("scale"===b.action||"scaleX"===b.action||"scaleY"===b.action){var c=this._shouldCenterTransform(b.target);(c&&("center"!==b.originX||"center"!==b.originY)||!c&&"center"===b.originX&&"center"===b.originY)&&(this._resetCurrentTransform(),b.reset=!0)}},_onScale:function(a,b,c,d){return!a[this.uniScaleKey]&&!this.uniScaleTransform||b.target.get("lockUniScaling")?(b.reset||"scale"!==b.currentAction||this._resetCurrentTransform(),b.currentAction="scaleEqually",this._scaleObject(c,d,"equally")):(b.currentAction="scale",this._scaleObject(c,d))},_setCursorFromEvent:function(a,b){if(!b)return this.setCursor(this.defaultCursor),!1;var c=b.hoverCursor||this.hoverCursor;if(b.selectable){var d=this.getActiveGroup(),e=b._findTargetCorner&&(!d||!d.contains(b))&&b._findTargetCorner(this.getPointer(a,!0));e?this._setCornerCursor(e,b,a):this.setCursor(c)}else this.setCursor(c);return!0},_setCornerCursor:function(b,c,d){if(b in a)this.setCursor(this._getRotatedCornerCursor(b,c,d));else{if("mtr"!==b||!c.hasRotatingPoint)return this.setCursor(this.defaultCursor),!1;this.setCursor(this.rotationCursor)}},_getRotatedCornerCursor:function(b,c,d){var e=Math.round(c.getAngle()%360/45);return 0>e&&(e+=8),e+=a[b],d[this.altActionKey]&&a[b]%2===0&&(e+=2),e%=8,this.cursorMap[e]}})}(),function(){var a=Math.min,b=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(a,b){var c=this.getActiveObject();return a[this.selectionKey]&&b&&b.selectable&&(this.getActiveGroup()||c&&c!==b)&&this.selection},_handleGrouping:function(a,b){var c=this.getActiveGroup();(b!==c||(b=this.findTarget(a,!0)))&&(c?this._updateActiveGroup(b,a):this._createActiveGroup(b,a),this._activeGroup&&this._activeGroup.saveCoords())},_updateActiveGroup:function(a,b){var c=this.getActiveGroup();if(c.contains(a)){if(c.removeWithUpdate(a),a.set("active",!1),1===c.size())return this.discardActiveGroup(b),void this.setActiveObject(c.item(0))}else c.addWithUpdate(a);this.fire("selection:created",{target:c,e:b}),c.set("active",!0)},_createActiveGroup:function(a,b){if(this._activeObject&&a!==this._activeObject){var c=this._createGroup(a);c.addWithUpdate(),this.setActiveGroup(c),this._activeObject=null,this.fire("selection:created",{target:c,e:b})}a.set("active",!0)},_createGroup:function(a){var b=this.getObjects(),c=b.indexOf(this._activeObject)<b.indexOf(a),d=c?[this._activeObject,a]:[a,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new fabric.Group(d,{canvas:this})},_groupSelectedObjects:function(a){var b=this._collectObjects();1===b.length?this.setActiveObject(b[0],a):b.length>1&&(b=new fabric.Group(b.reverse(),{canvas:this}),b.addWithUpdate(),this.setActiveGroup(b,a),b.saveCoords(),this.fire("selection:created",{target:b}),this.renderAll())},_collectObjects:function(){for(var c,d=[],e=this._groupSelector.ex,f=this._groupSelector.ey,g=e+this._groupSelector.left,h=f+this._groupSelector.top,i=new fabric.Point(a(e,g),a(f,h)),j=new fabric.Point(b(e,g),b(f,h)),k=e===g&&f===h,l=this._objects.length;l--&&(c=this._objects[l],!(c&&c.selectable&&c.visible&&(c.intersectsWithRect(i,j)||c.isContainedWithinRect(i,j)||c.containsPoint(i)||c.containsPoint(j))&&(c.set("active",!0),d.push(c),k))););return d},_maybeGroupObjects:function(a){this.selection&&this._groupSelector&&this._groupSelectedObjects(a);var b=this.getActiveGroup();b&&(b.setObjectsCoords().setCoords(),b.isMoving=!1,this.setCursor(this.defaultCursor)),this._groupSelector=null,this._currentTransform=null}})}(),function(){var a=fabric.StaticCanvas.supports("toDataURLWithQuality");fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(a){a||(a={});var b=a.format||"png",c=a.quality||1,d=a.multiplier||1,e={left:a.left||0,top:a.top||0,width:a.width||0,height:a.height||0};return this.__toDataURLWithMultiplier(b,c,e,d)},__toDataURLWithMultiplier:function(a,b,c,d){var e=this.getWidth(),f=this.getHeight(),g=(c.width||this.getWidth())*d,h=(c.height||this.getHeight())*d,i=this.getZoom(),j=i*d,k=this.viewportTransform,l=(k[4]-c.left)*d,m=(k[5]-c.top)*d,n=[j,0,0,j,l,m],o=this.interactive;this.viewportTransform=n,this.interactive&&(this.interactive=!1),e!==g||f!==h?this.setDimensions({width:g,height:h}):this.renderAll();var p=this.__toDataURL(a,b,c);return o&&(this.interactive=o),this.viewportTransform=k,this.setDimensions({width:e,height:f}),p},__toDataURL:function(b,c){var d=this.contextContainer.canvas;"jpg"===b&&(b="jpeg");var e=a?d.toDataURL("image/"+b,c):d.toDataURL("image/"+b);return e},toDataURLWithMultiplier:function(a,b,c){return this.toDataURL({format:a,multiplier:b,quality:c})}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(a,b,c){return this.loadFromJSON(a,b,c)},loadFromJSON:function(a,b,c){if(a){var d="string"==typeof a?JSON.parse(a):fabric.util.object.clone(a);this.clear();var e=this;return this._enlivenObjects(d.objects,function(){e._setBgOverlay(d,function(){delete d.objects,delete d.backgroundImage,delete d.overlayImage,delete d.background,delete d.overlay;for(var a in d)e[a]=d[a];b&&b()})},c),this}},_setBgOverlay:function(a,b){var c=this,d={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!(a.backgroundImage||a.overlayImage||a.background||a.overlay))return void(b&&b());var e=function(){d.backgroundImage&&d.overlayImage&&d.backgroundColor&&d.overlayColor&&(c.renderAll(),b&&b())};this.__setBgOverlay("backgroundImage",a.backgroundImage,d,e),this.__setBgOverlay("overlayImage",a.overlayImage,d,e),this.__setBgOverlay("backgroundColor",a.background,d,e),this.__setBgOverlay("overlayColor",a.overlay,d,e),e()},__setBgOverlay:function(a,b,c,d){var e=this;return b?void("backgroundImage"===a||"overlayImage"===a?fabric.Image.fromObject(b,function(b){e[a]=b,c[a]=!0,d&&d()}):this["set"+fabric.util.string.capitalize(a,!0)](b,function(){c[a]=!0,d&&d()})):void(c[a]=!0)},_enlivenObjects:function(a,b,c){var d=this;if(!a||0===a.length)return void(b&&b());var e=this.renderOnAddRemove;this.renderOnAddRemove=!1,fabric.util.enlivenObjects(a,function(a){a.forEach(function(a,b){d.insertAt(a,b)}),d.renderOnAddRemove=e,b&&b()},null,c)},_toDataURL:function(a,b){this.clone(function(c){b(c.toDataURL(a))})},_toDataURLWithMultiplier:function(a,b,c){this.clone(function(d){c(d.toDataURLWithMultiplier(a,b))})},clone:function(a,b){var c=JSON.stringify(this.toJSON(b));this.cloneWithoutData(function(b){b.loadFromJSON(c,function(){a&&a(b)})})},cloneWithoutData:function(a){var b=fabric.document.createElement("canvas");b.width=this.getWidth(),b.height=this.getHeight();var c=new fabric.Canvas(b);c.clipTo=this.clipTo,this.backgroundImage?(c.setBackgroundImage(this.backgroundImage.src,function(){c.renderAll(),a&&a(c)}),c.backgroundImageOpacity=this.backgroundImageOpacity,c.backgroundImageStretch=this.backgroundImageStretch):a&&a(c)}}),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.toFixed,e=b.util.string.capitalize,f=b.util.degreesToRadians,g=b.StaticCanvas.supports("setLineDash"),h=!b.isLikelyNode;b.Object||(b.Object=b.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:h,statefullCache:!1,noScaleCache:!0,dirty:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit fillRule backgroundColor".split(" "),initialize:function(a){a=a||{},a&&this.setOptions(a),this.objectCaching&&(this._createCacheCanvas(),this.setupState({propertySet:"cacheProperties"}))},_createCacheCanvas:function(){this._cacheCanvas=b.document.createElement("canvas"),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas()},_updateCacheCanvas:function(){if(this.noScaleCache&&this.canvas&&this.canvas._currentTransform){var a=this.canvas._currentTransform.action;if("scale"===a.slice(0,5))return!1}var c=this.getViewportTransform()[0],d=this.getObjectScaling(),e=this._getNonTransformedDimensions(),f=this.canvas&&this.canvas._isRetinaScaling()?b.devicePixelRatio:1,g=d.scaleX*c*f,h=d.scaleY*c*f,i=e.x*g,j=e.y*h;return i!==this.cacheWidth||j!==this.cacheHeight?(this._cacheCanvas.width=i,this._cacheCanvas.height=j,this._cacheContext.translate(i/2,j/2),this._cacheContext.scale(g,h),this.cacheWidth=i,this.cacheHeight=j,this.zoomX=g,this.zoomY=h,!0):!1},_initGradient:function(a){!a.fill||!a.fill.colorStops||a.fill instanceof b.Gradient||this.set("fill",new b.Gradient(a.fill)),!a.stroke||!a.stroke.colorStops||a.stroke instanceof b.Gradient||this.set("stroke",new b.Gradient(a.stroke))},_initPattern:function(a){!a.fill||!a.fill.source||a.fill instanceof b.Pattern||this.set("fill",new b.Pattern(a.fill)),!a.stroke||!a.stroke.source||a.stroke instanceof b.Pattern||this.set("stroke",new b.Pattern(a.stroke))},_initClipping:function(a){if(a.clipTo&&"string"==typeof a.clipTo){var c=b.util.getFunctionBody(a.clipTo);"undefined"!=typeof c&&(this.clipTo=new Function("ctx",c))}},setOptions:function(a){for(var b in a)this.set(b,a[b]);this._initGradient(a),this._initPattern(a),this._initClipping(a)},transform:function(a,b){this.group&&!this.group._transformDone&&this.group===this.canvas._activeGroup&&this.group.transform(a);var c=b?this._getLeftTopCoords():this.getCenterPoint();a.translate(c.x,c.y),a.rotate(f(this.angle)),a.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1)),a.transform(1,0,Math.tan(f(this.skewX)),1,0,0),a.transform(1,Math.tan(f(this.skewY)),0,1,0,0)},toObject:function(a){var c=b.Object.NUM_FRACTION_DIGITS,e={type:this.type,originX:this.originX,originY:this.originY,left:d(this.left,c),top:d(this.top,c),width:d(this.width,c),height:d(this.height,c),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:d(this.strokeWidth,c),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:d(this.strokeMiterLimit,c),scaleX:d(this.scaleX,c),scaleY:d(this.scaleY,c),angle:d(this.getAngle(),c),flipX:this.flipX,flipY:this.flipY,opacity:d(this.opacity,c),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():this.transformMatrix,skewX:d(this.skewX,c),skewY:d(this.skewY,c)};return b.util.populateWithProperties(this,e,a),this.includeDefaultValues||(e=this._removeDefaultValues(e)),e},toDatalessObject:function(a){return this.toObject(a)},_removeDefaultValues:function(a){var c=b.util.getKlass(a.type).prototype,d=c.stateProperties;return d.forEach(function(b){a[b]===c[b]&&delete a[b];var d="[object Array]"===Object.prototype.toString.call(a[b])&&"[object Array]"===Object.prototype.toString.call(c[b]);d&&0===a[b].length&&0===c[b].length&&delete a[b]}),a},toString:function(){return"#<fabric."+e(this.type)+">"},get:function(a){return this[a]},getObjectScaling:function(){var a=this.scaleX,b=this.scaleY;if(this.group){var c=this.group.getObjectScaling();a*=c.scaleX,b*=c.scaleY}return{scaleX:a,scaleY:b}},_setObject:function(a){for(var b in a)this._set(b,a[b])},set:function(a,b){return"object"==typeof a?this._setObject(a):"function"==typeof b&&"clipTo"!==a?this._set(a,b(this.get(a))):this._set(a,b),this},_set:function(a,c){var d="scaleX"===a||"scaleY"===a;return d&&(c=this._constrainScale(c)),"scaleX"===a&&0>c?(this.flipX=!this.flipX,c*=-1):"scaleY"===a&&0>c?(this.flipY=!this.flipY,c*=-1):"shadow"!==a||!c||c instanceof b.Shadow||(c=new b.Shadow(c)),this[a]=c,this.cacheProperties.indexOf(a)>-1&&(this.dirty=!0),("width"===a||"height"===a)&&(this.minScaleLimit=Math.min(.1,1/Math.max(this.width,this.height))),this},setOnGroup:function(){},toggle:function(a){var b=this.get(a);return"boolean"==typeof b&&this.set(a,!b),this},setSourcePath:function(a){return this.sourcePath=a,this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(a,c){0===this.width&&0===this.height||!this.visible||(a.save(),this._setupCompositeOperation(a),this.drawSelectionBackground(a),c||this.transform(a),this._setOpacity(a),this._setShadow(a),this.transformMatrix&&a.transform.apply(a,this.transformMatrix),this.clipTo&&b.util.clipContext(this,a),this.objectCaching&&!this.group?(this.isCacheDirty(c)&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,c),this.dirty=!1),this.drawCacheOnCanvas(a)):(this.drawObject(a,c),c&&this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),this.clipTo&&a.restore(),a.restore())},drawObject:function(a,b){this._renderBackground(a),this._setStrokeStyles(a),this._setFillStyles(a),this._render(a,b)},drawCacheOnCanvas:function(a){a.scale(1/this.zoomX,1/this.zoomY),a.drawImage(this._cacheCanvas,-this.cacheWidth/2,-this.cacheHeight/2)},isCacheDirty:function(a){if(!a&&this._updateCacheCanvas())return!0;if(this.dirty||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(!a){var b=this._getNonTransformedDimensions();this._cacheContext.clearRect(-b.x/2,-b.y/2,b.x,b.y)}return!0}return!1},_renderBackground:function(a){if(this.backgroundColor){var b=this._getNonTransformedDimensions();a.fillStyle=this.backgroundColor,a.fillRect(-b.x/2,-b.y/2,b.x,b.y),this._removeShadow(a)}},_setOpacity:function(a){a.globalAlpha*=this.opacity},_setStrokeStyles:function(a){this.stroke&&(a.lineWidth=this.strokeWidth,a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin,a.miterLimit=this.strokeMiterLimit,a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a,this):this.stroke)},_setFillStyles:function(a){this.fill&&(a.fillStyle=this.fill.toLive?this.fill.toLive(a,this):this.fill)},_setLineDash:function(a,b,c){b&&(1&b.length&&b.push.apply(b,b),g?a.setLineDash(b):c&&c(a))},_renderControls:function(a,c){if(!(!this.active||c||this.group&&this.group!==this.canvas.getActiveGroup())){var d,e=this.getViewportTransform(),g=this.calcTransformMatrix();g=b.util.multiplyTransformMatrices(e,g),d=b.util.qrDecompose(g),a.save(),a.translate(d.translateX,d.translateY),a.lineWidth=1*this.borderScaleFactor,this.group||(a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.group&&this.group===this.canvas.getActiveGroup()?(a.rotate(f(d.angle)),this.drawBordersInGroup(a,d)):(a.rotate(f(this.angle)),this.drawBorders(a)),this.drawControls(a),a.restore()}},_setShadow:function(a){if(this.shadow){var c=this.canvas&&this.canvas.viewportTransform[0]||1,d=this.canvas&&this.canvas.viewportTransform[3]||1,e=this.getObjectScaling();this.canvas&&this.canvas._isRetinaScaling()&&(c*=b.devicePixelRatio,d*=b.devicePixelRatio),a.shadowColor=this.shadow.color,a.shadowBlur=this.shadow.blur*(c+d)*(e.scaleX+e.scaleY)/4,a.shadowOffsetX=this.shadow.offsetX*c*e.scaleX,a.shadowOffsetY=this.shadow.offsetY*d*e.scaleY}},_removeShadow:function(a){this.shadow&&(a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0)},_renderFill:function(a){if(this.fill){if(a.save(),this.fill.gradientTransform){var b=this.fill.gradientTransform;a.transform.apply(a,b)}this.fill.toLive&&a.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),"evenodd"===this.fillRule?a.fill("evenodd"):a.fill(),a.restore()}},_renderStroke:function(a){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a),a.save(),this._setLineDash(a,this.strokeDashArray,this._renderDashedStroke),this.stroke.gradientTransform){var b=this.stroke.gradientTransform;a.transform.apply(a,b)}this.stroke.toLive&&a.translate(-this.width/2+this.stroke.offsetX||0,-this.height/2+this.stroke.offsetY||0),a.stroke(),a.restore()}},clone:function(a,c){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(c),a):new b.Object(this.toObject(c))},cloneAsImage:function(a,c){var d=this.toDataURL(c);return b.util.loadImage(d,function(c){a&&a(new b.Image(c))}),this},toDataURL:function(a){a||(a={});var c=b.util.createCanvasElement(),d=this.getBoundingRect();c.width=d.width,c.height=d.height,b.util.wrapElement(c,"div");var e=new b.StaticCanvas(c,{enableRetinaScaling:a.enableRetinaScaling});"jpg"===a.format&&(a.format="jpeg"),"jpeg"===a.format&&(e.backgroundColor="#fff");var f={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1),this.setPositionByOrigin(new b.Point(e.getWidth()/2,e.getHeight()/2),"center","center");var g=this.canvas;e.add(this);var h=e.toDataURL(a);return this.set(f).setCoords(),this.canvas=g,e.dispose(),e=null,h},isType:function(a){return this.type===a},complexity:function(){return 0},toJSON:function(a){return this.toObject(a)},setGradient:function(a,c){c||(c={});var d={colorStops:[]};d.type=c.type||(c.r1||c.r2?"radial":"linear"),d.coords={x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2},(c.r1||c.r2)&&(d.coords.r1=c.r1,d.coords.r2=c.r2),c.gradientTransform&&(d.gradientTransform=c.gradientTransform);for(var e in c.colorStops){var f=new b.Color(c.colorStops[e]);d.colorStops.push({offset:e,color:f.toRgb(),opacity:f.getAlpha()})}return this.set(a,b.Gradient.forObject(this,d))},setPatternFill:function(a){return this.set("fill",new b.Pattern(a))},setShadow:function(a){return this.set("shadow",a?new b.Shadow(a):null)},setColor:function(a){return this.set("fill",a),this},setAngle:function(a){var b=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return b&&this._setOriginToCenter(),this.set("angle",a),b&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},remove:function(){return this.canvas&&this.canvas.remove(this),this},getLocalPointer:function(a,c){c=c||this.canvas.getPointer(a);var d=new b.Point(c.x,c.y),e=this._getLeftTopCoords();return this.angle&&(d=b.util.rotatePoint(d,e,b.util.degreesToRadians(-this.angle))),{x:d.x-e.x,y:d.y-e.y}},_setupCompositeOperation:function(a){this.globalCompositeOperation&&(a.globalCompositeOperation=this.globalCompositeOperation)}}),b.util.createAccessors(b.Object),b.Object.prototype.rotate=b.Object.prototype.setAngle,c(b.Object.prototype,b.Observable),b.Object.NUM_FRACTION_DIGITS=2,b.Object.__uid=0)}("undefined"!=typeof exports?exports:this),function(){var a=fabric.util.degreesToRadians,b={left:-.5,center:0,right:.5},c={top:-.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(a,d,e,f,g){var h,i,j,k=a.x,l=a.y;return"string"==typeof d?d=b[d]:d-=.5,"string"==typeof f?f=b[f]:f-=.5,h=f-d,"string"==typeof e?e=c[e]:e-=.5,"string"==typeof g?g=c[g]:g-=.5,i=g-e,(h||i)&&(j=this._getTransformedDimensions(),k=a.x+h*j.x,l=a.y+i*j.y),new fabric.Point(k,l)},translateToCenterPoint:function(b,c,d){var e=this.translateToGivenOrigin(b,c,d,"center","center");return this.angle?fabric.util.rotatePoint(e,b,a(this.angle)):e},translateToOriginPoint:function(b,c,d){var e=this.translateToGivenOrigin(b,"center","center",c,d);return this.angle?fabric.util.rotatePoint(e,b,a(this.angle)):e},getCenterPoint:function(){var a=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(a,this.originX,this.originY)},getPointByOrigin:function(a,b){var c=this.getCenterPoint();return this.translateToOriginPoint(c,a,b)},toLocalPoint:function(b,c,d){var e,f,g=this.getCenterPoint();return e="undefined"!=typeof c&&"undefined"!=typeof d?this.translateToGivenOrigin(g,"center","center",c,d):new fabric.Point(this.left,this.top),f=new fabric.Point(b.x,b.y),this.angle&&(f=fabric.util.rotatePoint(f,g,-a(this.angle))),f.subtractEquals(e)},setPositionByOrigin:function(a,b,c){var d=this.translateToCenterPoint(a,b,c),e=this.translateToOriginPoint(d,this.originX,this.originY);this.set("left",e.x),this.set("top",e.y)},adjustPosition:function(c){var d,e,f=a(this.angle),g=this.getWidth(),h=Math.cos(f)*g,i=Math.sin(f)*g;d="string"==typeof this.originX?b[this.originX]:this.originX-.5,e="string"==typeof c?b[c]:c-.5,this.left+=h*(e-d),this.top+=i*(e-d),this.setCoords(),this.originX=c},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var a=this.getCenterPoint();this.originX="center",this.originY="center",this.left=a.x,this.top=a.y},_resetOrigin:function(){var a=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=a.x,this.top=a.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function a(a){return[new fabric.Point(a.tl.x,a.tl.y),new fabric.Point(a.tr.x,a.tr.y),new fabric.Point(a.br.x,a.br.y),new fabric.Point(a.bl.x,a.bl.y)]}var b=fabric.util.degreesToRadians,c=fabric.util.multiplyTransformMatrices;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(b,c){var d=a(this.oCoords),e=fabric.Intersection.intersectPolygonRectangle(d,b,c);return"Intersection"===e.status},intersectsWithObject:function(b){var c=fabric.Intersection.intersectPolygonPolygon(a(this.oCoords),a(b.oCoords));return"Intersection"===c.status||b.isContainedWithinObject(this)||this.isContainedWithinObject(b);

},isContainedWithinObject:function(b){for(var c=a(this.oCoords),d=0;4>d;d++)if(!b.containsPoint(c[d]))return!1;return!0},isContainedWithinRect:function(a,b){var c=this.getBoundingRect();return c.left>=a.x&&c.left+c.width<=b.x&&c.top>=a.y&&c.top+c.height<=b.y},containsPoint:function(a){this.oCoords||this.setCoords();var b=this._getImageLines(this.oCoords),c=this._findCrossPoints(a,b);return 0!==c&&c%2===1},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_findCrossPoints:function(a,b){var c,d,e,f,g,h,i=0;for(var j in b)if(h=b[j],!(h.o.y<a.y&&h.d.y<a.y||h.o.y>=a.y&&h.d.y>=a.y||(h.o.x===h.d.x&&h.o.x>=a.x?g=h.o.x:(c=0,d=(h.d.y-h.o.y)/(h.d.x-h.o.x),e=a.y-c*a.x,f=h.o.y-d*h.o.x,g=-(e-f)/(c-d)),g>=a.x&&(i+=1),2!==i)))break;return i},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(a){var b=this.calcCoords(a);return fabric.util.makeBoundingBoxFromPoints([b.tl,b.tr,b.br,b.bl])},getWidth:function(){return this._getTransformedDimensions().x},getHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(a){return Math.abs(a)<this.minScaleLimit?0>a?-this.minScaleLimit:this.minScaleLimit:a},scale:function(a){return a=this._constrainScale(a),0>a&&(this.flipX=!this.flipX,this.flipY=!this.flipY,a*=-1),this.scaleX=a,this.scaleY=a,this.setCoords()},scaleToWidth:function(a){var b=this.getBoundingRect().width/this.getWidth();return this.scale(a/this.width/b)},scaleToHeight:function(a){var b=this.getBoundingRect().height/this.getHeight();return this.scale(a/this.height/b)},calcCoords:function(a){var c=b(this.angle),d=this.getViewportTransform(),e=a?this._getTransformedDimensions():this._calculateCurrentDimensions(),f=e.x,g=e.y,h=Math.sin(c),i=Math.cos(c),j=f>0?Math.atan(g/f):0,k=f/Math.cos(j)/2,l=Math.cos(j+c)*k,m=Math.sin(j+c)*k,n=this.getCenterPoint(),o=a?n:fabric.util.transformPoint(n,d),p=new fabric.Point(o.x-l,o.y-m),q=new fabric.Point(p.x+f*i,p.y+f*h),r=new fabric.Point(p.x-g*h,p.y+g*i),s=new fabric.Point(o.x+l,o.y+m),t=new fabric.Point((p.x+r.x)/2,(p.y+r.y)/2),u=new fabric.Point((q.x+p.x)/2,(q.y+p.y)/2),v=new fabric.Point((s.x+q.x)/2,(s.y+q.y)/2),w=new fabric.Point((s.x+r.x)/2,(s.y+r.y)/2),x=new fabric.Point(u.x+h*this.rotatingPointOffset,u.y-i*this.rotatingPointOffset);return{tl:p,tr:q,br:s,bl:r,ml:t,mt:u,mr:v,mb:w,mtr:x}},setCoords:function(a){return this.oCoords=this.calcCoords(a),a||this._setCornerCoords&&this._setCornerCoords(),this},_calcRotateMatrix:function(){if(this.angle){var a=b(this.angle),c=Math.cos(a),d=Math.sin(a);return[c,d,-d,c,0,0]}return[1,0,0,1,0,0]},calcTransformMatrix:function(){var a=this.getCenterPoint(),b=[1,0,0,1,a.x,a.y],d=this._calcRotateMatrix(),e=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0),f=this.group?this.group.calcTransformMatrix():[1,0,0,1,0,0];return f=c(f,b),f=c(f,d),f=c(f,e)},_calcDimensionsTransformMatrix:function(a,d,e){var f=[1,0,Math.tan(b(a)),1],g=[1,Math.tan(b(d)),0,1],h=this.scaleX*(e&&this.flipX?-1:1),i=this.scaleY*(e&&this.flipY?-1:1),j=[h,0,0,i],k=c(j,f,!0);return c(k,g,!0)}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(a){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,a):this.canvas.sendBackwards(this,a),this},bringForward:function(a){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,a):this.canvas.bringForward(this,a),this},moveTo:function(a){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,a):this.canvas.moveTo(this,a),this}}),function(){function a(a,b){if(b){if(b.toLive)return a+": url(#SVGID_"+b.id+"); ";var c=new fabric.Color(b),d=a+": "+c.toRgb()+"; ",e=c.getAlpha();return 1!==e&&(d+=a+"-opacity: "+e.toString()+"; "),d}return a+": none; "}fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(b){var c=this.fillRule,d=this.strokeWidth?this.strokeWidth:"0",e=this.strokeDashArray?this.strokeDashArray.join(" "):"none",f=this.strokeLineCap?this.strokeLineCap:"butt",g=this.strokeLineJoin?this.strokeLineJoin:"miter",h=this.strokeMiterLimit?this.strokeMiterLimit:"4",i="undefined"!=typeof this.opacity?this.opacity:"1",j=this.visible?"":" visibility: hidden;",k=b?"":this.getSvgFilter(),l=a("fill",this.fill),m=a("stroke",this.stroke);return[m,"stroke-width: ",d,"; ","stroke-dasharray: ",e,"; ","stroke-linecap: ",f,"; ","stroke-linejoin: ",g,"; ","stroke-miterlimit: ",h,"; ",l,"fill-rule: ",c,"; ","opacity: ",i,";",k,j].join("")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgId:function(){return this.id?'id="'+this.id+'" ':""},getSvgTransform:function(){if(this.group&&"path-group"===this.group.type)return"";var a=fabric.util.toFixed,b=this.getAngle(),c=this.getSkewX()%360,d=this.getSkewY()%360,e=this.getCenterPoint(),f=fabric.Object.NUM_FRACTION_DIGITS,g="path-group"===this.type?"":"translate("+a(e.x,f)+" "+a(e.y,f)+")",h=0!==b?" rotate("+a(b,f)+")":"",i=1===this.scaleX&&1===this.scaleY?"":" scale("+a(this.scaleX,f)+" "+a(this.scaleY,f)+")",j=0!==c?" skewX("+a(c,f)+")":"",k=0!==d?" skewY("+a(d,f)+")":"",l="path-group"===this.type?this.width:0,m=this.flipX?" matrix(-1 0 0 1 "+l+" 0) ":"",n="path-group"===this.type?this.height:0,o=this.flipY?" matrix(1 0 0 -1 0 "+n+")":"";return[g,h,i,m,o,j,k].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var a=[];return this.fill&&this.fill.toLive&&a.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&a.push(this.stroke.toSVG(this,!1)),this.shadow&&a.push(this.shadow.toSVG(this)),a}})}(),function(){function a(a,b,d){var e={},f=!0;d.forEach(function(b){e[b]=a[b]}),c(a[b],e,f)}function b(a,c,d){if(!fabric.isLikelyNode&&a instanceof Element)return a===c;if(a instanceof Array){if(a.length!==c.length)return!1;for(var e=0,f=a.length;f>e;e++)if(a[e]!==c[e])return!1;return!0}if(a&&"object"==typeof a){if(!d&&Object.keys(a).length!==Object.keys(c).length)return!1;for(var g in a)if(!b(a[g],c[g]))return!1;return!0}return a===c}var c=fabric.util.object.extend,d="stateProperties";fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(a){return a=a||d,a="_"+a,!b(this[a],this,!0)},saveState:function(b){var c=b&&b.propertySet||d,e="_"+c;return a(this,e,this[c]),b&&b.stateProperties&&a(this,e,b.stateProperties),this},setupState:function(a){a=a||{};var b=a.propertySet||d;return a.propertySet=b,this["_"+b]={},this.saveState(a),this}})}(),function(){var a=fabric.util.degreesToRadians,b=function(){return"undefined"!=typeof G_vmlCanvasManager};fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(a){if(!this.hasControls||!this.active)return!1;var b,c,d=a.x,e=a.y;this.__corner=0;for(var f in this.oCoords)if(this.isControlVisible(f)&&("mtr"!==f||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==f&&"mr"!==f&&"mb"!==f&&"ml"!==f)&&(c=this._getImageLines(this.oCoords[f].corner),b=this._findCrossPoints({x:d,y:e},c),0!==b&&b%2===1))return this.__corner=f,f;return!1},_setCornerCoords:function(){var b,c,d=this.oCoords,e=a(45-this.angle),f=.707106*this.cornerSize,g=f*Math.cos(e),h=f*Math.sin(e);for(var i in d)b=d[i].x,c=d[i].y,d[i].corner={tl:{x:b-h,y:c-g},tr:{x:b+g,y:c-h},bl:{x:b-g,y:c+h},br:{x:b+h,y:c+g}}},_getNonTransformedDimensions:function(){var a=this.strokeWidth,b=this.width+a,c=this.height+a;return{x:b,y:c}},_getTransformedDimensions:function(a,b){"undefined"==typeof a&&(a=this.skewX),"undefined"==typeof b&&(b=this.skewY);var c,d,e=this._getNonTransformedDimensions(),f=e.x/2,g=e.y/2,h=[{x:-f,y:-g},{x:f,y:-g},{x:-f,y:g},{x:f,y:g}],i=this._calcDimensionsTransformMatrix(a,b,!1);for(c=0;c<h.length;c++)h[c]=fabric.util.transformPoint(h[c],i);return d=fabric.util.makeBoundingBoxFromPoints(h),{x:d.width,y:d.height}},_calculateCurrentDimensions:function(){var a=this.getViewportTransform(),b=this._getTransformedDimensions(),c=fabric.util.transformPoint(b,a,!0);return c.scalarAdd(2*this.padding)},drawSelectionBackground:function(b){if(!this.selectionBackgroundColor||this.group||!this.active)return this;b.save();var c=this.getCenterPoint(),d=this._calculateCurrentDimensions(),e=this.canvas.viewportTransform;return b.translate(c.x,c.y),b.scale(1/e[0],1/e[3]),b.rotate(a(this.angle)),b.fillStyle=this.selectionBackgroundColor,b.fillRect(-d.x/2,-d.y/2,d.x,d.y),b.restore(),this},drawBorders:function(a){if(!this.hasBorders)return this;var b=this._calculateCurrentDimensions(),c=1/this.borderScaleFactor,d=b.x+c,e=b.y+c;if(a.save(),a.strokeStyle=this.borderColor,this._setLineDash(a,this.borderDashArray,null),a.strokeRect(-d/2,-e/2,d,e),this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls){var f=-e/2;a.beginPath(),a.moveTo(0,f),a.lineTo(0,f-this.rotatingPointOffset),a.closePath(),a.stroke()}return a.restore(),this},drawBordersInGroup:function(a,b){if(!this.hasBorders)return this;var c=this._getNonTransformedDimensions(),d=fabric.util.customTransformMatrix(b.scaleX,b.scaleY,b.skewX),e=fabric.util.transformPoint(c,d),f=1/this.borderScaleFactor,g=e.x+f,h=e.y+f;return a.save(),this._setLineDash(a,this.borderDashArray,null),a.strokeStyle=this.borderColor,a.strokeRect(-g/2,-h/2,g,h),a.restore(),this},drawControls:function(a){if(!this.hasControls)return this;var b=this._calculateCurrentDimensions(),c=b.x,d=b.y,e=this.cornerSize,f=-(c+e)/2,g=-(d+e)/2,h=this.transparentCorners?"stroke":"fill";return a.save(),a.strokeStyle=a.fillStyle=this.cornerColor,this.transparentCorners||(a.strokeStyle=this.cornerStrokeColor),this._setLineDash(a,this.cornerDashArray,null),this._drawControl("tl",a,h,f,g),this._drawControl("tr",a,h,f+c,g),this._drawControl("bl",a,h,f,g+d),this._drawControl("br",a,h,f+c,g+d),this.get("lockUniScaling")||(this._drawControl("mt",a,h,f+c/2,g),this._drawControl("mb",a,h,f+c/2,g+d),this._drawControl("mr",a,h,f+c,g+d/2),this._drawControl("ml",a,h,f,g+d/2)),this.hasRotatingPoint&&this._drawControl("mtr",a,h,f+c/2,g-this.rotatingPointOffset),a.restore(),this},_drawControl:function(a,c,d,e,f){if(this.isControlVisible(a)){var g=this.cornerSize,h=!this.transparentCorners&&this.cornerStrokeColor;switch(this.cornerStyle){case"circle":c.beginPath(),c.arc(e+g/2,f+g/2,g/2,0,2*Math.PI,!1),c[d](),h&&c.stroke();break;default:b()||this.transparentCorners||c.clearRect(e,f,g,g),c[d+"Rect"](e,f,g,g),h&&c.strokeRect(e,f,g,g)}}},isControlVisible:function(a){return this._getControlsVisibility()[a]},setControlVisible:function(a,b){return this._getControlsVisibility()[a]=b,this},setControlsVisibility:function(a){a||(a={});for(var b in a)this.setControlVisible(b,a[b]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(a,b){b=b||{};var c=function(){},d=b.onComplete||c,e=b.onChange||c,f=this;return fabric.util.animate({startValue:a.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(b){a.set("left",b),f.renderAll(),e()},onComplete:function(){a.setCoords(),d()}}),this},fxCenterObjectV:function(a,b){b=b||{};var c=function(){},d=b.onComplete||c,e=b.onChange||c,f=this;return fabric.util.animate({startValue:a.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(b){a.set("top",b),f.renderAll(),e()},onComplete:function(){a.setCoords(),d()}}),this},fxRemove:function(a,b){b=b||{};var c=function(){},d=b.onComplete||c,e=b.onChange||c,f=this;return fabric.util.animate({startValue:a.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){a.set("active",!1)},onChange:function(b){a.set("opacity",b),f.renderAll(),e()},onComplete:function(){f.remove(a),d()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var a,b,c=[];for(a in arguments[0])c.push(a);for(var d=0,e=c.length;e>d;d++)a=c[d],b=d!==e-1,this._animate(a,arguments[0][a],arguments[1],b)}else this._animate.apply(this,arguments);return this},_animate:function(a,b,c,d){var e,f=this;b=b.toString(),c=c?fabric.util.object.clone(c):{},~a.indexOf(".")&&(e=a.split("."));var g=e?this.get(e[0])[e[1]]:this.get(a);"from"in c||(c.from=g),b=~b.indexOf("=")?g+parseFloat(b.replace("=","")):parseFloat(b),fabric.util.animate({startValue:c.from,endValue:b,byValue:c.by,easing:c.easing,duration:c.duration,abort:c.abort&&function(){return c.abort.call(f)},onChange:function(b){e?f[e[0]][e[1]]=b:f.set(a,b),d||c.onChange&&c.onChange()},onComplete:function(){d||(f.setCoords(),c.onComplete&&c.onComplete())}})}}),function(a){"use strict";function b(a,b){var c=a.origin,d=a.axis1,e=a.axis2,f=a.dimension,g=b.nearest,h=b.center,i=b.farthest;return function(){switch(this.get(c)){case g:return Math.min(this.get(d),this.get(e));case h:return Math.min(this.get(d),this.get(e))+.5*this.get(f);case i:return Math.max(this.get(d),this.get(e))}}}var c=a.fabric||(a.fabric={}),d=c.util.object.extend,e={x1:1,x2:1,y1:1,y2:1},f=c.StaticCanvas.supports("setLineDash");return c.Line?void c.warn("fabric.Line is already defined"):(c.Line=c.util.createClass(c.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(a,b){a||(a=[0,0,0,0]),this.callSuper("initialize",b),this.set("x1",a[0]),this.set("y1",a[1]),this.set("x2",a[2]),this.set("y2",a[3]),this._setWidthHeight(b)},_setWidthHeight:function(a){a||(a={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in a?a.left:this._getLeftToOriginX(),this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(a,b){return this.callSuper("_set",a,b),"undefined"!=typeof e[a]&&this._setWidthHeight(),this},_getLeftToOriginX:b({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:b({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a,b){if(a.beginPath(),b){var c=this.getCenterPoint();a.translate(c.x-this.strokeWidth/2,c.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&f){var d=this.calcLinePoints();a.moveTo(d.x1,d.y1),a.lineTo(d.x2,d.y2)}a.lineWidth=this.strokeWidth;var e=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle,this.stroke&&this._renderStroke(a),a.strokeStyle=e},_renderDashedStroke:function(a){var b=this.calcLinePoints();a.beginPath(),c.util.drawDashedLine(a,b.x1,b.y1,b.x2,b.y2,this.strokeDashArray),a.closePath()},toObject:function(a){return d(this.callSuper("toObject",a),this.calcLinePoints())},_getNonTransformedDimensions:function(){var a=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===a.x&&(a.y-=this.strokeWidth),0===a.y&&(a.x-=this.strokeWidth)),a},calcLinePoints:function(){var a=this.x1<=this.x2?-1:1,b=this.y1<=this.y2?-1:1,c=a*this.width*.5,d=b*this.height*.5,e=a*this.width*-.5,f=b*this.height*-.5;return{x1:c,x2:e,y1:d,y2:f}},toSVG:function(a){var b=this._createBaseSVGMarkup(),c={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};return this.group&&"path-group"===this.group.type||(c=this.calcLinePoints()),b.push("<line ",this.getSvgId(),'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),a?a(b.join("")):b.join("")},complexity:function(){return 1}}),c.Line.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),c.Line.fromElement=function(a,b){var e=c.parseAttributes(a,c.Line.ATTRIBUTE_NAMES),f=[e.x1||0,e.y1||0,e.x2||0,e.y2||0];return new c.Line(f,d(e,b))},void(c.Line.fromObject=function(a,b){var d=[a.x1,a.y1,a.x2,a.y2],e=new c.Line(d,a);return b&&b(e),e}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";function b(a){return"radius"in a&&a.radius>=0}var c=a.fabric||(a.fabric={}),d=Math.PI,e=c.util.object.extend;return c.Circle?void c.warn("fabric.Circle is already defined."):(c.Circle=c.util.createClass(c.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*d,initialize:function(a){this.callSuper("initialize",a),this.set("radius",a&&a.radius||0)},_set:function(a,b){return this.callSuper("_set",a,b),"radius"===a&&this.setRadius(b),this},toObject:function(a){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(a))},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=0,e=0,f=(this.endAngle-this.startAngle)%(2*d);if(0===f)this.group&&"path-group"===this.group.type&&(c=this.left+this.radius,e=this.top+this.radius),b.push("<circle ",this.getSvgId(),'cx="'+c+'" cy="'+e+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');else{var g=Math.cos(this.startAngle)*this.radius,h=Math.sin(this.startAngle)*this.radius,i=Math.cos(this.endAngle)*this.radius,j=Math.sin(this.endAngle)*this.radius,k=f>d?"1":"0";b.push('<path d="M '+g+" "+h," A "+this.radius+" "+this.radius," 0 ",+k+" 1"," "+i+" "+j,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath(),a.arc(b?this.left+this.radius:0,b?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1),this._renderFill(a),this._renderStroke(a)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(a){return this.radius=a,this.set("width",2*a).set("height",2*a)},complexity:function(){return 1}}),c.Circle.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),c.Circle.fromElement=function(a,d){d||(d={});var f=c.parseAttributes(a,c.Circle.ATTRIBUTE_NAMES);if(!b(f))throw new Error("value of `r` attribute is required and can not be negative");f.left=f.left||0,f.top=f.top||0;var g=new c.Circle(e(f,d));return g.left-=g.radius,g.top-=g.radius,g},void(c.Circle.fromObject=function(a,b){var d=new c.Circle(a);return b&&b(d),d}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={});return b.Triangle?void b.warn("fabric.Triangle is already defined"):(b.Triangle=b.util.createClass(b.Object,{type:"triangle",initialize:function(a){this.callSuper("initialize",a),this.set("width",a&&a.width||100).set("height",a&&a.height||100)},_render:function(a){var b=this.width/2,c=this.height/2;a.beginPath(),a.moveTo(-b,c),a.lineTo(0,-c),a.lineTo(b,c),a.closePath(),this._renderFill(a),this._renderStroke(a)},_renderDashedStroke:function(a){var c=this.width/2,d=this.height/2;a.beginPath(),b.util.drawDashedLine(a,-c,d,0,-d,this.strokeDashArray),b.util.drawDashedLine(a,0,-d,c,d,this.strokeDashArray),b.util.drawDashedLine(a,c,d,-c,d,this.strokeDashArray),a.closePath()},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=this.width/2,d=this.height/2,e=[-c+" "+d,"0 "+-d,c+" "+d].join(",");return b.push("<polygon ",this.getSvgId(),'points="',e,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),a?a(b.join("")):b.join("")},complexity:function(){return 1}}),void(b.Triangle.fromObject=function(a,c){var d=new b.Triangle(a);return c&&c(d),d}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=2*Math.PI,d=b.util.object.extend;return b.Ellipse?void b.warn("fabric.Ellipse is already defined."):(b.Ellipse=b.util.createClass(b.Object,{type:"ellipse",rx:0,ry:0,initialize:function(a){this.callSuper("initialize",a),this.set("rx",a&&a.rx||0),this.set("ry",a&&a.ry||0)},_set:function(a,b){switch(this.callSuper("_set",a,b),a){case"rx":this.rx=b,this.set("width",2*b);break;case"ry":this.ry=b,this.set("height",2*b)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(a){return this.callSuper("toObject",["rx","ry"].concat(a))},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=0,d=0;return this.group&&"path-group"===this.group.type&&(c=this.left+this.rx,d=this.top+this.ry),b.push("<ellipse ",this.getSvgId(),'cx="',c,'" cy="',d,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath(),a.save(),a.transform(1,0,0,this.ry/this.rx,0,0),a.arc(b?this.left+this.rx:0,b?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,c,!1),a.restore(),this._renderFill(a),this._renderStroke(a)},complexity:function(){return 1}}),b.Ellipse.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),b.Ellipse.fromElement=function(a,c){c||(c={});var e=b.parseAttributes(a,b.Ellipse.ATTRIBUTE_NAMES);e.left=e.left||0,e.top=e.top||0;var f=new b.Ellipse(d(e,c));return f.top-=f.ry,f.left-=f.rx,f},void(b.Ellipse.fromObject=function(a,c){var d=new b.Ellipse(a);return c&&c(d),d}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;if(b.Rect)return void b.warn("fabric.Rect is already defined");var d=b.Object.prototype.stateProperties.concat();d.push("rx","ry","x","y"),b.Rect=b.util.createClass(b.Object,{stateProperties:d,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(a){this.callSuper("initialize",a),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(a,b){if(1===this.width&&1===this.height)return void a.fillRect(-.5,-.5,1,1);var c=this.rx?Math.min(this.rx,this.width/2):0,d=this.ry?Math.min(this.ry,this.height/2):0,e=this.width,f=this.height,g=b?this.left:-this.width/2,h=b?this.top:-this.height/2,i=0!==c||0!==d,j=.4477152502;a.beginPath(),a.moveTo(g+c,h),a.lineTo(g+e-c,h),i&&a.bezierCurveTo(g+e-j*c,h,g+e,h+j*d,g+e,h+d),a.lineTo(g+e,h+f-d),i&&a.bezierCurveTo(g+e,h+f-j*d,g+e-j*c,h+f,g+e-c,h+f),a.lineTo(g+c,h+f),i&&a.bezierCurveTo(g+j*c,h+f,g,h+f-j*d,g,h+f-d),a.lineTo(g,h+d),i&&a.bezierCurveTo(g,h+j*d,g+j*c,h,g+c,h),a.closePath(),this._renderFill(a),this._renderStroke(a)},_renderDashedStroke:function(a){var c=-this.width/2,d=-this.height/2,e=this.width,f=this.height;a.beginPath(),b.util.drawDashedLine(a,c,d,c+e,d,this.strokeDashArray),b.util.drawDashedLine(a,c+e,d,c+e,d+f,this.strokeDashArray),b.util.drawDashedLine(a,c+e,d+f,c,d+f,this.strokeDashArray),b.util.drawDashedLine(a,c,d+f,c,d,this.strokeDashArray),a.closePath()},toObject:function(a){return this.callSuper("toObject",["rx","ry"].concat(a))},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=this.left,d=this.top;return this.group&&"path-group"===this.group.type||(c=-this.width/2,d=-this.height/2),b.push("<rect ",this.getSvgId(),'x="',c,'" y="',d,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),a?a(b.join("")):b.join("")},complexity:function(){return 1}}),b.Rect.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),b.Rect.fromElement=function(a,d){if(!a)return null;d=d||{};var e=b.parseAttributes(a,b.Rect.ATTRIBUTE_NAMES);e.left=e.left||0,e.top=e.top||0;var f=new b.Rect(c(d?b.util.object.clone(d):{},e));return f.visible=f.visible&&f.width>0&&f.height>0,f},b.Rect.fromObject=function(a,c){var d=new b.Rect(a);return c&&c(d),d}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={});return b.Polyline?void b.warn("fabric.Polyline is already defined"):(b.Polyline=b.util.createClass(b.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(a,c){return b.Polygon.prototype.initialize.call(this,a,c)},_calcDimensions:function(){return b.Polygon.prototype._calcDimensions.call(this)},toObject:function(a){return b.Polygon.prototype.toObject.call(this,a)},toSVG:function(a){return b.Polygon.prototype.toSVG.call(this,a)},_render:function(a,c){b.Polygon.prototype.commonRender.call(this,a,c)&&(this._renderFill(a),this._renderStroke(a))},_renderDashedStroke:function(a){var c,d;a.beginPath();for(var e=0,f=this.points.length;f>e;e++)c=this.points[e],d=this.points[e+1]||c,b.util.drawDashedLine(a,c.x,c.y,d.x,d.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),b.Polyline.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(),b.Polyline.fromElement=function(a,c){if(!a)return null;c||(c={});var d=b.parsePointsAttribute(a.getAttribute("points")),e=b.parseAttributes(a,b.Polyline.ATTRIBUTE_NAMES);return new b.Polyline(d,b.util.object.extend(e,c))},void(b.Polyline.fromObject=function(a,c){var d=new b.Polyline(a.points,a);return c&&c(d),d}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.array.min,e=b.util.array.max,f=b.util.toFixed;return b.Polygon?void b.warn("fabric.Polygon is already defined"):(b.Polygon=b.util.createClass(b.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(a,b){b=b||{},this.points=a||[],this.callSuper("initialize",b),this._calcDimensions(),"top"in b||(this.top=this.minY),"left"in b||(this.left=this.minX),this.pathOffset={x:this.minX+this.width/2,y:this.minY+this.height/2}},_calcDimensions:function(){var a=this.points,b=d(a,"x"),c=d(a,"y"),f=e(a,"x"),g=e(a,"y");this.width=f-b||0,this.height=g-c||0,this.minX=b||0,this.minY=c||0},toObject:function(a){return c(this.callSuper("toObject",a),{points:this.points.concat()})},toSVG:function(a){for(var b,c=[],d=this._createBaseSVGMarkup(),e=0,g=this.points.length;g>e;e++)c.push(f(this.points[e].x,2),",",f(this.points[e].y,2)," ");return this.group&&"path-group"===this.group.type||(b=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") "),d.push("<",this.type," ",this.getSvgId(),'points="',c.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),b," ",this.getSvgTransformMatrix(),'"/>\n'),a?a(d.join("")):d.join("")},_render:function(a,b){this.commonRender(a,b)&&(this._renderFill(a),(this.stroke||this.strokeDashArray)&&(a.closePath(),this._renderStroke(a)))},commonRender:function(a,b){var c,d=this.points.length;if(!d||isNaN(this.points[d-1].y))return!1;b||a.translate(-this.pathOffset.x,-this.pathOffset.y),a.beginPath(),a.moveTo(this.points[0].x,this.points[0].y);for(var e=0;d>e;e++)c=this.points[e],a.lineTo(c.x,c.y);return!0},_renderDashedStroke:function(a){b.Polyline.prototype._renderDashedStroke.call(this,a),a.closePath()},complexity:function(){return this.points.length}}),b.Polygon.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(),b.Polygon.fromElement=function(a,d){if(!a)return null;d||(d={});var e=b.parsePointsAttribute(a.getAttribute("points")),f=b.parseAttributes(a,b.Polygon.ATTRIBUTE_NAMES);return new b.Polygon(e,c(f,d))},void(b.Polygon.fromObject=function(a,c){var d=new b.Polygon(a.points,a);return c&&c(d),d}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.array.min,d=b.util.array.max,e=b.util.object.extend,f=Object.prototype.toString,g=b.util.drawArc,h={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},i={m:"l",M:"L"};return b.Path?void b.warn("fabric.Path is already defined"):(b.Path=b.util.createClass(b.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(a,b){b=b||{},b&&this.setOptions(b),a||(a=[]);var c="[object Array]"===f.call(a);this.path=c?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(c||(this.path=this._parsePath()),this._setPositionDimensions(b),b.sourcePath&&this.setSourcePath(b.sourcePath),this.objectCaching&&(this._createCacheCanvas(),this.setupState({propertySet:"cacheProperties"})))},_setPositionDimensions:function(a){var b=this._parseDimensions();this.minX=b.left,this.minY=b.top,this.width=b.width,this.height=b.height,"undefined"==typeof a.left&&(this.left=b.left+("center"===this.originX?this.width/2:"right"===this.originX?this.width:0)),"undefined"==typeof a.top&&(this.top=b.top+("center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0)),this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_renderPathCommands:function(a){var b,c,d,e=null,f=0,h=0,i=0,j=0,k=0,l=0,m=-this.pathOffset.x,n=-this.pathOffset.y;this.group&&"path-group"===this.group.type&&(m=0,n=0),a.beginPath();for(var o=0,p=this.path.length;p>o;++o){switch(b=this.path[o],b[0]){case"l":i+=b[1],j+=b[2],a.lineTo(i+m,j+n);break;case"L":i=b[1],j=b[2],a.lineTo(i+m,j+n);break;case"h":i+=b[1],a.lineTo(i+m,j+n);break;case"H":i=b[1],a.lineTo(i+m,j+n);break;case"v":j+=b[1],a.lineTo(i+m,j+n);break;case"V":j=b[1],a.lineTo(i+m,j+n);break;case"m":i+=b[1],j+=b[2],f=i,h=j,a.moveTo(i+m,j+n);break;case"M":i=b[1],j=b[2],f=i,h=j,a.moveTo(i+m,j+n);break;case"c":c=i+b[5],d=j+b[6],k=i+b[3],l=j+b[4],a.bezierCurveTo(i+b[1]+m,j+b[2]+n,k+m,l+n,c+m,d+n),i=c,j=d;break;case"C":i=b[5],j=b[6],k=b[3],l=b[4],a.bezierCurveTo(b[1]+m,b[2]+n,k+m,l+n,i+m,j+n);break;case"s":c=i+b[3],d=j+b[4],null===e[0].match(/[CcSs]/)?(k=i,l=j):(k=2*i-k,l=2*j-l),a.bezierCurveTo(k+m,l+n,i+b[1]+m,j+b[2]+n,c+m,d+n),k=i+b[1],l=j+b[2],i=c,j=d;break;case"S":c=b[3],d=b[4],null===e[0].match(/[CcSs]/)?(k=i,l=j):(k=2*i-k,l=2*j-l),a.bezierCurveTo(k+m,l+n,b[1]+m,b[2]+n,c+m,d+n),i=c,j=d,k=b[1],l=b[2];break;case"q":c=i+b[3],d=j+b[4],k=i+b[1],l=j+b[2],a.quadraticCurveTo(k+m,l+n,c+m,d+n),i=c,j=d;break;case"Q":c=b[3],d=b[4],a.quadraticCurveTo(b[1]+m,b[2]+n,c+m,d+n),i=c,j=d,k=b[1],l=b[2];break;case"t":c=i+b[1],d=j+b[2],null===e[0].match(/[QqTt]/)?(k=i,l=j):(k=2*i-k,l=2*j-l),a.quadraticCurveTo(k+m,l+n,c+m,d+n),i=c,j=d;break;case"T":c=b[1],d=b[2],null===e[0].match(/[QqTt]/)?(k=i,l=j):(k=2*i-k,l=2*j-l),a.quadraticCurveTo(k+m,l+n,c+m,d+n),i=c,j=d;break;case"a":g(a,i+m,j+n,[b[1],b[2],b[3],b[4],b[5],b[6]+i+m,b[7]+j+n]),i+=b[6],j+=b[7];break;case"A":g(a,i+m,j+n,[b[1],b[2],b[3],b[4],b[5],b[6]+m,b[7]+n]),i=b[6],j=b[7];break;case"z":case"Z":i=f,j=h,a.closePath()}e=b}},_render:function(a){this._renderPathCommands(a),this._renderFill(a),this._renderStroke(a)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(a){var b=e(this.callSuper("toObject",["sourcePath","pathOffset"].concat(a)),{path:this.path.map(function(a){return a.slice()})});return b},toDatalessObject:function(a){var b=this.toObject(a);return this.sourcePath&&(b.path=this.sourcePath),delete b.sourcePath,b},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),d="",e=0,f=this.path.length;f>e;e++)b.push(this.path[e].join(" "));var g=b.join(" ");return this.group&&"path-group"===this.group.type||(d=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") "),c.push("<path ",this.getSvgId(),'d="',g,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),d,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n"),a?a(c.join("")):c.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var a,b,c,d,e,f=[],g=[],j=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,k=0,l=this.path.length;l>k;k++){for(a=this.path[k],d=a.slice(1).trim(),g.length=0;c=j.exec(d);)g.push(c[0]);e=[a.charAt(0)];for(var m=0,n=g.length;n>m;m++)b=parseFloat(g[m]),isNaN(b)||e.push(b);var o=e[0],p=h[o.toLowerCase()],q=i[o]||o;if(e.length-1>p)for(var r=1,s=e.length;s>r;r+=p)f.push([o].concat(e.slice(r,r+p))),o=q;else f.push(e)}return f},_parseDimensions:function(){
for(var a,e,f,g,h=[],i=[],j=null,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=this.path.length;r>q;++q){switch(a=this.path[q],a[0]){case"l":m+=a[1],n+=a[2],g=[];break;case"L":m=a[1],n=a[2],g=[];break;case"h":m+=a[1],g=[];break;case"H":m=a[1],g=[];break;case"v":n+=a[1],g=[];break;case"V":n=a[1],g=[];break;case"m":m+=a[1],n+=a[2],k=m,l=n,g=[];break;case"M":m=a[1],n=a[2],k=m,l=n,g=[];break;case"c":e=m+a[5],f=n+a[6],o=m+a[3],p=n+a[4],g=b.util.getBoundsOfCurve(m,n,m+a[1],n+a[2],o,p,e,f),m=e,n=f;break;case"C":m=a[5],n=a[6],o=a[3],p=a[4],g=b.util.getBoundsOfCurve(m,n,a[1],a[2],o,p,m,n);break;case"s":e=m+a[3],f=n+a[4],null===j[0].match(/[CcSs]/)?(o=m,p=n):(o=2*m-o,p=2*n-p),g=b.util.getBoundsOfCurve(m,n,o,p,m+a[1],n+a[2],e,f),o=m+a[1],p=n+a[2],m=e,n=f;break;case"S":e=a[3],f=a[4],null===j[0].match(/[CcSs]/)?(o=m,p=n):(o=2*m-o,p=2*n-p),g=b.util.getBoundsOfCurve(m,n,o,p,a[1],a[2],e,f),m=e,n=f,o=a[1],p=a[2];break;case"q":e=m+a[3],f=n+a[4],o=m+a[1],p=n+a[2],g=b.util.getBoundsOfCurve(m,n,o,p,o,p,e,f),m=e,n=f;break;case"Q":o=a[1],p=a[2],g=b.util.getBoundsOfCurve(m,n,o,p,o,p,a[3],a[4]),m=a[3],n=a[4];break;case"t":e=m+a[1],f=n+a[2],null===j[0].match(/[QqTt]/)?(o=m,p=n):(o=2*m-o,p=2*n-p),g=b.util.getBoundsOfCurve(m,n,o,p,o,p,e,f),m=e,n=f;break;case"T":e=a[1],f=a[2],null===j[0].match(/[QqTt]/)?(o=m,p=n):(o=2*m-o,p=2*n-p),g=b.util.getBoundsOfCurve(m,n,o,p,o,p,e,f),m=e,n=f;break;case"a":g=b.util.getBoundsOfArc(m,n,a[1],a[2],a[3],a[4],a[5],a[6]+m,a[7]+n),m+=a[6],n+=a[7];break;case"A":g=b.util.getBoundsOfArc(m,n,a[1],a[2],a[3],a[4],a[5],a[6],a[7]),m=a[6],n=a[7];break;case"z":case"Z":m=k,n=l}j=a,g.forEach(function(a){h.push(a.x),i.push(a.y)}),h.push(m),i.push(n)}var s=c(h)||0,t=c(i)||0,u=d(h)||0,v=d(i)||0,w=u-s,x=v-t,y={left:s,top:t,width:w,height:x};return y}}),b.Path.fromObject=function(a,c){var d;return"string"!=typeof a.path?(d=new b.Path(a.path,a),c&&c(d),d):void b.loadSVGFromURL(a.path,function(e){var f=a.path;d=e[0],delete a.path,b.util.object.extend(d,a),d.setSourcePath(f),c&&c(d)})},b.Path.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(["d"]),b.Path.fromElement=function(a,c,d){var f=b.parseAttributes(a,b.Path.ATTRIBUTE_NAMES);c&&c(new b.Path(f.d,e(f,d)))},void(b.Path.async=!0))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.array.invoke,e=b.Object.prototype.toObject;return b.PathGroup?void b.warn("fabric.PathGroup is already defined"):(b.PathGroup=b.util.createClass(b.Object,{type:"path-group",fill:"",initialize:function(a,b){b=b||{},this.paths=a||[];for(var c=this.paths.length;c--;)this.paths[c].group=this;b.toBeParsed&&(this.parseDimensionsFromPaths(b),delete b.toBeParsed),this.setOptions(b),this.setCoords(),b.sourcePath&&this.setSourcePath(b.sourcePath),this.objectCaching&&(this._createCacheCanvas(),this.setupState({propertySet:"cacheProperties"}))},parseDimensionsFromPaths:function(a){for(var c,d,e,f,g,h,i=[],j=[],k=this.paths.length;k--;){e=this.paths[k],f=e.height+e.strokeWidth,g=e.width+e.strokeWidth,c=[{x:e.left,y:e.top},{x:e.left+g,y:e.top},{x:e.left,y:e.top+f},{x:e.left+g,y:e.top+f}],h=this.paths[k].transformMatrix;for(var l=0;l<c.length;l++)d=c[l],h&&(d=b.util.transformPoint(d,h,!1)),i.push(d.x),j.push(d.y)}a.width=Math.max.apply(null,i),a.height=Math.max.apply(null,j)},drawObject:function(a){a.save(),a.translate(-this.width/2,-this.height/2);for(var b=0,c=this.paths.length;c>b;++b)this.paths[b].render(a,!0);a.restore()},isCacheDirty:function(){if(this.callSuper("isCacheDirty"))return!0;if(!this.statefullCache)return!1;for(var a=0,b=this.paths.length;b>a;a++)if(this.paths[a].isCacheDirty(!0)){var c=this._getNonTransformedDimensions();return this._cacheContext.clearRect(-c.x/2,-c.y/2,c.x,c.y),!0}return!1},_set:function(a,b){if("fill"===a&&b&&this.isSameColor())for(var c=this.paths.length;c--;)this.paths[c]._set(a,b);return this.callSuper("_set",a,b)},toObject:function(a){var b=c(e.call(this,["sourcePath"].concat(a)),{paths:d(this.getObjects(),"toObject",a)});return b},toDatalessObject:function(a){var b=this.toObject(a);return this.sourcePath&&(b.paths=this.sourcePath),b},toSVG:function(a){var b=this.getObjects(),c=this.getPointByOrigin("left","top"),d="translate("+c.x+" "+c.y+")",e=this._createBaseSVGMarkup();e.push("<g ",this.getSvgId(),'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),d,this.getSvgTransform(),'" ',">\n");for(var f=0,g=b.length;g>f;f++)e.push("	",b[f].toSVG(a));return e.push("</g>\n"),a?a(e.join("")):e.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=this.getObjects()[0].get("fill")||"";return"string"!=typeof a?!1:(a=a.toLowerCase(),this.getObjects().every(function(b){var c=b.get("fill")||"";return"string"==typeof c&&c.toLowerCase()===a}))},complexity:function(){return this.paths.reduce(function(a,b){return a+(b&&b.complexity?b.complexity():0)},0)},getObjects:function(){return this.paths}}),b.PathGroup.fromObject=function(a,c){"string"==typeof a.paths?b.loadSVGFromURL(a.paths,function(d){var e=a.paths;delete a.paths;var f=b.util.groupSVGElements(d,a,e);c(f)}):b.util.enlivenObjects(a.paths,function(d){delete a.paths,c(new b.PathGroup(d,a))})},void(b.PathGroup.async=!0))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.array.min,e=b.util.array.max,f=b.util.array.invoke;if(!b.Group){var g={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};b.Group=b.util.createClass(b.Object,b.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,initialize:function(a,b,c){b=b||{},this._objects=[],c&&this.callSuper("initialize",b),this._objects=a||[];for(var d=this._objects.length;d--;)this._objects[d].group=this;this.originalState={},b.originX&&(this.originX=b.originX),b.originY&&(this.originY=b.originY),c?this._updateObjectsCoords(!0):(this._calcBounds(),this._updateObjectsCoords(),this.callSuper("initialize",b)),this.setCoords(),this.saveCoords()},_updateObjectsCoords:function(a){for(var b=this.getCenterPoint(),c=this._objects.length;c--;)this._updateObjectCoords(this._objects[c],b,a)},_updateObjectCoords:function(a,b,c){if(a.__origHasControls=a.hasControls,a.hasControls=!1,!c){var d=a.getLeft(),e=a.getTop(),f=!0;a.set({originalLeft:d,originalTop:e,left:d-b.x,top:e-b.y}),a.setCoords(f)}},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){return this._restoreObjectsState(),b.util.resetObjectTransform(this),a&&(this._objects.push(a),a.group=this,a._set("canvas",this.canvas)),this.forEachObject(this._setObjectActive,this),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,this},_setObjectActive:function(a){a.set("active",!0),a.group=this},removeWithUpdate:function(a){return this._restoreObjectsState(),b.util.resetObjectTransform(this),this.forEachObject(this._setObjectActive,this),this.remove(a),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,this},_onObjectAdded:function(a){this.dirty=!0,a.group=this,a._set("canvas",this.canvas)},_onObjectRemoved:function(a){this.dirty=!0,delete a.group,a.set("active",!1)},delegatedProperties:{fill:!0,stroke:!0,strokeWidth:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(a,b){var c=this._objects.length;if(this.delegatedProperties[a]||"canvas"===a)for(;c--;)this._objects[c].set(a,b);else for(;c--;)this._objects[c].setOnGroup(a,b);this.callSuper("_set",a,b)},toObject:function(a){return c(this.callSuper("toObject",a),{objects:f(this._objects,"toObject",a)})},render:function(a){this._transformDone=!0,this.callSuper("render",a),this._transformDone=!1},drawObject:function(a){for(var b=0,c=this._objects.length;c>b;b++)this._renderObject(this._objects[b],a)},isCacheDirty:function(){if(this.callSuper("isCacheDirty"))return!0;if(!this.statefullCache)return!1;for(var a=0,b=this._objects.length;b>a;a++)if(this._objects[a].isCacheDirty(!0)){var c=this._getNonTransformedDimensions();return this._cacheContext.clearRect(-c.x/2,-c.y/2,c.x,c.y),!0}return!1},_renderControls:function(a,b){a.save(),a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",a,b);for(var c=0,d=this._objects.length;d>c;c++)this._objects[c]._renderControls(a);a.restore()},_renderObject:function(a,b){if(a.visible){var c=a.hasRotatingPoint;a.hasRotatingPoint=!1,a.render(b),a.hasRotatingPoint=c}},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(a){var c=a.calcTransformMatrix(),d=b.util.qrDecompose(c),e=new b.Point(d.translateX,d.translateY);return a.flipX=!1,a.flipY=!1,a.set("scaleX",d.scaleX),a.set("scaleY",d.scaleY),a.skewX=d.skewX,a.skewY=d.skewY,a.angle=d.angle,a.setPositionByOrigin(e,"center","center"),a},_restoreObjectState:function(a){return this.realizeTransform(a),a.setCoords(),a.hasControls=a.__origHasControls,delete a.__origHasControls,a.set("active",!1),delete a.group,this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){var a=!0;return this.forEachObject(function(b){b.setCoords(a)}),this},_calcBounds:function(a){for(var b,c,d,e=[],f=[],g=["tr","br","bl","tl"],h=0,i=this._objects.length,j=g.length,k=!0;i>h;++h)for(b=this._objects[h],b.setCoords(k),d=0;j>d;d++)c=g[d],e.push(b.oCoords[c].x),f.push(b.oCoords[c].y);this.set(this._getBounds(e,f,a))},_getBounds:function(a,c,f){var g=new b.Point(d(a),d(c)),h=new b.Point(e(a),e(c)),i={width:h.x-g.x||0,height:h.y-g.y||0};return f||(i.left=g.x||0,i.top=g.y||0,"center"===this.originX&&(i.left+=i.width/2),"right"===this.originX&&(i.left+=i.width),"center"===this.originY&&(i.top+=i.height/2),"bottom"===this.originY&&(i.top+=i.height)),i},toSVG:function(a){var b=this._createBaseSVGMarkup();b.push("<g ",this.getSvgId(),'transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'" style="',this.getSvgFilter(),'">\n');for(var c=0,d=this._objects.length;d>c;c++)b.push("	",this._objects[c].toSVG(a));return b.push("</g>\n"),a?a(b.join("")):b.join("")},get:function(a){if(a in g){if(this[a])return this[a];for(var b=0,c=this._objects.length;c>b;b++)if(this._objects[b][a])return!0;return!1}return a in this.delegatedProperties?this._objects[0]&&this._objects[0].get(a):this[a]}}),b.Group.fromObject=function(a,c){b.util.enlivenObjects(a.objects,function(d){delete a.objects,c&&c(new b.Group(d,a,!0))})},b.Group.async=!0}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=fabric.util.object.extend;if(a.fabric||(a.fabric={}),a.fabric.Image)return void fabric.warn("fabric.Image is already defined.");var c=fabric.Object.prototype.stateProperties.concat();c.push("alignX","alignY","meetOrSlice"),fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",strokeWidth:0,_lastScaleX:1,_lastScaleY:1,minimumScaleTrigger:.5,stateProperties:c,objectCaching:!1,initialize:function(a,b,c){b||(b={}),this.filters=[],this.resizeFilters=[],this.callSuper("initialize",b),this._initElement(a,b,c)},getElement:function(){return this._element},setElement:function(a,b,c){var d,e;return this._element=a,this._originalElement=a,this._initConfig(c),0===this.resizeFilters.length?d=b:(e=this,d=function(){e.applyFilters(b,e.resizeFilters,e._filteredEl||e._originalElement,!0)}),0!==this.filters.length?this.applyFilters(d):d&&d(this),this},setCrossOrigin:function(a){return this.crossOrigin=a,this._element.crossOrigin=a,this},getOriginalSize:function(){var a=this.getElement();return{width:a.width,height:a.height}},_stroke:function(a){if(this.stroke&&0!==this.strokeWidth){var b=this.width/2,c=this.height/2;a.beginPath(),a.moveTo(-b,-c),a.lineTo(b,-c),a.lineTo(b,c),a.lineTo(-b,c),a.lineTo(-b,-c),a.closePath()}},_renderDashedStroke:function(a){var b=-this.width/2,c=-this.height/2,d=this.width,e=this.height;a.save(),this._setStrokeStyles(a),a.beginPath(),fabric.util.drawDashedLine(a,b,c,b+d,c,this.strokeDashArray),fabric.util.drawDashedLine(a,b+d,c,b+d,c+e,this.strokeDashArray),fabric.util.drawDashedLine(a,b+d,c+e,b,c+e,this.strokeDashArray),fabric.util.drawDashedLine(a,b,c+e,b,c,this.strokeDashArray),a.closePath(),a.restore()},toObject:function(a){var c=[],d=[],e=1,f=1;this.filters.forEach(function(a){a&&("Resize"===a.type&&(e*=a.scaleX,f*=a.scaleY),c.push(a.toObject()))}),this.resizeFilters.forEach(function(a){a&&d.push(a.toObject())});var g=b(this.callSuper("toObject",["crossOrigin","alignX","alignY","meetOrSlice"].concat(a)),{src:this.getSrc(),filters:c,resizeFilters:d});return g.width/=e,g.height/=f,g},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=-this.width/2,d=-this.height/2,e="none",f=!0;if(this.group&&"path-group"===this.group.type&&(c=this.left,d=this.top),"none"!==this.alignX&&"none"!==this.alignY&&(e="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice),b.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',"<image ",this.getSvgId(),'xlink:href="',this.getSvgSrc(f),'" x="',c,'" y="',d,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',e,'"',"></image>\n"),this.stroke||this.strokeDashArray){var g=this.fill;this.fill=null,b.push("<rect ",'x="',c,'" y="',d,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=g}return b.push("</g>\n"),a?a(b.join("")):b.join("")},getSrc:function(a){var b=a?this._element:this._originalElement;return b?fabric.isLikelyNode?b._src:b.src:this.src||""},setSrc:function(a,b,c){fabric.util.loadImage(a,function(a){return this.setElement(a,b,c)},this,c&&c.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyFilters:function(a,b,c,d){if(b=b||this.filters,c=c||this._originalElement){var e,f,g=fabric.util.createImage(),h=this.canvas?this.canvas.getRetinaScaling():fabric.devicePixelRatio,i=this.minimumScaleTrigger/h,j=this;if(0===b.length)return this._element=c,a&&a(this),c;var k=fabric.util.createCanvasElement();return k.width=c.width,k.height=c.height,k.getContext("2d").drawImage(c,0,0,c.width,c.height),b.forEach(function(a){a&&(d?(e=j.scaleX<i?j.scaleX:1,f=j.scaleY<i?j.scaleY:1,1>e*h&&(e*=h),1>f*h&&(f*=h)):(e=a.scaleX,f=a.scaleY),a.applyTo(k,e,f),d||"Resize"!==a.type||(j.width*=a.scaleX,j.height*=a.scaleY))}),g.width=k.width,g.height=k.height,fabric.isLikelyNode?(g.src=k.toBuffer(void 0,fabric.Image.pngCompression),j._element=g,!d&&(j._filteredEl=g),a&&a(j)):(g.onload=function(){j._element=g,!d&&(j._filteredEl=g),a&&a(j),g.onload=k=null},g.src=k.toDataURL("image/png")),k}},_render:function(a,b){var c,d,e,f=this._findMargins();c=b?this.left:-this.width/2,d=b?this.top:-this.height/2,"slice"===this.meetOrSlice&&(a.beginPath(),a.rect(c,d,this.width,this.height),a.clip()),this.isMoving===!1&&this.resizeFilters.length&&this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,e=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!0)):e=this._element,e&&a.drawImage(e,c+f.marginX,d+f.marginY,f.width,f.height),this._stroke(a),this._renderStroke(a)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var a,b,c=this.width,d=this.height,e=0,f=0;return("none"!==this.alignX||"none"!==this.alignY)&&(a=[this.width/this._element.width,this.height/this._element.height],b="meet"===this.meetOrSlice?Math.min.apply(null,a):Math.max.apply(null,a),c=this._element.width*b,d=this._element.height*b,"Mid"===this.alignX&&(e=(this.width-c)/2),"Max"===this.alignX&&(e=this.width-c),"Mid"===this.alignY&&(f=(this.height-d)/2),"Max"===this.alignY&&(f=this.height-d)),{width:c,height:d,marginX:e,marginY:f}},_resetWidthHeight:function(){var a=this.getElement();this.set("width",a.width),this.set("height",a.height)},_initElement:function(a,b,c){this.setElement(fabric.util.getById(a),c,b),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(a){a||(a={}),this.setOptions(a),this._setWidthHeight(a),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(a,b){a&&a.length?fabric.util.enlivenObjects(a,function(a){b&&b(a)},"fabric.Image.filters"):b&&b()},_setWidthHeight:function(a){this.width="width"in a?a.width:this.getElement()?this.getElement().width||0:0,this.height="height"in a?a.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(a,b){fabric.util.loadImage(a.src,function(c){fabric.Image.prototype._initFilters.call(a,a.filters,function(d){a.filters=d||[],fabric.Image.prototype._initFilters.call(a,a.resizeFilters,function(d){return a.resizeFilters=d||[],new fabric.Image(c,a,b)})})},null,a.crossOrigin)},fabric.Image.fromURL=function(a,b,c){fabric.util.loadImage(a,function(a){b&&b(new fabric.Image(a,c))},null,c&&c.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")),fabric.Image.fromElement=function(a,c,d){var e,f=fabric.parseAttributes(a,fabric.Image.ATTRIBUTE_NAMES);f.preserveAspectRatio&&(e=fabric.util.parsePreserveAspectRatioAttribute(f.preserveAspectRatio),b(f,e)),fabric.Image.fromURL(f["xlink:href"],c,b(d?fabric.util.object.clone(d):{},f))},fabric.Image.async=!0,fabric.Image.pngCompression=1}("undefined"!=typeof exports?exports:this),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var a=this.getAngle()%360;return a>0?90*Math.round((a-1)/90):90*Math.round(a/90)},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(a){a=a||{};var b=function(){},c=a.onComplete||b,d=a.onChange||b,e=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(a){e.setAngle(a),d()},onComplete:function(){e.setCoords(),c()},onStart:function(){e.set("active",!1)}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(a){return a.straighten(),this.renderAll(),this},fxStraightenObject:function(a){return a.fxStraighten({onChange:this.renderAll.bind(this)}),this}}),fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",initialize:function(a){a&&this.setOptions(a)},setOptions:function(a){for(var b in a)this[b]=a[b]},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}}),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.Brightness=e(d.BaseFilter,{type:"Brightness",initialize:function(a){a=a||{},this.brightness=a.brightness||0},applyTo:function(a){for(var b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=c.data,e=this.brightness,f=0,g=d.length;g>f;f+=4)d[f]+=e,d[f+1]+=e,d[f+2]+=e;b.putImageData(c,0,0)},toObject:function(){return c(this.callSuper("toObject"),{brightness:this.brightness})}}),b.Image.filters.Brightness.fromObject=function(a){return new b.Image.filters.Brightness(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.Convolute=e(d.BaseFilter,{type:"Convolute",initialize:function(a){a=a||{},this.opaque=a.opaque,this.matrix=a.matrix||[0,0,0,0,1,0,0,0,0]},applyTo:function(a){for(var b,c,d,e,f,g,h,i,j,k=this.matrix,l=a.getContext("2d"),m=l.getImageData(0,0,a.width,a.height),n=Math.round(Math.sqrt(k.length)),o=Math.floor(n/2),p=m.data,q=m.width,r=m.height,s=l.createImageData(q,r),t=s.data,u=this.opaque?1:0,v=0;r>v;v++)for(var w=0;q>w;w++){f=4*(v*q+w),b=0,c=0,d=0,e=0;for(var x=0;n>x;x++)for(var y=0;n>y;y++)h=v+x-o,g=w+y-o,0>h||h>r||0>g||g>q||(i=4*(h*q+g),j=k[x*n+y],b+=p[i]*j,c+=p[i+1]*j,d+=p[i+2]*j,e+=p[i+3]*j);t[f]=b,t[f+1]=c,t[f+2]=d,t[f+3]=e+u*(255-e)}l.putImageData(s,0,0)},toObject:function(){return c(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),b.Image.filters.Convolute.fromObject=function(a){return new b.Image.filters.Convolute(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.GradientTransparency=e(d.BaseFilter,{type:"GradientTransparency",initialize:function(a){a=a||{},this.threshold=a.threshold||100},applyTo:function(a){for(var b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=c.data,e=this.threshold,f=d.length,g=0,h=d.length;h>g;g+=4)d[g+3]=e+255*(f-g)/f;b.putImageData(c,0,0)},toObject:function(){return c(this.callSuper("toObject"),{threshold:this.threshold})}}),b.Image.filters.GradientTransparency.fromObject=function(a){return new b.Image.filters.GradientTransparency(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Grayscale=d(c.BaseFilter,{type:"Grayscale",applyTo:function(a){for(var b,c=a.getContext("2d"),d=c.getImageData(0,0,a.width,a.height),e=d.data,f=d.width*d.height*4,g=0;f>g;)b=(e[g]+e[g+1]+e[g+2])/3,e[g]=b,e[g+1]=b,e[g+2]=b,g+=4;c.putImageData(d,0,0)}}),b.Image.filters.Grayscale.fromObject=function(){return new b.Image.filters.Grayscale}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Invert=d(c.BaseFilter,{type:"Invert",applyTo:function(a){var b,c=a.getContext("2d"),d=c.getImageData(0,0,a.width,a.height),e=d.data,f=e.length;for(b=0;f>b;b+=4)e[b]=255-e[b],e[b+1]=255-e[b+1],e[b+2]=255-e[b+2];c.putImageData(d,0,0)}}),b.Image.filters.Invert.fromObject=function(){return new b.Image.filters.Invert}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.Mask=e(d.BaseFilter,{type:"Mask",initialize:function(a){a=a||{},this.mask=a.mask,this.channel=[0,1,2,3].indexOf(a.channel)>-1?a.channel:0},applyTo:function(a){if(this.mask){var c,d=a.getContext("2d"),e=d.getImageData(0,0,a.width,a.height),f=e.data,g=this.mask.getElement(),h=b.util.createCanvasElement(),i=this.channel,j=e.width*e.height*4;h.width=a.width,h.height=a.height,h.getContext("2d").drawImage(g,0,0,a.width,a.height);var k=h.getContext("2d").getImageData(0,0,a.width,a.height),l=k.data;for(c=0;j>c;c+=4)f[c+3]=l[c+i];d.putImageData(e,0,0)}},toObject:function(){return c(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}}),b.Image.filters.Mask.fromObject=function(a,c){b.util.loadImage(a.mask.src,function(d){a.mask=new b.Image(d,a.mask),c&&c(new b.Image.filters.Mask(a))})},b.Image.filters.Mask.async=!0}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.Noise=e(d.BaseFilter,{type:"Noise",initialize:function(a){a=a||{},this.noise=a.noise||0},applyTo:function(a){for(var b,c=a.getContext("2d"),d=c.getImageData(0,0,a.width,a.height),e=d.data,f=this.noise,g=0,h=e.length;h>g;g+=4)b=(.5-Math.random())*f,e[g]+=b,e[g+1]+=b,e[g+2]+=b;c.putImageData(d,0,0)},toObject:function(){return c(this.callSuper("toObject"),{noise:this.noise})}}),b.Image.filters.Noise.fromObject=function(a){return new b.Image.filters.Noise(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.Pixelate=e(d.BaseFilter,{type:"Pixelate",initialize:function(a){a=a||{},this.blocksize=a.blocksize||4},applyTo:function(a){var b,c,d,e,f,g,h,i=a.getContext("2d"),j=i.getImageData(0,0,a.width,a.height),k=j.data,l=j.height,m=j.width;for(c=0;l>c;c+=this.blocksize)for(d=0;m>d;d+=this.blocksize){b=4*c*m+4*d,e=k[b],f=k[b+1],g=k[b+2],h=k[b+3];for(var n=c,o=c+this.blocksize;o>n;n++)for(var p=d,q=d+this.blocksize;q>p;p++)b=4*n*m+4*p,k[b]=e,k[b+1]=f,k[b+2]=g,k[b+3]=h}i.putImageData(j,0,0)},toObject:function(){return c(this.callSuper("toObject"),{blocksize:this.blocksize})}}),b.Image.filters.Pixelate.fromObject=function(a){return new b.Image.filters.Pixelate(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.RemoveWhite=e(d.BaseFilter,{type:"RemoveWhite",initialize:function(a){a=a||{},this.threshold=a.threshold||30,this.distance=a.distance||20},applyTo:function(a){for(var b,c,d,e=a.getContext("2d"),f=e.getImageData(0,0,a.width,a.height),g=f.data,h=this.threshold,i=this.distance,j=255-h,k=Math.abs,l=0,m=g.length;m>l;l+=4)b=g[l],c=g[l+1],d=g[l+2],b>j&&c>j&&d>j&&k(b-c)<i&&k(b-d)<i&&k(c-d)<i&&(g[l+3]=0);e.putImageData(f,0,0)},toObject:function(){return c(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}}),b.Image.filters.RemoveWhite.fromObject=function(a){return new b.Image.filters.RemoveWhite(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Sepia=d(c.BaseFilter,{type:"Sepia",applyTo:function(a){var b,c,d=a.getContext("2d"),e=d.getImageData(0,0,a.width,a.height),f=e.data,g=f.length;for(b=0;g>b;b+=4)c=.3*f[b]+.59*f[b+1]+.11*f[b+2],f[b]=c+100,f[b+1]=c+50,f[b+2]=c+255;d.putImageData(e,0,0)}}),b.Image.filters.Sepia.fromObject=function(){return new b.Image.filters.Sepia}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.Image.filters,d=b.util.createClass;c.Sepia2=d(c.BaseFilter,{type:"Sepia2",applyTo:function(a){var b,c,d,e,f=a.getContext("2d"),g=f.getImageData(0,0,a.width,a.height),h=g.data,i=h.length;for(b=0;i>b;b+=4)c=h[b],d=h[b+1],e=h[b+2],h[b]=(.393*c+.769*d+.189*e)/1.351,h[b+1]=(.349*c+.686*d+.168*e)/1.203,h[b+2]=(.272*c+.534*d+.131*e)/2.14;f.putImageData(g,0,0)}}),b.Image.filters.Sepia2.fromObject=function(){return new b.Image.filters.Sepia2}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.Tint=e(d.BaseFilter,{type:"Tint",initialize:function(a){a=a||{},this.color=a.color||"#000000",this.opacity="undefined"!=typeof a.opacity?a.opacity:new b.Color(this.color).getAlpha()},applyTo:function(a){var c,d,e,f,g,h,i,j,k,l=a.getContext("2d"),m=l.getImageData(0,0,a.width,a.height),n=m.data,o=n.length;for(k=new b.Color(this.color).getSource(),d=k[0]*this.opacity,e=k[1]*this.opacity,f=k[2]*this.opacity,j=1-this.opacity,c=0;o>c;c+=4)g=n[c],h=n[c+1],i=n[c+2],n[c]=d+g*j,n[c+1]=e+h*j,n[c+2]=f+i*j;l.putImageData(m,0,0)},toObject:function(){return c(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}}),b.Image.filters.Tint.fromObject=function(a){return new b.Image.filters.Tint(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.Multiply=e(d.BaseFilter,{type:"Multiply",initialize:function(a){a=a||{},this.color=a.color||"#000000"},applyTo:function(a){var c,d,e=a.getContext("2d"),f=e.getImageData(0,0,a.width,a.height),g=f.data,h=g.length;for(d=new b.Color(this.color).getSource(),c=0;h>c;c+=4)g[c]*=d[0]/255,g[c+1]*=d[1]/255,g[c+2]*=d[2]/255;e.putImageData(f,0,0)},toObject:function(){return c(this.callSuper("toObject"),{color:this.color})}}),b.Image.filters.Multiply.fromObject=function(a){return new b.Image.filters.Multiply(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric,c=b.Image.filters,d=b.util.createClass;c.Blend=d(c.BaseFilter,{type:"Blend",initialize:function(a){a=a||{},this.color=a.color||"#000",this.image=a.image||!1,this.mode=a.mode||"multiply",this.alpha=a.alpha||1},applyTo:function(a){var c,d,e,f,g,h,i,j,k,l,m=a.getContext("2d"),n=m.getImageData(0,0,a.width,a.height),o=n.data,p=!1;if(this.image){p=!0;var q=b.util.createCanvasElement();q.width=this.image.width,q.height=this.image.height;var r=new b.StaticCanvas(q);r.add(this.image);var s=r.getContext("2d");l=s.getImageData(0,0,r.width,r.height).data}else l=new b.Color(this.color).getSource(),c=l[0]*this.alpha,d=l[1]*this.alpha,e=l[2]*this.alpha;for(var t=0,u=o.length;u>t;t+=4)switch(f=o[t],g=o[t+1],h=o[t+2],p&&(c=l[t]*this.alpha,d=l[t+1]*this.alpha,e=l[t+2]*this.alpha),this.mode){case"multiply":o[t]=f*c/255,o[t+1]=g*d/255,o[t+2]=h*e/255;break;case"screen":o[t]=1-(1-f)*(1-c),o[t+1]=1-(1-g)*(1-d),o[t+2]=1-(1-h)*(1-e);break;case"add":o[t]=Math.min(255,f+c),o[t+1]=Math.min(255,g+d),o[t+2]=Math.min(255,h+e);break;case"diff":case"difference":o[t]=Math.abs(f-c),o[t+1]=Math.abs(g-d),o[t+2]=Math.abs(h-e);break;case"subtract":i=f-c,j=g-d,k=h-e,o[t]=0>i?0:i,o[t+1]=0>j?0:j,o[t+2]=0>k?0:k;break;case"darken":o[t]=Math.min(f,c),o[t+1]=Math.min(g,d),o[t+2]=Math.min(h,e);break;case"lighten":o[t]=Math.max(f,c),o[t+1]=Math.max(g,d),o[t+2]=Math.max(h,e)}m.putImageData(n,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}}),b.Image.filters.Blend.fromObject=function(a){return new b.Image.filters.Blend(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=Math.pow,d=Math.floor,e=Math.sqrt,f=Math.abs,g=Math.max,h=Math.round,i=Math.sin,j=Math.ceil,k=b.Image.filters,l=b.util.createClass;k.Resize=l(k.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(a,b,c){if(1!==b||1!==c){this.rcpScaleX=1/b,this.rcpScaleY=1/c;var d,e=a.width,f=a.height,g=h(e*b),i=h(f*c);"sliceHack"===this.resizeType&&(d=this.sliceByTwo(a,e,f,g,i)),"hermite"===this.resizeType&&(d=this.hermiteFastResize(a,e,f,g,i)),"bilinear"===this.resizeType&&(d=this.bilinearFiltering(a,e,f,g,i)),"lanczos"===this.resizeType&&(d=this.lanczosResize(a,e,f,g,i)),a.width=g,a.height=i,a.getContext("2d").putImageData(d,0,0)}},sliceByTwo:function(a,c,e,f,h){var i,j=a.getContext("2d"),k=.5,l=.5,m=1,n=1,o=!1,p=!1,q=c,r=e,s=b.util.createCanvasElement(),t=s.getContext("2d");for(f=d(f),h=d(h),s.width=g(f,c),s.height=g(h,e),f>c&&(k=2,m=-1),h>e&&(l=2,n=-1),i=j.getImageData(0,0,c,e),a.width=g(f,c),a.height=g(h,e),j.putImageData(i,0,0);!o||!p;)c=q,e=r,f*m<d(q*k*m)?q=d(q*k):(q=f,o=!0),h*n<d(r*l*n)?r=d(r*l):(r=h,p=!0),i=j.getImageData(0,0,c,e),t.putImageData(i,0,0),j.clearRect(0,0,q,r),j.drawImage(s,0,0,c,e,0,0,q,r);return j.getImageData(0,0,f,h)},lanczosResize:function(a,b,g,h,k){function l(a){return function(b){if(b>a)return 0;if(b*=Math.PI,f(b)<1e-16)return 1;var c=b/a;return i(b)*i(c)/b/c}}function m(a){var i,j,l,n,o,C,D,E,F,G,H;for(A.x=(a+.5)*t,B.x=d(A.x),i=0;k>i;i++){for(A.y=(i+.5)*u,B.y=d(A.y),o=0,C=0,D=0,E=0,F=0,j=B.x-x;j<=B.x+x;j++)if(!(0>j||j>=b)){G=d(1e3*f(j-A.x)),z[G]||(z[G]={});for(var I=B.y-y;I<=B.y+y;I++)0>I||I>=g||(H=d(1e3*f(I-A.y)),z[G][H]||(z[G][H]=s(e(c(G*v,2)+c(H*w,2))/1e3)),l=z[G][H],l>0&&(n=4*(I*b+j),o+=l,C+=l*q[n],D+=l*q[n+1],E+=l*q[n+2],F+=l*q[n+3]))}n=4*(i*h+a),r[n]=C/o,r[n+1]=D/o,r[n+2]=E/o,r[n+3]=F/o}return++a<h?m(a):p}var n=a.getContext("2d"),o=n.getImageData(0,0,b,g),p=n.getImageData(0,0,h,k),q=o.data,r=p.data,s=l(this.lanczosLobes),t=this.rcpScaleX,u=this.rcpScaleY,v=2/this.rcpScaleX,w=2/this.rcpScaleY,x=j(t*this.lanczosLobes/2),y=j(u*this.lanczosLobes/2),z={},A={},B={};return m(0)},bilinearFiltering:function(a,b,c,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t=0,u=this.rcpScaleX,v=this.rcpScaleY,w=a.getContext("2d"),x=4*(b-1),y=w.getImageData(0,0,b,c),z=y.data,A=w.getImageData(0,0,e,f),B=A.data;

for(m=0;f>m;m++)for(n=0;e>n;n++)for(k=d(u*n),l=d(v*m),o=u*n-k,p=v*m-l,s=4*(l*b+k),q=0;4>q;q++)g=z[s+q],h=z[s+4+q],i=z[s+x+q],j=z[s+x+4+q],r=g*(1-o)*(1-p)+h*o*(1-p)+i*p*(1-o)+j*o*p,B[t++]=r;return A},hermiteFastResize:function(a,b,c,g,h){for(var i=this.rcpScaleX,k=this.rcpScaleY,l=j(i/2),m=j(k/2),n=a.getContext("2d"),o=n.getImageData(0,0,b,c),p=o.data,q=n.getImageData(0,0,g,h),r=q.data,s=0;h>s;s++)for(var t=0;g>t;t++){for(var u=4*(t+s*g),v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=(s+.5)*k,D=d(s*k);(s+1)*k>D;D++)for(var E=f(C-(D+.5))/m,F=(t+.5)*i,G=E*E,H=d(t*i);(t+1)*i>H;H++){var I=f(F-(H+.5))/l,J=e(G+I*I);J>1&&-1>J||(v=2*J*J*J-3*J*J+1,v>0&&(I=4*(H+D*b),B+=v*p[I+3],x+=v,p[I+3]<255&&(v=v*p[I+3]/250),y+=v*p[I],z+=v*p[I+1],A+=v*p[I+2],w+=v))}r[u]=y/w,r[u+1]=z/w,r[u+2]=A/w,r[u+3]=B/x}return q},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),b.Image.filters.Resize.fromObject=function(a){return new b.Image.filters.Resize(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.ColorMatrix=e(d.BaseFilter,{type:"ColorMatrix",initialize:function(a){a||(a={}),this.matrix=a.matrix||[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]},applyTo:function(a){var b,c,d,e,f,g=a.getContext("2d"),h=g.getImageData(0,0,a.width,a.height),i=h.data,j=i.length,k=this.matrix;for(b=0;j>b;b+=4)c=i[b],d=i[b+1],e=i[b+2],f=i[b+3],i[b]=c*k[0]+d*k[1]+e*k[2]+f*k[3]+k[4],i[b+1]=c*k[5]+d*k[6]+e*k[7]+f*k[8]+k[9],i[b+2]=c*k[10]+d*k[11]+e*k[12]+f*k[13]+k[14],i[b+3]=c*k[15]+d*k[16]+e*k[17]+f*k[18]+k[19];g.putImageData(h,0,0)},toObject:function(){return c(this.callSuper("toObject"),{type:this.type,matrix:this.matrix})}}),b.Image.filters.ColorMatrix.fromObject=function(a){return new b.Image.filters.ColorMatrix(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.Contrast=e(d.BaseFilter,{type:"Contrast",initialize:function(a){a=a||{},this.contrast=a.contrast||0},applyTo:function(a){for(var b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=c.data,e=259*(this.contrast+255)/(255*(259-this.contrast)),f=0,g=d.length;g>f;f+=4)d[f]=e*(d[f]-128)+128,d[f+1]=e*(d[f+1]-128)+128,d[f+2]=e*(d[f+2]-128)+128;b.putImageData(c,0,0)},toObject:function(){return c(this.callSuper("toObject"),{contrast:this.contrast})}}),b.Image.filters.Contrast.fromObject=function(a){return new b.Image.filters.Contrast(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.Image.filters,e=b.util.createClass;d.Saturate=e(d.BaseFilter,{type:"Saturate",initialize:function(a){a=a||{},this.saturate=a.saturate||0},applyTo:function(a){for(var b,c=a.getContext("2d"),d=c.getImageData(0,0,a.width,a.height),e=d.data,f=.01*-this.saturate,g=0,h=e.length;h>g;g+=4)b=Math.max(e[g],e[g+1],e[g+2]),e[g]+=b!==e[g]?(b-e[g])*f:0,e[g+1]+=b!==e[g+1]?(b-e[g+1])*f:0,e[g+2]+=b!==e[g+2]?(b-e[g+2])*f:0;c.putImageData(d,0,0)},toObject:function(){return c(this.callSuper("toObject"),{saturate:this.saturate})}}),b.Image.filters.Saturate.fromObject=function(a){return new b.Image.filters.Saturate(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.clone,d=b.util.toFixed,e=b.Object.NUM_FRACTION_DIGITS,f=2;if(b.Text)return void b.warn("fabric.Text is already defined");var g=b.Object.prototype.stateProperties.concat();g.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing");var h=b.Object.prototype.cacheProperties.concat();h.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),b.Text=b.util.createClass(b.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:g,cacheProperties:h,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,charSpacing:0,initialize:function(a,b){b=b||{},this.text=a,this.__skipDimension=!0,this.callSuper("initialize",b),this.__skipDimension=!1,this._initDimensions(),this.setupState({propertySet:"_dimensionAffectingProps"})},_initDimensions:function(a){this.__skipDimension||(a||(a=b.util.createCanvasElement().getContext("2d"),this._setTextStyles(a)),this._textLines=this._splitTextIntoLines(),this._clearCache(),this.width=this._getTextWidth(a)||this.cursorWidth||f,this.height=this._getTextHeight(a))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(a){this._setTextStyles(a),this.group&&"path-group"===this.group.type&&a.translate(this.left,this.top),this._renderTextLinesBackground(a),this._renderText(a),this._renderTextDecoration(a)},_renderText:function(a){this._renderTextFill(a),this._renderTextStroke(a)},_setTextStyles:function(a){a.textBaseline="alphabetic",a.font=this._getFontDeclaration()},_getTextHeight:function(){return this._getHeightOfSingleLine()+(this._textLines.length-1)*this._getHeightOfLine()},_getTextWidth:function(a){for(var b=this._getLineWidth(a,0),c=1,d=this._textLines.length;d>c;c++){var e=this._getLineWidth(a,c);e>b&&(b=e)}return b},_renderChars:function(a,b,c,d,e){var f,g,h=a.slice(0,-4);if(this[h].toLive){var i=-this.width/2+this[h].offsetX||0,j=-this.height/2+this[h].offsetY||0;b.save(),b.translate(i,j),d-=i,e-=j}if(0!==this.charSpacing){var k=this._getWidthOfCharSpacing();c=c.split("");for(var l=0,m=c.length;m>l;l++)f=c[l],g=b.measureText(f).width+k,b[a](f,d,e),d+=g>0?g:0}else b[a](c,d,e);this[h].toLive&&b.restore()},_renderTextLine:function(a,b,c,d,e,f){e-=this.fontSize*this._fontSizeFraction;var g=this._getLineWidth(b,f);if("justify"!==this.textAlign||this.width<g)return void this._renderChars(a,b,c,d,e,f);for(var h,i=c.split(/\s+/),j=0,k=this._getWidthOfWords(b,i.join(" "),f,0),l=this.width-k,m=i.length-1,n=m>0?l/m:0,o=0,p=0,q=i.length;q>p;p++){for(;" "===c[j]&&j<c.length;)j++;h=i[p],this._renderChars(a,b,h,d+o,e,f,j),o+=this._getWidthOfWords(b,h,f,j)+n,j+=h.length}},_getWidthOfWords:function(a,b){var c,d,e=a.measureText(b).width;return 0!==this.charSpacing&&(c=b.split("").length,d=c*this._getWidthOfCharSpacing(),e+=d),e>0?e:0},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},isEmptyStyles:function(){return!0},_renderTextCommon:function(a,b){for(var c=0,d=this._getLeftOffset(),e=this._getTopOffset(),f=0,g=this._textLines.length;g>f;f++){var h=this._getHeightOfLine(a,f),i=h/this.lineHeight,j=this._getLineWidth(a,f),k=this._getLineLeftOffset(j);this._renderTextLine(b,a,this._textLines[f],d+k,e+c+i,f),c+=h}},_renderTextFill:function(a){(this.fill||!this.isEmptyStyles())&&this._renderTextCommon(a,"fillText")},_renderTextStroke:function(a){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a),a.save(),this._setLineDash(a,this.strokeDashArray),a.beginPath(),this._renderTextCommon(a,"strokeText"),a.closePath(),a.restore())},_getHeightOfLine:function(){return this._getHeightOfSingleLine()*this.lineHeight},_getHeightOfSingleLine:function(){return this.fontSize*this._fontSizeMult},_renderTextLinesBackground:function(a){if(this.textBackgroundColor){var b,c,d,e=0,f=a.fillStyle;a.fillStyle=this.textBackgroundColor;for(var g=0,h=this._textLines.length;h>g;g++)b=this._getHeightOfLine(a,g),c=this._getLineWidth(a,g),c>0&&(d=this._getLineLeftOffset(c),a.fillRect(this._getLeftOffset()+d,this._getTopOffset()+e,c,b/this.lineHeight)),e+=b;a.fillStyle=f,this._removeShadow(a)}},_getLineLeftOffset:function(a){return"center"===this.textAlign?(this.width-a)/2:"right"===this.textAlign?this.width-a:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[]},_shouldClearDimensionCache:function(){var a=!1;return this._forceClearCache?(this._forceClearCache=!1,this.dirty=!0,!0):(a=this.hasStateChanged("_dimensionAffectingProps"),a&&(this.saveState({propertySet:"_dimensionAffectingProps"}),this.dirty=!0),a)},_getLineWidth:function(a,b){if(this.__lineWidths[b])return-1===this.__lineWidths[b]?this.width:this.__lineWidths[b];var c,d,e=this._textLines[b];return c=""===e?0:this._measureLine(a,b),this.__lineWidths[b]=c,c&&"justify"===this.textAlign&&(d=e.split(/\s+/),d.length>1&&(this.__lineWidths[b]=-1)),c},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},_measureLine:function(a,b){var c,d,e=this._textLines[b],f=a.measureText(e).width,g=0;return 0!==this.charSpacing&&(c=e.split("").length,g=(c-1)*this._getWidthOfCharSpacing()),d=f+g,d>0?d:0},_renderTextDecoration:function(a){function b(b){var e,f,g,h,i,j,k,l=0;for(e=0,f=d._textLines.length;f>e;e++){for(i=d._getLineWidth(a,e),j=d._getLineLeftOffset(i),k=d._getHeightOfLine(a,e),g=0,h=b.length;h>g;g++)a.fillRect(d._getLeftOffset()+j,l+(d._fontSizeMult-1+b[g])*d.fontSize-c,i,d.fontSize/15);l+=k}}if(this.textDecoration){var c=this.height/2,d=this,e=[];this.textDecoration.indexOf("underline")>-1&&e.push(.85),this.textDecoration.indexOf("line-through")>-1&&e.push(.43),this.textDecoration.indexOf("overline")>-1&&e.push(-.12),e.length>0&&b(e)}},_getFontDeclaration:function(){return[b.isLikelyNode?this.fontWeight:this.fontStyle,b.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",b.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(a,b){this.visible&&(this._shouldClearDimensionCache()&&(this._setTextStyles(a),this._initDimensions(a)),this.callSuper("render",a,b))},_splitTextIntoLines:function(){return this.text.split(this._reNewline)},toObject:function(a){var b=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","textDecoration","textAlign","textBackgroundColor","charSpacing"].concat(a);return this.callSuper("toObject",b)},toSVG:function(a){this.ctx||(this.ctx=b.util.createCanvasElement().getContext("2d"));var c=this._createBaseSVGMarkup(),d=this._getSVGLeftTopOffsets(this.ctx),e=this._getSVGTextAndBg(d.textTop,d.textLeft);return this._wrapSVGTextAndBg(c,e),a?a(c.join("")):c.join("")},_getSVGLeftTopOffsets:function(a){var b=this._getHeightOfLine(a,0),c=-this.width/2,d=0;return{textLeft:c+(this.group&&"path-group"===this.group.type?this.left:0),textTop:d+(this.group&&"path-group"===this.group.type?-this.top:0),lineTop:b}},_wrapSVGTextAndBg:function(a,b){var c=!0,d=this.getSvgFilter(),e=""===d?"":' style="'+d+'"';a.push("	<g ",this.getSvgId(),'transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"',e,">\n",b.textBgRects.join(""),"		<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(c),'" >\n',b.textSpans.join(""),"		</text>\n","	</g>\n")},_getSVGTextAndBg:function(a,b){var c=[],d=[],e=0;this._setSVGBg(d);for(var f=0,g=this._textLines.length;g>f;f++)this.textBackgroundColor&&this._setSVGTextLineBg(d,f,b,a,e),this._setSVGTextLineText(f,c,e,b,a,d),e+=this._getHeightOfLine(this.ctx,f);return{textSpans:c,textBgRects:d}},_setSVGTextLineText:function(a,c,f,g,h){var i=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-h+f-this.height/2;return"justify"===this.textAlign?void this._setSVGTextLineJustifed(a,c,i,g):void c.push('			<tspan x="',d(g+this._getLineLeftOffset(this._getLineWidth(this.ctx,a)),e),'" ','y="',d(i,e),'" ',this._getFillAttributes(this.fill),">",b.util.string.escapeXml(this._textLines[a]),"</tspan>\n")},_setSVGTextLineJustifed:function(a,c,f,g){var h=b.util.createCanvasElement().getContext("2d");this._setTextStyles(h);var i,j,k=this._textLines[a],l=k.split(/\s+/),m=this._getWidthOfWords(h,l.join("")),n=this.width-m,o=l.length-1,p=o>0?n/o:0,q=this._getFillAttributes(this.fill);for(g+=this._getLineLeftOffset(this._getLineWidth(h,a)),a=0,j=l.length;j>a;a++)i=l[a],c.push('			<tspan x="',d(g,e),'" ','y="',d(f,e),'" ',q,">",b.util.string.escapeXml(i),"</tspan>\n"),g+=this._getWidthOfWords(h,i)+p},_setSVGTextLineBg:function(a,b,c,f,g){a.push("		<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',d(c+this._getLineLeftOffset(this._getLineWidth(this.ctx,b)),e),'" y="',d(g-this.height/2,e),'" width="',d(this._getLineWidth(this.ctx,b),e),'" height="',d(this._getHeightOfLine(this.ctx,b)/this.lineHeight,e),'"></rect>\n')},_setSVGBg:function(a){this.backgroundColor&&a.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',d(-this.width/2,e),'" y="',d(-this.height/2,e),'" width="',d(this.width,e),'" height="',d(this.height,e),'"></rect>\n')},_getFillAttributes:function(a){var c=a&&"string"==typeof a?new b.Color(a):"";return c&&c.getSource()&&1!==c.getAlpha()?'opacity="'+c.getAlpha()+'" fill="'+c.setAlpha(1).toRgb()+'"':'fill="'+a+'"'},_set:function(a,b){this.callSuper("_set",a,b),this._dimensionAffectingProps.indexOf(a)>-1&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),b.Text.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),b.Text.DEFAULT_SVG_FONT_SIZE=16,b.Text.fromElement=function(a,c){if(!a)return null;var d=b.parseAttributes(a,b.Text.ATTRIBUTE_NAMES);c=b.util.object.extend(c?b.util.object.clone(c):{},d),c.top=c.top||0,c.left=c.left||0,"dx"in d&&(c.left+=d.dx),"dy"in d&&(c.top+=d.dy),"fontSize"in c||(c.fontSize=b.Text.DEFAULT_SVG_FONT_SIZE),c.originX||(c.originX="left");var e="";"textContent"in a?e=a.textContent:"firstChild"in a&&null!==a.firstChild&&"data"in a.firstChild&&null!==a.firstChild.data&&(e=a.firstChild.data),e=e.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var f=new b.Text(e,c),g=f.getHeight()/f.height,h=(f.height+f.strokeWidth)*f.lineHeight-f.height,i=h*g,j=f.getHeight()+i,k=0;return"left"===f.originX&&(k=f.getWidth()/2),"right"===f.originX&&(k=-f.getWidth()/2),f.set({left:f.getLeft()+k,top:f.getTop()-j/2+f.fontSize*(.18+f._fontSizeFraction)/f.lineHeight}),f},b.Text.fromObject=function(a,d){var e=new b.Text(a.text,c(a));return d&&d(e),e},b.util.createAccessors(b.Text)}("undefined"!=typeof exports?exports:this),function(){var a=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,styles:null,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],initialize:function(a,b){this.styles=b?b.styles||{}:{},this.callSuper("initialize",a,b),this.initBehavior()},_clearCache:function(){this.callSuper("_clearCache"),this.__widthOfSpace=[]},isEmptyStyles:function(){if(!this.styles)return!0;var a=this.styles;for(var b in a)for(var c in a[b])for(var d in a[b][c])return!1;return!0},setSelectionStart:function(a){a=Math.max(a,0),this._updateAndFire("selectionStart",a)},setSelectionEnd:function(a){a=Math.min(a,this.text.length),this._updateAndFire("selectionEnd",a)},_updateAndFire:function(a,b){this[a]!==b&&(this._fireSelectionChanged(),this[a]=b),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getSelectionStyles:function(a,b){if(2===arguments.length){for(var c=[],d=a;b>d;d++)c.push(this.getSelectionStyles(d));return c}var e=this.get2DCursorLocation(a),f=this._getStyleDeclaration(e.lineIndex,e.charIndex);return f||{}},setSelectionStyles:function(a){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,a);else for(var b=this.selectionStart;b<this.selectionEnd;b++)this._extendStyles(b,a);return this._forceClearCache=!0,this},_extendStyles:function(a,b){var c=this.get2DCursorLocation(a);this._getLineStyle(c.lineIndex)||this._setLineStyle(c.lineIndex,{}),this._getStyleDeclaration(c.lineIndex,c.charIndex)||this._setStyleDeclaration(c.lineIndex,c.charIndex,{}),fabric.util.object.extend(this._getStyleDeclaration(c.lineIndex,c.charIndex),b)},_initDimensions:function(a){a||this.clearContextTop(),this.callSuper("_initDimensions",a)},render:function(a,b){this.clearContextTop(),this.callSuper("render",a,b)},_render:function(a){this.callSuper("_render",a),this.ctx=a,this.cursorOffsetCache={},this.renderCursorOrSelection()},clearContextTop:function(){if(this.active&&this.isEditing&&this.canvas&&this.canvas.contextTop){var a=this.canvas.contextTop;a.save(),a.transform.apply(a,this.canvas.viewportTransform),this.transform(a),this.transformMatrix&&a.transform.apply(a,this.transformMatrix),this._clearTextArea(a),a.restore()}},renderCursorOrSelection:function(){if(this.active&&this.isEditing){var a,b,c=this.text.split("");this.canvas&&this.canvas.contextTop?(b=this.canvas.contextTop,b.save(),b.transform.apply(b,this.canvas.viewportTransform),this.transform(b),this.transformMatrix&&b.transform.apply(b,this.transformMatrix),this._clearTextArea(b)):(b=this.ctx,b.save()),this.selectionStart===this.selectionEnd?(a=this._getCursorBoundaries(c,"cursor"),this.renderCursor(a,b)):(a=this._getCursorBoundaries(c,"selection"),this.renderSelection(c,a,b)),b.restore()}},_clearTextArea:function(a){var b=this.width+4,c=this.height+4;a.clearRect(-b/2,-c/2,b,c)},get2DCursorLocation:function(a){"undefined"==typeof a&&(a=this.selectionStart);for(var b=this._textLines.length,c=0;b>c;c++){if(a<=this._textLines[c].length)return{lineIndex:c,charIndex:a};a-=this._textLines[c].length+1}return{lineIndex:c-1,charIndex:this._textLines[c-1].length<a?this._textLines[c-1].length:a}},getCurrentCharStyle:function(a,b){var c=this._getStyleDeclaration(a,0===b?0:b-1);return{fontSize:c&&c.fontSize||this.fontSize,fill:c&&c.fill||this.fill,textBackgroundColor:c&&c.textBackgroundColor||this.textBackgroundColor,textDecoration:c&&c.textDecoration||this.textDecoration,fontFamily:c&&c.fontFamily||this.fontFamily,fontWeight:c&&c.fontWeight||this.fontWeight,fontStyle:c&&c.fontStyle||this.fontStyle,stroke:c&&c.stroke||this.stroke,strokeWidth:c&&c.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(a,b){var c=this._getStyleDeclaration(a,0===b?0:b-1);return c&&c.fontSize?c.fontSize:this.fontSize},getCurrentCharColor:function(a,b){var c=this._getStyleDeclaration(a,0===b?0:b-1);return c&&c.fill?c.fill:this.cursorColor},_getCursorBoundaries:function(a,b){var c=Math.round(this._getLeftOffset()),d=this._getTopOffset(),e=this._getCursorBoundariesOffsets(a,b);return{left:c,top:d,leftOffset:e.left+e.lineLeft,topOffset:e.top}},_getCursorBoundariesOffsets:function(a,b){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;for(var c,d=0,e=0,f=0,g=0,h=0,i=0;i<this.selectionStart;i++)"\n"===a[i]?(h=0,g+=this._getHeightOfLine(this.ctx,e),e++,f=0):(h+=this._getWidthOfChar(this.ctx,a[i],e,f),f++),d=this._getLineLeftOffset(this._getLineWidth(this.ctx,e));return"cursor"===b&&(g+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,e)/this.lineHeight-this.getCurrentCharFontSize(e,f)*(1-this._fontSizeFraction)),0!==this.charSpacing&&f===this._textLines[e].length&&(h-=this._getWidthOfCharSpacing()),c={top:g,left:h>0?h:0,lineLeft:d},this.cursorOffsetCache=c,this.cursorOffsetCache},renderCursor:function(a,b){var c=this.get2DCursorLocation(),d=c.lineIndex,e=c.charIndex,f=this.getCurrentCharFontSize(d,e),g=0===d&&0===e?this._getLineLeftOffset(this._getLineWidth(b,d)):a.leftOffset,h=this.scaleX*this.canvas.getZoom(),i=this.cursorWidth/h;b.fillStyle=this.getCurrentCharColor(d,e),b.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,b.fillRect(a.left+g-i/2,a.top+a.topOffset,i,f)},renderSelection:function(a,b,c){c.fillStyle=this.selectionColor;for(var d=this.get2DCursorLocation(this.selectionStart),e=this.get2DCursorLocation(this.selectionEnd),f=d.lineIndex,g=e.lineIndex,h=f;g>=h;h++){var i=this._getLineLeftOffset(this._getLineWidth(c,h))||0,j=this._getHeightOfLine(this.ctx,h),k=0,l=0,m=this._textLines[h];if(h===f){for(var n=0,o=m.length;o>n;n++)n>=d.charIndex&&(h!==g||n<e.charIndex)&&(l+=this._getWidthOfChar(c,m[n],h,n)),n<d.charIndex&&(i+=this._getWidthOfChar(c,m[n],h,n));n===m.length&&(l-=this._getWidthOfCharSpacing())}else if(h>f&&g>h)l+=this._getLineWidth(c,h)||5;else if(h===g){for(var p=0,q=e.charIndex;q>p;p++)l+=this._getWidthOfChar(c,m[p],h,p);e.charIndex===m.length&&(l-=this._getWidthOfCharSpacing())}k=j,(this.lineHeight<1||h===g&&this.lineHeight>1)&&(j/=this.lineHeight),c.fillRect(b.left+i,b.top+b.topOffset,l>0?l:0,j),b.topOffset+=k}},_renderChars:function(a,b,c,d,e,f,g){if(this.isEmptyStyles())return this._renderCharsFast(a,b,c,d,e);g=g||0;var h,i,j=this._getHeightOfLine(b,f),k="";b.save(),e-=j/this.lineHeight*this._fontSizeFraction;for(var l=g,m=c.length+g;m>=l;l++)h=h||this.getCurrentCharStyle(f,l),i=this.getCurrentCharStyle(f,l+1),(this._hasStyleChanged(h,i)||l===m)&&(this._renderChar(a,b,f,l-1,k,d,e,j),k="",h=i),k+=c[l-g];b.restore()},_renderCharsFast:function(a,b,c,d,e){"fillText"===a&&this.fill&&this.callSuper("_renderChars",a,b,c,d,e),"strokeText"===a&&(this.stroke&&this.strokeWidth>0||this.skipFillStrokeCheck)&&this.callSuper("_renderChars",a,b,c,d,e)},_renderChar:function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r=this._getStyleDeclaration(c,d);if(r?(j=this._getHeightOfChar(b,e,c,d),l=r.stroke,k=r.fill,n=r.textDecoration):j=this.fontSize,l=(l||this.stroke)&&"strokeText"===a,k=(k||this.fill)&&"fillText"===a,r&&b.save(),i=this._applyCharStylesGetWidth(b,e,c,d,r||null),n=n||this.textDecoration,r&&r.textBackgroundColor&&this._removeShadow(b),0!==this.charSpacing){p=this._getWidthOfCharSpacing(),o=e.split(""),i=0;for(var s,t=0,u=o.length;u>t;t++)s=o[t],k&&b.fillText(s,f+i,g),l&&b.strokeText(s,f+i,g),q=b.measureText(s).width+p,i+=q>0?q:0}else k&&b.fillText(e,f,g),l&&b.strokeText(e,f,g);(n||""!==n)&&(m=this._fontSizeFraction*h/this.lineHeight,this._renderCharDecoration(b,n,f,g,m,i,j)),r&&b.restore(),b.translate(i,0)},_hasStyleChanged:function(a,b){return a.fill!==b.fill||a.fontSize!==b.fontSize||a.textBackgroundColor!==b.textBackgroundColor||a.textDecoration!==b.textDecoration||a.fontFamily!==b.fontFamily||a.fontWeight!==b.fontWeight||a.fontStyle!==b.fontStyle||a.stroke!==b.stroke||a.strokeWidth!==b.strokeWidth},_renderCharDecoration:function(a,b,c,d,e,f,g){if(b){var h,i,j=g/15,k={underline:d+g/10,"line-through":d-g*(this._fontSizeFraction+this._fontSizeMult-1)+j,overline:d-(this._fontSizeMult-this._fontSizeFraction)*g},l=["underline","line-through","overline"];for(h=0;h<l.length;h++)i=l[h],b.indexOf(i)>-1&&a.fillRect(c,k[i],f,j)}},_renderTextLine:function(a,b,c,d,e,f){this.isEmptyStyles()||(e+=this.fontSize*(this._fontSizeFraction+.03)),this.callSuper("_renderTextLine",a,b,c,d,e,f)},_renderTextDecoration:function(a){return this.isEmptyStyles()?this.callSuper("_renderTextDecoration",a):void 0},_renderTextLinesBackground:function(a){this.callSuper("_renderTextLinesBackground",a);var b,c,d,e,f,g,h=0,i=this._getLeftOffset(),j=this._getTopOffset();a.save();for(var k=0,l=this._textLines.length;l>k;k++)if(b=this._getHeightOfLine(a,k),e=this._textLines[k],""!==e&&this.styles&&this._getLineStyle(k)){c=this._getLineWidth(a,k),d=this._getLineLeftOffset(c);for(var m=0,n=e.length;n>m;m++)g=this._getStyleDeclaration(k,m),g&&g.textBackgroundColor&&(f=e[m],a.fillStyle=g.textBackgroundColor,a.fillRect(i+d+this._getWidthOfCharsAt(a,k,m),j+h,this._getWidthOfChar(a,f,k,m),b/this.lineHeight));h+=b}else h+=b;a.restore()},_getCacheProp:function(a,b){return a+b.fontSize+b.fontWeight+b.fontStyle},_getFontCache:function(a){return fabric.charWidthsCache[a]||(fabric.charWidthsCache[a]={}),fabric.charWidthsCache[a]},_applyCharStylesGetWidth:function(b,c,d,e,f){var g,h,i,j=f||this._getStyleDeclaration(d,e),k=a(j);if(this._applyFontStyles(k),i=this._getFontCache(k.fontFamily),h=this._getCacheProp(c,k),!j&&i[h]&&this.caching)return i[h];"string"==typeof k.shadow&&(k.shadow=new fabric.Shadow(k.shadow));var l=k.fill||this.fill;return b.fillStyle=l.toLive?l.toLive(b,this):l,k.stroke&&(b.strokeStyle=k.stroke&&k.stroke.toLive?k.stroke.toLive(b,this):k.stroke),b.lineWidth=k.strokeWidth||this.strokeWidth,b.font=this._getFontDeclaration.call(k),k.shadow&&(k.scaleX=this.scaleX,k.scaleY=this.scaleY,k.canvas=this.canvas,k.getObjectScaling=this.getObjectScaling,this._setShadow.call(k,b)),this.caching&&i[h]?i[h]:(g=b.measureText(c).width,this.caching&&(i[h]=g),g)},_applyFontStyles:function(a){a.fontFamily||(a.fontFamily=this.fontFamily),a.fontSize||(a.fontSize=this.fontSize),a.fontWeight||(a.fontWeight=this.fontWeight),a.fontStyle||(a.fontStyle=this.fontStyle)},_getStyleDeclaration:function(b,c,d){return d?this.styles[b]&&this.styles[b][c]?a(this.styles[b][c]):{}:this.styles[b]&&this.styles[b][c]?this.styles[b][c]:null},_setStyleDeclaration:function(a,b,c){this.styles[a][b]=c},_deleteStyleDeclaration:function(a,b){delete this.styles[a][b]},_getLineStyle:function(a){return this.styles[a]},_setLineStyle:function(a,b){this.styles[a]=b},_deleteLineStyle:function(a){delete this.styles[a]},_getWidthOfChar:function(a,b,c,d){if(!this._isMeasuring&&"justify"===this.textAlign&&this._reSpacesAndTabs.test(b))return this._getWidthOfSpace(a,c);a.save();var e=this._applyCharStylesGetWidth(a,b,c,d);return 0!==this.charSpacing&&(e+=this._getWidthOfCharSpacing()),a.restore(),e>0?e:0},_getHeightOfChar:function(a,b,c){var d=this._getStyleDeclaration(b,c);return d&&d.fontSize?d.fontSize:this.fontSize},_getWidthOfCharsAt:function(a,b,c){var d,e,f=0;for(d=0;c>d;d++)e=this._textLines[b][d],f+=this._getWidthOfChar(a,e,b,d);return f},_measureLine:function(a,b){this._isMeasuring=!0;var c=this._getWidthOfCharsAt(a,b,this._textLines[b].length);return 0!==this.charSpacing&&(c-=this._getWidthOfCharSpacing()),this._isMeasuring=!1,c>0?c:0},_getWidthOfSpace:function(a,b){if(this.__widthOfSpace[b])return this.__widthOfSpace[b];var c=this._textLines[b],d=this._getWidthOfWords(a,c,b,0),e=this.width-d,f=c.length-c.replace(this._reSpacesAndTabs,"").length,g=Math.max(e/f,a.measureText(" ").width);return this.__widthOfSpace[b]=g,g},_getWidthOfWords:function(a,b,c,d){for(var e=0,f=0;f<b.length;f++){var g=b[f];g.match(/\s/)||(e+=this._getWidthOfChar(a,g,c,f+d))}return e},_getHeightOfLine:function(a,b){if(this.__lineHeights[b])return this.__lineHeights[b];for(var c=this._textLines[b],d=this._getHeightOfChar(a,b,0),e=1,f=c.length;f>e;e++){var g=this._getHeightOfChar(a,b,e);g>d&&(d=g)}return this.__lineHeights[b]=d*this.lineHeight*this._fontSizeMult,this.__lineHeights[b]},_getTextHeight:function(a){for(var b,c=0,d=0,e=this._textLines.length;e>d;d++)b=this._getHeightOfLine(a,d),c+=d===e-1?b/this.lineHeight:b;return c},toObject:function(b){return fabric.util.object.extend(this.callSuper("toObject",b),{styles:a(this.styles,!0)})}}),fabric.IText.fromObject=function(b,c){var d=new fabric.IText(b.text,a(b));return c&&c(d),d}}(),function(){var a=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},initSelectedHandler:function(){this.on("selected",function(){var a=this;setTimeout(function(){a.selected=!0},100)})},initAddedHandler:function(){var a=this;this.on("added",function(){var b=a.canvas;b&&(b._hasITextHandlers||(b._hasITextHandlers=!0,a._initCanvasHandlers(b)),b._iTextInstances=b._iTextInstances||[],b._iTextInstances.push(a))})},initRemovedHandler:function(){var a=this;this.on("removed",function(){var b=a.canvas;b&&(b._iTextInstances=b._iTextInstances||[],fabric.util.removeFromArray(b._iTextInstances,a),0===b._iTextInstances.length&&(b._hasITextHandlers=!1,a._removeCanvasHandlers(b)))})},_initCanvasHandlers:function(a){a._canvasITextSelectionClearedHanlder=function(){fabric.IText.prototype.exitEditingOnOthers(a)}.bind(this),a._mouseUpITextHandler=function(){a._iTextInstances&&a._iTextInstances.forEach(function(a){a.__isMousedown=!1})}.bind(this),a.on("selection:cleared",a._canvasITextSelectionClearedHanlder),a.on("object:selected",a._canvasITextSelectionClearedHanlder),a.on("mouse:up",a._mouseUpITextHandler)},_removeCanvasHandlers:function(a){a.off("selection:cleared",a._canvasITextSelectionClearedHanlder),a.off("object:selected",a._canvasITextSelectionClearedHanlder),a.off("mouse:up",a._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(a,b,c,d){var e;return e={isAborted:!1,abort:function(){this.isAborted=!0}},a.animate("_currentCursorOpacity",b,{duration:c,onComplete:function(){e.isAborted||a[d]()},onChange:function(){a.canvas&&a.selectionStart===a.selectionEnd&&a.renderCursorOrSelection()},abort:function(){return e.isAborted}}),e},_onTickComplete:function(){var a=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){a._currentTickCompleteState=a._animateCursor(a,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(a){var b=this,c=a?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){b._tick()},c)},abortCursorAnimation:function(){var a=this._currentTickState||this._currentTickCompleteState;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,a&&this.canvas&&this.canvas.clearContext(this.canvas.contextTop||this.ctx)},selectAll:function(){this.selectionStart=0,this.selectionEnd=this.text.length,this._fireSelectionChanged(),this._updateTextarea()},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(a){var b=0,c=a-1;if(this._reSpace.test(this.text.charAt(c)))for(;this._reSpace.test(this.text.charAt(c));)b++,c--;for(;/\S/.test(this.text.charAt(c))&&c>-1;)b++,c--;return a-b},findWordBoundaryRight:function(a){var b=0,c=a;if(this._reSpace.test(this.text.charAt(c)))for(;this._reSpace.test(this.text.charAt(c));)b++,c++;for(;/\S/.test(this.text.charAt(c))&&c<this.text.length;)b++,c++;return a+b},findLineBoundaryLeft:function(a){for(var b=0,c=a-1;!/\n/.test(this.text.charAt(c))&&c>-1;)b++,c--;return a-b},findLineBoundaryRight:function(a){for(var b=0,c=a;!/\n/.test(this.text.charAt(c))&&c<this.text.length;)b++,c++;return a+b},getNumNewLinesInSelectedText:function(){for(var a=this.getSelectedText(),b=0,c=0,d=a.length;d>c;c++)"\n"===a[c]&&b++;return b},searchWordBoundary:function(a,b){for(var c=this._reSpace.test(this.text.charAt(a))?a-1:a,d=this.text.charAt(c),e=/[ \n\.,;!\?\-]/;!e.test(d)&&c>0&&c<this.text.length;)c+=b,d=this.text.charAt(c);return e.test(d)&&"\n"!==d&&(c+=1===b?0:1),c},selectWord:function(a){a=a||this.selectionStart;var b=this.searchWordBoundary(a,-1),c=this.searchWordBoundary(a,1);this.selectionStart=b,this.selectionEnd=c,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(a){a=a||this.selectionStart;var b=this.findLineBoundaryLeft(a),c=this.findLineBoundaryRight(a);this.selectionStart=b,this.selectionEnd=c,this._fireSelectionChanged(),this._updateTextarea()},enterEditing:function(a){return!this.isEditing&&this.editable?(this.canvas&&this.exitEditingOnOthers(this.canvas),
this.isEditing=!0,this.initHiddenTextarea(a),this.hiddenTextarea.focus(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.renderAll(),this):this):void 0},exitEditingOnOthers:function(a){a._iTextInstances&&a._iTextInstances.forEach(function(a){a.selected=!1,a.isEditing&&a.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(a){if(this.__isMousedown&&this.isEditing){var b=this.getSelectionStartFromPointer(a.e),c=this.selectionStart,d=this.selectionEnd;b!==this.__selectionStartOnMouseDown&&(b>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=b):(this.selectionStart=b,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==c||this.selectionEnd!==d)&&(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){if(this.hiddenTextarea&&!this.inCompositionMode&&(this.cursorOffsetCache={},this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart,this.hiddenTextarea.selectionEnd=this.selectionEnd,this.selectionStart===this.selectionEnd)){var a=this._calcTextareaPosition();this.hiddenTextarea.style.left=a.left,this.hiddenTextarea.style.top=a.top,this.hiddenTextarea.style.fontSize=a.fontSize}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var a=this.text.split(""),b=this._getCursorBoundaries(a,"cursor"),c=this.get2DCursorLocation(),d=c.lineIndex,e=c.charIndex,f=this.getCurrentCharFontSize(d,e),g=0===d&&0===e?this._getLineLeftOffset(this._getLineWidth(this.ctx,d)):b.leftOffset,h=this.calcTransformMatrix(),i={x:b.left+g,y:b.top+b.topOffset+f},j=this.canvas.upperCanvasEl,k=j.width-f,l=j.height-f;return i=fabric.util.transformPoint(i,h),i=fabric.util.transformPoint(i,this.canvas.viewportTransform),i.x<0&&(i.x=0),i.x>k&&(i.x=k),i.y<0&&(i.y=0),i.y>l&&(i.y=l),i.x+=this.canvas._offset.left,i.y+=this.canvas._offset.top,{left:i.x+"px",top:i.y+"px",fontSize:f}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var a=this._textBeforeEdit!==this.text;return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea.blur&&this.hiddenTextarea.blur(),this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this.fire("editing:exited"),a&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),a&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var a in this.styles)this._textLines[a]||delete this.styles[a]},_removeCharsFromTo:function(a,b){for(;b!==a;)this._removeSingleCharAndStyle(a+1),b--;this.selectionStart=a,this.selectionEnd=a},_removeSingleCharAndStyle:function(a){var b="\n"===this.text[a-1],c=b?a:a-1;this.removeStyleObject(b,c),this.text=this.text.slice(0,a-1)+this.text.slice(a),this._textLines=this._splitTextIntoLines()},insertChars:function(a,b){var c;if(this.selectionEnd-this.selectionStart>1&&this._removeCharsFromTo(this.selectionStart,this.selectionEnd),!b&&this.isEmptyStyles())return void this.insertChar(a,!1);for(var d=0,e=a.length;e>d;d++)b&&(c=fabric.copiedTextStyle[d]),this.insertChar(a[d],e-1>d,c)},insertChar:function(a,b,c){var d="\n"===this.text[this.selectionStart];this.text=this.text.slice(0,this.selectionStart)+a+this.text.slice(this.selectionEnd),this._textLines=this._splitTextIntoLines(),this.insertStyleObjects(a,d,c),this.selectionStart+=a.length,this.selectionEnd=this.selectionStart,b||(this._updateTextarea(),this.setCoords(),this._fireSelectionChanged(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this}),this.canvas&&this.canvas.renderAll())},insertNewlineStyleObject:function(b,c,d){this.shiftLineStyles(b,1),this.styles[b+1]||(this.styles[b+1]={});var e={},f={};if(this.styles[b]&&this.styles[b][c-1]&&(e=this.styles[b][c-1]),d)f[0]=a(e),this.styles[b+1]=f;else{for(var g in this.styles[b])parseInt(g,10)>=c&&(f[parseInt(g,10)-c]=this.styles[b][g],delete this.styles[b][g]);this.styles[b+1]=f}this._forceClearCache=!0},insertCharStyleObject:function(b,c,d){var e=this.styles[b],f=a(e);0!==c||d||(c=1);for(var g in f){var h=parseInt(g,10);h>=c&&(e[h+1]=f[h],f[h-1]||delete e[h])}this.styles[b][c]=d||a(e[c-1]),this._forceClearCache=!0},insertStyleObjects:function(a,b,c){var d=this.get2DCursorLocation(),e=d.lineIndex,f=d.charIndex;this._getLineStyle(e)||this._setLineStyle(e,{}),"\n"===a?this.insertNewlineStyleObject(e,f,b):this.insertCharStyleObject(e,f,c)},shiftLineStyles:function(b,c){var d=a(this.styles);for(var e in this.styles){var f=parseInt(e,10);f>b&&(this.styles[f+c]=d[f],d[f-c]||delete this.styles[f])}},removeStyleObject:function(a,b){var c=this.get2DCursorLocation(b),d=c.lineIndex,e=c.charIndex;this._removeStyleObject(a,c,d,e)},_getTextOnPreviousLine:function(a){return this._textLines[a-1]},_removeStyleObject:function(b,c,d,e){if(b){var f=this._getTextOnPreviousLine(c.lineIndex),g=f?f.length:0;this.styles[d-1]||(this.styles[d-1]={});for(e in this.styles[d])this.styles[d-1][parseInt(e,10)+g]=this.styles[d][e];this.shiftLineStyles(c.lineIndex,-1)}else{var h=this.styles[d];h&&delete h[e];var i=a(h);for(var j in i){var k=parseInt(j,10);k>=e&&0!==k&&(h[k-1]=i[k],delete h[k])}}},insertNewline:function(){this.insertChars("\n")},setSelectionStartEndWithShift:function(a,b,c){a>=c?(b===a?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=a),this.selectionStart=c):c>a&&b>c?"right"===this._selectionDirection?this.selectionEnd=c:this.selectionStart=c:(b===a?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=b),this.selectionEnd=c)},setSelectionInBoundaries:function(){var a=this.text.length;this.selectionStart>a?this.selectionStart=a:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>a?this.selectionEnd=a:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(a){this.__newClickTime=+new Date;var b=this.canvas.getPointer(a.e);this.isTripleClick(b)?(this.fire("tripleclick",a),this._stopEvent(a.e)):this.isDoubleClick(b)&&(this.fire("dblclick",a),this._stopEvent(a.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=b,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected},isDoubleClick:function(a){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===a.x&&this.__lastPointer.y===a.y&&this.__lastIsEditing},isTripleClick:function(a){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===a.x&&this.__lastPointer.y===a.y},_stopEvent:function(a){a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler(),this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},initClicks:function(){this.on("dblclick",function(a){this.selectWord(this.getSelectionStartFromPointer(a.e))}),this.on("tripleclick",function(a){this.selectLine(this.getSelectionStartFromPointer(a.e))})},initMousedownHandler:function(){this.on("mousedown",function(a){if(this.editable){var b=this.canvas.getPointer(a.e);this.__mousedownX=b.x,this.__mousedownY=b.y,this.__isMousedown=!0,this.selected&&this.setCursorByClick(a.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection())}})},_isObjectMoved:function(a){var b=this.canvas.getPointer(a);return this.__mousedownX!==b.x||this.__mousedownY!==b.y},initMouseupHandler:function(){this.on("mouseup",function(a){this.__isMousedown=!1,this.editable&&!this._isObjectMoved(a.e)&&(this.__lastSelected&&!this.__corner&&(this.enterEditing(a.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()),this.selected=!0)})},setCursorByClick:function(a){var b=this.getSelectionStartFromPointer(a),c=this.selectionStart,d=this.selectionEnd;a.shiftKey?this.setSelectionStartEndWithShift(c,d,b):(this.selectionStart=b,this.selectionEnd=b),this._fireSelectionChanged(),this._updateTextarea()},getSelectionStartFromPointer:function(a){for(var b,c,d=this.getLocalPointer(a),e=0,f=0,g=0,h=0,i=0,j=this._textLines.length;j>i;i++){c=this._textLines[i],g+=this._getHeightOfLine(this.ctx,i)*this.scaleY;var k=this._getLineWidth(this.ctx,i),l=this._getLineLeftOffset(k);f=l*this.scaleX;for(var m=0,n=c.length;n>m;m++){if(e=f,f+=this._getWidthOfChar(this.ctx,c[m],i,this.flipX?n-m:m)*this.scaleX,!(g<=d.y||f<=d.x))return this._getNewSelectionStartFromOffset(d,e,f,h+i,n);h++}if(d.y<g)return this._getNewSelectionStartFromOffset(d,e,f,h+i-1,n)}return"undefined"==typeof b?this.text.length:void 0},_getNewSelectionStartFromOffset:function(a,b,c,d,e){var f=a.x-b,g=c-a.x,h=g>f?0:1,i=d+h;return this.flipX&&(i=e-i),i>this.text.length&&(i=this.text.length),i}}),fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off");var a=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+a.top+"; left: "+a.left+"; opacity: 0; width: 0px; height: 0px; z-index: -999;",fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),fabric.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"cut",this.cut.bind(this)),fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMapUp:{67:"copy",88:"cut"},_ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(a){if(this.isEditing){if(a.keyCode in this._keysMap)this[this._keysMap[a.keyCode]](a);else{if(!(a.keyCode in this._ctrlKeysMapDown&&(a.ctrlKey||a.metaKey)))return;this[this._ctrlKeysMapDown[a.keyCode]](a)}a.stopImmediatePropagation(),a.preventDefault(),this.canvas&&this.canvas.renderAll()}},onKeyUp:function(a){return!this.isEditing||this._copyDone?void(this._copyDone=!1):void(a.keyCode in this._ctrlKeysMapUp&&(a.ctrlKey||a.metaKey)&&(this[this._ctrlKeysMapUp[a.keyCode]](a),a.stopImmediatePropagation(),a.preventDefault(),this.canvas&&this.canvas.renderAll()))},onInput:function(a){if(this.isEditing&&!this.inCompositionMode){var b,c,d,e=this.selectionStart||0,f=this.selectionEnd||0,g=this.text.length,h=this.hiddenTextarea.value.length;h>g?(d="left"===this._selectionDirection?f:e,b=h-g,c=this.hiddenTextarea.value.slice(d,d+b)):(b=h-g+f-e,c=this.hiddenTextarea.value.slice(e,e+b)),this.insertChars(c),a.stopPropagation()}},onCompositionStart:function(){this.inCompositionMode=!0,this.prevCompositionLength=0,this.compositionStart=this.selectionStart},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(a){var b=a.data;this.selectionStart=this.compositionStart,this.selectionEnd=this.selectionEnd===this.selectionStart?this.compositionStart+this.prevCompositionLength:this.selectionEnd,this.insertChars(b,!1),this.prevCompositionLength=b.length},forwardDelete:function(a){if(this.selectionStart===this.selectionEnd){if(this.selectionStart===this.text.length)return;this.moveCursorRight(a)}this.removeChars(a)},copy:function(a){if(this.selectionStart!==this.selectionEnd){var b=this.getSelectedText(),c=this._getClipboardData(a);c&&c.setData("text",b),fabric.copiedText=b,fabric.copiedTextStyle=fabric.util.object.clone(this.getSelectionStyles(this.selectionStart,this.selectionEnd)),a.stopImmediatePropagation(),a.preventDefault(),this._copyDone=!0}},paste:function(a){var b=null,c=this._getClipboardData(a),d=!0;c?(b=c.getData("text").replace(/\r/g,""),fabric.copiedTextStyle&&fabric.copiedText===b||(d=!1)):b=fabric.copiedText,b&&this.insertChars(b,d),a.stopImmediatePropagation(),a.preventDefault()},cut:function(a){this.selectionStart!==this.selectionEnd&&(this.copy(a),this.removeChars(a))},_getClipboardData:function(a){return a&&a.clipboardData||fabric.window.clipboardData},_getWidthBeforeCursor:function(a,b){for(var c,d=this._textLines[a].slice(0,b),e=this._getLineWidth(this.ctx,a),f=this._getLineLeftOffset(e),g=0,h=d.length;h>g;g++)c=d[g],f+=this._getWidthOfChar(this.ctx,c,a,g);return f},getDownCursorOffset:function(a,b){var c=this._getSelectionForOffset(a,b),d=this.get2DCursorLocation(c),e=d.lineIndex;if(e===this._textLines.length-1||a.metaKey||34===a.keyCode)return this.text.length-c;var f=d.charIndex,g=this._getWidthBeforeCursor(e,f),h=this._getIndexOnLine(e+1,g),i=this._textLines[e].slice(f);return i.length+h+2},_getSelectionForOffset:function(a,b){return a.shiftKey&&this.selectionStart!==this.selectionEnd&&b?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(a,b){var c=this._getSelectionForOffset(a,b),d=this.get2DCursorLocation(c),e=d.lineIndex;if(0===e||a.metaKey||33===a.keyCode)return-c;var f=d.charIndex,g=this._getWidthBeforeCursor(e,f),h=this._getIndexOnLine(e-1,g),i=this._textLines[e].slice(0,f);return-this._textLines[e-1].length+h-i.length},_getIndexOnLine:function(a,b){for(var c,d=this._getLineWidth(this.ctx,a),e=this._textLines[a],f=this._getLineLeftOffset(d),g=f,h=0,i=0,j=e.length;j>i;i++){var k=e[i],l=this._getWidthOfChar(this.ctx,k,a,i);if(g+=l,g>b){c=!0;var m=g-l,n=g,o=Math.abs(m-b),p=Math.abs(n-b);h=o>p?i:i-1;break}}return c||(h=e.length-1),h},moveCursorDown:function(a){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||this._moveCursorUpOrDown("Down",a)},moveCursorUp:function(a){(0!==this.selectionStart||0!==this.selectionEnd)&&this._moveCursorUpOrDown("Up",a)},_moveCursorUpOrDown:function(a,b){var c="get"+a+"CursorOffset",d=this[c](b,"right"===this._selectionDirection);b.shiftKey?this.moveCursorWithShift(d):this.moveCursorWithoutShift(d),0!==d&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(a){var b="left"===this._selectionDirection?this.selectionStart+a:this.selectionEnd+a;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,b),0!==a},moveCursorWithoutShift:function(a){return 0>a?(this.selectionStart+=a,this.selectionEnd=this.selectionStart):(this.selectionEnd+=a,this.selectionStart=this.selectionEnd),0!==a},moveCursorLeft:function(a){(0!==this.selectionStart||0!==this.selectionEnd)&&this._moveCursorLeftOrRight("Left",a)},_move:function(a,b,c){var d;if(a.altKey)d=this["findWordBoundary"+c](this[b]);else{if(!a.metaKey&&35!==a.keyCode&&36!==a.keyCode)return this[b]+="Left"===c?-1:1,!0;d=this["findLineBoundary"+c](this[b])}return void 0!==typeof d&&this[b]!==d?(this[b]=d,!0):void 0},_moveLeft:function(a,b){return this._move(a,b,"Left")},_moveRight:function(a,b){return this._move(a,b,"Right")},moveCursorLeftWithoutShift:function(a){var b=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(b=this._moveLeft(a,"selectionStart")),this.selectionEnd=this.selectionStart,b},moveCursorLeftWithShift:function(a){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(a,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(a,"selectionStart")):void 0},moveCursorRight:function(a){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||this._moveCursorLeftOrRight("Right",a)},_moveCursorLeftOrRight:function(a,b){var c="moveCursor"+a+"With";this._currentCursorOpacity=1,c+=b.shiftKey?"Shift":"outShift",this[c](b)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(a){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(a,"selectionStart"):this.selectionEnd!==this.text.length?(this._selectionDirection="right",this._moveRight(a,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(a){var b=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(b=this._moveRight(a,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,b},removeChars:function(a){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(a):this._removeCharsFromTo(this.selectionStart,this.selectionEnd),this.setSelectionEnd(this.selectionStart),this._removeExtraneousStyles(),this.canvas&&this.canvas.renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(a){if(0!==this.selectionStart)if(a.metaKey){var b=this.findLineBoundaryLeft(this.selectionStart);this._removeCharsFromTo(b,this.selectionStart),this.setSelectionStart(b)}else if(a.altKey){var c=this.findWordBoundaryLeft(this.selectionStart);this._removeCharsFromTo(c,this.selectionStart),this.setSelectionStart(c)}else this._removeSingleCharAndStyle(this.selectionStart),this.setSelectionStart(this.selectionStart-1)}}),function(){var a=fabric.util.toFixed,b=fabric.Object.NUM_FRACTION_DIGITS;fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(a,b,c,d,e,f){this._getLineStyle(a)?this._setSVGTextLineChars(a,b,c,d,f):fabric.Text.prototype._setSVGTextLineText.call(this,a,b,c,d,e)},_setSVGTextLineChars:function(a,b,c,d,e){for(var f=this._textLines[a],g=0,h=this._getLineLeftOffset(this._getLineWidth(this.ctx,a))-this.width/2,i=this._getSVGLineTopOffset(a),j=this._getHeightOfLine(this.ctx,a),k=0,l=f.length;l>k;k++){var m=this._getStyleDeclaration(a,k)||{};b.push(this._createTextCharSpan(f[k],m,h,i.lineTop+i.offset,g));var n=this._getWidthOfChar(this.ctx,f[k],a,k);m.textBackgroundColor&&e.push(this._createTextCharBg(m,h,i.lineTop,j,n,g)),g+=n}},_getSVGLineTopOffset:function(a){for(var b=0,c=0,d=0;a>d;d++)b+=this._getHeightOfLine(this.ctx,d);return c=this._getHeightOfLine(this.ctx,d),{lineTop:b,offset:(this._fontSizeMult-this._fontSizeFraction)*c/(this.lineHeight*this._fontSizeMult)}},_createTextCharBg:function(c,d,e,f,g,h){return['		<rect fill="',c.textBackgroundColor,'" x="',a(d+h,b),'" y="',a(e-this.height/2,b),'" width="',a(g,b),'" height="',a(f/this.lineHeight,b),'"></rect>\n'].join("")},_createTextCharSpan:function(c,d,e,f,g){var h=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text",getSvgFilter:fabric.Object.prototype.getSvgFilter},d));return['			<tspan x="',a(e+g,b),'" y="',a(f-this.height/2,b),'" ',d.fontFamily?'font-family="'+d.fontFamily.replace(/"/g,"'")+'" ':"",d.fontSize?'font-size="'+d.fontSize+'" ':"",d.fontStyle?'font-style="'+d.fontStyle+'" ':"",d.fontWeight?'font-weight="'+d.fontWeight+'" ':"",d.textDecoration?'text-decoration="'+d.textDecoration+'" ':"",'style="',h,'">',fabric.util.string.escapeXml(c),"</tspan>\n"].join("")}})}(),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.clone;b.Textbox=b.util.createClass(b.IText,b.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingY:!0,lockScalingFlip:!0,noScaleCache:!1,initialize:function(a,c){this.callSuper("initialize",a,c),this.setControlsVisibility(b.Textbox.getTextboxControlVisibility()),this.ctx=this.objectCaching?this._cacheContext:b.util.createCanvasElement().getContext("2d"),this._dimensionAffectingProps.push("width")},_initDimensions:function(a){this.__skipDimension||(a||(a=b.util.createCanvasElement().getContext("2d"),this._setTextStyles(a),this.clearContextTop()),this.dynamicMinWidth=0,this._textLines=this._splitTextIntoLines(a),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this._clearCache(),this.height=this._getTextHeight(a))},_generateStyleMap:function(){for(var a=0,b=0,c=0,d={},e=0;e<this._textLines.length;e++)"\n"===this.text[c]&&e>0?(b=0,c++,a++):" "===this.text[c]&&e>0&&(b++,c++),d[e]={line:a,offset:b},c+=this._textLines[e].length,b+=this._textLines[e].length;return d},_getStyleDeclaration:function(a,b,c){if(this._styleMap){var d=this._styleMap[a];if(!d)return c?{}:null;a=d.line,b=d.offset+b}return this.callSuper("_getStyleDeclaration",a,b,c)},_setStyleDeclaration:function(a,b,c){var d=this._styleMap[a];a=d.line,b=d.offset+b,this.styles[a][b]=c},_deleteStyleDeclaration:function(a,b){var c=this._styleMap[a];a=c.line,b=c.offset+b,delete this.styles[a][b]},_getLineStyle:function(a){var b=this._styleMap[a];return this.styles[b.line]},_setLineStyle:function(a,b){var c=this._styleMap[a];this.styles[c.line]=b},_deleteLineStyle:function(a){var b=this._styleMap[a];delete this.styles[b.line]},_wrapText:function(a,b){var c,d=b.split(this._reNewline),e=[];for(c=0;c<d.length;c++)e=e.concat(this._wrapLine(a,d[c],c));return e},_measureText:function(a,b,c,d){var e=0;d=d||0;for(var f=0,g=b.length;g>f;f++)e+=this._getWidthOfChar(a,b[f],c,f+d);return e},_wrapLine:function(a,b,c){for(var d=0,e=[],f="",g=b.split(" "),h="",i=0,j=" ",k=0,l=0,m=0,n=!0,o=this._getWidthOfCharSpacing(),p=0;p<g.length;p++)h=g[p],k=this._measureText(a,h,c,i),i+=h.length,d+=l+k-o,d>=this.width&&!n?(e.push(f),f="",d=k,n=!0):d+=o,n||(f+=j),f+=h,l=this._measureText(a,j,c,i),i++,n=!1,k>m&&(m=k);return p&&e.push(f),m>this.dynamicMinWidth&&(this.dynamicMinWidth=m-o),e},_splitTextIntoLines:function(a){a=a||this.ctx;var b=this.textAlign;a.save(),this._setTextStyles(a),this.textAlign="left";var c=this._wrapText(a,this.text);return this.textAlign=b,a.restore(),this._textLines=c,this._styleMap=this._generateStyleMap(),c},setOnGroup:function(a,b){"scaleX"===a&&(this.set("scaleX",Math.abs(1/b)),this.set("width",this.get("width")*b/("undefined"==typeof this.__oldScaleX?1:this.__oldScaleX)),this.__oldScaleX=b)},get2DCursorLocation:function(a){"undefined"==typeof a&&(a=this.selectionStart);for(var b=this._textLines.length,c=0,d=0;b>d;d++){var e=this._textLines[d],f=e.length;if(c+f>=a)return{lineIndex:d,charIndex:a-c};c+=f,("\n"===this.text[c]||" "===this.text[c])&&c++}return{lineIndex:b-1,charIndex:this._textLines[b-1].length}},_getCursorBoundariesOffsets:function(a,b){for(var c=0,d=0,e=this.get2DCursorLocation(),f=this._textLines[e.lineIndex].split(""),g=this._getLineLeftOffset(this._getLineWidth(this.ctx,e.lineIndex)),h=0;h<e.charIndex;h++)d+=this._getWidthOfChar(this.ctx,f[h],e.lineIndex,h);for(h=0;h<e.lineIndex;h++)c+=this._getHeightOfLine(this.ctx,h);return"cursor"===b&&(c+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,e.lineIndex)/this.lineHeight-this.getCurrentCharFontSize(e.lineIndex,e.charIndex)*(1-this._fontSizeFraction)),{top:c,left:d,lineLeft:g}},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},toObject:function(a){return this.callSuper("toObject",["minWidth"].concat(a))}}),b.Textbox.fromObject=function(a,d){var e=new b.Textbox(a.text,c(a));return d&&d(e),e},b.Textbox.getTextboxControlVisibility=function(){return{tl:!1,tr:!1,br:!1,bl:!1,ml:!0,mt:!1,mr:!0,mb:!1,mtr:!0}}}("undefined"!=typeof exports?exports:this),function(){var a=fabric.Canvas.prototype._setObjectScale;fabric.Canvas.prototype._setObjectScale=function(b,c,d,e,f,g,h){var i=c.target;if(!(i instanceof fabric.Textbox))return a.call(fabric.Canvas.prototype,b,c,d,e,f,g,h);var j=i.width*(b.x/c.scaleX/(i.width+i.strokeWidth));return j>=i.getMinWidth()?(i.set("width",j),!0):void 0},fabric.Group.prototype._refreshControlsVisibility=function(){if("undefined"!=typeof fabric.Textbox)for(var a=this._objects.length;a--;)if(this._objects[a]instanceof fabric.Textbox)return void this.setControlsVisibility(fabric.Textbox.getTextboxControlVisibility())};var b=fabric.util.object.clone;fabric.util.object.extend(fabric.Textbox.prototype,{_removeExtraneousStyles:function(){for(var a in this._styleMap)this._textLines[a]||delete this.styles[this._styleMap[a].line]},insertCharStyleObject:function(a,b,c){var d=this._styleMap[a];a=d.line,b=d.offset+b,fabric.IText.prototype.insertCharStyleObject.apply(this,[a,b,c])},insertNewlineStyleObject:function(a,b,c){var d=this._styleMap[a];a=d.line,b=d.offset+b,fabric.IText.prototype.insertNewlineStyleObject.apply(this,[a,b,c])},shiftLineStyles:function(a,c){var d=b(this.styles),e=this._styleMap[a];a=e.line;for(var f in this.styles){var g=parseInt(f,10);g>a&&(this.styles[g+c]=d[g],d[g-c]||delete this.styles[g])}},_getTextOnPreviousLine:function(a){for(var b=this._textLines[a-1];this._styleMap[a-2]&&this._styleMap[a-2].line===this._styleMap[a-1].line;)b=this._textLines[a-2]+b,a--;return b},removeStyleObject:function(a,b){var c=this.get2DCursorLocation(b),d=this._styleMap[c.lineIndex],e=d.line,f=d.offset+c.charIndex;this._removeStyleObject(a,c,e,f)}})}(),function(){var a=fabric.IText.prototype._getNewSelectionStartFromOffset;fabric.IText.prototype._getNewSelectionStartFromOffset=function(b,c,d,e,f){e=a.call(this,b,c,d,e,f);for(var g=0,h=0,i=0;i<this._textLines.length&&(g+=this._textLines[i].length,!(g+h>=e));i++)("\n"===this.text[g+h]||" "===this.text[g+h])&&h++;return e-i+h}}(),function(){function request(a,b,c){var d=URL.parse(a);d.port||(d.port=0===d.protocol.indexOf("https:")?443:80);var e=0===d.protocol.indexOf("https:")?HTTPS:HTTP,f=e.request({hostname:d.hostname,port:d.port,path:d.path,method:"GET"},function(a){var d="";b&&a.setEncoding(b),a.on("end",function(){c(d)}),a.on("data",function(b){200===a.statusCode&&(d+=b)})});f.on("error",function(a){fabric.log(a.errno===process.ECONNREFUSED?"ECONNREFUSED: connection refused to "+d.hostname+":"+d.port:a.message),c(null)}),f.end()}function requestFs(a,b){var c=require("fs");c.readFile(a,function(a,c){if(a)throw fabric.log(a),a;b(c)})}if("undefined"==typeof document||"undefined"==typeof window){var DOMParser=require("xmldom").DOMParser,URL=require("url"),HTTP=require("http"),HTTPS=require("https"),Canvas=require("canvas"),Image=require("canvas").Image;fabric.util.loadImage=function(a,b,c){function d(d){d?(e.src=new Buffer(d,"binary"),e._src=a,b&&b.call(c,e)):(e=null,b&&b.call(c,null,!0))}var e=new Image;a&&(a instanceof Buffer||0===a.indexOf("data"))?(e.src=e._src=a,b&&b.call(c,e)):a&&0!==a.indexOf("http")?requestFs(a,d):a?request(a,"binary",d):b&&b.call(c,a)},fabric.loadSVGFromURL=function(a,b,c){a=a.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim(),0!==a.indexOf("http")?requestFs(a,function(a){fabric.loadSVGFromString(a.toString(),b,c)}):request(a,"",function(a){fabric.loadSVGFromString(a,b,c)})},fabric.loadSVGFromString=function(a,b,c){var d=(new DOMParser).parseFromString(a);fabric.parseSVGDocument(d.documentElement,function(a,c){b&&b(a,c)},c)},fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body),callback&&callback()})},fabric.createCanvasForNode=function(a,b,c,d){d=d||c;var e=fabric.document.createElement("canvas"),f=new Canvas(a||600,b||600,d),g=new Canvas(a||600,b||600,d);e.style={},e.width=f.width,e.height=f.height,c=c||{},c.nodeCanvas=f,c.nodeCacheCanvas=g;var h=fabric.Canvas||fabric.StaticCanvas,i=new h(e,c);return i.nodeCanvas=f,i.nodeCacheCanvas=g,i.contextContainer=f.getContext("2d"),i.contextCache=g.getContext("2d"),i.Font=Canvas.Font,i};var originaInitStatic=fabric.StaticCanvas.prototype._initStatic;fabric.StaticCanvas.prototype._initStatic=function(a,b){a=a||fabric.document.createElement("canvas"),this.nodeCanvas=new Canvas(a.width,a.height),this.nodeCacheCanvas=new Canvas(a.width,a.height),originaInitStatic.call(this,a,b),this.contextContainer=this.nodeCanvas.getContext("2d"),this.contextCache=this.nodeCacheCanvas.getContext("2d"),this.Font=Canvas.Font},fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(a){return this.nodeCanvas.createJPEGStream(a)},fabric.StaticCanvas.prototype._initRetinaScaling=function(){return this._isRetinaScaling()?(this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.nodeCanvas.width=this.width*fabric.devicePixelRatio,this.nodeCanvas.height=this.height*fabric.devicePixelRatio,this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio),this):void 0},fabric.Canvas&&(fabric.Canvas.prototype._initRetinaScaling=fabric.StaticCanvas.prototype._initRetinaScaling);var origSetBackstoreDimension=fabric.StaticCanvas.prototype._setBackstoreDimension;fabric.StaticCanvas.prototype._setBackstoreDimension=function(a,b){return origSetBackstoreDimension.call(this,a,b),this.nodeCanvas[a]=b,this},fabric.Canvas&&(fabric.Canvas.prototype._setBackstoreDimension=fabric.StaticCanvas.prototype._setBackstoreDimension)}}(),DrawerJs={plugins:{},util:{},utilPlugins:{},brushes:{}},DrawerJs.texts={"Add Drawer":"Add Drawer","Insert Drawer":"Insert Drawer",Insert:"Insert","Free drawing mode":"Free drawing mode",SimpleWhiteEraser:"SimpleWhiteEraser",Eraser:"Eraser","Delete this canvas":"Delete this canvas","Are you sure want to delete this canvas?":"Are you sure want to delete this canvas?","Size (px)":"Size (px)",Position:"Position",Inline:"Inline",Left:"Left",Center:"Center",Right:"Right",Floating:"Floating","Canvas properties":"Canvas properties",Background:"Background",transparent:"transparent",Cancel:"Cancel",Save:"Save","Enter fullscreen mode":"Enter fullscreen mode","Exit fullscreen mode":"Exit fullscreen mode","Bring forward":"Bring forward","Send backwards":"Send backwards",
"Bring to front":"Bring to front","Send to back":"Send to back",Duplicate:"Duplicate",Remove:"Remove","Size:":"Size:","Fill:":"Fill:",Transparent:"Transparent","Border:":"Border:",None:"None","Draw an arrow":"Draw an arrow","Draw a two-sided arrow":"Draw a two-sided arrow","Lines and arrows":"Lines and arrows","Draw a circle":"Draw a circle","Draw a line":"Draw a line","Draw a rectangle":"Draw a rectangle","Draw a triangle":"Draw a triangle","Draw a Polygon":"Draw a Polygon","Stop drawing a polygon":"Stop drawing a polygon (esc)","Click to start a new line":"Click to start a new line","Draw a text":"Draw a text","Click to place a text":"Click to place a text","Font:":"Font:","Move canvas":"Move canvas","Click to start drawing a ":"Click to start drawing a "},function(a,b){"use strict";{var c=(fabric.util.getPointer,fabric.util.degreesToRadians,fabric.util.radiansToDegrees),d=Math.atan2;Math.abs}a.Canvas=fabric.util.createClass(fabric.Canvas,{initialize:function(a,b){b=b?b:{},this.preserveObjectStacking=!0,this.callSuper("initialize",a,b)},disableSelection:function(){var a=null,b=this.getObjects();this.deactivateAll();for(var c=0;c<b.length;c++)a=b[c],void 0===a.__evented&&(a.__evented=a.get("evented"),a.set("evented",!1)),void 0===a.__selectable&&(a.__selectable=a.get("selectable"),a.set("selectable",!1))},restoreSelection:function(){for(var a=null,b=this.getObjects(),c=0;c<b.length;c++)a=b[c],void 0!==a.__evented&&(a.set("evented",a.__evented),delete a.__evented),void 0!==a.__selectable&&(a.set("selectable",a.__selectable),delete a.__selectable)},_renderObjects:function(a,c){var d,e,f,g=b.getTemporaryCanvas(this),h=g.getContext("2d");for(h.clearRect(0,0,this.width,this.height),this.eraserPaths=[],d=0,e=c.length;e>d;++d)f=c[d],f instanceof fabric.EraserPath||f.render(a)},_applyEraserPath:function(a,b){a.visible=!0,a.globalCompositeOperation="destination-out",a.render(b),a.visible=!1},_findNewLowerIndex:function(a,b,c){var d;if(c){d=b;for(var e=b-1;e>=0;--e)if(!(this._objects[e]instanceof fabric.EraserPath)){var f=a.intersectsWithObject(this._objects[e])||a.isContainedWithinObject(this._objects[e])||this._objects[e].isContainedWithinObject(a);if(f){d=e;break}}}else d=b-1;return d},_findNewUpperIndex:function(a,b,c){var d;if(c){d=b;for(var e=b+1;e<this._objects.length;++e)if(!(this._objects[e]instanceof fabric.EraserPath)){var f=a.intersectsWithObject(this._objects[e])||a.isContainedWithinObject(this._objects[e])||this._objects[e].isContainedWithinObject(a);if(f){d=e;break}}}else d=b+1;return d},_rotateObject:function(a,b){var e=this._currentTransform;if(!e.target.get("lockRotation")){var f=d(e.ey-e.top,e.ex-e.left),g=d(b-e.top,a-e.left),h=c(g-f+e.theta);return 0>h&&(h=360+h),e.target.set("angle",h%360),!0}}})}(DrawerJs,DrawerJs.util),function(a,b){"use strict";var c=null;b.setDrawerFolderUrl=function(a){c=a.replace(/\/*$/g,"")+"/"},b.getDrawerFolderUrl=function(){if(c)return c;for(var a=document.getElementsByTagName("script"),b=/dist\/(drawer.+\.js)+$/,d=0;d<a.length;d++){var e=a.item(d);if(e.src){var f=e.src.match(b);if(f){var g=e.src.replace(f[1],"");return g}}}return""},b.unbindClick=function(b,c){var d=c+"drawerBindClick";a(b).off("click."+d),a(b).off("touchstart."+d),a(b).off("touchend."+d)},b.bindClick=function(b,c,d){var e=c+"drawerBindClick";a(b).on("click."+e,function(a){var c=this,f=null;if(c.__lastClickTime){var g=Date.now()-c.__lastClickTime;if(g>500){try{f=d.apply(c,[a])}catch(h){var i="Catched error - click."+e;console.groupCollapsed(i),console.log("%c[Event name]","color: green","click."+e),console.log("%c[Element]","color: green",b),console.error(h),console.groupEnd(i)}if(f===!1)return a.stopPropagation(),a.preventDefault(),!1}}else{try{f=d.apply(c,[a])}catch(h){var i="Catched error - click."+e;console.groupCollapsed(i),console.log("%c[Event name]","color: green","click."+e),console.log("%c[Element]","color: green",b),console.error(h),console.groupEnd(i)}if(f===!1)return a.stopPropagation(),a.preventDefault(),!1}}),a(b).on("touchstart."+e,function(c){var d=this;d.__drawerTouchStartEvent=c,a(b).off("click."+e)}),a(b).on("touchend."+e,function(a){var b,c=this;if(c.__drawerTouchStartEvent){var f=Math.abs(c.__drawerTouchStartEvent.timeStamp-a.timeStamp);if(300>f){c.__lastClickTime=Date.now();try{b=d.apply(c,[a])}catch(g){var h="Catched error - touchend."+e;console.groupCollapsed(h),console.log("%c[Event name]","color: green","touchend."+e),console.log("%c[Element]","color: green",c),console.error(g),console.groupEnd(h)}if(b===!1)return a.stopPropagation(),a.preventDefault(),!1}delete c.__drawerTouchStartEvent}})},b.bindDoubleTap=function(c,d,e){var f=500,g=20;a(c).on("touchend."+d,function(a){var c,h=this;if(h.__touchEndTime){var i=Date.now()-h.__touchEndTime;c=b.getEventPosition(a);var j,k=Math.abs(h.__touchEndX-c.left),l=Math.abs(h.__touchEndY-c.top);if(f>i&&g>k&&g>l){delete h.__touchEndTime,delete h.__touchEndX,delete h.__touchEndY;try{j=e.apply(h,[a])}catch(m){var n="Catched error - touchend(doubleTap)."+d;console.groupCollapsed(n),console.log("%c[Event name]","color: green","touchend(doubleTap)."+d),console.log("%c[Element]","color: green",h),console.error(m),console.groupEnd(n)}if(j===!1)return a.stopPropagation(),a.preventDefault(),!1}else delete h.__touchEndTime,delete h.__touchEndX,delete h.__touchEndY}else h.__touchEndTime=Date.now(),c=b.getEventPosition(a),h.__touchEndX=c.left,h.__touchEndY=c.top,b.setTimeout(function(){delete h.__touchEndTime,delete h.__touchEndX,delete h.__touchEndY},f)})},b.bindLongPress=function(c,d,e){var f="drawerBindLongPress",g=d+f;a(c).on("touchstart."+g,function(c){var d=this;d.__touchStartTime=Date.now();var f=b.getEventPosition(c);d.__touchStartX=f.left,d.__touchStartY=f.top,d.__longPressCheckTimeout&&clearTimeout(d.__longPressCheckTimeout);var h=function(){delete d.__touchStartTime,delete d.__touchStartX,delete d.__touchStartY,a(d).off("touchmove."+g),a(d).off("touchend."+g)};return a(d).on("touchmove."+g,function(a){var c=b.getEventPosition(a);if(d.__touchStartTime){var e=Math.abs(d.__touchStartX-c.left),f=Math.abs(d.__touchStartY-c.top);(e>10||f>10)&&h()}}),a(d).on("touchend."+g,function(){h()}),d.__longPressCheckTimeout=setTimeout(function(){if(d.__touchStartTime){h();try{{e.apply(d,[c])}}catch(a){var b="Catched error - touchstart(bindLongPress)."+g;console.groupCollapsed(b),console.log("%c[Event name]","color: green","touchstart(bindLongPress)."+g),console.log("%c[Element]","color: green",d),console.error(a),console.groupEnd(b)}}},1e3),!0})},b.unbindLongPress=function(b,c){var d="drawerBindLongPress",e=c+d;a(b).off("touchstart."+e),a(b).off("touchmove."+e),a(b).off("touchend."+e)},b.mouseDown=function(a){return"mousedown."+a+this.id+" touchstart."+a+this.id},b.mouseMove=function(a){return"mousemove."+a+this.id+" touchmove."+a+this.id},b.mouseUp=function(a){return"mouseup."+a+this.id+" touchend."+a+this.id},b.getTransitionDuration=function(a,b){var c=window.getComputedStyle(a),d=c.webkitTransitionDuration,e=c.webkitTransitionDelay;return d=d.indexOf("ms")>-1?parseFloat(d):1e3*parseFloat(d),e=e.indexOf("ms")>-1?parseFloat(e):1e3*parseFloat(e),b?d+e:d},b.getEventPosition=function(a,c){var d={},e=function(a,c){var d;if(a){var f=a.type.indexOf("touch")>-1,g=f&&a.touches&&a.touches.length,h=b.eventCoordsAreValid(a),i=f&&g&&!h;d=i?a:!c&&e(a.originalEvent,!0)}return d};if(a){c=c||0;var f=e(a),g=f&&b.eventCoordsAreValid(f.touches[c]),h=b.eventCoordsAreValid(a),i=a&&a.originalEvent&&b.eventCoordsAreValid(a.originalEvent),j=g&&f.touches[c]||h&&a||i&&a.originalEvent;j&&(d={left:j.pageX,top:j.pageY})}return d},b.eventCoordsAreValid=function(a){var b;if(a){var c=0!==a.pageX&&0!==a.pageY,d="number"==typeof a.pageX&&"number"==typeof a.pageY,e=d&&isFinite(a.pageX)&&isFinite(a.pageY);b=c&&d&&e}return b},b.isShape=function(a){var b=!1;return b=!a.type||"line"!=a.type&&"arrow"!=a.type?a.path?!1:!0:!1},b.__temporaryCanvas=null,b.__latestValidCanvasWidth=null,b.__latestValidCanvasHeight=null,b.getTemporaryCanvas=function(a){b.__temporaryCanvas||(b.__temporaryCanvas=document.createElement("canvas"));var c=a.width,d=a.height,e=c||b.__latestValidCanvasWidth||1,f=d||b.__latestValidCanvasHeight||1;return b.__temporaryCanvas.setAttribute("width",e),b.__temporaryCanvas.setAttribute("height",f),b.__latestValidCanvasWidth=e,b.__latestValidCanvasHeight=f,b.__temporaryCanvas},b.LastCoordsQueue=function(){this.coordsQueue=[],this.length=10,this.pushCoords=function(a,b){this.coordsQueue.length>this.length&&(this.coordsQueue=this.coordsQueue.slice(this.coordsQueue.length-this.length)),this.coordsQueue.push({x:a,y:b})},this.getInterpolatedValues=function(){if(0===this.coordsQueue.length)return[];if(1===this.coordsQueue.length)return[{x:this.coordsQueue[0].x,y:this.coordsQueue[0].y}];for(var a=[],b=this.coordsQueue[this.coordsQueue.length-2].x,c=this.coordsQueue[this.coordsQueue.length-2].y,d=this.coordsQueue[this.coordsQueue.length-1].x,e=this.coordsQueue[this.coordsQueue.length-1].y,f=d-b,g=e-c,h=Math.abs(f),i=Math.abs(g),j=h>i?h:i,k=0;j>k;k++)a.push({x:b+f/j*k,y:c+g/j*k});return a}},b.addCSSRule=function(a,b,c,d){a&&("insertRule"in a?a.insertRule(b+"{"+c+"}",d):"addRule"in a&&a.addRule(b,c,d))},b.addStyleToStyleSheet=function(c,d,e,f,g){var h=e&&e instanceof jQuery&&e.length,i="string"==typeof e&&a(e).length&&a(e),j=e instanceof Node&&a(e).length&&a(e),k=h||i||j;if(k)b.addCSSRule(k[0].sheet,c,d);else if(f){var l=document.head||document.getElementsByTagName("head")[0],m=document.createElement("style");m.type="text/css",m.id=e,l.appendChild(m),b.addCSSRule(m.sheet,c,d)}else if(g){var n=c+"{"+d+"}";b.addStyle(n)}},b.addStyle=function(a){var b=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css",c.styleSheet?c.styleSheet.cssText=a:c.appendChild(document.createTextNode(a)),b.appendChild(c)},b.isString=function(a){return"string"==typeof a||a instanceof String},b.getScrollTopFromElement=function(a){for(var b=a,c={left:0,top:0},d=!0;d;){d=b&&b.length&&!b.is("body");var e=b.scrollTop(),f=b.scrollLeft();c.top+=e,c.left+=f,b=b.parent()}return c},b.debounce=function(a,c,d){c=c||0;var e;return function(){var f=this,g=arguments,h=function(){e=null,d||a.apply(f,g)},i=d&&!e;clearTimeout(e),e=b.setTimeout(h,c),i&&a.apply(f,g)}},b.loadImage=function(a,c,d,e){d=d||{};var f=c||new Image;return f.style.opacity=0,new Promise(function(c){f.src===a?c(f,d):(f.removeAttribute("crossOrigin"),!e&&a.match(/^https?:\/\/|^\/\//)&&f.setAttribute("crossOrigin","anonymous"),f.onload=function(){b.setTimeout(function(){c(f,d)},1)},f.src=a)})},b.checkBrowser=function(a){var b=navigator.userAgent.toLowerCase(),c=/(opr)[\/]([\w.]+)/.exec(b)||/(chrome)[ \/]([\w.]+)/.exec(b)||/(webkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(b)||/(webkit)[ \/]([\w.]+)/.exec(b)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(b)||/(msie) ([\w.]+)/.exec(b)||b.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(b)||b.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(b)||[];return"safari"==a?"undefined"!=typeof c[3]?"safari"==c[3]:!1:"version"==a?c[2]:"webkit"==a?"chrome"==c[1]||"opr"==c[1]||"webkit"==c[1]:"rv"==c[1]?"msie"==a:"opr"==c[1]?"webkit"==a:a==c[1]},b.getScrollOffset=function(a){var b={},c=!0,d=a,e=0,f=0;if(a&&a.length)for(;c;)d=d.parent(),c=d&&d.length&&!d.is("body"),e+=d.scrollLeft(),f+=d.scrollTop();return b.left=e,b.top=f,b},b.setTimeout=function(a,b,c){var d,e,f=new Error("Parent stack"),g=f.stack;return d=function(){try{a.apply(window,arguments)}catch(b){var c="Catched error - setTimeout";console.groupCollapsed(c),console.log("%c[Parent stack]","color: green",g),console.log("%c[Error stack]","color: green",b.stack),console.error(b),console.groupEnd(c)}},e=window.setTimeout(d,b,c)},function(){var a,c,d="";window.addEventListener?a="addEventListener":(a="attachEvent",d="on");var e="onwheel"in document.createElement("div")&&"wheel",f=void 0!==document.onmousewheel&&"mousewheel",g="DOMMouseScroll";c=e||f||g;var h=function(a){a=a||window.event;var b={originalEvent:a,target:a.target||a.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==a.type?0:1,deltaX:0,deltaY:0,deltaZ:0,preventDefault:function(){a.preventDefault?a.preventDefault():a.returnValue=!1}};return"mousewheel"==c?(b.deltaY=-1/40*a.wheelDelta,a.wheelDeltaX&&(b.deltaX=-1/40*a.wheelDeltaX)):b.deltaY=a.deltaY||a.detail,callback(b)},i=function(b,e,f,g){var i,j=d+e;i="wheel"==c?f:h,b[a](j,i,g||!1)};b.addWheelListener=function(a,b,d){i(a,c,b,d),"DOMMouseScroll"==c&&i(a,"MozMousePixelScroll",b,d)},b.requestAnimationFrame=window.requestAnimationFrame.bind(window)||window.mozRequestAnimationFrame.bind(window)||window.webkitRequestAnimationFrame.bind(window)||window.msRequestAnimationFrame.bind(window)||function(a){a()},b.cancelAnimationFrame=window.cancelAnimationFrame.bind(window)||window.mozCancelAnimationFrame.bind(window)||function(){}}()}(jQuery,DrawerJs.util),function(){var a=function(a){if(!a)throw new Error("DrawerApi(): no drawer is provided!");this.drawer=a};a.prototype.drawer=null,a.prototype.checkIsActive=function(){if(this.drawer.mode!=this.drawer.MODE_ACTIVE)throw new Error("Drawer is not active!")},a.prototype.startEditing=function(){this.drawer._startEditing()},a.prototype.stopEditing=function(){this.drawer._stopEditing()},a.prototype.getCanvasAsJSON=function(){return this.drawer.api.checkIsActive(),this.drawer.getSerializedCanvas()},a.prototype.saveCanvas=function(){this.drawer.api.checkIsActive(),this.drawer.syncCanvasData()},a.prototype.loadCanvasFromData=function(a){this.drawer.loadCanvas(a)},a.prototype.getCanvasAsImage=function(){return this.drawer.getImageData()},a.prototype.saveCanvasImage=function(){this.drawer.api.checkIsActive(),this.drawer.syncImageData()},a.prototype.getSize=function(){var a=this.drawer.getSize();return a},a.prototype.setSize=function(a,b){this.drawer.setSize(a,b)},a.prototype.setActiveColor=function(a){this.drawer.setActiveColor(a)},a.prototype.createText=function(a,b,c,d){this.drawer._pluginsInstances.Text.addShape(a,b,c,d)},a.prototype.updateOptions=function(a){this.drawer.updateOptions(a)},a.prototype.setOptions=function(a){this.drawer.setOptions(a)},a.prototype.loadPlugin=function(a){this.drawer.loadPlugin(a)},a.prototype.unloadPlugin=function(a){this.drawer.unloadPlugin(a)},DrawerJs.DrawerApi=a}(DrawerJs),function(a){a.prototype._checkObject=function(a){if(!a)throw new Error("[Drawer API]  no object provided!");if(!(a instanceof fabric.Object))throw new Error("[Drawer API]  object type is not 'fabric.Object!'")},a.prototype.getSelectedObject=function(){return this.drawer.fCanvas.getActiveObject()},a.prototype.bringObjectForward=function(a){return this._checkObject(a),this.drawer.fCanvas.bringForward(a,!0),this.drawer.syncCanvasData(),a},a.prototype.sendObjectBackwards=function(a){return this._checkObject(a),this.drawer.fCanvas.sendBackwards(a,!0),this.drawer.syncCanvasData(),a},a.prototype.bringObjectToFront=function(a){return this._checkObject(a),this.drawer.fCanvas.bringToFront(a,!0),this.drawer.syncCanvasData(),a},a.prototype.sendObjectToBack=function(a){return this._checkObject(a),this.drawer.fCanvas.sendToBack(a),this.drawer.syncCanvasData(),a},a.prototype.removeObject=function(a){this._checkObject(a),a.remove(),this.drawer.fCanvas.renderAll()},a.prototype.duplicateObject=function(a,b){this._checkObject(a);var c=this,d=function(d){if(!d)throw new Error("[Drawer API] duplicateObject() : Clone failed! Clone source: "+a.toString());return d.set("left",a.get("left")+20),d.set("top",a.get("top")+20),c.drawer.fCanvas.add(d),c.drawer.fCanvas.renderAll(),b&&b(d),d};return a.async?void a.clone(d):d(a.clone())}}(DrawerJs.DrawerApi),function(a,b,c,d){"use strict";var e=function(c,e,f,g){var h=this;if(this.mode=this.MODE_INACTIVE,this.redactorInstance=c,this.id=Math.random().toString().replace("0.",""),this.width=f||0,this.height=g||0,this._eventEmitter=a({}),this.api=new b.DrawerApi(this),this.setOptions(e),this.$imageElement=null,this.$canvasEditContainer=null,this.aligmentCss={},this.toolbars=new DrawerToolbarManager(this),h.options.detectTouch){if("Function"!==h.options.detectTouch.constructor.name)throw new Error("detectTouch should be a function which will be called when Drawer needs to determine whether it is working on touch device");h.touchDevice=h.options.detectTouch(h)}else h.touchDevice=/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent),a("body").on("touchstart.DrawerTouchCheck",function(){h.touchDevice=!0,a("body").off("touchstart.DrawerTouchCheck"),h.log("touch","Found touch screen")});if(h.$canvasDataContainer=null,h.options.contentConfig.canvasDataContainer&&(h.$canvasDataContainer=a(h.options.contentConfig.canvasDataContainer),h.$canvasDataContainer.length<1))throw h.$canvasDataContainer=null,new Error("contentConfig.canvasDataContainer provided but not found in DOM: "+h.options.contentConfig.canvasDataContainer);if(h.$imagesContainer=null,h.options.contentConfig.imagesContainer&&(h.$imagesContainer=a(h.options.contentConfig.imagesContainer),h.$imagesContainer.length<1))throw h.$imagesContainer=null,new Error("contentConfig.imagesContainer provided but not found in DOM: "+h.options.contentConfig.imagesContainer);var i=".editable-canvas-not-edited {background: url("+this.options.defaultImageUrl+") no-repeat !important;background-size: contain !important;}";return d.addStyle(i),this};e.prototype.api={},e.prototype.MODE_PREPARING="mode:preparing",e.prototype.MODE_ACTIVE="mode:active",e.prototype.MODE_INACTIVE="mode:inactive",e.prototype.setOptions=function(b){this.options=a.extend(!0,this.defaultOptions||{},b||{}),this.onOptionsUpdated(!0)},e.prototype.getPluginConfig=function(b){var c={},d=b&&"string"==typeof b&&b.length,e=d&&this.options.pluginsConfig[b],f=d&&this.options.pluginsConfig.Text&&this.options.pluginsConfig.Text[b];return e&&(c=a.extend(!0,c,e)),f&&(c=a.extend(!0,c,f)),c},e.prototype.updateOptions=function(b){b=b||{},this.options=a.extend(!0,this.options,b);var c=!1;b.plugins&&(this.options.plugins=b.plugins,c=!0),this.onOptionsUpdated(c)},e.prototype.onOptionsUpdated=function(a){this.options.basePath&&d.setDrawerFolderUrl(this.options.basePath),this.options.canvasProperties.rotationCursor="url("+d.getDrawerFolderUrl()+"assets/cursor-fa-rotate-right.cur), default",this.activeColor||(this.activeColor=this.options.activeColor||this.defaultOptions.activeColor),void 0===this.activeOpacity&&(this.activeOpacity=this.options.activeOpacity||this.defaultOptions.activeOpacity),a&&(this.loadPlugins(),this.toolbars&&this.toolbars.resetAllToolbars())},e.prototype.unloadPlugins=function(){for(var a in this._pluginsInstances)this.unloadPlugin(a)},e.prototype.unloadPlugin=function(a){if(this._pluginsInstances.hasOwnProperty(a)){var b=this._pluginsInstances[a];b.removeTool&&b.removeTool(!0),delete this._pluginsInstances[a]}},e.prototype.loadPlugin=function(a){if(!a||!c[a])return void this.error("Drawer: Load plugin error - "+a+". No such plugin.");var b=this._pluginsInstances[a],d=this.options.corePlugins&&-1!==this.options.corePlugins.indexOf(a);if(b)return void(d||this.error("Drawer: Load plugin error - "+a+". Plugin should not be specified multiple times."));try{var e={};this.options.pluginsConfig[a]&&(e=this.options.pluginsConfig[a]);var f=new c[a](this,e);this._pluginsInstances[a]=f}catch(g){this.error("Drawer: Load plugin error - "+a+"."),this.error(g)}},e.prototype.loadPlugins=function(){if(this._pluginsInstances?this.unloadPlugins():this._pluginsInstances={},this.options.corePlugins)for(var a=0;a<this.options.corePlugins.length;a++)this.loadPlugin(this.options.corePlugins[a]);if(this.options.plugins)for(var b=0;b<this.options.plugins.length;b++)this.loadPlugin(this.options.plugins[b])},e.prototype.log=function(a,b){this.options.debug&&console.log("%c["+a+"]","color: green",b)},e.prototype.error=function(a){this.options.debug&&console.error(a)},e.prototype.clickEvent=function(a){return"click."+a+" touchend."+a},e.prototype.getHtml=function(){var b=a("<img>").css({display:"inline-block",width:this.width||this.options.defaultWidth,height:this.height||this.options.defaultHeight,background:this.options.backgroundCss}).addClass("editable-canvas-image").addClass("editable-canvas-not-edited").attr("id","canvas_image_"+this.id).attr("data-redactor-drawer-enabled",!0).attr("src","");return this.options.borderCss&&b.css("border",this.options.borderCss),a(b)[0].outerHTML},e.prototype.updateAligmentCss=function(){this.aligmentCss=this.getAligmentCssFor(this.$imageElement)},e.prototype.getAligmentCssFor=function(a){var b=window.getComputedStyle(a[0]),c={display:b.display,"float":b["float"],"margin-left":b.marginLeft,"margin-right":b.marginRight,position:b.position,left:b.left,top:b.top};return a.attr("data-margin-left")&&(c["margin-left"]=a.attr("data-margin-left")),a.attr("data-margin-right")&&(c["margin-right"]=a.attr("data-margin-right")),c},e.prototype.setAligmentCssFor=function(a,b){"none"==a.css("display")&&delete b.display,a.css(b),b["margin-left"]&&"auto"==b["margin-left"]&&(a.css("margin-left","auto"),a.attr("data-margin-left","auto")),b["margin-right"]&&"auto"==b["margin-right"]&&(a.css("margin-right","auto"),a.attr("data-margin-right","auto"))},e.prototype.onInsert=function(){var b=this;a(document).off(this.clickEvent("DrawerStop"+this.id));var c=!this.$imageElement;this.$imageElement=a(document.getElementById("canvas_image_"+this.id)),c&&(this.aligmentCss=this.options.align?this._generateAlignCss(this.options.align):this.getAligmentCssFor(this.$imageElement),this.width=this.$imageElement.outerWidth(),this.height=this.$imageElement.outerHeight(),this.$imageElement.removeClass("edit-mode")),this.$imageElement.attr("src").length<1&&!this.$imageElement.hasClass("editable-canvas-not-edited")&&(this.$imageElement.attr("src",this.getImageData()),this.$imageElement.removeClass("editable-canvas-not-edited")),this.setAligmentCssFor(this.$imageElement,this.aligmentCss),this.options.editOnClick?(this.$imageElement.off(),d.bindClick(this.$imageElement,"Drawer",function(){b._startEditing()})):(this.$imageElement.off(b.clickEvent("Drawer")),this.$imageElement.on(b.clickEvent("Drawer"),function(){b.drawCanvasControls()})),d.bindClick(a(document),"Drawer",this._globalClickHandler.bind(this)),this.on(this.EVENT_OPTIONS_CHANGED,this.onOptionsChange.bind(this)),this.on(this.EVENT_CANVAS_READY,this.onOptionsChange.bind(this))},e.prototype._globalClickHandler=function(b){var c=a(b.target).parents("#redactor-drawer-box");if(c.length>0)return c.attr("data-canvas-id")!=this.id?!1:!0;if(b.target.id=="canvas_image_"+this.id)return!1;if("redactor-image-editter"==b.target.id&&a(b.target).attr("data-canvas-id")==this.id)return!1;if(a(b.target).parents("#redactor-modal").length>0)return!1;if(this.$canvasEditContainer){var d=!(!this.options.exitOnOutsideClick||this.resizingNow||this.croppingNow||this.movingNow||this.fullscreenMode||this.drawingInProgress||this.isBrushDrawing);d&&this._stopEditing()}},e.prototype.drawCanvasControls=function(){var b=this,c=a("#redactor-image-editter");c.attr("data-canvas-id",this.id),c.text("Edit in Drawer"),c.css("margin-left","-"+c.innerWidth()/2+"px"),c.off("click"),c.on("click",function(){b._startEditing()})},e.prototype._startEditing=function(){this.log("canvasEditMode","startEditing()");var c=this;if(this.mode!=this.MODE_INACTIVE)return void this.log("Drawer.startEditing(): already in active mode");this.mode=this.MODE_PREPARING,c.redactorInstance&&c.redactorInstance.$editor.attr("contenteditable","false"),c._previousFocusedElement=document.activeElement,a(document.activeElement).blur(),this.width=this.$imageElement.outerWidth(),this.height=this.$imageElement.outerHeight(),this.$imageElement.addClass("edit-mode"),this.$imageElement.removeClass("editable-canvas-not-edited");var d=a('<canvas width="'+this.width+'" height="'+this.height+'" />');this.$canvasEditContainer=a('<span id="redactor-drawer-box" data-canvas-id="'+this.id+'" tabindex="0"></span>'),this.$canvasEditContainer=a("<span></span>"),this.$canvasEditContainer.attr("id","redactor-drawer-box"),this.$canvasEditContainer.attr("data-canvas-id",this.id),this.$canvasEditContainer.attr({id:"redactor-drawer-box","class":"drawer-instance-container","data-canvas-id":this.id,tabindex:"0"}),this.options.borderCss&&this.$canvasEditContainer.css("border",this.options.borderCssEditMode),this.touchDevice&&this.$canvasEditContainer.addClass("touch"),this.$canvasEditContainer.css({position:"absolute"}),this.aligmentCss=this.getAligmentCssFor(this.$imageElement),this.$canvasEditContainer.append(d),a("body").append(this.$canvasEditContainer),this.adjustEditContainer(),a(window).on("resize.drawer"+this.id,function(){c.adjustEditContainer(!1,!0)}),this.redactorInstance&&this.redactorInstance.image.hideResize();var e=this.getCanvasData();this.fCanvas=new b.Canvas(d.get(0)),this.fCanvas.selection=!1,this.options&&this.options.canvasProperties&&a.each(this.options.canvasProperties,function(a,b){c.fCanvas[a]=b}),this.$canvasEditContainer.css("background",this.$imageElement.css("background")),this.loadCanvas(e)},e.prototype._stopEditing=function(){return this.log("canvasEditMode","_stopEditing()"),this.mode==this.MODE_INACTIVE?void this.log("canvasEditMode","_stopEditing(): already stopped, mode is INACTIVE"):(this.redactorInstance&&this.redactorInstance.$editor.attr("contenteditable","true"),this.trigger(this.EVENT_DO_DEACTIVATE_ALL_TOOLS),this.fCanvas&&this.fCanvas.deactivateAll(),this.$imageElement.attr("src",this.getImageData()),this.$imageElement.removeClass("edit-mode"),this.$imageElement.removeClass("editable-canvas-not-edited"),this.syncCanvasData(),this.$imageElement.show(),this.$canvasEditContainer&&(this.$canvasEditContainer.remove(),this.$canvasEditContainer=null),a(window).off("resize.drawer"+this.id),this.trigger(this.EVENT_EDIT_STOP),void(this.mode=this.MODE_INACTIVE))},e.prototype.setActiveColor=function(a){var b=this.fCanvas.getActiveObject(),c=this.activeDrawingTool,d=this._pluginsInstances.Color,e=d&&d.colorControl;this.activeColor=a,this.options.activeColor=a,!b&&e&&e.setColor(a),c&&(c.brush=null,c._activateTool()),this.trigger(this.EVENT_CANVAS_MODIFIED)},e.prototype.setColor=function(a,b){if(a&&(this.activeColor=a),void 0!==b&&(this.activeOpacity=b),this.fCanvas){var c=this.fCanvas.getActiveObject();if(this.setOpacity(this.activeOpacity,!0),c){var d="line"===c.type||"arrow"===c.type,e=c.path;d?c.set("stroke",this.activeColor):e?c.set("stroke",this.activeColor):c.set("fill",this.activeColor),this.fCanvas.renderAll()}this.fCanvas.freeDrawingBrush.color=this.activeColor,this.fCanvas.freeDrawingBrush.fill=this.activeColor,this.trigger(this.EVENT_CANVAS_MODIFIED)}},e.prototype.setOpacity=function(a,b){a=void 0!==a?a:this.activeOpacity,this.activeOpacity=a;var c=this.fCanvas.getActiveObject();c&&c.set("opacity",a),this.fCanvas.freeDrawingBrush.opacity=a,b||(this.fCanvas.renderAll(),this.trigger(this.EVENT_CANVAS_MODIFIED))},e.prototype.setBrushSize=function(a){this.fCanvas&&(this.fCanvas.freeDrawingBrush.width=a),this.trigger(this.EVENT_BRUSH_SIZE_CHANGED)},e.prototype.getBrushSize=function(){var a=0;return this.fCanvas&&(a=this.fCanvas.freeDrawingBrush.width),a},e.prototype.setBrush=function(a){this.fCanvas.freeDrawingBrush=a,this.trigger(this.EVENT_BRUSH_CHANGED)},e.prototype.getBrush=function(){return this.fCanvas?this.fCanvas.freeDrawingBrush:null},e.prototype.getSize=function(){var a={},b=this.$canvasEditContainer,c=b&&b.get(0).getBoundingClientRect(),e=b&&d.getScrollOffset(b);return a.top=c?c.top:null,a.left=c?c.left:null,a.scrollTop=e?e.top:null,a.scrollLeft=e?e.left:null,a.width=this.width,a.height=this.height,a},e.prototype.setSize=function(a,b){this.width=a,this.height=b,this.fCanvas&&(this.fCanvas.setWidth(this.width),this.fCanvas.setHeight(this.height)),this.$imageElement.css("width",this.width),this.$imageElement.css("height",this.height),this.$canvasEditContainer&&(this.$canvasEditContainer.css("width",this.width),this.$canvasEditContainer.css("height",this.height)),this.adjustEditContainer(!1,!0)},e.prototype._generateAlignCss=function(a){var b={};switch(a){case"floating":b.position="absolute",b.display="block",b["float"]="none",b.left="0px",b.top="0px";break;case"center":b["float"]="none",b["margin-left"]="auto",b["margin-right"]="auto",b.display="block",b.position="static";break;case"left":case"right":b.display="block",b["float"]=a,b.position="static";break;case"inline":b["float"]="none",b.display="inline-block",b.position="static";break;default:b["float"]="none",b.display="inline-block",b.position="static"}return b},e.prototype.setAlign=function(a){var b=this._generateAlignCss(a);this.setAligmentCssFor(this.$imageElement,b),this.aligmentCss=this.getAligmentCssFor(this.$imageElement),this.adjustEditContainer(),this.trigger(this.EVENT_CANVAS_MODIFIED)},e.prototype.getAlign=function(){var a="inline";return"absolute"==this.aligmentCss.position?a="floating":"left"==this.aligmentCss["float"]?a="left":"right"==this.aligmentCss["float"]?a="right":"block"==this.aligmentCss.display&&"auto"==this.aligmentCss["margin-left"]&&(a="center"),a},e.prototype.adjustEditContainer=function(a,b){var c=this,e=this.$canvasEditContainer.hasClass("animated");if(!this.$canvasEditContainer)return!1;var f=this.$imageElement.offset();a||this.$canvasEditContainer.removeClass("animated"),this.$canvasEditContainer.css({top:f.top,left:f.left}),a||(b?c.$canvasEditContainer.toggleClass("animated",!!e):d.setTimeout(function(){c.$canvasEditContainer&&c.$canvasEditContainer.length&&c.$canvasEditContainer.toggleClass("animated",!!e)},0))},e.prototype.destroy=function(){this.trigger(this.EVENT_DESTROY),this._stopEditing(),this.$imageElement.remove(),this.syncCanvasData(!0),this.syncImageData(!0)},e.prototype.activateDefaultPlugin=function(){if(this.options.defaultActivePlugin){var a=this.options.defaultActivePlugin.name,b=this.options.defaultActivePlugin.mode;if("always"==b||"lastUsed"==b||"onNew"==b&&0===this.fCanvas.getObjects().length){this.log("defaultActivePlugin",b+"/"+a),this.lastUsedPluginName&&"lastUsed"==b&&(a=this.lastUsedPluginName);var c=this._pluginsInstances[a];c?this.trigger(this.EVENT_DO_ACTIVATE_TOOL,[c]):this.log("WARNING","options['defaultActivePlugin']['name'] is '"+a+"', but no such plugin found.")}}},e.prototype.onCanvasModified=function(a){var b=this;return void 0===a&&this.options.contentConfig.saveAfterInactiveSec?(void 0!==this.__activityTimer&&(b.log("saveAfterInactiveSec","Cleaning previous timeout"),clearTimeout(this.__activityTimer)),b.log("saveAfterInactiveSec","Setting up a timeout"),this.__activityTimer=d.setTimeout(function(){b.log("saveAfterInactiveSec","Timeout happened, triggering onCanvasModified"),b.onCanvasModified(!0)},1e3*this.options.contentConfig.saveAfterInactiveSec),!1):(this.redactorInstance||this.beforeSync(),this.syncCanvasData(),this.syncImageData(),this.trigger(this.EVENT_CANVAS_MODIFIED),void(this.redactorInstance||this.afterSync()))},e.prototype._updateObjectsControls=function(a){var b=this.options.objectControls;if(this.touchDevice&&this.options.objectControlsTouch&&(b=this.options.objectControlsTouch),b)for(var c in b)b.hasOwnProperty(c)&&a.set(c,b[c])},e.prototype.getPluginInstance=function(a){if(this._pluginsInstances[a])return this._pluginsInstances[a];throw new Error("Plugin not exists: "+a)},e.prototype.onOptionsChange=function(){this.options.transparentBackground?(this.$imageElement.css("background","transparent"),this.$canvasEditContainer.css("background","transparent")):(this.$imageElement.css("background","white"),this.$canvasEditContainer.css("background","white"))},e.prototype.t=function(a){return this.options.texts[a]?this.options.texts[a]:a},e.prototype.showError=function(a){alert(a)},e.prototype.left=function(){return 0|this.$canvasEditContainer.css("left").replace("px","")},e.prototype.top=function(){return 0|this.$canvasEditContainer.css("top").replace("px","")},e.prototype.setTemporaryStyles=function(b){b=b||!1;var c=!!b,d=c?a.extend(!0,{},this.fCanvas._temporaryStyles||{},b||{}):!1;

for(var e in b)void 0===b[e]&&delete d[e];d?(this.fCanvas._temporaryStyles=d,this.fCanvas.copiedTextStyle={0:d},fabric.copiedTextStyle={0:d}):(this.fCanvas._temporaryStyles=d,this.fCanvas.copiedTextStyle=d,fabric.copiedTextStyle=d)},e.prototype.getRelativeEventPosition=function(a){var b={},c=d.getEventPosition(a),e=d.getScrollOffset(this.$canvasEditContainer),f=this.$canvasEditContainer.get(0),g=f.getBoundingClientRect();return b.top=c.top-g.top-e.top,b.left=c.left-g.left-e.left,b.scaledTop=b.top,b.scaledLeft=b.left,b},b.Drawer=e}(jQuery,DrawerJs,DrawerJs.plugins,DrawerJs.util,DrawerJs.texts),function(a,b,c){a.prototype.defaultOptions={captionText:"Drawer",defaultWidth:"100%",defaultHeight:"500px",enableImageCrop:!0,editOnClick:!0,exitOnOutsideClick:!0,activeColor:"#E80F07",activeOpacity:1,toolbarSize:35,toolbarSizeTouch:45,toolbars:{popupButtonAlwaysVisible:!0,drawingTools:{position:"top"},toolOptions:{position:"bottom"},settings:{position:"right"}},tooltipCss:{background:"black",color:"white"},canvasProperties:{selectionColor:"rgba(255, 255, 255, 0.3)",selectionDashArray:[3,8],selectionLineWidth:1,selectionBorderColor:"#5f5f5f"},objectControls:{borderColor:"rgba(102,153,255,0.75)",borderOpacityWhenMoving:.4,cornerColor:"rgba(102,153,255,0.5)",cornerSize:12,hasBorders:!0},objectControlsTouch:{borderColor:"rgba(102,153,255,0.75)",borderOpacityWhenMoving:.4,cornerColor:"rgba(102,153,255,0.5)",cornerSize:20,hasBorders:!0},contentConfig:{saveAfterInactiveSec:null,saveInHtml:!0,canvasDataContainer:null,imagesContainer:null,loadCanvasData:null,saveCanvasData:null,loadImageData:null,saveImageData:null},backgroundCss:"white",borderCss:"1px dashed rgb(195, 194, 194)",borderCssEditMode:"1px dashed rgb(195, 194, 194)",defaultImageUrl:"images/drawer.jpg",plugins:[],pluginsConfig:{},corePlugins:["Zoom"],texts:c,basePath:null,debug:!1}}(DrawerJs.Drawer,DrawerJs.util,DrawerJs.texts),function(a){a.prototype.EVENT_EDIT_START="editStart",a.prototype.EVENT_EDIT_STOP="editStop",a.prototype.EVENT_LOADED_FROM_JSON="loadedFromJson",a.prototype.EVENT_CANVAS_READY="ready",a.prototype.EVENT_CANVAS_START_RESIZE="canvas:resize:start",a.prototype.EVENT_BEFORE_RENDER="before:render",a.prototype.EVENT_AFTER_RENDER="after:render",a.prototype.EVENT_CANVAS_RESIZING="canvas:resize:resizing",a.prototype.EVENT_CANVAS_STOP_RESIZE="canvas:resize:stop",a.prototype.EVENT_BRUSH_SIZE_CHANGED="brushSizeChanged",a.prototype.EVENT_BRUSH_CHANGED="brushChanged",a.prototype.EVENT_DO_ACTIVATE_TOOL="activateTool",a.prototype.EVENT_DO_DEACTIVATE_TOOL="deactivateTool",a.prototype.EVENT_DO_DEACTIVATE_ALL_TOOLS="deactivateAllTools",a.prototype.EVENT_OPTIONS_CHANGED="options.changed",a.prototype.EVENT_DESTROY="destroy",a.prototype.EVENT_TOOL_ACTIVATED="toolActivated",a.prototype.EVENT_TOOL_DEACTIVATED="toolDeactivated",a.prototype.EVENT_TOOLS_TOOLBAR_CREATED="toolsToolbarCreated",a.prototype.BEFORE_CREATE_TOOLBARS="beforeCreateToolbars",a.prototype.AFTER_CREATE_TOOLBARS="afterCreateToolbars",a.prototype.EVENT_OPTIONS_TOOLBAR_CREATED="optionsToolbarCreated",a.prototype.EVENT_CONFIG_TOOLBAR_CREATED="configToolbarCreated",a.prototype.EVENT_IMAGECROP_TOOLBAR_CREATED="imageCropToolbarCreated",a.prototype.EVENT_FLOATING_TOOLBAR_CREATED="floatingToolbarCreated",a.prototype.EVENT_MINIMIZED_TOOLBAR_CREATED="minimizedToolbarCreated",a.prototype.EVENT_TOOLBAR_DESTROYED="toolbarDestroyed",a.prototype.EVENT_TOOLBAR_CHANGE_STATE="toolbarChangeState",a.prototype.EVENT_TOOLBAR_CLEAR_STATE="toolbarClearState",a.prototype.EVENT_TOOLBAR_STATE_HIDDEN_OFF="toolbarShow",a.prototype.EVENT_TOOLBAR_STATE_HIDDEN_ON="toolbarHide",a.prototype.EVENT_TOOLBAR_STATE_OVERLAY_ON="toolbarOverlayShow",a.prototype.EVENT_TOOLBAR_STATE_OVERLAY_OFF="toolbarOverlayHide",a.prototype.EVENT_TOOLBAR_STATE_DISABLED_ON="toolbarDisableOn",a.prototype.EVENT_TOOLBAR_STATE_DISABLED_OFF="toolbarDisableOff",a.prototype.EVENT_RESTORE_DEFAULT_ZOOM="restoreDefaultZoom",a.prototype.EVENT_CONTEXTMENU="contextmenu",a.prototype.EVENT_KEYDOWN="keydown",a.prototype.EVENT_BEFORE_SHAPE_ADD="beforeShapeAdd",a.prototype.EVENT_AFTER_SHAPE_ADD="afterShapeAdd",a.prototype.EVENT_ZOOM_SET="EVENT_ZOOM_SET",a.prototype.EVENT_ZOOM_UNSET="EVENT_ZOOM_UNSET",a.prototype.EVENT_ZOOM_UPPER_SET="EVENT_ZOOM_UPPER_SET",a.prototype.EVENT_ZOOM_UPPER_UNSET="EVENT_ZOOM_UPPER_UNSET",a.prototype.EVENT_ZOOM_UPPER_RESTORE="EVENT_ZOOM_UPPER_RESTORE",a.prototype.EVENT_ZOOM_RESTORE="EVENT_ZOOM_RESTORE",a.prototype.EVENT_ZOOM_CHANGE="zoomChange",a.prototype.EVENT_CANVAS_MODIFIED="canvasModified",a.prototype.EVENT_OBJECT_ADDED="objectAdded",a.prototype.EVENT_OBJECT_SELECTED="objectSelected",a.prototype.EVENT_OBJECT_MOVING="objectMoving",a.prototype.EVENT_SELECTION_CLEARED="selectionCleared",a.prototype.EVENT_TEXT_SELECTION_CHANGED="textSelectionChanged",a.prototype.EVENT_TEXT_EDITING_ENTERED="textEditingEntered",a.prototype.EVENT_TEXT_EDITING_EXITED="textEditingExited",a.prototype.EVENT_TEXT_STYLES_CHANGED="textStylesChanged",a.prototype.EVENT_TEXT_GET_STYLES="textGetStyles",a.prototype.EVENT_OVERCANVAS_POPUP_SHOW="overcanvasPopupShow",a.prototype.EVENT_OVERCANVAS_POPUP_HIDE="overcanvasPopupHide",a.prototype.EVENT_OVERCANVAS_BUTTON_SHOW="overcanvasButtonShow",a.prototype.EVENT_OVERCANVAS_BUTTON_HIDE="overcanvasButtonHide",a.prototype.EVENT_IMAGE_CROP="initImageCrop",a.prototype.EVENT_RESIZER_HIDE="resizerHide",a.prototype.EVENT_RESIZER_SHOW="resizerShow",a.prototype.EVENT_CREATE_TOOLTIP="createTooltip",a.prototype.EVENT_HIDE_TOOLTIPS="hideTooltips",a.prototype.EVENT_DESTROY_TOOLTIPS="destroyTooltips",a.prototype.off=function(a,b){return this._eventEmitter.off(a,b)},a.prototype.on=function(a,b){return this._eventEmitter.on(a,b)},a.prototype.trigger=function(a,b){var c,d=!this.insideEvent;try{this.insideEvent=!0,c=this._eventEmitter.trigger(a,b)}catch(e){if(this.options.debug){var f="Catched error - "+a;console.groupCollapsed(f),this.log("Event name",a),this.log("Arguments",b),this.error(e),console.groupEnd(f)}}return d&&(this.insideEvent=!1),c}}(DrawerJs.Drawer),function(a,b){a.prototype.getCanvasData=function(){var a=null;if(this.fCanvas)a=this.fCanvas.toJSON();else if(this.options.contentConfig.loadCanvasData)a=this.options.contentConfig.loadCanvasData(this.id);else if(this.$canvasDataContainer){var b=this.$canvasDataContainer.text();b&&(a=JSON.parse(b)[this.id])}else{var c=this.$imageElement.attr("data-canvas-serialized");c&&(a=JSON.parse(c))}return a},a.prototype.getImageData=function(){if(this.fCanvas)this.imageData=this.fCanvas.toDataURL();else if(this.options.contentConfig.loadImageData)this.imageData=this.options.contentConfig.loadImageData(this.id),'"'==this.imageData[0]&&'"'==this.imageData[this.imageData.length-1]&&(this.imageData=this.imageData.substr(1,this.imageData.length-2));else if(this.$imagesContainer){var a=this.$imagesContainer.text();if(a){var b=JSON.parse(a);this.imageData=b[this.id]}}return this.imageData},a.prototype.loadCanvas=function(a){var b=this;a?this.fCanvas.loadFromJSON(a,function(){var a=b.fCanvas.getObjects();for(var c in a)b._updateObjectsControls(a[c]);b.mode=b.MODE_ACTIVE,b.trigger(b.EVENT_LOADED_FROM_JSON),b.fCanvas.renderAll(),b.onCanvasLoaded()}):(b.mode=this.MODE_ACTIVE,b.onCanvasLoaded())},a.prototype.onCanvasLoaded=function(){var a=this;this.fCanvas.on("object:added",function(b){a._updateObjectsControls(b.target),a.trigger(a.EVENT_OBJECT_ADDED,b),a.onCanvasModified()}),this.fCanvas.on("object:moving",function(b){a.trigger(a.EVENT_OBJECT_MOVING,b)}),this.fCanvas.on("object:modified",function(){a.onCanvasModified()}),this.fCanvas.on("before:render",function(b){a.trigger(a.EVENT_BEFORE_RENDER,b)}),this.fCanvas.on("after:render",function(b){a.trigger(a.EVENT_AFTER_RENDER,b)}),this.fCanvas.on("canvas:zoom:lower:set",function(b){a.trigger(a.EVENT_ZOOM_SET,b)}),this.fCanvas.on("canvas:zoom:lower:restore",function(b){a.trigger(a.EVENT_ZOOM_RESTORE,b)}),this.fCanvas.on("canvas:zoom:upper:set",function(b){a.trigger(a.EVENT_ZOOM_UPPER_SET,b)}),this.fCanvas.on("canvas:zoom:upper:restore",function(b){a.trigger(a.EVENT_ZOOM_UPPER_RESTORE,b)}),this.fCanvas.on("pencil:move:before",function(b){a.trigger(a.EVENT_ZOOM_UPPER_SET,b)}),this.fCanvas.on("pencil:move:after",function(b){a.trigger(a.EVENT_ZOOM_UPPER_RESTORE,b)}),this.fCanvas.on("object:removed",function(){a.onCanvasModified()}),this.fCanvas.on("object:selected",function(b){a.trigger(a.EVENT_OBJECT_SELECTED,b)}),this.fCanvas.on("selection:cleared",function(b){a.trigger(a.EVENT_SELECTION_CLEARED,b)}),this.fCanvas.on("text:selection:changed",function(b){a.trigger(a.EVENT_TEXT_SELECTION_CHANGED,b)}),this.fCanvas.on("text:editing:entered",function(b){a.trigger(a.EVENT_TEXT_EDITING_ENTERED,b)}),this.fCanvas.on("text:editing:exited",function(b){a.trigger(a.EVENT_TEXT_EDITING_EXITED,b)}),this.setColor(),this.toolbars.createAllToolbars(),$(this.fCanvas.upperCanvasEl).attr("data-id",1),this.setSize(this.width,this.height),this.$canvasEditContainer.on("contextmenu",function(b){return a.trigger(a.EVENT_CONTEXTMENU,[b]),!1}),b.bindLongPress(this.$canvasEditContainer,"canvasEdit",function(b){a.trigger(a.EVENT_CONTEXTMENU,[b])}),this.trigger(this.EVENT_EDIT_START),this.$canvasEditContainer.on("keydown",".canvas-container",function(b){a.trigger(a.EVENT_KEYDOWN,b);var c=8==b.which,d=46==b.which,e=c||d,f=e;if(f){a.fCanvas.renderOnAddRemove=!1;var g=a.fCanvas.getActiveObject();g&&(g.remove(),b.preventDefault(),b.stopPropagation());var h=a.fCanvas.getActiveGroup();return h&&(h.getObjects().map(function(a){a.remove()}),a.fCanvas.discardActiveGroup(),b.preventDefault(),b.stopPropagation()),a.fCanvas.renderAll(),a.fCanvas.renderOnAddRemove=!0,!1}}),this.trigger(this.EVENT_CANVAS_READY)},a.prototype.getSerializedCanvas=function(){var a=this.fCanvas.toJSON(),b=JSON.stringify(a,null,2);return b},a.prototype.beforeSync=function(){this.options.contentConfig&&!this.options.contentConfig.saveInHtml&&this.$imageElement.attr("src",""),this.fCanvas&&(this.beforeSyncActiveObject=this.fCanvas.getActiveObject(),this.beforeSyncActiveGroup=this.fCanvas.getActiveGroup(),this.fCanvas.deactivateAll())},a.prototype.afterSync=function(){this.beforeSyncActiveObject&&(this.fCanvas.setActiveObject(this.beforeSyncActiveObject),delete this.beforeSyncActiveObject),this.beforeSyncActiveGroup&&(this.fCanvas.setActiveGroup(this.beforeSyncActiveGroup),delete this.beforeSyncActiveGroup),this.options.contentConfig&&!this.options.contentConfig.saveInHtml&&this.$imageElement.attr("src",this.getImageData())},a.prototype.syncCanvasData=function(a){var b=this;if(b.fCanvas){var c=this.getSerializedCanvas();if(b.$canvasDataContainer){var d=b.$canvasDataContainer.text(),e={};d.length>0&&(e=JSON.parse(d)),a?delete e[b.id]:b.fCanvas&&(e[b.id]=c),b.$canvasDataContainer.text(JSON.stringify(e,null,2)),b.log("sync","sync with data container done.")}this.options.contentConfig.saveCanvasData&&this.options.contentConfig.saveCanvasData(this.id,c),this.options.contentConfig.saveInHtml&&this.$imageElement.attr("data-canvas-serialized",c)}},a.prototype.syncImageData=function(a){var b=this,c=b.getImageData();if(b.$imagesContainer){var d=b.$imagesContainer.text(),e={};d.length>0&&(e=JSON.parse(d)),a?delete e[b.id]:e[b.id]=c,b.$imagesContainer.text(JSON.stringify(e,null,2)),b.log("sync","sync with images container done.")}b.options.contentConfig.saveImageData&&b.options.contentConfig.saveImageData(this.id,c)}}(DrawerJs.Drawer,DrawerJs.util),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.ErasableMixin=function(a){this.eraserPaths=[],a&&(this.eraserPaths=this._createEraserPaths(a.eraserPaths))},b.ErasableMixin.prototype.initialize=function(a){this.eraserPaths=[],a&&(this.eraserPaths=b.ErasableMixin.prototype._createEraserPaths.call(this,a.eraserPaths))},b.ErasableMixin.prototype._createEraserPaths=function(a){var c=[];return a&&a.map(function(a){b.EraserPath.fromObject(a,function(a){c.push(a)})}),c},b.ErasableMixin.prototype.render=function(a,b){var c=DrawerJs.util.getTemporaryCanvas(this.canvas),d=c.getContext("2d"),e=this.canvas.width,f=this.canvas.height;d.clearRect(0,0,e,f),b(d);for(var g=0;g<this.eraserPaths.length;g++)this.eraserPaths[g].globalCompositeOperation="destination-out",this.eraserPaths[g].render(d);a.drawImage(c,0,0)},b.ErasableMixin.prototype.addEraserPath=function(a,c){var d=this;a.clone(function(a){a.set("stroke","blue"),a.selectable=!1,a.evented=!1;var e=d.getCenterPoint(),f=a.getCenterPoint();a.polygonOffsetX=f.x-e.x,a.polygonOffsetY=f.y-e.y;var g=d.angle;a.set({angle:g});for(var h=0;h<a.path.length;h++)b.ErasableMixin.prototype._rotatePathPoints(a.path[h],e,-g);b.ErasableMixin.prototype._updatePathPosition.call(d,a),d.eraserPaths.push(a),c&&c(this)})},b.ErasableMixin.prototype._updateEPathsOnSet=function(a,c){if(this.eraserPaths)for(var d=(this.getCenterPoint(),0);d<this.eraserPaths.length;d++){var e=this.eraserPaths[d];if(e instanceof b.EraserPath){var f,g=e.scaleX,h=e.scaleY;"scaleX"==a&&(f=c/this.scaleX,g*=f,e.set("scaleX",g)),"scaleY"==a&&(f=c/this.scaleY,h*=f,e.set("scaleY",h)),"angle"==a&&e.set("angle",this.angle),b.ErasableMixin.prototype._updatePathPosition.call(this,e)}}},b.ErasableMixin.prototype._updatePathPosition=function(a){var c=this.getCenterPoint(),d=a.scaleX,e=a.scaleY,f=c.x+a.polygonOffsetX*d,g=c.y+a.polygonOffsetY*e,h=b.util.rotatePoint(new b.Point(f,g),c,b.util.degreesToRadians(a.angle));a.set("left",h.x),a.set("top",h.y)},b.ErasableMixin.prototype._rotatePathPoints=function(a,c,d){for(var e,f,g=b.util.degreesToRadians(d),h=a.length,i=0;h>i;i++)"number"==typeof a[i]&&(e=new b.Point(a[i],a[i+1]),f=b.util.rotatePoint(e,c,g),a[i]=f.x,a[i+1]=f.y,i++);return a},b.ErasableMixin.prototype.toObject=function(){var a={eraserPaths:this.eraserPaths.map(function(a){return a.toObject()})};return a},b.ErasableMixin.prototype.fromObject=function(a){return this.eraserPaths=b.ErasableMixin.prototype._createEraserPaths(a.eraserPaths),this},b.makeObjectErasable=function(a){var d=new b.ErasableMixin;a.prototype.isErasable=!0;var e=a.prototype.initialize;a.prototype.initialize=function(){e.apply(this,arguments),d.initialize.apply(this,arguments)},a.prototype.addEraserPath=function(a){d.addEraserPath.call(this,a)};var f=a.prototype.render;a.prototype.render=function(a){d.render.call(this,a,f.bind(this))};var g=a.prototype._set;a.prototype._set=function(a,b){d._updateEPathsOnSet.call(this,a,b),g.call(this,a,b)};var h=a.fromObject;a.fromObject=function(a,b){if(!this.async){var c=h.call(this,a),e=d.fromObject.call(c,a);return e}h.call(this,a,function(c){var e=d.fromObject.call(c,a);b&&b(e)})};var i=a.prototype.toObject;a.prototype.toObject=function(){var a=i.call(this);return c(a,d.toObject.call(this)),a}}}("undefined"!=typeof exports?exports:this),function(a){"use strict";{var b=a.fabric||(a.fabric={});b.util.object.extend}b.ErasableObject=b.util.createClass(b.Object,{type:"erasableObject",initialize:function(a){a=a||{},this.callSuper("initialize",a)}}),b.ErasableObject.fromObject=function(a){return new b.ErasableObject(a)},b.makeObjectErasable(b.ErasableObject)}("undefined"!=typeof exports?exports:this),function(a){"use strict";{var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.array.min,e=b.util.array.max;b.util.toFixed}b.SegmentablePolygon=b.util.createClass(b.ErasableObject,{type:"segmentablePolygon",points:null,minX:0,minY:0,objectOptionsList:["color","border","opacity"],initialize:function(a,b){this.points=a,void 0===a&&console.error("Points should be array."),b=b||{},this.callSuper("initialize",b),this._calcDimensions(),"top"in b||(this.top=this.minY),"left"in b||(this.left=this.minX)},_calcDimensions:function(){for(var a=null,b=null,c=null,f=null,g=0;g<this.points.length;g++){var h=d(this.points[g],"x");(null===a||a>h)&&(a=h);var i=d(this.points[g],"y");(null===b||b>i)&&(b=i);var j=e(this.points[g],"x");(null===c||j>c)&&(c=j);var k=e(this.points[g],"y");(null===f||k>f)&&(f=k)}this.width=c-a||1,this.height=f-b||1,this.minX=a,this.minY=b},_fixPoints:function(){this._calcDimensions(),(this.minX!=this.width/2*-1||this.minY!=this.height/2*-1)&&this.points.forEach(function(a){a.forEach(function(a){a.x-=this.minX+this.width/2,a.y-=this.minY+this.height/2},this)},this)},_applyPointOffset:function(){this.points.forEach(function(a){a.forEach(function(a){a.x-=this.minX+this.width/2,a.y-=this.minY+this.height/2},this)},this)},toObject:function(a){return c(this.callSuper("toObject",a),{points:this.points.concat(),type:this.type})},render:function(a,b){2==this.points[0].length&&(this.oldStroke=this.stroke,this.oldStrokeDashArray=this.strokeDashArray,this.oldStrokeWidth=this.strokeWidth,this.stroke=this.fill,this.strokeWidth=3,this.strokeDashArray=[]),this.callSuper("render",a,b),2==this.points[0].length&&(this.stroke=this.oldStroke,this.strokeDashArray=this.oldStrokeDashArray,this.strokeWidth=this.oldStrokeWidth)},_render:function(a){this.commonRender(a),this._renderFill(a),(this.stroke||this.strokeDashArray)&&(a.closePath(),this._renderStroke(a))},commonRender:function(a){var b;a.beginPath(),this._applyPointOffset&&(this.group&&"path-group"===this.group.type||this._applyPointOffset(),this._applyPointOffset=null);var c=this.points[0];if(1==c.length){var d=2;a.arc(c[0].x,c[0].y,d,0,2*Math.PI,!1)}a.moveTo(c[0].x,c[0].y);for(var e=0,f=c.length;f>e;e++)b=c[e],a.lineTo(b.x,b.y);if(a.closePath(),this.points.length>1)for(var g=1;g<this.points.length;g++){var h=this.points[g];a.moveTo(h[0].x,h[0].y);for(var i=0;i<h.length;i++)a.lineTo(h[i].x,h[i].y)}},complexity:function(){for(var a=0,b=0;b<this.points.length;b++)a+=this.points[b].length;return a}}),b.SegmentablePolygon.fromObject=function(a){return new b.SegmentablePolygon(a.points,a,!0)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.PText=b.util.createClass(b.IText,{type:"PText",_defaultOptions:{editIconMode:!0},objectOptionsList:["color","border","opacity","TextLineHeight","TextAlign"],initialize:function(a,b){this.callSuper("initialize",a,b),this.options=$.extend(!0,this._defaultOptions||{},b||{});var c=DrawerJs.util.getDrawerFolderUrl()+"assets/pencil-square-o.32.png";this.options.editIconMode&&(this.startEditControl=new ObjectFloatingControl(this,c,this._iconClickHandler.bind(this),this.options))},onInput:function(a){if(this.isEditing&&!this.inCompositionMode){var b,c,d,e=this.selectionStart||0,f=this.selectionEnd||0,g=this.text.length,h=this.hiddenTextarea.value.length;h>g?(d="left"===this._selectionDirection?f:e,b=h-g,c=this.hiddenTextarea.value.slice(d,d+b)):(b=h-g+f-e,c=this.hiddenTextarea.value.slice(e,e+b));var i=this.selectionStart===this.selectionEnd,j=i&&this.canvas.copiedTextStyle;this.insertChars(c,j),a.stopPropagation()}},renderCursorOrSelection:function(a){this.canvas.fire("canvas:zoom:upper:set"),this.callSuper("renderCursorOrSelection",a),this.canvas.fire("canvas:zoom:upper:restore")},initMouseupHandler:function(){this.on("mouseup",function(a){this.options.editIconMode?this.onMouseUpHandler(a):this.onMouseUpSuperHandler(a)})},onMouseUpHandler:function(a){this.__isMousedown=!1,!this.editable||this._isObjectMoved&&this._isObjectMoved(a.e)||(this.selected=!0)},onMouseUpSuperHandler:function(a){this.__isMousedown=!1,!this.editable||this._isObjectMoved&&this._isObjectMoved(a.e)||(this.__lastSelected&&!this.__corner&&(this.enterEditing(a.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()),this.selected=!0)},_iconClickHandler:function(a){this.canvas.setActiveObject(this),this.enterEditing(a.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()},getObjStyles:function(a){a=a||this;var b={fontSize:a.fontSize,fill:a.fill,textBackgroundColor:a.textBackgroundColor,textDecoration:a.textDecoration,fontFamily:a.fontFamily,fontWeight:a.fontWeight,fontStyle:a.fontStyle,lineHeight:a.lineHeight,stroke:a.stroke,strokeWidth:a.strokeWidth};return b},render:function(a){this.callSuper("render",a)},toObject:function(a){return c(this.callSuper("toObject",a))}}),b.PText.fromObject=function(a){return new b.PText(a.text,a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";{var b=a.fabric||(a.fabric={});b.util.object.extend}b.ErasableText=b.util.createClass(b.PText,{type:"ErasableText",isErasable:!0,initialize:function(a,b){this.callSuper("initialize",a,b)}}),b.ErasableText.fromObject=function(a){return new b.ErasableText(a.text,a)},b.makeObjectErasable(b.ErasableText)}("undefined"!=typeof exports?exports:this),function(a){"use strict";{var b=a.fabric||(a.fabric={});b.util.object.extend}b.Arrow=b.util.createClass(b.Line,{type:"arrow",objectCaching:!1,objectOptionsList:["border","opacity","lineWidth","strokeWidth"],initialize:function(a,b){this.callSuper("initialize",a,b),b&&this.set("oneSided",b.oneSided)},_render:function(a,b){this.width<20&&this.height<20||this.scaleX<.3&&this.scaleY<.3?this.set("padding",20):this.set("padding",10),this.canvas.calcOffset(),this.callSuper("_render",a,b);var c=this.callSuper("calcLinePoints"),d=this._calcArrowAngle(c.x1,c.y1,c.x2,c.y2);this.oneSided||this._drawArrow(a,{x:c.x1,y:c.y1},d+90),this._drawArrow(a,{x:c.x2,y:c.y2},d-90)},_drawArrow:function(a,b,c){var d=.5;this.get("strokeWidth")>1&&(d*=this.get("strokeWidth")/2);var e=10,f=20,g={x:b.x,y:b.y+e*d},h={x:b.x-e*d,y:b.y-f*d},i={x:b.x,y:b.y-e*d},j={x:b.x+e*d,y:b.y-f*d};a.save(),a.translate(b.x,b.y),a.rotate(c*Math.PI/180),a.translate(-1*b.x,-1*b.y),a.beginPath(),a.moveTo(g.x,g.y),a.lineTo(h.x,h.y),a.lineTo(i.x,i.y),a.lineTo(j.x,j.y),a.fillStyle=this.stroke,a.fill(),a.restore()},_calcArrowAngle:function(a,b,c,d){var e,f,g=0;return e=c-a,f=d-b,g=0===e?0===f?0:f>0?Math.PI/2:3*Math.PI/2:0===f?e>0?0:Math.PI:0>e?Math.atan(f/e)+Math.PI:0>f?Math.atan(f/e)+2*Math.PI:Math.atan(f/e),180*g/Math.PI},toObject:function(a){return a||(a=[]),a.push("oneSided","padding"),b.util.object.extend(this.callSuper("toObject",a),this.calcLinePoints())}}),b.Arrow.fromObject=function(a){var c=[a.x1,a.y1,a.x2,a.y2];return new b.Arrow(c,a)}}("undefined"!=typeof exports?exports:this),this.DrawerJs||(this.DrawerJs={}),this.DrawerJs.clipping={},function(a){"use strict";a.runClippingOperation=function(a){var g=a.firstShape,h=a.secondShape,i=e(g.width,g.currentWidth,g.height,g.currentHeight,g.center,g.angleInRadians,g.points),j=c(h.center,h.points),k=b(a.cmd,i,d(j));if(h.centersQueue)for(var l=0;l<h.centersQueue.length;l++)j=c(h.centersQueue[l],h.points),k=b(a.cmd,k,d(j));k=ClipperLib.JS.Lighten(k,.1);var m=null;return k.length>0&&(m=f(g.currentWidth,g.width,g.currentHeight,g.height,g.center,-1*g.angleInRadians,k)),m};var b=function(a,b,c){var d=new ClipperLib.Paths,e=new ClipperLib.Clipper;return e.AddPaths(b,ClipperLib.PolyType.ptSubject,!0),e.AddPaths(c,ClipperLib.PolyType.ptClip,!0),e.Execute(a,d),d},c=function(a,b){for(var c=[],d=0;d<b.length;d++){for(var e=[],f=0;f<b[d].length;f++)e.push({x:a.x+b[d][f].x,y:a.y+b[d][f].y});c.push(e)}return c},d=function(a){for(var b=[],c=0;c<a.length;c++){for(var d=[],e=0;e<a[c].length;e++)d.push({X:a[c][e].x,Y:a[c][e].y});b.push(d)}return b},e=function(a,b,c,d,e,f,g){for(var h=[],i=Math.sin(f),j=Math.cos(f),k=0;k<g.length;k++){for(var l=[],m=0;m<g[k].length;m++){var n=g[k][m].x,o=g[k][m].y,p=100*n/a,q=p*b/100,r=100*o/c,s=r*d/100;q=e.x+q,s=e.y+s,q-=e.x,s-=e.y;var t=q*j-s*i,u=q*i+s*j;q=t+=e.x,s=u+=e.y,l.push({X:q,Y:s})}h.push(l)}return h},f=function(a,b,c,d,e,f,g){for(var h=[],i=Math.sin(f),j=Math.cos(f),k=0;k<g.length;k++){for(var l=[],m=0;m<g[k].length;m++){var n=g[k][m].X,o=g[k][m].Y;n-=e.x,o-=e.y;var p=n*j-o*i,q=n*i+o*j;n=p+=e.x,o=q+=e.y,n-=e.x,o-=e.y;var r=100*n/a;n=r*b/100;var s=100*o/c;o=s*d/100,l.push({x:n,y:o})}h.push(l)}return h}}(DrawerJs.clipping),function(a){"use strict";var b=a.fabric||(a.fabric={});b.ErasableArrow=b.util.createClass(b.Arrow,{type:"ErasableArrow",originX:"center",originY:"center",initialize:function(a,b){b=b||{},this.callSuper("initialize",a,b)},toObject:function(a){return this.callSuper("toObject",a)},_render:function(a){this.callSuper("_render",a)}}),b.ErasableArrow.fromObject=function(a){var c=[a.x1,a.y1,a.x2,a.y2];return new b.ErasableArrow(c,a)},b.makeObjectErasable(b.ErasableArrow)}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.ErasableImage=b.util.createClass(b.Image,{type:"ErasableImage",async:!0,objectOptionsList:["opacity","border"],initialize:function(a,b){b=b||{},this.width=b.width||10,this.height=b.height||10,this.callSuper("initialize",a,b)},_render:function(a){this.callSuper("_render",a)},_set:function(a,b){this.callSuper("_set",a,b)},toObject:function(a){return c(this.callSuper("toObject",a),{width:this.width,height:this.height})}}),b.ErasableImage.fromObject=function(a,c){b.util.loadImage(a.src,function(d){var e=new b.ErasableImage(d,a);c&&c(e)})},b.ErasableImage.async=!0,b.makeObjectErasable(b.ErasableImage)}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={});b.ErasableLine=b.util.createClass(b.Line,{type:"ErasableLine",originX:"center",originY:"center",objectOptionsList:["border","opacity","lineWidth","strokeWidth"],initialize:function(a,b){b=b||{},this.callSuper("initialize",a,b)},toObject:function(a){return this.callSuper("toObject",a)},_render:function(a){this.callSuper("_render",a)}}),b.ErasableLine.fromObject=function(a){var c=[a.x1,a.y1,a.x2,a.y2];return new b.ErasableLine(c,a)},b.makeObjectErasable(b.ErasableLine)}("undefined"!=typeof exports?exports:this),function(a){"use strict";{var b=a.fabric||(a.fabric={});b.util.object.extend}b.ErasablePath=b.util.createClass(b.Path,{type:"ErasablePath",objectCaching:!1,evented:!1,selectable:!1,initialize:function(a,b){b=b||{},this.callSuper("initialize",a,b)},_render:function(a){this.callSuper("_render",a)},toObject:function(a){return this.callSuper("toObject",a)}}),b.ErasablePath.fromObject=function(a){return new b.ErasablePath(a.path,a)},b.ErasablePath.async=!1,b.makeObjectErasable(b.ErasablePath)}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={});b.ErasablePencilBrush=b.util.createClass(b.PencilBrush,{type:"ErasablePencilBrush",objectOptionsList:["color","opacity","brush"],onMouseMove:function(a){this._captureDrawingPath(a),this.canvas.clearContext(this.canvas.contextTop),this._render(),this.canvas.renderAll()},_render:function(){this.canvas.fire("pencil:move:before"),this.callSuper("_render"),this.canvas.fire("pencil:move:after")},initialize:function(a,b){b=b||{},this.options=b,this.callSuper("initialize",a)},createPath:function(a){var c=new b.ErasablePath(a,{fill:null,stroke:this.color,opacity:this.opacity,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,c.setShadow(this.shadow)),c}})}("undefined"!=typeof exports?exports:this),function(a,b){"use strict";var c=a.fabric||(a.fabric={}),d=(c.util.object.extend,function(a,d,e,f){if(!(a&&a instanceof c.Object))throw new Error("[ObjectFloatingControl()]  invalid param : obj");if(this.obj=a,!d||!b.isString(d))throw new Error("[ObjectFloatingControl()]  invalid param : iconPath");if(this.iconPath=d,!(e&&e instanceof Function))throw new Error("[ObjectFloatingControl()]  invalid param : callback");this.callback=e,this.options=$.extend(!0,{},this._defaultOptions||{},f||{}),this.enabled=this.options.enabled,c.Image.fromURL(d,this._onIconReady.bind(this)),this.obj.on("added",this._onAdded.bind(this)),this.obj.on("removed",this._onRemoved.bind(this))});d.prototype.SMALL_ICON="small",d.prototype.MEDIUM_ICON="medium",d.prototype.LARGE_ICON="large",d.prototype.LEFT_TOP="left-top",d.prototype.LEFT_BOTTOM="left-bottom",d.prototype.RIGHT_TOP="right-top",d.prototype.RIGHT_BOTTOM="right-bottom",d.prototype._defaultOptions={defaulIconSize:32,symbolicIconSizes:{small:16,medium:32,large:48},enabled:!0},d.prototype.remove=function(){this._onRemoved()},d.prototype.enable=function(){this.enabled=!0},d.prototype.disable=function(){this.enabled=!1},d.prototype._onAdded=function(){this.canvas=this.obj.canvas,this._iconClickHandlerBinded=this._iconClickHandler.bind(this),this.canvas.on("mouse:up",this._iconClickHandlerBinded),this.canvas.on("touchend",this._iconClickHandlerBinded),this._bindedAfterRender=this._onAfterRender.bind(this),this.canvas.on("after:render",this._bindedAfterRender)},d.prototype._onRemoved=function(){this.canvas.off("mouse:up",this._iconClickHandlerBinded),this.canvas.off("touchend",this._iconClickHandlerBinded),this.canvas.off("after:render",this._bindedAfterRender)},d.prototype._onIconReady=function(a){var b=this.options.iconSize||this.options.defaulIconSize,c=this.options.editIconSize,d="string"==typeof c&&this.options.symbolicIconSizes[c],e=d||c||this.options.defaulIconSize,f=e/b;this.icon=a,this.iconSize=b,this.iconScale=f,this.icon.offsetFromLeft=.66*this.options.defaulIconSize,this.icon.offsetFromTop=.66*-this.iconSize,this.icon.set({scaleX:f,scaleY:f,originX:"center",originY:"center",opacity:1})},d.prototype._iconClickHandler=function(a){if(this.enabled&&this.canvas&&this.icon){var b,c,d=this.canvas.getPointer(a.e);if(d)b=d.x,c=d.y;else if(void 0===a.e.offsetX){var e=drawer.left(),f=drawer.top();b=a.e.pageX-e,c=a.e.pageY-f,console.log("x : ",a.e.pageX,"-",e,"=",b),console.log("y : ",a.e.pageY,"-",f,"=",c)}else b=a.e.offsetX,c=a.e.offsetY;this._coordInsideIcon(b,c)&&this.callback(a,this)}},d.prototype._coordInsideIcon=function(a,b){var c=this.icon.width*this.icon.scaleX/2,d=this._calcIconCoords(),e=a>d.x-c&&a<d.x+c,f=b>d.y-c&&b<d.y+c,g=e&&f;return g},d.prototype._onAfterRender=function(){this.canvas.fire("canvas:zoom:lower:set"),this._drawIcon(),this.canvas.fire("canvas:zoom:lower:restore")},d.prototype._drawIcon=function(){if(this.enabled&&this.icon&&this.obj.active){var a=this._calcIconCoords();this.icon.left=a.x,this.icon.top=a.y,this.icon.render(this.canvas.getContext())}},d.prototype._calcIconCoords=function(){var a=this.obj.getPointByOrigin("left","top"),b=this.icon.offsetFromLeft*this.obj.scaleX,d=this.icon.offsetFromTop,e=c.util.degreesToRadians(this.obj.angle),f=b*Math.cos(e)-d*Math.sin(e),g=b*Math.sin(e)+d*Math.cos(e);return{x:a.x+f,y:a.y+g}},a.ObjectFloatingControl=d}("undefined"!=typeof exports?exports:this,DrawerJs.util),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.array.min,e=b.util.array.max,f=b.util.toFixed;b.SegmentableLine=b.util.createClass(b.Object,{type:"SegmentableLine",objectOptionsList:["border","opacity","lineWidth","strokeWidth"],points:null,minX:0,minY:0,initialize:function(a,b){b=b||{},this.points=a,this.callSuper("initialize",b),this._calcDimensions(),"top"in b||(this.top=this.minY),"left"in b||(this.left=this.minX)},_calcDimensions:function(){for(var a=(this.points,null),b=null,c=null,f=null,g=0;g<this.points.length;g++){var h=d(this.points[g],"x");(null===a||a>h)&&(a=h);var i=d(this.points[g],"y");(null===b||b>i)&&(b=i);var j=e(this.points[g],"x");(null===c||j>c)&&(c=j);var k=e(this.points[g],"y");(null===f||k>f)&&(f=k)}this.width=c-a||1,this.height=f-b||1,this.minX=a,this.minY=b},_applyPointOffset:function(){this.points.forEach(function(a){a.forEach(function(a){a.x-=this.minX+this.width/2,a.y-=this.minY+this.height/2},this)},this)},toObject:function(a){return c(this.callSuper("toObject",a),{points:this.points.concat(),type:this.type})},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),d=0,e=this.points.length;e>d;d++)b.push(f(this.points[d].x,2),",",f(this.points[d].y,2)," ");return c.push("<",this.type," ",'points="',b.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n'),a?a(c.join("")):c.join("")},_render:function(a){this.commonRender(a),this._renderFill(a),(this.stroke||this.strokeDashArray)&&this._renderStroke(a)},commonRender:function(a){
var b;a.beginPath(),this._applyPointOffset&&(this.group&&"path-group"===this.group.type||this._applyPointOffset(),this._applyPointOffset=null);var c=this.points[0];a.moveTo(c[0].x,c[0].y);for(var d=0,e=c.length;e>d;d++)b=c[d],a.lineTo(b.x,b.y);if(this.points.length>1)for(var f=1;f<this.points.length;f++){var g=this.points[f];a.moveTo(g[0].x,g[0].y);for(var h=0;h<g.length;h++)a.lineTo(g[h].x,g[h].y)}},complexity:function(){return this.points.length}}),b.SegmentableLine.fromObject=function(a){return new b.SegmentableLine(a.points,a,!0)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";{var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.util.array.min,b.util.array.max,b.util.toFixed}b.PCircle=b.util.createClass(b.SegmentablePolygon,{radius:0,type:"PCircle",initialize:function(a){a=a||{},this.radius=a.radius||0;var b=this.makeCircle(this.radius);this.width=2*this.radius,this.height=2*this.radius,this.callSuper("initialize",b,a)},makeCircle:function(a){for(var b=[],c=0,d=0,e=0;360>e;e++){var f=e*Math.PI/180,g=c+a*Math.cos(f),h=d+a*Math.sin(f);b.push({x:g,y:h})}return[b]},_render:function(a){this.callSuper("_render",a)},_set:function(a,b){"radius"===a&&(this.points=this.makeCircle(b),this.width=2*b,this.height=2*b,this.callSuper("_set","points",this.points)),this.callSuper("_set",a,b)},isPointInside:function(a,b){var c=this.getCenterPoint();return Math.sqrt((a-c.x)*(a-c.x)+(b-c.y)*(b-c.y))<this.radius},getPerimeterPoints:function(a,b,c){var d,e=0,f=360,g="number"==typeof a&&"number"==typeof b,h=g&&!c;return h&&(a||b)&&(f=0!==a&&0!==b?90:180,0>b?(e=180,a>0&&(e=270)):0>a&&(e=90)),d=this.getSectorPoints(e,f)},getSectorPoints:function(a,c){var d=[],e=15,f=Math.round(Math.random()*e/2),g=a+c+e-f,h=a-f;for(h;g>=h;h+=e){var i={},j=b.util.degreesToRadians(h%360),k=this.radius*Math.cos(j),l=this.radius*Math.sin(j);i.x=this.left+Math.round(k),i.y=this.top+Math.round(l),d.push(i)}return d},toObject:function(a){return c(this.callSuper("toObject",a),{radius:this.radius})}}),b.PCircle.fromObject=function(a){return new b.PCircle(a,!0)},b.PCircle.async=!1}("undefined"!=typeof exports?exports:this),function(a){"use strict";{var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.util.array.min,b.util.array.max,b.util.toFixed}b.PRect=b.util.createClass(b.SegmentablePolygon,{type:"PRect",initialize:function(a){a=a||{},this.width=a.width||10,this.height=a.height||10;var b=this.makeRect(this.width,this.height);this.callSuper("initialize",b,a)},makeRect:function(a,b){var c=a/2,d=b/2,e=[{x:-1*c,y:-1*d},{x:c,y:-1*d},{x:c,y:d},{x:-1*c,y:d}];return[e]},_render:function(a){this.callSuper("_render",a)},_set:function(a,b){var c=!1;"width"===a&&(this.width=b,c=!0),"height"===a&&(this.height=b,c=!0),c&&(this.points=this.makeRect(this.width,this.height),this.callSuper("_set","points",this.points)),this.callSuper("_set",a,b)},toObject:function(a){return c(this.callSuper("toObject",a),{width:this.width,height:this.height})}}),b.PRect.fromObject=function(a){return new b.PRect(a,!0)},b.PRect.async=!1}("undefined"!=typeof exports?exports:this),function(a){"use strict";{var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.util.array.min,b.util.array.max,b.util.toFixed}b.PTriangle=b.util.createClass(b.SegmentablePolygon,{type:"PTriangle",initialize:function(a){a=a||{},this.width=a.width||10,this.height=a.height||10;var b=this.makeTriangle(this.width,this.height);this.callSuper("initialize",b,a)},makeTriangle:function(a,b){var c=a/2,d=b/2,e=[{x:-1*c,y:d},{x:0,y:-1*d},{x:c,y:d}];return[e]},_render:function(a){this.callSuper("_render",a)},_set:function(a,b){var c=!1;"width"===a&&(this.width=b,c=!0),"height"===a&&(this.height=b,c=!0),c&&(this.points=this.makeTriangle(this.width,this.height),this.callSuper("_set","points",this.points)),this.callSuper("_set",a,b)},toObject:function(a){return c(this.callSuper("toObject",a),{width:this.width,height:this.height})}}),b.PTriangle.fromObject=function(a){return new b.PTriangle(a,!0)},b.PTriangle.async=!1}("undefined"!=typeof exports?exports:this);var emptyFunc=function(){},DrawerToolbar=function(a,b){if(!a)throw new Error("DrawerToolbar c-tor : drawerInstance is not set!");this.drawerInstance=a,this.buttonsGroups={},this._setupOptions(b),this._setupElement(),this._attachEventHandlers(),this._attachDrawerEventHandlers(),this._initCompactType()};DrawerToolbar.prototype.MULTILINE="multiline",DrawerToolbar.prototype.SCROLLABLE="scrollable",DrawerToolbar.prototype.POPUP="popup",DrawerToolbar.prototype.POSITION_TYPE_OUTSIDE="outside",DrawerToolbar.prototype.POSITION_TYPE_INSIDE="inside",DrawerToolbar.prototype.position="top",DrawerToolbar.prototype.buttonsGroups={},DrawerToolbar.prototype.buttons=[],DrawerToolbar.prototype._defaultOptions={compactType:DrawerToolbar.prototype.MULTILINE,positionType:DrawerToolbar.prototype.POSITION_TYPE_OUTSIDE,buttonWidth:32,buttonHeight:35},DrawerToolbar.prototype._defaultButtonConfig={additionalClass:"",iconClass:"",tooltipText:"",buttonOrder:10,isSubMenu:!1,group:{name:"",tooltip:""},clickHandler:emptyFunc},DrawerToolbar.prototype._setupOptions=function(a){this.options=$.extend(!0,{},this._defaultOptions||{},a||{})},DrawerToolbar.prototype._setupElement=function(){var a=this._generateTemplate(),b=$(a);this.$toolbar=b,this.$toolbarContentHolder=this.$toolbar.find(".toolbar-content-wrapper")},DrawerToolbar.prototype._generateTemplate=function(){var a,b="editable-canvas-toolbar "+(this.options.toolbarClass||"")+(this.options.hidden?" hidden ":"");return a='<ul class="'+b+'" contenteditable="false"><ul class="toolbar-content-wrapper"></ul></ul>'},DrawerToolbar.prototype._attachEventHandlers=function(){},DrawerToolbar.prototype._attachDrawerEventHandlers=function(){var a=this;this.drawerInstance.on(this.drawerInstance.EVENT_DO_ACTIVATE_TOOL,function(){a.hideActiveSubmenu()})},DrawerToolbar.prototype._initCompactType=function(){switch(!0){case this.options.compactType===DrawerToolbar.prototype.SCROLLABLE:this._initCompactType_scrollable();break;case this.options.compactType===DrawerToolbar.prototype.MULTILINE:this._initCompactType_multiline();break;case this.options.compactType===DrawerToolbar.prototype.POPUP:this._initCompactType_popup();break;default:this._initCompactType_multiline()}},DrawerToolbar.prototype._initCompactType_scrollable=function(){this.isScrollable=!0,this.scrollModeActive=!1,this.currentScrollOffset=0,this.$toolbar.addClass("toolbar-scrollable"),this._addScrollButtons(),this.drawerInstance.on(this.drawerInstance.EVENT_CANVAS_START_RESIZE,this._onCanvasResizeStart.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_CANVAS_RESIZING,this._onCanvasResizing.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_CANVAS_STOP_RESIZE,this._onCanvasResizeFinish.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_EDIT_START,this.checkScroll.bind(this)),this.$toolbar.on("mousedown.toolbar touchstart.toolbar",this.onTouchStart.bind(this))},DrawerToolbar.prototype._initCompactType_multiline=function(){this.$toolbar.addClass("toolbar-multiline")},DrawerToolbar.prototype._initCompactType_popup=function(){this._initCompactType_multiline()},DrawerToolbar.prototype.remove=function(){this.$toolbar.remove(),this.buttonsGroups={},this.drawerInstance.trigger(this.drawerInstance.EVENT_TOOLBAR_DESTROYED,[this])},DrawerToolbar.prototype.addControl=function(a,b){b=void 0!==b?b:this._defaultButtonConfig.buttonOrder;var c=this._getOrderString(b),d=a.attr("style");a.attr("style",(d||"")+";"+c),this.$toolbarContentHolder.append(a)},DrawerToolbar.prototype.addButton=function(a){a=this._validateButtonConfig(a);var b=this.createButton(a);return this.buttons.push(b),this.$toolbarContentHolder.append(b),this.checkScroll(),b},DrawerToolbar.prototype.addButtonToGroup=function(a){a=this._validateButtonConfig(a);var b=this.buttonsGroups[a.group.name],c=b&&b.length,d=!c;d&&(this._createAndAppendGroup(a.group,a.iconClass,a.buttonOrder),b=this.buttonsGroups[a.group.name]),a.isSubMenu=!0;var e=this.createButton(a);return b.$submenuWrapper.buttons.push(e),b.find(".group-items-container").append(e),e},DrawerToolbar.prototype._validateButtonConfig=function(a){a=a||{};var b=$.extend(!0,{},this._defaultButtonConfig),c=$.extend(!0,{},b,a);return c.buttonOrder="number"==typeof c.buttonOrder?c.buttonOrder:b.buttonOrder,c.isSubMenu=void 0!==c.isSubMenu?c.isSubMenu:b.isSubMenu,c.clickHandler="function"==typeof c.clickHandler?c.clickHandler:b.clickHandler,c},DrawerToolbar.prototype._getOrderString=function(a){var b="-webkit-order:"+a+";-ms-flex-order:"+a+";order:"+a+";";return b},DrawerToolbar.prototype.createButton=function(a){var b,c=this._getOrderString(a.buttonOrder),d='style="'+c+'"',e=a.isSubMenu?" submenu-child ":" ",f="toolbar-button "+a.additionalClass+e,g='<li class="'+f+'"data-tooltip-class="'+a.additionalClass+'"'+d+'><a href="#" class="toolbar-button-icon '+e+'"data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="line-height,font-size:($v / 2.5)" tabindex="-1"><i class="fa '+a.iconClass+" "+e+'"></i></a></li>';b=$(g);var h={additionalClass:a.additionalClass,text:a.tooltipText,position:"bottom"};b.tooltip=this.drawerInstance.trigger(this.drawerInstance.EVENT_CREATE_TOOLTIP,[b.find("a"),h]);var i=b.find("a");return i.on("click",function(a){a.preventDefault(),a.stopPropagation()}),DrawerJs.util.bindClick(i,"editable-canvas-toolbar-button",a.clickHandler),b},DrawerToolbar.prototype.removeButton=function(a){return a?(DrawerJs.util.unbindClick(a.find("a"),"editable-canvas-toolbar-button"),void a.remove()):void console.warn("DrawerToolbar.removeButton() : no $button is provided!")},DrawerToolbar.prototype._createAndAppendGroup=function(a,b,c){var d=this._getOrderString(c),e='style="'+d+'"',f=$('<li class="toolbar-button btn-group group-'+a.name+'"data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="width,height"'+e+'><a href="#" class="toolbar-button-icon"data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="line-height,font-size:($v / 2.5)" tabindex="-1"><i class="fa '+b+'"></i></a><div class="submenu-wrapper"><ul class="group-items-container submenu-child toolbar-dropdown-block"></ul></div></li>');f.$submenuWrapper=f.find(".submenu-wrapper"),f.$submenuWrapper.buttons=[],this.$toolbarContentHolder.append(f),this.buttonsGroups[a.name]=f,f.find("a").on("click",function(a){a.preventDefault()}),f.on("click",this.onGroupButtonClick.bind(this,f));var g={additionalClass:a.name,text:a.tooltip,position:"bottom"};this.drawerInstance.trigger(this.drawerInstance.EVENT_CREATE_TOOLTIP,[f.children("a"),g])},DrawerToolbar.prototype.setActiveButton=function(a){var b=this.$toolbar.find(".toolbar-button."+a),c=b.find(".toolbar-button-icon");c.addClass("active")},DrawerToolbar.prototype.clearActiveButton=function(){var a=this.$toolbar.find(".toolbar-button .toolbar-button-icon.active");a.removeClass("active")},DrawerToolbar.prototype.onGroupButtonClick=function(a,b){this.activeSubmenu=a.$submenuWrapper.clone(!0);var c=$(b.currentTarget);if(this.isHorizontal()){var d=parseInt(this.$toolbar.css("padding-left")),e=c.position().left-this.currentScrollOffset+d;this.activeSubmenu.css("left",e+"px")}else{var f=parseInt(this.$toolbar.css("padding-top")),g=c.position().top-this.currentScrollOffset+f;this.activeSubmenu.css("top",g+"px")}this.$toolbar.parent().append(this.activeSubmenu);var h=0;switch(this.position){case"custom":case"top":h=this.$toolbar[0].offsetTop+this.$toolbar.height(),this.activeSubmenu.css("top",h+"px");break;case"left":h=this.$toolbar[0].offsetLeft+this.$toolbar.width(),this.activeSubmenu.css("left",h+"px");break;case"right":h=this.$toolbar[0].offsetLeft-this.$toolbar.width(),this.activeSubmenu.css("left",h+"px");break;case"bottom":h=this.$toolbar[0].offsetTop-this.activeSubmenu.height(),this.activeSubmenu.css("top",h+"px")}$("body").on("mousedown.submenu",this.onSubmenuMouseDown.bind(this))},DrawerToolbar.prototype.onSubmenuMouseDown=function(a){this.activeSubmenu&&(a.target==this.activeSubmenu||$(a.target).hasClass("submenu-child")||this.hideActiveSubmenu())},DrawerToolbar.prototype.hideActiveSubmenu=function(){this.activeSubmenu&&(this.drawerInstance.trigger(this.drawerInstance.EVENT_HIDE_TOOLTIPS),this.activeSubmenu.remove(),this.activeSubmenu=null,$("body").off("mousedown.submenu"))},DrawerToolbar.prototype._setGroupButtonActive=function(a,b){var c=this.buttonsGroups[a],d=this.$toolbar.find("."+b);c.attr("class",d.attr("class")),c.addClass("btn-group");var e=c.children("a");e.addClass("active"),e.html(d.children("a").html())},DrawerToolbar.prototype._addScrollButtons=function(){var a=function(a){return'<li class="toolbar-button '+a+'"><a href="#" data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="line-height,font-size:($v / 2.5)" tabindex="-1"><i class="fa"></i></a></li>'};this.$scrollToBeginBtn=$(a("scroll-to-begin-btn")),this.$scrollToEndBtn=$(a("scroll-to-end-btn"));var b=this.$scrollToBeginBtn.find("a"),c=this.$scrollToEndBtn.find("a");b.on("click",function(a){a.preventDefault()}),c.on("click",function(a){a.preventDefault()}),DrawerJs.util.bindClick(b,"scroll-to-begin-btn",this.onScrollToBegin.bind(this)),DrawerJs.util.bindClick(c,"scroll-to-end-btn",this.onScrollToEnd.bind(this)),this.$toolbar.append(this.$scrollToBeginBtn),this.$toolbar.append(this.$scrollToEndBtn)},DrawerToolbar.prototype.onTouchStart=function(a){if(this.scrollModeActive){this.mouseDown=!0;var b="touchstart"==a.type?a.originalEvent.touches[0]:a,c=this.isHorizontal()?b.pageX:b.pageY;this.touchStartCoord=c+this.currentScrollOffset,console.log("TOUCH START",this.touchStartCoord,a),$("body").on("mouseup.toolbar touchend.toolbar",this.onTouchEnd.bind(this)),this.$toolbar.on("mousemove.toolbar touchmove.toolbar",this.onTouchMove.bind(this))}},DrawerToolbar.prototype.onTouchEnd=function(a){console.log("TOUCH END",a),this.mouseDown=!1,$("body").off("mousemove.toolbar touchmove.toolbar"),$("body").off("mouseup.toolbar touchend.toolbar")},DrawerToolbar.prototype.onTouchMove=function(a){if(this.mouseDown){var b=a.target,c=$(b),d=c.is("input"),e=c.is(".color-indicator"),f=!d&&!e;if(f){a.preventDefault();var g="touchmove"===a.type?a.originalEvent.touches[0]:a,h=this.isHorizontal()?g.pageX:g.pageY,i=this.touchStartCoord-h;console.log("TOUCH MOVE",h,i),this.scrollTo(i)}}},DrawerToolbar.prototype._onCanvasResizeStart=function(){this.checkScroll()},DrawerToolbar.prototype._onCanvasResizing=function(){this.checkScroll()},DrawerToolbar.prototype._onCanvasResizeFinish=function(){this.checkScroll()},DrawerToolbar.prototype.checkScroll=function(){var a=this.$toolbarContentHolder.get(0),b=this.isHorizontal()?a.scrollWidth:a.scrollHeight,c=this.isHorizontal()?this.$toolbar.width():this.$toolbar.height();b>c?(this.scrollModeActive=!0,this.$toolbar.addClass("show-scroll")):(this.scrollModeActive=!1,this.$toolbar.removeClass("show-scroll"),this.scrollTo(0))},DrawerToolbar.prototype._getCurrOffsetProps=function(){var a,b={},c=this.isHorizontal(),d=this.currentScrollOffset,e=this.$toolbar.find(".toolbar-content-wrapper"),f=e.get(0).getBoundingClientRect(),g=e.children();return g.each(function(e,g){var h=$(g),i=g.getBoundingClientRect(),j=c?i.left-f.left:i.top-f.top,k=Math.abs(j-d),l=h.is(":visible"),m=a>k,n=l&&(void 0===a||m);n&&(a=k,b.relativeOffset=j-d,b.$element=h,b.sizes=i)}),b},DrawerToolbar.prototype._getOffsetStep_Custom=function(a){var b,c,d,e,f=0,g=this.isHorizontal(),h=g?this.$toolbar.width():this.$toolbar.height(),i=g?this.options.buttonWidth:this.options.buttonHeight,j=h-2*i,k=this._getCurrOffsetProps(),l=k.$element,m=!0;f=k.relativeOffset;var n=l.get(0).getBoundingClientRect();for(b=l;m;){if(c=a?b.prev():b.next(),c.length&&Math.abs(f)<j){var o=c.is(":visible");o&&(d=c.get(0).getBoundingClientRect(),e=g?d.left-n.left:d.top-n.top,e>0?e+=3:e-=3,f+=e,m=!1)}else m=!1;b=c}return f},DrawerToolbar.prototype._getOffsetStep_Buttons=function(){var a,b=this.isHorizontal()?this.$toolbar.width():this.$toolbar.height(),c=this.isHorizontal()?this.options.buttonWidth:this.options.buttonHeight,d=Math.ceil(b/c),e=Math.max(d-1,1);return a=e*c},DrawerToolbar.prototype.onScrollToBegin=function(){var a,b;this.customScrollMode?a=this._getOffsetStep_Custom(!0):(b=this._getOffsetStep_Buttons(),a=-b),this.scrollToolbarBy(a)},DrawerToolbar.prototype.onScrollToEnd=function(){var a,b;this.customScrollMode?a=this._getOffsetStep_Custom():(b=this._getOffsetStep_Buttons(),a=b),this.scrollToolbarBy(a)},DrawerToolbar.prototype.scrollToolbarBy=function(a){var b=this.currentScrollOffset+parseInt(a),c=this.$toolbar.get(0),d=this.isHorizontal(),e=(d?this.$toolbar.width():this.$toolbar.height(),d?c.scrollWidth:c.scrollHeight),f=d?this.options.buttonWidth:this.options.buttonHeight,g=e-f;b=Math.min(b,g),b=Math.max(b,0),this.scrollTo(b)},DrawerToolbar.prototype.toggleToolbarVisibility=function(a,b){var c=!this.$toolbar.hasClass("hidden"),d=b?this.visibilityState:c;d?this.showToolbar(a):this.hideToolbar(a)},DrawerToolbar.prototype.hideToolbar=function(a){a&&(this.visibilityState=!this.$toolbar.hasClass("hidden")),this.invisible=!0,this.$toolbar.addClass("hidden")},DrawerToolbar.prototype.showToolbar=function(a){a&&(this.visibilityState=!this.$toolbar.hasClass("hidden")),this.invisible=!1,this.$toolbar.removeClass("hidden")},DrawerToolbar.prototype.scrollTo=function(a){this.currentScrollOffset=parseInt(a),this.isHorizontal()?this.$toolbarContentHolder.css("left","-"+this.currentScrollOffset+"px"):this.$toolbarContentHolder.css("top","-"+this.currentScrollOffset+"px")},DrawerToolbar.prototype.getToolbarOrientation=function(){return this.$toolbar.hasClass("toolbar-vertical")?"vertical":"horizontal"},DrawerToolbar.prototype.isHorizontal=function(){return"horizontal"===this.getToolbarOrientation()},DrawerToolbar.prototype.height=function(){return this.$toolbar.height()},DrawerToolbar.prototype.width=function(){return this.$toolbar.width()};var DrawerToolbarManager=function(a){if(this.drawerInstance=a,!a)throw new Error("DrawerToolbarManager : drawer must be provided!");this.toolbars={},this.toolbarPlaceholders={},this.TooltipManager=new DrawerJs.utilPlugins.TooltipManager(this.drawerInstance)};DrawerToolbarManager.prototype.addToolbar=function(a,b){b=b||{};var c=b.position==ToolbarPlaceholder.prototype.CUSTOM_POSITION,d=c?b.customAnchorSelector:b.position,e=d===ToolbarPlaceholder.prototype.POPUP_POSITION||d===ToolbarPlaceholder.prototype.OVER_CANVAS_POSITION,f=e?ToolbarPlaceholder.prototype.POSITION_TYPE_CUSTOM:b.positionType||ToolbarPlaceholder.prototype.POSITION_TYPE_OUTSIDE,g=this.toolbarPlaceholders[f]&&this.toolbarPlaceholders[f][d],h=this.toolbarPlaceholders[d],i=g||h;if(i)i.addToolbar(a);else if(!c){var j="DrawerToolbarManager.addToolbar() : no placeholder exists with name '",k=f+" "+d+" "+b.customAnchorSelector+"'";this.drawerInstance.error(j+k)}},DrawerToolbarManager.prototype.createAllToolbars=function(){var a=this;this.drawerInstance.trigger(this.drawerInstance.BEFORE_CREATE_TOOLBARS,[this]),this._createHelperElements(),this._createToolbarsPlaceholders();var b,c,d,e=this.drawerInstance.options.toolbars,f=this.drawerInstance.$canvasEditContainer.hasClass("fullscreen"),g=e.overCanvas;if(f){var h={positionType:ToolbarPlaceholder.prototype.POSITION_TYPE_INSIDE};b=$.extend(!0,{},e.toolOptions,e.toolOptions.fullscreenMode||{},h),c=$.extend(!0,{},e.drawingTools,e.drawingTools.fullscreenMode||{},h),d=$.extend(!0,{},e.settings,e.settings.fullscreenMode||{},h)}else b=e.toolOptions,c=e.drawingTools,d=e.settings;this.toolOptionsToolbar=new ToolOptionsToolbar(this.drawerInstance,b);var i={position:b.position,positionType:b.positionType,customAnchorSelector:b.customAnchorSelector};b.compactType===DrawerToolbar.prototype.POPUP&&(i.position=ToolbarPlaceholder.prototype.POPUP_POSITION,i.positionType=ToolbarPlaceholder.prototype.POSITION_TYPE_CUSTOM),this.addToolbar(this.toolOptionsToolbar,i),this.drawingToolsToolbar=new DrawingToolsToolbar(this.drawerInstance,c);var j={position:c.position,positionType:c.positionType,customAnchorSelector:c.customAnchorSelector};this.addToolbar(this.drawingToolsToolbar,j),this.settingsToolbar=new SettingsToolbar(this.drawerInstance,d);var k={position:d.position,positionType:d.positionType,customAnchorSelector:d.customAnchorSelector};this.addToolbar(this.settingsToolbar,k),this.overCanvasToolbar=new OverCanvasToolbar(this.drawerInstance,g);var l={position:ToolbarPlaceholder.prototype.OVER_CANVAS_POSITION,positionType:ToolbarPlaceholder.prototype.POSITION_TYPE_CUSTOM};this.addToolbar(this.overCanvasToolbar,l),this.cropImageToolbar=new CropImageToolbar(this.drawerInstance,g);var m={position:ToolbarPlaceholder.prototype.TOP_POSITION,positionType:ToolbarPlaceholder.prototype.POSITION_TYPE_INSIDE};this.addToolbar(this.cropImageToolbar,m),this.minimizedToolbar=new MinimizedToolbar(this.drawerInstance);var n={position:ToolbarPlaceholder.prototype.TOP_POSITION,positionType:ToolbarPlaceholder.prototype.POSITION_TYPE_INSIDE};this.addToolbar(this.minimizedToolbar,n),this.setToolbarButtonsSize(),this.drawerInstance.on(this.drawerInstance.EVENT_EDIT_STOP,function(){a.destroyAllToolbars()}),this.drawerInstance.trigger(this.drawerInstance.AFTER_CREATE_TOOLBARS,[this])},DrawerToolbarManager.prototype._createToolbarsPlaceholders=function(){this.toolbarPlaceholders.outside={},this.toolbarPlaceholders.inside={},this.toolbarPlaceholders.custom={},this.toolbarPlaceholders.outside.top=new ToolbarPlaceholder(this.drawerInstance,ToolbarPlaceholder.prototype.TOP_POSITION,ToolbarPlaceholder.prototype.POSITION_TYPE_OUTSIDE),this.toolbarPlaceholders.outside.left=new ToolbarPlaceholder(this.drawerInstance,ToolbarPlaceholder.prototype.LEFT_POSITION,ToolbarPlaceholder.prototype.POSITION_TYPE_OUTSIDE),this.toolbarPlaceholders.outside.right=new ToolbarPlaceholder(this.drawerInstance,ToolbarPlaceholder.prototype.RIGHT_POSITION,ToolbarPlaceholder.prototype.POSITION_TYPE_OUTSIDE),this.toolbarPlaceholders.outside.bottom=new ToolbarPlaceholder(this.drawerInstance,ToolbarPlaceholder.prototype.BOTTOM_POSITION,ToolbarPlaceholder.prototype.POSITION_TYPE_OUTSIDE),this.toolbarPlaceholders.inside.top=new ToolbarPlaceholder(this.drawerInstance,ToolbarPlaceholder.prototype.TOP_POSITION,ToolbarPlaceholder.prototype.POSITION_TYPE_INSIDE),this.toolbarPlaceholders.inside.left=new ToolbarPlaceholder(this.drawerInstance,ToolbarPlaceholder.prototype.LEFT_POSITION,ToolbarPlaceholder.prototype.POSITION_TYPE_INSIDE),this.toolbarPlaceholders.inside.right=new ToolbarPlaceholder(this.drawerInstance,ToolbarPlaceholder.prototype.RIGHT_POSITION,ToolbarPlaceholder.prototype.POSITION_TYPE_INSIDE),this.toolbarPlaceholders.inside.bottom=new ToolbarPlaceholder(this.drawerInstance,ToolbarPlaceholder.prototype.BOTTOM_POSITION,ToolbarPlaceholder.prototype.POSITION_TYPE_INSIDE),this.toolbarPlaceholders.custom.canvas=new ToolbarPlaceholder(this.drawerInstance,ToolbarPlaceholder.prototype.OVER_CANVAS_POSITION,ToolbarPlaceholder.prototype.POSITION_TYPE_CUSTOM),this.toolbarPlaceholders.custom.popup=new ToolbarPlaceholder(this.drawerInstance,ToolbarPlaceholder.prototype.POPUP_POSITION,ToolbarPlaceholder.prototype.POSITION_TYPE_CUSTOM),this.toolbarPlaceholders.custom.minimized=new ToolbarPlaceholder(this.drawerInstance,ToolbarPlaceholder.prototype.TOP_POSITION,ToolbarPlaceholder.prototype.POSITION_TYPE_INSIDE);for(var a=["drawingTools","toolOptions","settings"],b=0;b<a.length;b++){var c=this.drawerInstance.options.toolbars[a[b]];if(c&&c.position==ToolbarPlaceholder.prototype.CUSTOM_POSITION&&c.customAnchorSelector){var d=c.customAnchorSelector;this.toolbarPlaceholders[d]=new ToolbarPlaceholder(this.drawerInstance,ToolbarPlaceholder.prototype.CUSTOM_POSITION,null,d)}}},DrawerToolbarManager.prototype._removeHelperElements=function(){this.drawerInstance.$toolbarsWrapper&&this.drawerInstance.$toolbarsWrapper.length&&this.drawerInstance.$toolbarsWrapper.remove();var a=this.drawerInstance.$canvasEditContainer.find(".toolbars-wrapper");a&&a.length&&a.remove(),this.drawerInstance.$toolbarsWrapper=void 0},DrawerToolbarManager.prototype._createHelperElements=function(){this._removeHelperElements();var a='<div class="toolbars-wrapper"></div>',b=$(a),c=this.drawerInstance.$canvasEditContainer;c.append(b),this.drawerInstance.$toolbarsWrapper=b},DrawerToolbarManager.prototype.destroyAllToolbars=function(){this.settingsToolbar.remove(),this.drawingToolsToolbar.remove(),this.toolOptionsToolbar.remove()},DrawerToolbarManager.prototype.resetAllToolbars=function(){this.destroyAllToolbars(),this.createAllToolbars()},DrawerToolbarManager.prototype._adjustElementsSize=function(a,b){for(var c=$("[data-editable-canvas-sizeable="+a+"]"),d=0;d<c.length;d++){var e=c[d],f=$(e).attr("data-editable-canvas-cssrules");if(f)for(var g=f.split(","),h=0;h<g.length;h++){var i=g[h],j=b;"-"==i[0]&&(i=i.substr(1),j="-"+b);var k=i.match(/:\((.+)\)/);if(k){i=i.replace(k[0],"");var l=k[1];l=l.replace("$v",j);var m=new Function("return "+l)();j=m}$(e).css(i,j+"px")}}},DrawerToolbarManager.prototype.setToolbarButtonsSize=function(a){a?this.touchDevice?this.drawerInstance.options.toolbarSizeTouch=a:this.drawerInstance.options.toolbarSize=a:a=this.touchDevice?this.drawerInstance.options.toolbarSizeTouch:this.drawerInstance.options.toolbarSize,this._adjustElementsSize("toolbar-button",a)};var ToolbarPlaceholder=function(a,b,c,d){if(this.drawerInstance=a,!a)throw new Error("ToolbarPlaceholder: drawerInstance is not provided!");this._setupOptions(b,c,d),this._setupElement(),this._attachEventHandlers(),this._attachDrawerEventHandlers()};ToolbarPlaceholder.prototype.TOP_POSITION="top",ToolbarPlaceholder.prototype.BOTTOM_POSITION="bottom",ToolbarPlaceholder.prototype.LEFT_POSITION="left",ToolbarPlaceholder.prototype.RIGHT_POSITION="right",ToolbarPlaceholder.prototype.OVER_CANVAS_POSITION="canvas",ToolbarPlaceholder.prototype.POPUP_POSITION="popup",ToolbarPlaceholder.prototype.POSITION_TYPE_OUTSIDE="outside",ToolbarPlaceholder.prototype.POSITION_TYPE_INSIDE="inside",ToolbarPlaceholder.prototype.POSITION_TYPE_CUSTOM="custom",ToolbarPlaceholder.prototype.CUSTOM_POSITION="custom",ToolbarPlaceholder.prototype.HORIZONTAL_ORIENTATION="horizontal",ToolbarPlaceholder.prototype.VERTICAL_ORIENTATION="vertical",ToolbarPlaceholder.prototype.STATE_HIDDEN="hidden",ToolbarPlaceholder.prototype.STATE_OVERLAY="overlay",ToolbarPlaceholder.prototype.STATE_DISABLED="disabled",ToolbarPlaceholder.prototype._html_default='<ul class="noselect toolbar-placeholder" contenteditable=false><li class="toolbar-placeholder-overlay"></li></ul>',ToolbarPlaceholder.prototype._html_popup='<div class="noselect toolbar-placeholder hidden" contenteditable=false><div class="close-btn"><span class="fa fa-close"></span></div><div class="overlay"></div></div>',ToolbarPlaceholder.prototype._setupOptions=function(a,b,c){if(a===this.POPUP_POSITION){var d=this.drawerInstance.$popupWrapper,e=d&&d.find(".popup-content");e&&e.length&&(a=this.CUSTOM_POSITION,this.$customAnchor=e)}this.position=a,this.positionType=b,this.customAnchorSelector=c},ToolbarPlaceholder.prototype._attachEventHandlers=function(){},ToolbarPlaceholder.prototype._attachDrawerEventHandlers=function(){var a=this;this.drawerInstance.on(this.drawerInstance.EVENT_EDIT_STOP,function(){a.$element.remove()});this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_CHANGE_STATE,function(b,c){var d=$.extend(!0,{},c||{});a.changeState(d)}),this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_CLEAR_STATE,function(b,c){var d=c&&c.excludeElements,e=a.$element.find(d).length,f=a.$element.closest(d).length,g=a.position===a.POSITION_TYPE_CUSTOM,h=e||f;h||g||(a.turnOffOverlay(),a.turnOffDisabled(),a._showPlaceholder())}),this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_STATE_HIDDEN_OFF,function(b,c){var d=$.extend(!0,{},c||{});d.state="hidden",d.turnOn=!1,a.changeState(d)}),this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_STATE_HIDDEN_ON,function(b,c){var d=$.extend(!0,{},c||{});d.state="hidden",d.turnOn=!0,a.changeState(d)}),this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_STATE_OVERLAY_ON,function(b,c){var d=$.extend(!0,{},c||{});d.state="overlay",d.turnOn=!0,a.changeState(d)}),this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_STATE_OVERLAY_OFF,function(b,c){var d=$.extend(!0,{},c||{});d.state="overlay",d.turnOn=!1,a.changeState(d)}),this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_STATE_DISABLED_ON,function(b,c){var d=$.extend(!0,{},c||{});d.state="disabled",d.turnOn=!0,a.changeState(d)}),this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_STATE_DISABLED_OFF,function(b,c){var d=$.extend(!0,{},c||{});d.state="disabled",d.turnOn=!1,a.changeState(d)})},ToolbarPlaceholder.prototype._setPosition=function(a,b,c){if(a=a||this.position,b=b||this.positionType,c=c||this.customAnchorSelector,this.position=a,a==this.CUSTOM_POSITION){this.customAnchorSelector=c;var d=$(window.document).find(this.$customAnchor),e=$(window.document).find(c),f=d.length?d:e.length?e:!1;f?(this.orientation=this.HORIZONTAL_ORIENTATION,this.$customAnchor=f,this.$customAnchor.append(this.$element)):(this.drawerInstance.error("ToolbarPlaceholder : no anchor element found for custom toolbar by selector '"+c+"'"),this.position=this.TOP_POSITION)}else{switch(a){case this.TOP_POSITION:this.$element.addClass("toolbar-placeholder-top"),this.orientation=this.HORIZONTAL_ORIENTATION;break;case this.BOTTOM_POSITION:this.$element.addClass("toolbar-placeholder-bottom"),this.orientation=this.HORIZONTAL_ORIENTATION;break;case this.LEFT_POSITION:this.$element.addClass("toolbar-placeholder-left"),this.orientation=this.VERTICAL_ORIENTATION;break;case this.RIGHT_POSITION:this.$element.addClass("toolbar-placeholder-right"),this.orientation=this.VERTICAL_ORIENTATION;break;case this.OVER_CANVAS_POSITION:this.$element.addClass("toolbar-placeholder-overcanvas"),this.orientation=this.HORIZONTAL_ORIENTATION;break;default:this.position=this.TOP_POSITION,this.$element.addClass("toolbar-placeholder-top"),this.orientation=this.HORIZONTAL_ORIENTATION}b&&b===this.POSITION_TYPE_INSIDE&&this.$element.addClass("toolbar-placeholder-inside"),this.$element.attr("data-position",a);var g=this.drawerInstance.$toolbarsWrapper;g.append(this.$element)}},ToolbarPlaceholder.prototype._setupElement=function(){var a=this._getHtmlOfElement();this.$element=$(a),this.$overlay=this.$element.find(".toolbar-placeholder-overlay"),this._setPosition()},ToolbarPlaceholder.prototype._getHtmlOfElement=function(){var a;return a=this._html_default,this.position===this.POPUP_POSITION&&(a=this._html_popup),a},ToolbarPlaceholder.prototype.changeState=function(a){var b,c=this;b=function(a){var b,d,e,f=a&&a.length?a:$();return f.each(function(a,f){var g=$(f);e||(b=c.$element.find(g).length,d=c.$element.closest(g).length,e=b||d)}),e};var d=a&&a.excludeElements.length?a.excludeElements:$(),e=b(d),f=c.position===c.POSITION_TYPE_CUSTOM,g=e||f;if(!g)switch(a.state){case this.STATE_OVERLAY:this.toggleOverlay(a.turnOn);break;case this.STATE_HIDDEN:a.turnOn?this._hidePlaceholder():this._showPlaceholder();break;case this.STATE_DISABLED:a.turnOn?this.turnOnDisabled():this.turnOffDisabled()}},ToolbarPlaceholder.prototype._hidePlaceholder=function(){this.$element.addClass("hidden")},ToolbarPlaceholder.prototype._showPlaceholder=function(){this.$element.removeClass("hidden")},ToolbarPlaceholder.prototype.toggleOverlay=function(a){a?this.turnOnOverlay():this.turnOffOverlay()},ToolbarPlaceholder.prototype.turnOnDisabled=function(){this.$element.addClass("placeholder-disabled")},ToolbarPlaceholder.prototype.turnOffDisabled=function(){this.$element.removeClass("placeholder-disabled")},ToolbarPlaceholder.prototype.turnOnOverlay=function(){this.$element.addClass("placeholder-overlayed")},ToolbarPlaceholder.prototype.turnOffOverlay=function(){this.$element.removeClass("placeholder-overlayed")},ToolbarPlaceholder.prototype.addToolbar=function(a){var b=a.$toolbar;this.$element.append(b),a.position=this.position,
b.removeClass("toolbar-horizontal").removeClass("toolbar-vertical"),b.addClass(this.orientation==this.HORIZONTAL_ORIENTATION?"toolbar-horizontal":"toolbar-vertical")};var CropImageToolbar=function(a,b){b=b||{},b.toolbarClass="tool-cropimage hidden",DrawerToolbar.call(this,a,b),this._createDefaultButtons(),a.trigger(a.EVENT_IMAGECROP_TOOLBAR_CREATED,[this])};CropImageToolbar.prototype=Object.create(DrawerToolbar.prototype),CropImageToolbar.prototype.constructor=DrawerToolbar,CropImageToolbar.prototype._createDefaultButtons=function(){};var DrawingToolsToolbar=function(a,b){b.toolbarClass="drawing-tools-toolbar",this.eventNameSpace=".toolbar-drawingTools",DrawerToolbar.call(this,a,b),this._setDrawerHandlers(),a.trigger(a.EVENT_TOOLS_TOOLBAR_CREATED,[this])};DrawingToolsToolbar.prototype=Object.create(DrawerToolbar.prototype),DrawingToolsToolbar.prototype.constructor=DrawerToolbar,DrawingToolsToolbar.prototype._setDrawerHandlers=function(){var a=this.drawerInstance,b=this.eventNameSpace;a.off(a.EVENT_DO_ACTIVATE_TOOL+b),a.on(a.EVENT_DO_ACTIVATE_TOOL+b,function(b,c){a.lastUsedPluginName=c.name}),a.off(a.EVENT_DO_DEACTIVATE_TOOL+b),a.on(a.EVENT_DO_DEACTIVATE_TOOL+b,function(b,c){a.lastUsedPluginName==c.name&&(a.lastUsedPluginName=null)}),a.off(a.AFTER_CREATE_TOOLBARS+b),a.on(a.AFTER_CREATE_TOOLBARS+b,function(){a.activateDefaultPlugin()})};var MinimizedToolbar=function(a,b){b=b||{},b.toolbarClass="tool-minimized-toolbar",DrawerToolbar.call(this,a,b),a.trigger(a.EVENT_MINIMIZED_TOOLBAR_CREATED,[this])};MinimizedToolbar.prototype=Object.create(DrawerToolbar.prototype),MinimizedToolbar.prototype.constructor=DrawerToolbar;var OverCanvasToolbar=function(a,b){b=b||{},b.toolbarClass="tool-overcanvas-toolbar",DrawerToolbar.call(this,a,b),a.trigger(a.EVENT_FLOATING_TOOLBAR_CREATED,[this])};OverCanvasToolbar.prototype=Object.create(DrawerToolbar.prototype),OverCanvasToolbar.prototype.constructor=DrawerToolbar;var SettingsToolbar=function(a,b){b=b||{},b.toolbarClass="tool-settings-toolbar",DrawerToolbar.call(this,a,b),this._createDefaultButtons(),a.trigger(a.EVENT_CONFIG_TOOLBAR_CREATED,[this])};SettingsToolbar.prototype=Object.create(DrawerToolbar.prototype),SettingsToolbar.prototype.constructor=DrawerToolbar,SettingsToolbar.prototype._createDefaultButtons=function(){};var ToolOptionsToolbar=function(a,b){b.toolbarClass="tool-options-toolbar",DrawerToolbar.call(this,a,b),a.trigger(a.EVENT_OPTIONS_TOOLBAR_CREATED,[this])};ToolOptionsToolbar.prototype=Object.create(DrawerToolbar.prototype),ToolOptionsToolbar.prototype.constructor=DrawerToolbar,ToolOptionsToolbar.prototype.customScrollMode=!0,function(a,b,c,d){"use strict";var e=".ToolbarComboBox",f=function(a,c){return this.$element=b(a),this._setupOptions(c),this._setupCombobox(),this._attachEventHandlers(),this._attachDrawerEventHandlers(),{instance:this,updateSelectedValues:this.updateSelectedValues.bind(this),hideDropdown:this.hideDropdown.bind(this),showDropdown:this.hideDropdown.bind(this)}};f.prototype._defaultOptions={wrapper:"toolbar-combobox-wrapper",editable:!1,addNewOptions:!1,buttonMode:!1,items:[]},f.prototype._setupOptions=function(a){var c=this._collectOptionsFromElement();return this.options=b.extend(!0,{},this._defaultOptions||{},c||{},a||{}),this._initialOptions=b.extend(!0,{},a),this._initialOptionsFromElement=b.extend(!0,{},c),this.options},f.prototype._setupCombobox=function(){var a=this._generateTemplate(),c=b(a);c.insertAfter(this.$element),this.$element.addClass("hidden"),this.$combobox=c,this.$options=this.$combobox.find("ul"),this.$dropdown=this.$combobox.find(".dropdown-box"),this.$input=this.$combobox.find("input"),this.$closestToolbarItem=this.$element.closest(".toolbar-item-wrapper")},f.prototype._generateTemplate=function(){var a,b=this,c='<div class="inputbox"><input type="text"/></div>',d="";return this.options.items.forEach(function(a){var c,e="object"==typeof a,f=e?a.value:a,g=e?a.text||f:f,h=e?a.style||"":"";c=b._generateNewOptionItem(g,f,!1,!0,h),d+=c}),this.wrapperClasses=this.options.wrapper+(this.options.buttonMode?" button-mode ":"")+(this.options.editable?" edit-mode ":""),a='<div class="'+this.wrapperClasses+' collapsed" tabindex="-1"><div class="selected"><span></span><a class="ui-button"><i class="fa fa-angle-down"></i></a></div><div class="dropdown-box">'+(this.options.editable?c:"")+'<ul class="option-list">'+d+"</ul></div></div>"},f.prototype._generateNewOptionItem=function(a,c,d,e,f){a=a||"",f=f||"";var g='<li style="'+f+'"data-val="'+c+'"class="option-item"><div class="option-item-text">'+a+"</div></li>",h=b(g);return d&&(this.$combobox.find(".selected").attr("data-val",c).find("span").text(a),h.addClass("selected")),e?h.get(0).outerHTML:h},f.prototype._setupDropDownSize=function(){var a=this.$combobox.width();a&&(this.sizesUpdated=!0)},f.prototype._attachDrawerEventHandlers=function(){var a=this,d=this.$element.closest(".toolbar-item-wrapper");d&&d.length&&(c.bindClick(b("body"),"_optionTool_toggleDropdown",function(c){var e=b(c.target),f=e.closest(".toolbar-item-wrapper"),g=e.is("canvas"),h=d.get(0)===f.get(0),i=!h&&!g;i&&(d.find(".toolbar-dropdown-block").addClass("collapsed"),a.hideDropdown())}),c.bindClick(d.find(".toolbar-item-icon"),"_optionTool_toggleDDropdown",function(){var b,e=d.find(".toolbar-dropdown-block").hasClass("collapsed");if(e){var f=a.options&&a.options.drawer&&a.options.drawer.toolbars&&a.options.drawer.toolbars.toolOptionsToolbar,g=f&&f.options,h=g&&"popup"!==g.position,i=g&&"outside"===g.positionType,j=g&&"scrollable"===g.compactType;if(b=h&&i&&j){var k=a.$combobox.clone(!0);d.closest(".toolbar-placeholder").append(k),k.addClass("combobox-cloned"),a.$clonedCombobox=k;var l=c.getScrollOffset(a.options.drawer.$canvasEditContainer),m=c.getScrollOffset(a.$element.parent()),n=a.options.drawer.$canvasEditContainer.get(0).getBoundingClientRect(),o=a.$element.parent().get(0).getBoundingClientRect().left,p=o-n.left-(m.left-l.left)-a.$clonedCombobox.width()/2;a.$clonedCombobox.css({left:p})}}b||d.find(".toolbar-dropdown-block").toggleClass("collapsed",!e)}))},f.prototype._attachEventHandlers=function(){var a=this;if(this.options.editable){var c,d=this.$input;d.off("focus"+e).on("focus"+e,function(){a.$combobox.addClass("focus"),c=!0}),d.off("blur"+e).on("blur"+e,function(){c=!1,a.$combobox.trigger("blur")}),d.off("keypress"+e).on("keypress"+e,function(c){if("13"==c.keyCode){var e=d.val();d.val("");var f=b("<option>").val(e).text(e).attr("data-is-input",1);if(a.$element.append(f),a.options.addNewOptions){var g=a._generateNewOptionItem(e,e,!0);a.$options.append(g)}a.changeActiveOption(e)}})}this.$element.off("valueChanged"+e).on("valueChanged"+e,function(b,c){var d,e=a.$element.val(),f=c?c.value:void 0,g=c?f:e;c&&(d=c.classString),a.updateSelectedValues(g,d)}),this.$element.off("change"+e).on("change"+e,function(){if(!a.addNewOptions){var b=a.$element,c=b.attr("prev-value"),d=-1===a.options.valuesArr.indexOf(c);d&&b.find('option[data-val="'+c+'"]').remove()}}),this.$combobox.off("mouseleave"+e).on("mouseleave"+e,function(){var b=a.$element.closest(".toolbar-item-wrapper");b.find(".toolbar-dropdown-block").addClass("collapsed"),a.hideDropdown()}),this.$combobox.off("click"+e+"_optionSelect").on("click"+e+"_optionSelect",".option-item",this._onOptionSelect.bind(this)),this.$combobox.off("click"+e+"_toggleDropdown").on("click"+e+"_toggleDropdown",".selected",function(){a.toggleDropdown()}),this.$combobox.off("blur"+e).on("blur"+e,function(b){b.preventDefault(),setTimeout(function(){c||a.hideDropdown()},100),a.$combobox.removeClass("focus")})},f.prototype._collectOptionsFromElement=function(){var a={},c=this.$element.attr("data-editable")&&"true"===this.$element.attr("data-editable");return a.items=[],a.valuesArr=[],this.$element.find("option").each(function(c,d){var e=b(d),f=e.val(),g=e.text(),h=e.attr("style")||"",i={value:f,text:g,style:h};a.valuesArr.push(f),a.items.push(i)}),a.editable=c,a},f.prototype._onOptionSelect=function(a){var c=b(a.currentTarget),d=c.hasClass("selected"),e=d?"":c.attr("data-val"),f=c.text();this.hideDropdown(),this.changeActiveOption(e,f),a.stopPropagation(),a.preventDefault()},f.prototype.changeActiveOption=function(a){var b=this.$element.val();this.$element.attr("prev-value",b),this.$element.val(a),this.updateSelectedValues(a),this.$element.trigger("toolbarOptionChange")},f.prototype.updateSelectedValues=function(a,b){a=a||"";var c=this.$combobox.find(".option-item"),d=c.filter('[data-val="'+a+'"]'),e=d&&d.length?d.text():a,f=this.$combobox.hasClass("collapsed")?" collapsed":"",g=this.wrapperClasses+" "+(b||"")+f;this.$combobox.attr("class",g),this.$combobox.find(".selected span").text(e),c.removeClass("selected"),d?(d.addClass("selected"),this.$input.val("")):this.$input.val(a)},f.prototype.showDropdown=function(){this.dropdownIsVisible=!0,this.sizesUpdated||this._setupDropDownSize(),this.$combobox.find(".ui-button .fa").addClass("fa-angle-down").removeClass("fa-angle-up"),this.$combobox.removeClass("collapsed")},f.prototype.hideDropdown=function(){this.dropdownIsVisible=!1,this.$combobox.addClass("collapsed"),this.$combobox.find(".ui-button .fa").removeClass("fa-angle-down").addClass("fa-angle-up"),this.$clonedCombobox&&this.$clonedCombobox.remove()},f.prototype.toggleDropdown=function(a){var b=void 0!==a?a:!this.dropdownIsVisible;this.dropdownIsVisible=b,b?this.showDropdown():this.hideDropdown()},b.fn.ToolbarComboBox=function(a){var c=[];return b(this).each(function(d,e){var g=new f(e,a);b(e).data("comboBox",g),c.push(g)}),c},b.fn.getComboBox=function(){var a=[];return b(this).each(function(c,d){var e=b(d).data("comboBox");e&&a.push(e)}),a.length>1?a:a[0]},d.ToolbarComboBox=f}(window,jQuery,DrawerJs.util,DrawerJs.utilPlugins),function(a,b,c,d){"use strict";var e=function(a,c){return this.$element=b(a),this._setupOptions(c),this._processOptions(),this._setupTooltip(),this._attachEventHandlers(),{instance:this,$trigger:this.$element,adjustPosition:this.adjustPosition.bind(this),destroy:this.destroy.bind(this),hideTooltip:this.hideTooltip.bind(this),showTooltip:this.showTooltip.bind(this)}};e.prototype._defaultOptions={defaultClass:"editable-canvas-tooltip",defaultPositionX:"center",defaultPositionY:"bottom",additionalClass:"",text:"",position:"",style:"",styleObj:{},$tooltipWrapper:"",tooltipWrapperSelector:void 0},e.prototype.enabled=!0,e.prototype._defaultWrapper="body",e.prototype._eventsNamespace=".drawerTooltip",e.prototype._firstShow=!0,e.prototype._setupOptions=function(a){var c=this._collectOptionsFromElement();return this.options=b.extend(!0,{},this._defaultOptions||{},c||{},a||{}),this._initialOptions=b.extend(!0,{},a),this._initialOptionsFromElement=b.extend(!0,{},c),this.options},e.prototype._checkElement=function(a){var c,d;return"string"==typeof a&&(d=b(a)),a instanceof b&&(d=a),d&&d.length&&(c=d.eq(0)),c},e.prototype._processOptions=function(){var a=this._checkElement(this.options.$tooltipWrapper),b=this._checkElement(this.options.tooltipWrapperSelector),c=this._checkElement(this._defaultWrapper);this.$tooltipWrapper=a||b||c},e.prototype._setupTooltip=function(){var a=this._generateTemplate(),c=b(a);this.options.styleObj&&c.css(this.options.styleObj),this.$element.addClass("tooltip-trigger"),this.$element.data("DrawerTooltip",this),this.$tooltipWrapper.append(c),this.$tooltip=c},e.prototype._generateTemplate=function(){var a,b=this.options.text||"",c=this.options.defaultClass+" "+this.options.additionalClass,d=this.options.style||"";return a='<span class="'+c+'"style="'+d+'">'+b+"</span>"},e.prototype._attachEventHandlers=function(){var a=this,c=this.$element;this._detachEventHandlers(),c.on("mouseenter"+this._eventsNamespace,function(d){var e=b(d.currentTarget),f=b("body"),g=f.hasClass("drawer-moving"),h=f.hasClass("drawer-resizing"),i=c.hasClass("disabled"),j=g||h||i;j||a.showTooltip(e)}),c.on("mouseout"+this._eventsNamespace,function(){a.hideTooltip()})},e.prototype._detachEventHandlers=function(){this.$element.off("mouseenter"+this._eventsNamespace),this.$element.off("mouseout"+this._eventsNamespace)},e.prototype._parsePositionString=function(a){a=a||this.options.position||"";var b={},c=-1!==a.indexOf("right")||-1!==a.indexOf("left"),d=c&&(-1!==a.indexOf("right")?"right":"left"),e=-1!==a.indexOf("top")||-1!==a.indexOf("bottom"),f=e&&(-1!==a.indexOf("top")?"top":"bottom");return d=d||(e?"center":this.options.defaultPositionX),f=f||(c?"center":this.options.defaultPositionY),b.positionX=d,b.positionY=f,b},e.prototype._resetTooltip=function(){},e.prototype.adjustPosition=function(a,b){if(this.enabled){b=b||this.$element;var d=this._parsePositionString(a),e=this.$tooltip,f=0,g=0,h=8,i=c.getScrollTopFromElement(b),j=b.get(0).getBoundingClientRect(),k=e.get(0).getBoundingClientRect();switch(d.positionX){case"right":g=i.left+j.left+j.width+h;break;case"left":g=i.left+j.left-k.width-h;break;default:g=i.left+j.left+(j.width-k.width)/2}switch(d.positionY){case"top":f=i.top+j.top-k.height-h;break;case"bottom":f=i.top+j.top+j.height+h;break;default:f=i.top+j.top+(j.height-k.height)/2}e.attr("positionX",d.positionX),e.attr("positionY",d.positionY),e.css({top:f+"px",left:g+"px"})}},e.prototype._collectOptionsFromElement=function(a){a=a||this.$element;var b={};b.items=[];var c=a.text(),d=a.attr("tooltip-text"),e=a.attr("tooltip-style")||"",f=a.attr("tooltip-position")||"";return b.text=d||c,b.style=e,b.position=f,b},e.prototype.destroy=function(){this._detachEventHandlers(),this.$tooltip.remove(),this.$element.data("DrawerTooltip",void 0),this.$element.removeClass("tooltip-trigger"),this.enabled=!1},e.prototype.showTooltip=function(a){this.enabled&&(this.$element.trigger("showTooltip"),this._firstShow=!1,this.$tooltip.is(":visible")||this.$tooltip.addClass("tooltip-transparent"),this.adjustPosition(void 0,a),this.$tooltip.removeClass("tooltip-transparent"),this.$tooltip.addClass("active"),this.isVisible=!0)},e.prototype.hideTooltip=function(){this.enabled&&this.isVisible&&(this.$tooltip.removeClass("active"),this.isVisible=!1)},b.fn.DrawerTooltip=function(a){var c=[];return b(this).each(function(d,f){var g=new e(f,a);b(f).data("DrawerTooltip",g),c.push(g)}),c},b.fn.getDrawerTooltip=function(){var a=[];return b(this).each(function(c,d){var e=b(d).data("DrawerTooltip");e&&a.push(e)}),a.length>1?a:a[0]},d.Tooltip=e}(window,jQuery,DrawerJs.util,DrawerJs.utilPlugins),function(a,b,c,d){"use strict";var e=function(a,b){return this.drawerInstance=a,this._setupOptions(b),this._processOptions(),this._createHelperElements(),this._attachDrawerEventHandlers(),this._attachEventHandlers(),{instance:this,createTooltip:this.createTooltip.bind(this)}};e.prototype._defaultOptions={tooltipCss:{}},e.prototype._tooltipInstances=[],e.prototype._setupOptions=function(a){var c={styleObj:this.drawerInstance.options.tooltipCss};return this.options=b.extend(!0,{},this._defaultOptions||{},c,a||{}),this._initialOptions=b.extend(!0,{},a),this.options},e.prototype._processOptions=function(){},e.prototype.createTooltip=function(a,c){a=a||[];var e,f=this,g=[],h=b.extend(!0,{},this.options,c||{});return a.each(function(a,b){e=new d.Tooltip(b,h),f._tooltipInstances.push(e),g.push(e)}),g},e.prototype.removeAllTooltips=function(){this._tooltipInstances.forEach(function(a){a.destroy()}),this._tooltipInstances=[]},e.prototype.hideAllTooltips=function(){this._tooltipInstances.forEach(function(a){a.hideTooltip()})},e.prototype._removeHelperElements=function(){this.drawerInstance.$tooltipContainer&&this.drawerInstance.$tooltipContainer.length&&this.drawerInstance.$tooltipContainer.remove()},e.prototype._createHelperElements=function(){this._removeHelperElements();var a=this.drawerInstance.id,c='<div class="tooltip-container" data-drawer-instance="'+a+'"></div>',d=b(c),e=b("body");e.append(d),this.options.$tooltipWrapper=d,this.drawerInstance.$tooltipContainer=d},e.prototype._attachDrawerEventHandlers=function(){var a=this;this.drawerInstance.on(this.drawerInstance.EVENT_CREATE_TOOLTIP,function(b,c,d){return a.createTooltip(c,d)}),this.drawerInstance.on(this.drawerInstance.EVENT_HIDE_TOOLTIPS,function(){a.hideAllTooltips()}),this.drawerInstance.on(this.drawerInstance.EVENT_DESTROY_TOOLTIPS,function(){a.removeAllTooltips()}),this.drawerInstance.on("destroy",function(){a.removeAllTooltips()})},e.prototype._attachEventHandlers=function(){b("body").off("showTooltip").on("showTooltip",".tooltip-trigger",function(a){var c=b(a.currentTarget),d=c.data("DrawerTooltip");if(d._firstShow){var e,f=c.closest(".toolbar-placeholder"),g=f.attr("data-position");switch(g){case ToolbarPlaceholder.prototype.TOP_POSITION:e=ToolbarPlaceholder.prototype.BOTTOM_POSITION;break;case ToolbarPlaceholder.prototype.BOTTOM_POSITION:e=ToolbarPlaceholder.prototype.TOP_POSITION;break;case ToolbarPlaceholder.prototype.LEFT_POSITION:e=ToolbarPlaceholder.prototype.RIGHT_POSITION;break;case ToolbarPlaceholder.prototype.RIGHT_POSITION:e=ToolbarPlaceholder.prototype.LEFT_POSITION}e&&(d.options.position=e)}})},d.TooltipManager=e}(window,jQuery,DrawerJs.util,DrawerJs.utilPlugins),function(a,b){"use strict";var c=function(a,b){if(!a)throw new Error("BaseTool CTOR : drawerInstance is not set!");this._setupOptions(b),this.drawerInstance=a,this.drawer=a,this._bindedOnToolbarCreated=this._onToolbarCreated.bind(this),this.drawerInstance.on(this.drawerInstance.EVENT_TOOLS_TOOLBAR_CREATED,this._bindedOnToolbarCreated)};c.prototype.name="",c.prototype.type=null,c.prototype.active=!1,c.prototype.btnClass="btn",c.prototype.faClass="",c.prototype.tooltip="",c.prototype.toolbar=null,c.prototype.$toolButton=null,c.prototype.drawerInstance=null,c.prototype._onDeactivateAllTools=function(){if(this.active){var a=".tool-"+this.name;this.drawerInstance.trigger(this.drawerInstance.EVENT_DO_DEACTIVATE_TOOL+a,[this])}},c.prototype._setupOptions=function(b,c,d){c=c||this.name;var e=this.drawerInstance||this.drawer,f=e&&e.getPluginConfig(c),g=a.extend(!0,{},this._defaultOptions||{},f||{},b||{});return d||(this.options=g),g},c.prototype._onToolbarCreated=function(a,b){this.toolbar=b,this.createButton(b),this._setHandlers(),this.onToolbarCreated&&this.onToolbarCreated(a,b)},c.prototype.onToolbarDestroyed=function(a,b){this.toolbar==b&&this.removeTool()},c.prototype.removeTool=function(a){this.$toolButton&&this.toolbar.removeButton(this.$toolButton),a&&(this._unsetHandlers(),this.drawerInstance.off(this.drawerInstance.EVENT_TOOLS_TOOLBAR_CREATED,this._bindedOnToolbarCreated))},c.prototype._setHandlers=function(){var a=".tool-"+this.name;this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_DESTROYED+a,this.onToolbarDestroyed.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_DO_DEACTIVATE_ALL_TOOLS+a,this._onDeactivateAllTools.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_DO_DEACTIVATE_TOOL+a,this._onDeactivateTool.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_DO_ACTIVATE_TOOL,this._onActivateTool.bind(this))},c.prototype._unsetHandlers=function(){var a=".tool-"+this.name;this.drawerInstance.off(this.drawerInstance.EVENT_TOOLBAR_DESTROYED+a),this.drawerInstance.off(this.drawerInstance.EVENT_DO_DEACTIVATE_ALL_TOOLS+a),this.drawerInstance.off(this.drawerInstance.EVENT_DO_DEACTIVATE_TOOL+a),this.drawerInstance.off(this.drawerInstance.EVENT_DO_ACTIVATE_TOOL+a)},c.prototype._onDeactivateTool=function(a,b){if(!b||!b.name)throw new Error("BaseTool.onDeactivateTool() : no tool name is provided!");this.active&&b.name==this.name&&this._deactivateTool()},c.prototype._onActivateTool=function(a,b){if(!b||!b.name)throw new Error("BaseTool._onActivateTool() : no tool name is provided!");if(b.name===this.name&&!this.active){var c={beforeActivateTool:!0};this.drawerInstance.trigger(this.drawerInstance.EVENT_DO_DEACTIVATE_ALL_TOOLS,c),this._activateTool()}},c.prototype.createButton=function(a){var b={buttonOrder:this.options.buttonOrder,additionalClass:this.btnClass,iconClass:this.faClass,tooltipText:this.tooltip,clickHandler:this.onButtonClick.bind(this)};this.group?(b.group=this.group,this.$toolButton=a.addButtonToGroup(b)):this.$toolButton=a.addButton(b)},c.prototype.onButtonClick=function(){var a=this.active?this.drawerInstance.EVENT_DO_DEACTIVATE_TOOL:this.drawerInstance.EVENT_DO_ACTIVATE_TOOL;this.drawerInstance.trigger(a,[this])},c.prototype._activateTool=function(){this.drawerInstance.log("TOOL","["+this.name+"] .activateTool() [BaseTool]"),this.drawerInstance.fCanvas.discardActiveObject(),this.drawerInstance.fCanvas.renderAll(),this.active=!0,this.drawerInstance.activeDrawingTool=this,this.highlightButton(),this.drawerInstance.trigger(this.drawerInstance.EVENT_TOOL_ACTIVATED,[this])},c.prototype._deactivateTool=function(){this.drawerInstance.log("TOOL","["+this.name+"] : deactivateTool [BaseTool]"),this.active=!1,this.drawerInstance.activeDrawingTool===this&&(this.drawerInstance.activeDrawingTool=null),this.highlightButtonOff(),this.drawerInstance.fCanvas.renderAll(),this.drawerInstance.trigger(this.drawerInstance.EVENT_TOOL_DEACTIVATED,[this])},c.prototype.highlightButton=function(){this.group?this.toolbar._setGroupButtonActive(this.group.name,this.btnClass):this.toolbar.setActiveButton(this.btnClass)},c.prototype.highlightButtonOff=function(){this.toolbar.clearActiveButton()},b.BaseTool=c}(jQuery,DrawerJs.plugins),function(a,b,c,d){"use strict";var e=d.mouseUp("BaseBrushTimer"),f=d.mouseDown("BaseBrushTimer"),g=function(a){c.call(this,a),this.type="brush",this.brushConstructor=fabric.ErasablePencilBrush};g.prototype=Object.create(c.prototype),g.prototype.constructor=g,g.prototype.doNotZoomOnActivate=!0,g.prototype.createButton=function(a){var b=this,c=function(){var a=b.active?b.drawerInstance.EVENT_DO_DEACTIVATE_TOOL:b.drawerInstance.EVENT_DO_ACTIVATE_TOOL;b.drawerInstance.trigger(a,[b])},d={buttonOrder:this.options.buttonOrder,additionalClass:this.btnClass,iconClass:this.faClass,tooltipText:this.tooltip,clickHandler:c};this.$toolButton=a.addButton(d)},g.prototype._activateTool=function(){c.prototype._activateTool.call(this),this.drawerInstance.log("TOOL",this.name+" : activateTool [BaseBrush]");var a=this,b=a.drawerInstance.fCanvas;b.freeDrawingCursor="url(/redactor.plugin.drawer/dist/cursor-fa-eraser.cur), default",b.isDrawingMode=!0,a.brush||(a.brush=a.createBrush?a.createBrush():new fabric.ErasablePencilBrush(a.drawerInstance.fCanvas)),a.previousBrush=a.drawerInstance.getBrush(),a.drawerInstance.setBrush(a.brush),a.drawerInstance.trigger(this.drawerInstance.EVENT_TOOL_ACTIVATED,[this]),this.afterActivateTool(),this._attachTimerEvents()},g.prototype._attachTimerEvents=function(){var b=this.drawerInstance.fCanvas.upperCanvasEl,c=a(b);this._removeTimerEvents(),c.on(f,this._onMouseDownTimer.bind(this)),a(window.document).on(e,this._onMouseUpTimer.bind(this))},g.prototype._onMouseDownTimer=function(){this.drawerInstance.isBrushDrawing=!0},g.prototype._onMouseUpTimer=function(){var a=this;d.setTimeout(function(){a.drawerInstance.isBrushDrawing=!1},0)},g.prototype._removeTimerEvents=function(){var b=this.drawerInstance.fCanvas.upperCanvasEl,c=a(b);c.off(f),a(window.document).off(e)},g.prototype._deactivateTool=function(){c.prototype._deactivateTool.call(this),this.drawerInstance.log("TOOL",this.name+" : deactivateTool [BaseBrush]"),this.drawerInstance.fCanvas.isDrawingMode=!1,a(this.drawerInstance.fCanvas.upperCanvasEl).off("mousedown.BaseBrush touchstart.BaseBrush"),a(this.drawerInstance.fCanvas.upperCanvasEl).off("mouseup.BaseBrush touchend.BaseBrush"),this._removeTimerEvents(),this.drawerInstance.setBrush(this.previousBrush),this.brush=null,this.drawerInstance.trigger(this.drawerInstance.EVENT_TOOL_DEACTIVATED,[this]),this.afterDeactivateTool()},g.prototype.afterActivateTool=function(){throw new Error(this.name+" should implement afterActivateTool() method.")},g.prototype.afterDeactivateTool=function(){throw new Error(this.name+" should implement afterDeactivateTool() method.")},b.BaseBrush=g}(jQuery,DrawerJs.plugins,DrawerJs.plugins.BaseTool,DrawerJs.util),function(a,b,c,d){"use strict";var e=function(a){if(!a)throw new Error("BaseShape CTOR : drawerInstance is not set!");c.call(this,a);this.drawer=a,this.type="shape",this.objectBaseType="shape",this.toolOptionsList=["color","border","opacity"],this.drawingInProgress=!1,this.onlyOneItem=!0,this.MOUSEMOVE=this.getEventId(["mousemove","touchmove"]),this.MOUSEDOWN=this.getEventId(["mousedown","touchstart"]),this.MOUSEUP=this.getEventId(["mouseup","touchend"])};e.prototype=Object.create(c.prototype),e.prototype.constructor=e,e.prototype.minShapeSize=4,e.prototype.minShapeSizeForTouch=15,e.CENTERING_MODE={NORMAL:"normal",FROM_CENTER:"from_center"},e.prototype._setupOptions=function(b,c,d){c=c||this.name;var e=this.drawerInstance||this.drawer,f=e&&e.getPluginConfig(c),g=a.extend(!0,{},this._defaultOptions||{},f||{},b||{});return d||(this.options=g),g},e.prototype.getEventId=function(a){var b=this;return a instanceof String&&(a=[a]),a instanceof Array?a.map(function(a){return a+".drawerTool"+b.btnClass}).join(" "):void 0},e.prototype._activateTool=function(){if(!this.active){c.prototype._activateTool.call(this),this.drawerInstance.log("TOOL",this.name+" : _activateTool() [BaseShape]");var a=this;this.drawerInstance.touchDevice||a.showHelpTooltip();var b=this.drawerInstance.fCanvas;b.disableSelection(),b.renderAll(),b.defaultCursor="crosshair",this.setUpHandlers?this.setUpHandlers():this._setUpHandlers()}},e.prototype._setUpHandlers=function(){var b=this,c=this.drawerInstance.fCanvas;a(c.upperCanvasEl).on(b.MOUSEDOWN,function(d){if(b.drawerInstance.log("baseShape","mousedown"),a(c.upperCanvasEl).off(b.MOUSEDOWN),b.drawerInstance.touchDevice||b.removeHelpTooltip(),c.getActiveObject())return!0;if(b.drawingInProgress)return b.finishItemDraw(),!0;b.drawingInProgress=!0,b.drawerInstance.drawingInProgress=!0;var e=b.drawer.fCanvas.getPointer(d,!0);if(!b.createShape)throw new Error("createShape method does not exist",b);b.shape=b.createShape(e.x,e.y),b.drawerInstance.trigger(b.drawerInstance.EVENT_ZOOM_SET),c.add(b.shape),b.drawerInstance.trigger(b.drawerInstance.EVENT_ZOOM_RESTORE),a(document).on(b.MOUSEMOVE,function(a){var d=b.drawer.fCanvas.getPointer(a);if(!b.updateShape)throw new Error("updateShape method does not exist",b);b.updateShape(b.shape,d.x,d.y),c.renderAll()}),a(document).on(b.MOUSEUP,function(){b.drawerInstance.log("baseShape","mouseup");var a=b.drawer.touchDevice?b.minShapeSizeForTouch:b.minShapeSize,c=b.shape.width<a,d=!b.checkOnlyWidth&&b.shape.height<a,e=b.checkOnlyWidthOrHeight?c&&d:c||d,f=e;return f?(b.shape.remove(),b.shape=null,b._deactivateTool(),void b._activateTool()):(b.finishItemDraw(),void(b.onlyOneItem&&b.drawerInstance.trigger(b.drawerInstance.EVENT_DO_DEACTIVATE_TOOL,b)))})})},e.prototype.finishItemDraw=function(){var b=this,c=b.drawerInstance.fCanvas;if(c.defaultCursor="default",this.drawerInstance.touchDevice||b.removeHelpTooltip(),c.deactivateAll(),c.calcOffset(),b.drawingInProgress=!1,d.setTimeout(function(){b.drawerInstance.drawingInProgress=!1}),a(document).off(b.MOUSEMOVE),a(document).off(b.MOUSEUP),this.finishShape&&this.finishShape(this.shape),b.shape){b.shape.width<0&&(b.shape.set("width",-1*b.shape.width),b.shape.set("left",b.shape.left-b.shape.width),b.shape.set("flipX",!0)),b.shape.height<0&&(b.shape.set("height",-1*b.shape.height),b.shape.set("top",b.shape.top-b.shape.height),b.shape.set("flipY",!0));var e=b.shape.clone();b.shape.remove(),b.shape=null,c.deactivateAll(),c.add(e),c.restoreSelection(),c.renderAll(),c.calcOffset(),c.renderAll()}},e.prototype._deactivateTool=function(){this.active&&(c.prototype._deactivateTool.call(this),this.drawerInstance.log("TOOL",this.name+" : _deactivateTool() [BaseShape]"),this.finishItemDraw(),a(this.drawerInstance.fCanvas.upperCanvasEl).off(this.MOUSEDOWN),this.drawerInstance.fCanvas.restoreSelection())},e.prototype.showHelpTooltip=function(){var b=this,c=b.drawerInstance.fCanvas,d="";d=this.helpTooltipText?this.helpTooltipText:b.drawerInstance.t("Click to start drawing a ")+'<i class="fa '+b.faClass+'"></i>',b.cursorTooltip=a('<div class="drawer-tool-mouse-tooltip '+this.btnClass+'">'+d+"</div>"),a("body").append(b.cursorTooltip),a(c.upperCanvasEl).on("mousemove.drawer-tool-mouse-toolip",function(a){b.cursorTooltip.css("left",a.pageX),b.cursorTooltip.css("top",a.pageY)}),a(c.upperCanvasEl).on("mouseleave",function(){b.cursorTooltip.css("opacity",0)}),a(c.upperCanvasEl).on("mouseenter",function(){b.cursorTooltip.css("opacity",1)})},e.prototype.removeHelpTooltip=function(){this.cursorTooltip&&(a("body").off("mousemove.drawer-tool-mouse-toolip"),this.cursorTooltip.fadeOut(),this.cursorTooltip.remove())},b.BaseShape=e}(jQuery,DrawerJs.plugins,DrawerJs.plugins.BaseTool,DrawerJs.util),function(a,b){"use strict";var c=function(a,b){if(!a)throw new Error("BaseToolOptions CTOR : drawer is not set!");this.drawer=a,this._setupOptions(b),this._bindedOnToolbarCreated=this._onToolbarCreated.bind(this),a.on(a.EVENT_OPTIONS_TOOLBAR_CREATED,this._bindedOnToolbarCreated),a.on(a.EVENT_TOOLBAR_DESTROYED,this._onToolbarDestroyed.bind(this)),a.on(a.EVENT_DO_DEACTIVATE_ALL_TOOLS,this._onDeactivateTool.bind(this)),a.on(a.EVENT_DO_DEACTIVATE_TOOL,this._onDeactivateTool.bind(this)),a.on(a.EVENT_DO_ACTIVATE_TOOL,this._onActivateTool.bind(this)),a.on(a.EVENT_TOOL_DEACTIVATED,this._onDeactivateTool.bind(this)),a.on(a.EVENT_TOOL_ACTIVATED,this._onActivateTool.bind(this)),a.on(a.EVENT_OBJECT_SELECTED,this._onObjectSelected.bind(this)),a.on(a.EVENT_SELECTION_CLEARED,this._onSelectionCleared.bind(this)),a.on(a.EVENT_TEXT_EDITING_ENTERED,this._onTextEditingEntered.bind(this)),a.on(a.EVENT_TEXT_EDITING_EXITED,this._onTextEditingExited.bind(this))};c.prototype.active=!1,c.prototype.drawer=null,c.prototype.toolbar=null,c.prototype.name="",c.prototype.type=null,c.prototype.optionName="",c.prototype.btnClass="btn",c.prototype.faClass="",c.prototype.showOnEditMode=!1,c.prototype.hideOnEditMode=!0,c.prototype.data={},c.prototype._setupOptions=function(b,c,d){b=b||{};var e=this._collectDefaultOptions(c),f=a.extend(!0,{},this._defaultOptions||{},e||{},b),g=this._onOptionsSetup(this._defaultOptions,b,e,f);return f=g||f,d||(this.options=f),f},c.prototype._onOptionsSetup=function(a,b,c,d){return d},c.prototype._collectDefaultOptions=function(a){a=a||this.name||this.optionName;var b=this.drawerInstance||this.drawer,c=b&&b.getPluginConfig(a);return c},c.prototype._onToolbarCreated=function(a,b){if(this.toolbar=b,this.createControls&&this.createControls(b),this.useCombobox&&this.$toolControl){var c={drawer:this.drawer,editable:!this.onlyPredefined,buttonMode:this.buttonMode},d=this.$toolControl.find("select");d.ToolbarComboBox(c),this.comboBox=d.getComboBox()}},c.prototype._onToolbarDestroyed=function(a,b){this.toolbar==b&&this.removeTool()},c.prototype.removeTool=function(a){this.deleteControls&&this.deleteControls(),a&&this.drawer.off(this.drawer.EVENT_OPTIONS_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},c.prototype._onTextEditingEntered=function(a,b){b=b&&b.target;var c=b&&b.isEditing,d=!this.hideOnEditMode&&(this.showOnEditMode||c);d?this.showControls(!0,b):this.hideControls()},c.prototype._onTextEditingExited=function(a,b){var c=b&&b.target&&b.target.isEditing,d=this.hideOnEditMode&&!c;d?this.showControls():this.hideControls()},c.prototype._onDeactivateTool=function(){this.active=!1;var a=this.options&&this.options.alwaysVisible;a?this.showControls():this.hideControls()},c.prototype._onActivateTool=function(a,b){this.updateOnTool(b)},c.prototype.updateOnTool=function(a){var b=a.toolOptionsList&&-1!==a.toolOptionsList.indexOf(this.optionName),c=!this.showOnEditMode||a.isEditing,d=b&&c;d?(this.active=!0,this.showControls(),this.onActivateTool&&this.onActivateTool(a)):(this.active=!1,this.hideControls(a.forceOptionsHide))},c.prototype._onObjectSelected=function(a,b){var c=b.target,d=c.objectOptionsList&&-1!==c.objectOptionsList.indexOf(this.optionName),e=!this.showOnEditMode||c.isEditing,f=d&&e;f?(this.showControls(),this.updateControlsFromObject(c)):this.hideControls();

},c.prototype.onSelectionCleared=function(){},c.prototype._onSelectionCleared=function(){this.drawer.activeDrawingTool?this.updateOnTool(this.drawer.activeDrawingTool):this.hideControls(),this.onSelectionCleared()},c.prototype.collectDataFromObject=function(){var a={};return a},c.prototype.updateControls=function(){},c.prototype.updateControlsFromObject=function(a){this.collectDataFromObject(a),this.updateControls(this.data)},c.prototype.showControls=function(){},c.prototype.hideControls=function(){},b.BaseToolOptions=c}(jQuery,DrawerJs.plugins),function(a,b,c){"use strict";var d=function(a){c.call(this,a),this.drawer=a,this._setEventHandlers(),this._setGlobalClickHandler()};d.prototype=Object.create(c.prototype),d.prototype.constructor=c,d.prototype.buttonIconClass="",d.prototype.showOnEditMode=!0,d.prototype.hideOnEditMode=!1,d.prototype.focusTextOnChange=!1,d.prototype.onlyPredefined=!1,d.prototype.stylesToObject=!1,d.prototype.useCombobox=!0,d.prototype.buttonMode=!0,d.prototype.predefined={},d.prototype.valueType={},d.prototype.minValue=void 0,d.prototype.maxValue=void 0,d.prototype._setEventHandlers=function(){this.drawer.on(this.drawer.EVENT_TEXT_STYLES_CHANGED,this._onStylesChanged.bind(this)),this.drawer.on(this.drawer.EVENT_TEXT_GET_STYLES,this._onGetStyles.bind(this)),this._onObjectAdded&&this.drawer.on(this.drawer.EVENT_OBJECT_ADDED,this._onObjectAdded.bind(this))},d.prototype._onStylesChanged=function(a,b,c,d){this.updateControls(b,c,d)},d.prototype._onGetStyles=function(b,c,d){d=d||{},d.defaultValues=a.extend(!0,{},d.defaultValues||{},this.options.defaultValues||{})},d.prototype.updateControls=function(b,c,d){b=b||this._lastData||{},c=c||{},d=d||[];var e=this,f=this.$toolControl;if(f){var g=f.find(".controls-value-item");g.each(function(g,h){var i=a(h),j=i.is("input, select, textarea"),k=i.data("name"),l=e._defaultOptions.defaultValues[k],m=c[k],n=-1!==d.indexOf(k),o=void 0===b[k],p=void 0!==b[k]?b[k]:m||l;n&&(p=""),j&&i.val(p),e._updateClasses(o,o&&p===m,n),f.toggleClass("option-value-invalid",!!o),f.toggleClass("option-value-multiple",!!n),f.toggleClass("option-value-inherited",!(!o||p!==m));var q=o&&p===m?" option-value-inherited ":"",r=o?" option-value-invalid ":"",s=n?" option-value-multiple ":"",t=""+q+r+s;i.data("comboBox")?i.data("comboBox").updateSelectedValues(p,t):i.trigger("valueChanged",[{value:p,valueName:k,inherited:o||p===m,multipleValues:n,classString:t}]),e.updateSingleControl(k,p)})}},d.prototype._updateClasses=function(a,b,c){this.$toolControl.toggleClass("option-value-invalid",!!a),this.$toolControl.toggleClass("option-value-multiple",!!b),this.$toolControl.toggleClass("option-value-inherited",!!c)},d.prototype.updateSingleControl=function(){},d.prototype.setStyles=function(a){a=a||this._lastData||this.getStylesFromControls();var b=this.drawer.fCanvas.getActiveObject();if(b){var c=b.selectionEnd===b.selectionStart;if(c)this.drawer.setTemporaryStyles(a);else if(this.drawer.setTemporaryStyles(),this.stylesToObject)for(var d in a)b[d]=a[d];else b.setSelectionStyles(a);this._lastData=a,this.focusTextOnChange&&(this.comboBox&&this.comboBox.hideDropdown(),b.hiddenTextarea&&b.hiddenTextarea.focus()),b.canvas.renderAll()}},d.prototype.normalizeValue=function(a,b,c){var d,e=c?void 0:this.options.defaultSize,f=this.validateValue(a,b),g=!f;return d=g?e:a,this.minValue&&void 0!==this.minValue[b]&&(d=d<this.minValue[b]?this.minValue[b]:d),this.maxValue&&void 0!==this.maxValue[b]&&(d=d>this.maxValue[b]?this.maxValue[b]:d),d},d.prototype._attachEvents=function(){this.$toolControl&&this.$toolControl.on("input change toolbarOptionChange",this.onInputChange.bind(this))},d.prototype.generateControlHtml=function(){var a="";return this.controlTemplate&&(a="function"==typeof this.controlTemplate?this.controlTemplate():this.controlTemplate),a},d.prototype.createControls=function(b,c){this.changeCallback=c;var d=this.generateControlHtml();return this.$toolControl=a(d),b.addControl(this.$toolControl,this.options.buttonOrder),this.setupControl(b,this.$toolControl,c),this._attachEvents(),this.$toolControl},d.prototype.setupControl=function(){},d.prototype._collectDefaultOptions=function(){var b=this.drawer.getPluginConfig("Text"),c={predefined:a.extend(!0,{},b.predefined||{}),defaultValues:a.extend(!0,{},b.defaultValues||{})};return c},d.prototype._onOptionsSetup=function(a,b,c,d){b=b||{},a=a||{},c=c||{};var e,f,g,h;for(e in d.predefined)f=a.predefined&&a.predefined[e],g=c.predefined&&c.predefined[e],h=b.predefined&&b.predefined[e],d.predefined[e]=void 0!==h&&h!==!1?h:void 0!==g&&g!==!1?g:void 0!==f&&f!==!1?f:[];return d},d.prototype.onInputChange=function(a){var b;b=this.getStylesFromChangeEvent(a),b||this.getStylesFromControls(),this.setStyles(b),this._updateClasses()},d.prototype.getStylesFromChangeEvent=function(){},d.prototype.getStylesFromControls=function(){var b=this,c={},d=this.$toolControl;if(d){var e=d.find("input, select, textarea");e.each(function(d,e){var f=a(e),g=f.data("name"),h=f.val(),i=b.normalizeValue(h,g);void 0!==g&&void 0!==h&&(c[g]=i)})}return this._lastData=c,c},d.prototype.validateValue=function(a,b,c){var d,e=this.onlyPredefined&&this.predefined&&this.predefined[b],f=e&&-1!==this.predefined[b].indexOf(a);switch(this.valueType[b]){case"number":a=parseFloat(a),d="number"==typeof a&&isFinite(a);break;case"string":d="string"==typeof a;break;case"color":var g="string"==typeof a,h=a instanceof fabric.Color;d=c?h:g;break;default:d=void 0!==a}return d=e?d&&f:d},d.prototype.hideControls=function(){this.$toolControl&&this.$toolControl.addClass("hidden")},d.prototype.showControls=function(a,b){if(a){b=b||this.drawer.fCanvas.getActiveObject();var c=b.getSelectionStyles(),d=b.getObjStyles();this.updateControls(c,d)}this.$toolControl&&this.$toolControl.removeClass("hidden")},d.prototype.remove=function(){this.$toolControl&&this.$toolControl.remove()},d.prototype._setGlobalClickHandler=function(){var b=this,c=a("html");c.off("click.textOptionTool").on("click.textOptionTool",function(){b.hideControls()})},b.BaseTextOptionTool=d}(jQuery,DrawerJs.plugins,DrawerJs.plugins.BaseToolOptions,DrawerJs.util),function(a,b,c){"use strict";function d(a){var b=!1;if(a){var c=void 0!==a.naturalWidth&&0!==a.naturalWidth,d=void 0!==a.naturalHeight&&0!==a.naturalHeight,e=c&&d;b=e}return b}function e(a){var b=".editable-canvas-not-edited",d="background: url("+a+") !important;background-repeat: no-repeat !important;background-position: center !important;background-size: contain !important;";c.addStyleToStyleSheet(b,d,"#canvasInactiveImage",!0)}b.prototype.setInactiveDrawerImage=function(a){if(a){var b,f,g="string"==typeof a&&a.length,h=a instanceof Image,i=g||h,j=g?a:a.src;i&&(b=h&&a.complete&&d(a),b?e(j):c.loadImage(j,null,null,!0).then(function(a){f=d(a),f&&e(a.src)}))}}}(jQuery,DrawerJs.DrawerApi,DrawerJs.util),function(a,b,c,d){var e=function(a,c){b.call(this,a);var d=this;this.drawer=a,this.name="BackgroundImage",this.btnClass="btn-image",this.faClass="fa-image",this.tooltip=a.t("Insert a background image"),this._setupOptions(c);var e=-1!=["stretch","center","bottom-left","bottom-right","top-right"].indexOf(this.options.imagePosition);if(e)if(this.options.dynamicRepositionImage){var f,g=this.options.dynamicRepositionImageThrottle>0?parseInt(this.options.dynamicRepositionImageThrottle):0;f=g?this._throttle(this._repositionImage.bind(this),g):this._repositionImage.bind(this),this.drawerInstance.on(this.drawerInstance.EVENT_CANVAS_RESIZING,f)}else this.drawerInstance.on(this.drawerInstance.EVENT_CANVAS_STOP_RESIZE,this._repositionImage.bind(this));this.options.fixedBackgroundUrl&&this.drawerInstance.on(this.drawerInstance.EVENT_CANVAS_READY,function(){d.loadImageFromUrl(d.options.fixedBackgroundUrl,c,!0)})};e.prototype=Object.create(b.prototype),e.prototype.constructor=e,e.prototype._defaultOptions={cropIsActive:!0,maxImageSizeKb:5120,imagePosition:"stretch",dynamicRepositionImage:!0,dynamicRepositionImageThrottle:100,acceptedMIMETypes:["image/jpeg","image/png","image/gif"]},e.prototype._activateTool=function(){var a=this;this.drawerInstance.log("TOOL","BackgroundImageTool._activateTool()"),b.prototype._activateTool.call(this),this._showDialog(),d.setTimeout(function(){a.drawerInstance.trigger(a.drawerInstance.EVENT_DO_DEACTIVATE_TOOL,[a])},300)},e.prototype._showDialog=function(){var b=this.options.acceptedMIMETypes.join(",");$el=a('<input type="file" accept="'+b+'">'),$el.on("change",this._processFileInput.bind(this)),$el.click()},e.prototype._processFileInput=function(a){var b=this,c=a.target.files;if(c.length<1)return void b.drawerInstance.showError(this.drawerInstance.t("No file selected."));var d=c[0];if(this._checkFile(d)){var e=this.options.cropIsActive&&this.drawer._pluginsInstances.ImageCrop;e?this.readFile(d,this._triggerImageCrop.bind(this)):this.readFile(d,this.loadImageFromUrl.bind(this))}},e.prototype._triggerImageCrop=function(a){var b={url:a,callback:this.loadImageFromUrl.bind(this)};this.drawerInstance.trigger(this.drawerInstance.EVENT_IMAGE_CROP,b)},e.prototype.readFile=function(a,b){var c=this,d=new FileReader;d.onload=function(){c.drawerInstance.log("IMAGE LOADED:",a.name),b(d.result)},d.readAsDataURL(a)},e.prototype._checkFile=function(a){var b=this;if(a.type.indexOf("image")<0)return b.drawerInstance.showError(this.drawerInstance.t("Incorrect file type.")),!1;if(this.options.maxImageSizeKb>0&&a.size>1024*this.options.maxImageSizeKb){var c=this.drawerInstance.t("File is to big!. Maximum file size is ");return c=c+this.options.maxImageSizeKb+" KB",b.drawerInstance.showError(c),!1}return!0},e.prototype.loadImageFromUrl=function(a,b,c){var d=this,e=new Image;e.onload=function(){d.makeImageBackground(e,b)},c&&(e.onerror=function(){var a=d.drawerInstance.t("Image failed to create!");d.drawerInstance.showError(a)}),b.crossOrigin&&(e.crossOrigin=b.crossOrigin),e.src=a},e.prototype.makeImageBackground=function(a,b){var c=this.drawerInstance.fCanvas,d=new fabric.Image(a);b=b?b:this.options;var e=this._calcPositioningOptions(d,b.imagePosition);c.setBackgroundImage(d,function(){c.renderAll()},e)},e.prototype._calcPositioningOptions=function(a,b){var c=this.drawerInstance.fCanvas,d={};switch(b){case"stretch":d.left=0,d.top=0,d.width=c.width,d.height=c.height;break;case"center":d.originX="center",d.originY="center",d.left=c.getCenter().left,d.top=c.getCenter().top;break;case"top-left":d.left=0,d.top=0;break;case"top-right":d.left=c.width-a.width,d.top=0;break;case"bottom-left":d.left=0,d.top=c.height-a.height;break;case"bottom-right":d.left=c.width-a.width,d.top=c.height-a.height;break;case"default":d.left=0,d.top=0,d.width=c.width,d.height=c.height}return d},e.prototype._repositionImage=function(){var a=this.drawerInstance.fCanvas;if(a.backgroundImage){var b=a.backgroundImage,c={};switch(this.options.imagePosition){case"stretch":c.width=a.width,c.height=a.height;break;case"center":c.originX="center",c.originY="center",c.left=a.getCenter().left,c.top=a.getCenter().top;break;case"top-right":c.left=a.width-b.width,c.top=0;break;case"bottom-right":c.left=a.width-b.width,c.top=a.height-b.height;break;default:return}b.set(c),b.setCoords(),a.renderAll()}},e.prototype.createButton=function(a){this.options.fixedBackgroundUrl||b.prototype.createButton.call(this,a)},e.prototype._throttle=function(a,b){function c(){return g?(e=arguments,void(f=this)):(a.apply(this,arguments),g=!0,void d.setTimeout(function(){g=!1,e&&(c.apply(f,e),e=f=null)},b))}var e,f,g=!1;return c},c.BackgroundImage=e}(jQuery,DrawerJs.plugins.BaseTool,DrawerJs.plugins,DrawerJs.util),function(a){a.prototype.setBackgroundImageFromUrl=function(a,b){this.drawer.api.checkIsActive();var c=this.drawer.getPluginInstance("BackgroundImage");c.loadImageFromUrl(a,b)},a.prototype.setBackgroundImage=function(a,b){this.drawer.api.checkIsActive();var c=this.drawer.getPluginInstance("BackgroundImage");c.makeImageBackground(a,b)}}(DrawerJs.DrawerApi),function(a,b,c,d){var e=function(a,c){var e=this;if(b.call(e,a),this.name="SimpleWhiteEraser",this.btnClass="btn-simple-eraser",this.faClass="fa-eraser",this.tooltip=a.t("SimpleWhiteEraser"),e._defaultOptions={brushSize:3,cursorUrl:"eraser"},this._setupOptions(c),"eraser"==e.options.cursorUrl){var f=d.getDrawerFolderUrl();f&&(e.options.cursorUrl="url("+f+"assets/cursor-fa-eraser.cur), default")}this.previousColor=null,this.previousBrushSize=null,this.savedBrushSize=this.options.brushSize};e.prototype=Object.create(b.prototype),e.prototype.constructor=e,e.prototype.afterActivateTool=function(){this.previousColor=this.drawerInstance.fCanvas.freeDrawingBrush.color,this.drawerInstance.fCanvas.freeDrawingBrush.color="#fff",this.drawerInstance.fCanvas.freeDrawingBrush.fill="#fff",this.drawerInstance.fCanvas.freeDrawingBrush.opacity=this.drawerInstance.activeOpacity,this._previousCursor=this.drawerInstance.fCanvas.freeDrawingCursor,this.drawerInstance.fCanvas.freeDrawingCursor=this.options.cursorUrl,this.previousBrushSize=this.drawerInstance.freeDrawingBrushSize,this.drawerInstance.setFreeDrawingBrushSize(this.savedBrushSize)},e.prototype.afterDeactivateTool=function(){this.drawerInstance.fCanvas.freeDrawingCursor=this._previousCursor,this.drawerInstance.fCanvas.freeDrawingBrush.color=this.previousColor,this.drawerInstance.fCanvas.freeDrawingBrush.fill=this.previousColor,this.savedBrushSize=this.drawerInstance.freeDrawingBrushSize,this.drawerInstance.setFreeDrawingBrushSize(this.previousBrushSize)},c.SimpleWhiteEraser=e}(jQuery,DrawerJs.plugins.BaseBrush,DrawerJs.plugins,DrawerJs.util),function(a,b,c,d,e){"use strict";var f=e.mouseUp("Eraser"),g=e.mouseDown("Eraser"),h=e.mouseMove("Eraser"),i="mouseenter.EraserCursor",j="mouseleave.EraserCursor",k=function(a,b){var d=this;c.call(d,a),this.name="Eraser",this.btnClass="btn-eraser",this.faClass="fa-eraser",this.tooltip=a.t("Eraser"),this.separatePathOnShapes=!0,d._defaultOptions={cursorUrl:"none",brushSize:3,useCoordsQueue:!1},this._setupOptions(b),this.toolOptionsList=["brushSize"],this.forceOptionsHide=!0,this.previousColor=null,this.previousBrushSize=null,this.savedBrushSize=this.options.brushSize,this.erasingNow=!1,this.brush=null};k.prototype=Object.create(c.prototype),k.prototype.constructor=k,k.prototype.afterActivateTool=function(){var b=this.drawerInstance,c=b.fCanvas;this._previousCursor=b.fCanvas.freeDrawingCursor,b.fCanvas.freeDrawingCursor=this.options.cursorUrl,this.brush=this._createBrush(),b.setBrush(this.brush),b.on(b.EVENT_BRUSH_SIZE_CHANGED,this._updateCursorShapeSize.bind(this)),a(c.upperCanvasEl).on(h,this._onMouseMove.bind(this)),a(c.upperCanvasEl).on(g,this._onMouseDown.bind(this)),a(c.upperCanvasEl).on(f,this._onMouseUp.bind(this)),this._createEraserCursorShape(),a(c.upperCanvasEl).on(i,this._showEraserCursorShape.bind(this)),a(c.upperCanvasEl).on(j,this._hideEraserCursorShape.bind(this)),c.on("path:created",this._onEraserPathCreated.bind(this))},k.prototype.afterDeactivateTool=function(){var b=this.drawerInstance.fCanvas;this.erasingNow=!1,b.off("path:created"),b.freeDrawingCursor=this._previousCursor,this._removeEraserCursorShape(),a(b.upperCanvasEl).off(h),a(b.upperCanvasEl).off(f),a(b.upperCanvasEl).off(g),a(b.upperCanvasEl).off(i),a(b.upperCanvasEl).off(j)},k.prototype._createBrush=function(){var a=new b.EraserBrush(this.drawerInstance.fCanvas);return a.color="#fff",a.opacity=this.drawerInstance.activeOpacity,a.width=this.options.brushSize,a},k.prototype._createEraserCursorShape=function(){var a=this.drawerInstance.getBrushSize()/2;this.eraserCursorShape=new fabric.PCircle({radius:a}),this.drawerInstance.fCanvas.add(this.eraserCursorShape),this.eraserCursorShape.isEraserBrush=!0,this.eraserCursorShape.set("fill","transparent"),this.eraserCursorShape.set("stroke","black"),this.eraserCursorShape.set("strokeWidth",1),this.eraserCursorShape.set("originX","center"),this.eraserCursorShape.set("originY","center"),this._updateCursorShapeSize()},k.prototype._removeEraserCursorShape=function(){this.eraserCursorShape&&(this.eraserCursorShape.remove(),delete this.eraserCursorShape)},k.prototype._showEraserCursorShape=function(){this.eraserCursorShape.set("visible",!0),this.drawerInstance.fCanvas.renderAll()},k.prototype._hideEraserCursorShape=function(){this.eraserCursorShape.set("visible",!1),this.drawerInstance.fCanvas.renderAll()},k.prototype._updateCursorShapeSize=function(){if(this.eraserCursorShape){var a=this.drawerInstance.getBrushSize()/2,b=2*Math.PI*a/20;this.eraserCursorShape.set("radius",a),this.eraserCursorShape.set("strokeDashArray",[b,b])}},k.prototype._onEraserPathCreated=function(a){var b=this.drawerInstance.fCanvas;a.path.set("eraserPath",!0),a.path.set("visible",!0);for(var c=0;c<this.affectedShapes.length;c++){var d=this.affectedShapes[c];delete d.eraserAffected,d.addEraserPath(a.path)}b.renderAll()},k.prototype._affectShapesUnderCoords=function(a,b){var c=this.drawerInstance.fCanvas,d=c.getObjects();this.eraserCursorShape._lastCenterPosition={x:a,y:b};for(var e=0;e<d.length;e++){var f=d[e];if(f.isErasable&&!f.eraserAffected&&!f.isEraserBrush){var g=this._checkObjectIntersection(f,a,b);g&&(f.eraserAffected=!0,this.affectedShapes.push(f))}}},k.prototype._checkObjectIntersection=function(a,b,c){var d,e,f,g=this.eraserCursorShape,h=g.intersectsWithObject(a);if(h&&(e=!a.canvas.isTargetTransparent(a,b,c),!e)){var i=g._lastCenterPosition?b-g._lastCenterPosition.x:void 0,j=g._lastCenterPosition?c-g._lastCenterPosition.y:void 0,k=g.getPerimeterPoints(i,j);k.forEach(function(b){f||(f=!a.canvas.isTargetTransparent(a,b.x,b.y))})}return d=e||f},k.prototype._onMouseDown=function(a){var b=3===a.which,c=2===a.which;b||c||(this.affectedShapes=[],this.erasingNow=!0)},k.prototype._onMouseUp=function(){this.erasingNow=!1,this.drawerInstance.fCanvas.renderAll()},k.prototype._onMouseMove=function(a){var b=this.drawer.fCanvas.getPointer(a),c=b.x,d=b.y;this.eraserCursorShape&&(this.eraserCursorShape.set("left",b.x),this.eraserCursorShape.set("top",b.y),this.eraserCursorShape.setCoords(),this.drawerInstance.fCanvas.renderAll()),this.erasingNow&&this.separatePathOnShapes&&this._affectShapesUnderCoords(c,d)},d.Eraser=k}(jQuery,DrawerJs.brushes,DrawerJs.plugins.BaseBrush,DrawerJs.plugins,DrawerJs.util),function(a){a.EraserBrush=fabric.util.createClass(fabric.PencilBrush,{initialize:function(a){this.callSuper("initialize",a)},_render:function(){this.canvas.fire("pencil:move:before"),this.callSuper("_render"),this.canvas.fire("pencil:move:after")},createPath:function(a){var b=new fabric.EraserPath(a,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,b.setShadow(this.shadow)),b}})}(DrawerJs.brushes),function(){"use strict";fabric.EraserPath=fabric.util.createClass(fabric.Path,{type:"EraserPath",objectCaching:!1,evented:!1,selectable:!1,initialize:function(a,b){b=b||{},this.polygonOffsetX=b.polygonOffsetX||null,this.polygonOffsetY=b.polygonOffsetY||null,this.callSuper("initialize",a,b)},toString:function(){return"#<fabric.EraserPath ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(a){var b=fabric.util.object.extend(this.callSuper("toObject",a),{path:this.path.map(function(a){return a.slice()}),pathOffset:this.pathOffset});return this.sourcePath&&(b.sourcePath=this.sourcePath),this.transformMatrix&&(b.transformMatrix=this.transformMatrix),this.polygonOffsetX&&this.polygonOffsetY&&(b.polygonOffsetX=this.polygonOffsetX,b.polygonOffsetY=this.polygonOffsetY),b}}),fabric.EraserPath.fromObject=function(a,b){"string"==typeof a.path?fabric.loadSVGFromURL(a.path,function(c){var d=c[0],e=a.path;delete a.path,fabric.util.object.extend(d,a),d.setSourcePath(e),b(d)}):b(new fabric.EraserPath(a.path,a))},fabric.EraserPath.async=!0}("undefined"!=typeof exports?exports:this),function(a,b,c,d){"use strict";var e=function(a,c){var e=this;if(b.call(e,a),this.name="Pencil",this.toolOptionsList=["color","opacity","brushSize"],this.btnClass="btn-pencil",this.faClass="fa-pencil",this.tooltip=a.t("Free drawing mode"),e._defaultOptions={cursorUrl:"pencil",brushSize:2},this._setupOptions(c),"pencil"==e.options.cursorUrl){var f=d.getDrawerFolderUrl();f&&(e.options.cursorUrl="url("+f+"assets/cursor-fa-pencil.cur), default")}};e.prototype=Object.create(b.prototype),e.prototype.constructor=e,e.prototype.createBrush=function(){var a=new fabric.ErasablePencilBrush(this.drawerInstance.fCanvas);return a.color=this.drawerInstance.activeColor,a.opacity=this.drawerInstance.activeOpacity,a.width=this.options.brushSize,a},e.prototype.afterActivateTool=function(){var a=this.drawerInstance.fCanvas;this._previousCursor=a.freeDrawingCursor,a.freeDrawingCursor=this.options.cursorUrl},e.prototype.afterDeactivateTool=function(){var a=this.drawerInstance.fCanvas;a.freeDrawingCursor=this._previousCursor},c.Pencil=e}(jQuery,DrawerJs.plugins.BaseBrush,DrawerJs.plugins,DrawerJs.util),function(a,b){"use strict";var c=function(a,b){var c=this;return a.redactorInstance?(this.drawerInstance=a,this.drawer=a,this.name="DrawerPluginCanvasProperties",this.LOGTAG=c.name,this._setupOptions(b),void c.drawerInstance.on(c.drawerInstance.EVENT_CONFIG_TOOLBAR_CREATED,function(b,d){var e=c.drawerInstance.redactorInstance,f='<section id="redactor-drawer-properties"><label class="drawer-properties-size-label">'+a.t("Size (px)")+'</label><input class="drawer-properties-width" type="number" value="'+a.width+'" /><span class="size-separator">x</span><input class="drawer-properties-height" type="number" value="'+a.height+'"/><label class="drawer-properties-align-label">'+a.t("Position")+'</label><select class="drawer-properties-align"><option value="inline">'+a.t("Inline")+'</option><option value="left">'+a.t("Left")+'</option><option value="center">'+a.t("Center")+'</option><option value="right">'+a.t("Right")+'</option><option value="floating">'+a.t("Floating")+'</option></select><span class="group-transparency"><label class="drawer-properties-background">'+a.t("Background")+'</label><input type="checkbox" id="background-transparency" class="background-transparency"/><label for="background-transparency" class="background-transparency">'+a.t("transparent")+"</label></span></section>";e.modal.addTemplate("drawer-properties",f);var g=function(){return c.openPopup(),!1},h={buttonOrder:9,additionalClass:"btn-canvas-properties",iconClass:"fa-cog",tooltipText:a.t("Canvas properties"),clickHandler:g};d.addButton(h)})):void console.error("'CanvasProperties' plugin can work only in redactor mode!")};c.prototype._setupOptions=function(b,c,d){c=c||this.name;var e=this.drawerInstance||this.drawer,f=e&&e.getPluginConfig(c),g=a.extend(!0,{},this._defaultOptions||{},f||{},b||{});return d||(this.options=g),g},c.prototype.openPopup=function(){function b(){var a=g.find(".drawer-properties-align").val();"floating"==a?g.find(".group-transparency").show():g.find(".group-transparency").hide()}{var c=this,d=c.drawerInstance.redactorInstance,e=c.drawerInstance;c.drawerInstance.$imageElement}d.modal.load("drawer-properties",e.t("Canvas properties"),260),d.modal.createCancelButton(),a(".redactor-modal-close-btn").html(e.t("Cancel"));var f=d.modal.createActionButton(e.t("Save")),g=a("#redactor-drawer-properties"),h=e.getAlign();g.find("select").val(h),g.find(".drawer-properties-width").val(e.width),g.find(".drawer-properties-height").val(e.height),c.currentAlign=h,c.currentHeight=e.height,c.currentWidth=e.width,c.$backgroundTransparencyInput=g.find("input.background-transparency"),c.$backgroundTransparencyInput.attr("checked",e.options.transparentBackground),g.find(".background-transparency").click(function(){var a=c.$backgroundTransparencyInput.attr("checked");c.$backgroundTransparencyInput.attr("checked",!a)}),f.on("click",function(){c.saveProperties()});var i=g.find(".drawer-properties-align");b(),i.change(function(){b()}),d.modal.show(),a(document.body).css("overflow",d.modal.bodyOveflow)},c.prototype.saveProperties=function(){var b=this,c=b.drawerInstance.redactorInstance,d=b.drawerInstance,e=b.drawerInstance.getPluginInstance("Fullscreen"),f=a("#redactor-drawer-properties"),g=f.find("input.drawer-properties-width").val(),h=f.find("input.drawer-properties-height").val(),i=f.find("select.drawer-properties-align option:selected").val();(b.currentWidth!=g||b.currentHeight!=h)&&(e&&e.isInFullscreenMode()&&e.exitFullscreen(),d.setSize(g,h)),d.options.align=i,b.currentAlign!=i&&(e&&e.isInFullscreenMode()&&e.exitFullscreen(),d.setAlign(i));var j=b.$backgroundTransparencyInput.attr("checked");d.options.transparentBackground=!!j,c.modal.close(),d.onCanvasModified(),d.trigger(d.EVENT_OPTIONS_CHANGED)},b.CanvasProperties=c}(jQuery,DrawerJs.plugins),function(a,b){"use strict";var c=function(a,b){this.drawer=a,this.name="CloseButton",this._setupOptions(b),this._bindedOnToolbarCreated=this._onToolbarCreated.bind(this),a.on(a.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated),a.on(a.EVENT_MINIMIZED_TOOLBAR_CREATED,this._bindedOnToolbarCreated)};c.prototype._defaultOptions={buttonOrder:1},c.prototype._setupOptions=function(b,c,d){c=c||this.name;var e=this.drawerInstance||this.drawer,f=e&&e.getPluginConfig(c),g=a.extend(!0,{},this._defaultOptions||{},f||{},b||{});return d||(this.options=g),g},c.prototype._onToolbarCreated=function(a,b){this.toolbar=b,this.createControls&&this.createControls(b)},c.prototype.createControls=function(a){this._createAndAddButton(a)},c.prototype.removeTool=function(a){this.deleteControls&&this.deleteControls(),a&&this.drawer.off(this.drawer.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},c.prototype._createAndAddButton=function(a){var b={buttonOrder:this.options.buttonOrder,additionalClass:"btn-delete-canvas",iconClass:"fa-times",tooltipText:this.drawer.t("Delete this canvas"),clickHandler:this._onCloseButtonClick.bind(this)};a.addButton(b)},c.prototype._onCloseButtonClick=function(){var a=this,b=a.drawer.t("Are you sure want to delete this canvas?");confirm(b)&&a.drawer.destroy()},b.CloseButton=c}(jQuery,DrawerJs.plugins,DrawerJs.util),function(a,b,c){"use strict";var d=function(b,c){var d=this;d.drawer=b,d.LOGTAG=d.name,d._setupOptions(c),d.previousWidth=null,d.previousHeight=null,d.previousOffset=null,d.$enterButton=null,d.$exitButton=null,d.onlyForEditing=!1,this._bindedOnToolbarCreated=this._onToolbarCreated.bind(this),b.on(b.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated),d.drawer.on(d.drawer.EVENT_EDIT_START,function(){var a=d.drawer.$imageElement.attr("data-before-fullscreen");a?(d.$enterButton.hide(),d.$exitButton.show()):(d.$enterButton.show(),d.$exitButton.hide())}),d.drawer.on(d.drawer.EVENT_EDIT_STOP,function(){d.onlyForEditing&&d.exitFullscreen()}),a(window).on("resize",function(){d.isInFullscreenMode()&&d.adjustFullscreenSize()})};d.prototype._setupOptions=function(b,c,d){c=c||this.name;var e=this.drawerInstance||this.drawer,f=e&&e.getPluginConfig(c),g=a.extend(!0,{},this._defaultOptions||{},f||{},b||{});return d||(this.options=g),g},d.prototype._onToolbarCreated=function(a,b){this.toolbar=b;var c={buttonOrder:this.options.buttonOrder,additionalClass:"btn-fullscreen",iconClass:"fa-expand",tooltipText:this.drawer.t("Enter fullscreen mode"),clickHandler:this.enterFullscreen.bind(this)},d={buttonOrder:this.options.buttonOrder,additionalClass:"btn-fullscreen",iconClass:"fa-compress",tooltipText:this.drawer.t("Exit fullscreen mode"),clickHandler:this.exitFullscreen.bind(this)};this.$enterButton=b.addButton(c),this.$exitButton=b.addButton(d),this.$exitButton.hide()},d.prototype.removeTool=function(a){this.deleteControls&&this.deleteControls(),a&&this.drawer.off(this.drawer.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},d.prototype.isInFullscreenMode=function(){var a=this.drawer.$imageElement;return void 0!==a.attr("data-before-fullscreen")?!0:!1},d.prototype.adjustFullscreenSize=function(){var a=this,b=a.drawer.redactorInstance,c=a.drawer.$imageElement,d=a.drawer.options.toolbarSize,e=b.$box.width()-d,f=b.$box.height()-d,g=b.$box.offset();a.drawer.$canvasEditContainer.css({left:g.left+"px",top:g.top+d+"px",width:e+"px",height:f+"px"}),a.drawer.fCanvas.setWidth(e),a.drawer.fCanvas.setHeight(f),a.onlyForEditing||c.css({position:"absolute",left:"0px",top:"0px",width:e+"px",height:f+"px"})},d.prototype.enterFullscreen=function(){{var a=this,b=a.drawer.redactorInstance,d=a.drawer.$imageElement;a.drawer.options.toolbarSize}if(a.$enterButton.hide(),a.$exitButton.show(),d.attr("data-before-fullscreen",JSON.stringify({imageCss:{position:d.css("position"),display:d.css("display"),left:d.css("float"),top:d.css("top"),"margin-left":d.css("margin-left"),"margin-right":d.css("margin-right"),width:d.css("width"),height:d.css("height")},canvasCss:{width:a.drawer.width,height:a.drawer.height,offset:a.drawer.$canvasEditContainer.offset()}})),this.onlyForEditing||d.css("position","absolute"),a.adjustFullscreenSize(),this.onlyForEditing){var e=c.getTransitionDuration(a.drawer.$canvasEditContainer[0]);c.setTimeout(function(){b.$box.css("opacity","0")},e)}a.drawer.toolbars.toolOptionsToolbar.removeClass("toolbar-bottomLeft").detach(),a.drawer.appendToolbar(a.drawer.toolbars.toolOptionsToolbar,"topRight"),a.drawer.toolbars.setToolbarButtonsSize(),a.drawer.onCanvasModified()},d.prototype.exitFullscreen=function(){var b=this,d=b.drawer.$imageElement;a(".editable-canvas-tooltip").removeClass("active"),b.$enterButton.show(),b.$exitButton.hide();var e=d.attr("data-before-fullscreen"),f=JSON.parse(e);if(d.attr("data-before-fullscreen",null),this.onlyForEditing?b.drawer.redactorInstance.$box.css("opacity","1"):d.css(f.imageCss),b.drawer.$canvasEditContainer){var g=c.getTransitionDuration(b.drawer.$canvasEditContainer[0]),h=f.canvasCss.width,i=f.canvasCss.height;b.drawer.$canvasEditContainer.css({left:f.canvasCss.offset.left+"px",top:f.canvasCss.offset.top+"px",width:h+"px",height:i+"px"}),b.drawer.$canvasEditContainer.find(".canvas-container").css({width:h+"px",height:i+"px"}),c.setTimeout(function(){b.drawer.fCanvas.setWidth(h),b.drawer.fCanvas.setHeight(i)},g),b.drawer.width=h,b.drawer.height=i,b.drawer.adjustEditContainer(!0,!0)}b.drawer.toolbars.toolOptionsToolbar.removeClass("toolbar-topRight").detach(),b.drawer.appendToolbar(b.drawer.toolbars.toolOptionsToolbar,"bottomLeft"),b.drawer.toolbars.setToolbarButtonsSize(),b.drawer.onCanvasModified()},b.Fullscreen=d}(jQuery,DrawerJs.plugins,DrawerJs.util),function(a,b,c,d){"use strict";var e,f=c.checkBrowser("mozilla"),g=c.checkBrowser("safari"),h=c.checkBrowser("webkit"),i=function(a,b){this.name="FullscreenModeButton",this.drawer=a,e=this.drawer.touchDevice,this._setupOptions(b),this._attachEvents(),this._setupFullscreenHandlers(),this.drawer.on(this.drawer.EVENT_CONFIG_TOOLBAR_CREATED,this._onConfigToolbarCreated.bind(this))};i.prototype._attachEvents=function(){var b=this,d="onfullscreenchange.FullscreenModeButton webkitfullscreenchange.FullscreenModeButton fullscreenchange.FullscreenModeButton mozfullscreenchange.FullscreenModeButton MSFullscreenChange.FullscreenModeButton ";a(document).off(d).on(d,function(){b.globalFullscreenMode=!b.globalFullscreenMode,b.reactOnResize=!0,c.setTimeout(function(){b.reactOnResize=!1},2e3),b.globalFullscreenMode?b.setFullscreenStateOn(!0):b.setFullscreenStateOff(!0)}),window.removeEventListener("resize",b._onWindowResize.bind(b)),window.addEventListener("resize",b._onWindowResize.bind(b)),a(document).off("keypress.FullscreenModeButton").on("keypress.FullscreenModeButton",function(a){var c=b.globalFullscreenMode&&b.fullscreenMode,d=27==a.keyCode,e=c&&d;e&&b.fullscreenOff(!0)})},i.prototype._setupOptions=function(b,c,d){c=c||this.name;var e=this.drawerInstance||this.drawer,f=e&&e.getPluginConfig(c),g=a.extend(!0,{},this._defaultOptions||{},f||{},b||{});return d||(this.options=g),g},i.prototype._onWindowResize=function(){var a=this;!f||a.reactOnResize||a.globalFullscreenMode||a._saveCurrentSizes(),
a.reactOnResize&&(a.globalFullscreenMode?a._refreshFullscreenSize(!1):a._restoreNormalSizes());var b=!1,c=!a.fullscreenMode&&a.reactOnResize&&f&&!a.globalFullscreenMode,d=a.fullscreenMode&&!a.globalFullscreenMode&&h,e=b||c||d;e&&a.setFullscreenStateOff(),a.reactOnResize=!1},i.prototype._saveCurrentSizes=function(a,b){a&&b||(a=this.drawer.$canvasEditContainer.outerWidth(),b=this.drawer.$canvasEditContainer.outerHeight()),this.savedWidth=a,this.savedHeight=b},i.prototype._refreshFullscreenSize=function(b){var c=a(window),d=c.width(),e=c.height(),f=this.drawer.width,g=this.drawer.height,h=this.drawer.$canvasEditContainer,i=h.hasClass("animated");b&&this._saveCurrentSizes(f,g),h.removeClass("animated"),this.drawer.setSize(d,e),this.drawer.trigger(this.drawer.EVENT_RESTORE_DEFAULT_ZOOM),h.toggleClass("animated",!!i)},i.prototype._restoreNormalSizes=function(){var a=this,b=this.drawer.$canvasEditContainer,d=b.hasClass("animated");b.removeClass("animated"),b.css("position",this.savedPosition),console.info(this.savedWidth,this.savedHeight),this.drawer.setSize(this.savedWidth,this.savedHeight),c.setTimeout(function(){a.drawer.adjustEditContainer(),a.drawer.trigger(a.drawer.EVENT_RESTORE_DEFAULT_ZOOM),c.setTimeout(function(){b.toggleClass("animated",!!d)},0)},0)},i.prototype._setupFullscreenHandlers=function(){var a,b=document.documentElement,c=function(){b.requestFullScreen()},d=b.requestFullScreen&&c,e=function(){b.msRequestFullscreen()},f=b.msRequestFullscreen&&e,g=function(){b.mozRequestFullScreen()},h=b.mozRequestFullScreen&&g,i=function(){b.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)},j=b.webkitRequestFullScreen&&i;this.fullscreenRequest=d||f||h||j||this.setFullscreenStateOn.bind(this),a=document.cancelFullScreen||document.msExitFullscreen||document.mozCancelFullScreen||document.webkitCancelFullScreen||this.setFullscreenStateOff.bind(this),this.fullscreenCancel=function(){a.call(document)}},i.prototype._onConfigToolbarCreated=function(a,b){this.fullscreenEl=this.drawer.$canvasEditContainer.get(0),this._createAndAddButton(b)},i.prototype.removeTool=function(a){this.deleteControls&&this.deleteControls(),a&&this.drawer.off(this.drawer.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},i.prototype._createAndAddButton=function(a){var b={buttonOrder:10,additionalClass:"btn-fullscreen-canvas",iconClass:"fa-window-restore",tooltipText:this.drawer.t("Toggle fullscreen mode"),clickHandler:this._onFullscreenModeButtonClick.bind(this)},c=a.addButton(b);this.$fullscreenModeButton=c},i.prototype._toggleFullScreen=function(a){var b=document.fullScreenElement&&null!==document.fullScreenElement,c=!document.mozFullScreen&&!document.webkitIsFullScreen,d=b||c,e=a===!1||!a&&d;e?this.fullscreenRequest():this.fullscreenCancel()},i.prototype._onFullscreenModeButtonClick=function(){this.fullscreenMode?this.fullscreenOff():this.fullscreenOn()},i.prototype.setFullscreenStateOff=function(){var a=this.drawer.$canvasEditContainer||this.drawer.$canvasEditContainer.length,b=a;if(this.changeStateInProgress=!0,b){this.drawer.trigger(this.drawer.EVENT_DO_DEACTIVATE_ALL_TOOLS),this.drawer.trigger(this.drawer.EVENT_DESTROY_TOOLTIPS);var d=this,e=this.drawer.$canvasEditContainer,f=e.hasClass("animated");this.fullscreenMode=!1,this.drawer.fullscreenMode=!1,e.addClass("fullscreen-in-progress"),e.removeClass("animated"),e.removeClass("fullscreen"),this.drawer.$imageElement.show(),this._restoreNormalSizes(),c.setTimeout(function(){d.drawer.toolbars.resetAllToolbars(),d.$fullscreenModeButton&&d.$fullscreenModeButton.removeClass("active"),g&&d._restoreNormalSizes(),e.toggleClass("animated",!!f),e.removeClass("fullscreen-in-progress"),d.changeStateInProgress=!1},0)}},i.prototype.setFullscreenStateOn=function(){this.changeStateInProgress=!0;var a=this.drawer.$canvasEditContainer||this.drawer.$canvasEditContainer.length,b=a;if(b){this.drawer.trigger(this.drawer.EVENT_DO_DEACTIVATE_ALL_TOOLS),this.drawer.trigger(this.drawer.EVENT_DESTROY_TOOLTIPS);var d=this,e=this.drawer.$canvasEditContainer,g=e.hasClass("animated");this.fullscreenMode=!0,this.drawer.fullscreenMode=!0,this.savedPosition=e.css("position"),e.addClass("fullscreen-in-progress"),e.removeClass("animated"),e.addClass("fullscreen"),this.drawer.$imageElement.hide(),d._refreshFullscreenSize(!f),c.setTimeout(function(){d.drawer.toolbars.resetAllToolbars(),d.drawer.toolbars.settingsToolbar.$toolbar.parent().addClass("fullscreenOverOther"),d.$fullscreenModeButton&&d.$fullscreenModeButton.addClass("active"),e.toggleClass("animated",!!g),e.removeClass("fullscreen-in-progress"),d.changeStateInProgress=!1},50)}},i.prototype.fullscreenOn=function(){this._toggleFullScreen(!1)},i.prototype.fullscreenOff=function(){this._toggleFullScreen(!0)},d.prototype.fullscreenOn=function(){var a=this.drawer.getPluginInstance("FullscreenModeButton");a.fullscreenOn()},d.prototype.fullscreenOff=function(){var a=this.drawer.getPluginInstance("FullscreenModeButton");a.fullscreenOff()},b.FullscreenModeButton=i}(jQuery,DrawerJs.plugins,DrawerJs.util,DrawerJs.DrawerApi),function(a,b){"use strict";var c=function(a,b){this.name="ImageCrop",this.drawer=a,this._setupOptions(b),this.drawer.on(this.drawer.BEFORE_CREATE_TOOLBARS,this._init.bind(this)),this.drawer.on(this.drawer.EVENT_IMAGECROP_TOOLBAR_CREATED,this._onToolbarCreated.bind(this)),this.drawer.on(this.drawer.EVENT_IMAGE_CROP,this._onImageCropTrigger.bind(this))};c.prototype._defaultOptions={toolbarState:"hidden"},c.prototype._defaultCropOptions={},c.prototype._init=function(){if(this.enabled=this.drawer.options.enableImageCrop&&b.ImageCropPlugin,this.enabled){var a=this._setupCropOptions();this._removeElements(),this._createElements(),this.cropper=new b.ImageCropPlugin(this.drawer,this.$cropperContainer,a)}},c.prototype._setupOptions=function(b,c,d){c=c||this.name;var e=this.drawerInstance||this.drawer,f=e&&e.getPluginConfig(c),g=a.extend(!0,{},this._defaultOptions||{},f||{},b||{});return d||(this.options=g),g},c.prototype._onToolbarCreated=function(a,b){this.cropContainerSizesUpdated=!1,this.$toolbar=b.$toolbar,this._resizeCropWrapper(),this._createToolbarButtons(b)},c.prototype._createToolbarButtons=function(a){var b,c,d,e,f,g={buttonOrder:this.options.buttonOrder,additionalClass:"btn-another-crop",iconClass:"fa-scissors",tooltipText:this.drawer.t("Crop image"),clickHandler:this._onAnotherCropButtonClick.bind(this)},h={buttonOrder:this.options.buttonOrder,additionalClass:"btn-apply-crop",iconClass:"fa-check",tooltipText:this.drawer.t("Apply current image"),clickHandler:this._onApplyCropButtonClick.bind(this)},i={buttonOrder:this.options.buttonOrder,additionalClass:"btn-undo-crop",iconClass:"fa-undo",tooltipText:this.drawer.t("Undo crop"),clickHandler:this._onUndoCropButtonClick.bind(this)},j=({buttonOrder:this.options.buttonOrder,additionalClass:"btn-useorigin-crop",iconClass:"fa-image",tooltipText:this.drawer.t("Use origin image"),clickHandler:this._onUseOriginButtonClick.bind(this)},{buttonOrder:this.options.buttonOrder,additionalClass:"btn-cancel-crop",iconClass:"fa-ban",tooltipText:this.drawer.t("Cancel"),clickHandler:this._onCancelCropButtonClick.bind(this)});b=a.addButton(g),c=a.addButton(h),d=a.addButton(i),f=a.addButton(j),this.$anotherCropButton=b,this.$applyButton=c,this.$undoCropButton=d,this.$useOriginButton=e,this.$cancelButton=f},c.prototype._onAnotherCropButtonClick=function(){this.cropper.applyCrop(!0),this.$undoCropButton.removeClass("disabled")},c.prototype._onApplyCropButtonClick=function(){this.cropper.applyCrop()},c.prototype._onUndoCropButtonClick=function(){var a=this.cropper,b=a.prevImages&&a.prevImages.length;b&&(a.undoCrop(!0),a.prevImages.length||this.$undoCropButton.addClass("disabled"))},c.prototype._onUseOriginButtonClick=function(){var a=this.cropper;a.success(a.originalImage)},c.prototype._onCancelCropButtonClick=function(){this.cropper.success()},c.prototype._resizeCropWrapper=function(){var a=this.drawer.toolbars.cropImageToolbar,b=a&&a.$toolbar&&a.$toolbar.height(),c=this.cropper&&this.cropper.$element;c&&c.css("top",b||0),b&&b>0&&(this.cropContainerSizesUpdated=!0)},c.prototype._getCropCallback=function(a){var b=this;return function(c){a&&"function"==typeof a&&a(c),b.hideCropper(),b.hideCropToolbar(),b.cropper.reset()}},c.prototype._onImageCropTrigger=function(a,b){if(this.enabled){var c=b&&b.url;if(b.newImage=!0,c){var d=this._getCropCallback(b.callback);this.showCropToolbar(),this.showCropper(),this.cropper._bind(b,d)}}},c.prototype._setupCropOptions=function(b){var c={};a.extend(!0,c,this._defaultCropOptions,b||{}),this.cropOptions=c},c.prototype._createElements=function(){var b,c=!0,d='<div class="image-crop-wrapper hidden"></div>',e=a(d);b=c?this.drawer.$canvasEditContainer:a("body"),b.append(e),this.drawer.$cropperContainer=e,this.$cropperContainer=e},c.prototype._removeElements=function(){this.$cropperContainer&&(this.$cropperContainer.remove(),delete this.$cropperContainer),this.drawer.$cropperContainer&&delete this.drawer.$cropperContainer,this.cropper&&(this.cropper._destroy(),delete this.cropper)},c.prototype.showCropToolbar=function(){this.$undoCropButton.addClass("disabled"),this.drawer.trigger(this.drawer.EVENT_RESIZER_HIDE),this.drawer.trigger(this.drawer.EVENT_TOOLBAR_CHANGE_STATE,[{excludeElements:this.$toolbar,state:this.options.toolbarState,turnOn:!0}]),this.drawer.trigger(this.drawer.EVENT_OVERCANVAS_BUTTON_HIDE,[!0]),this.drawer.toolbars.cropImageToolbar.showToolbar(),this.cropContainerSizesUpdated||this._resizeCropWrapper()},c.prototype.hideCropToolbar=function(){this.drawer.toolbars.cropImageToolbar.hideToolbar(),this.drawer.trigger(this.drawer.EVENT_RESIZER_SHOW),this.drawer.trigger(this.drawer.EVENT_TOOLBAR_CLEAR_STATE),this.drawer.trigger(this.drawer.EVENT_OVERCANVAS_BUTTON_SHOW)},c.prototype.showCropper=function(){this.$cropperContainer&&this.$cropperContainer.length&&this.$cropperContainer.removeClass("hidden")},c.prototype.hideCropper=function(){this.$cropperContainer&&this.$cropperContainer.length&&this.$cropperContainer.addClass("hidden")},b.ImageCrop=c}(jQuery,DrawerJs.plugins,DrawerJs.util),function(a,b,c){"use strict";function d(a){if(a in m)return a;for(var b=a[0].toUpperCase()+a.slice(1),c=l.length;c--;)if(a=l[c]+b,a in m)return a}var e,f,g,h=c.mouseDown("drawerJsCrop"),i=c.mouseUp("drawerJsCrop"),j=c.mouseMove("drawerJsCrop"),k=function(){},l=["Webkit","Moz","ms"],m=document.createElement("div").style;f=d("transform"),e=d("transformOrigin"),g=d("userSelect");var n=function(b,c,d){return this.name="ImageCropPlugin",this.drawer=b,this.$element=c,this._resetData(),this.options=a.extend(!0,{},this._defaultOptions,d||{}),this._init(),this};n.prototype._defaultOptions={boundary:{},enableExif:!1,minSize:10,enableOrientation:!1,update:k,controlsCss:{},controlsTouchCss:{}},n.prototype.globals={translate:"translate3d"},n.prototype._bind=function(b,d){var e=d&&"function"==typeof d;this.data="string"==typeof b?{url:b}:a.extend(!0,{},b||{}),this._resetData(),this.successCallback=e?d:this.successCallback||k,this.data&&this.data.newImage&&(this.originalImage=this.data.url,this.prevImages=[]),this.currentImage=this.data.url,this.elements.$fullsizePreview.attr("src",this.data.url);var f=c.loadImage(this.data.url,this.elements.$img.get(0),this.data).then(this.startCropping.bind(this));return f},n.prototype._getCanvas=function(a){var b=a.points,c=parseInt(b[0],10),d=parseInt(b[1],10),e=parseInt(b[2],10),f=parseInt(b[3],10),g=e-c,h=f-d,i=document.createElement("canvas"),j=i.getContext("2d"),k=g,l=h,m=0,n=0,o=k,p=l,q=a.outputWidth&&a.outputHeight,r=1;return!r&&q&&(o=a.outputWidth,p=a.outputHeight,r=o/k),i.width=o,i.height=p,a.backgroundColor&&(j.fillStyle=a.backgroundColor,j.fillRect(0,0,k,l)),0>c&&(m=Math.abs(c),c=0),0>d&&(n=Math.abs(d),d=0),e>this.originalWidth&&(g=this.originalWidth-c,k=g),f>this.originalHeight&&(h=this.originalHeight-d,l=h),1!==r&&(m*=r,n*=r,k*=r,l*=r),j.drawImage(this.elements.$fullsizePreview.get(0),c,d,g,h,m,n,k,l),i},n.prototype._getHtmlResult=function(b){var c=b.points,d=a('<div class="croppie-result">'),e=a("<img>"),f=c[2]-c[0],g=c[3]-c[1];return d.append(e),e.css({left:-1*c[0]+"px",top:-1*c[1]+"px"}),img.src=b.url,d.css({width:f+"px",height:g+"px"}),d},n.prototype._getBase64Result=function(a){var b=this._getCanvas(a).toDataURL(a.format,a.quality);return b},n.prototype._getBlobResult=function(a){var b=this;return new Promise(function(c){b._getCanvas(a).toBlob(function(a){c(a)},a.format,a.quality)})},n.prototype._get=function(){var a=this.elements.$img.get(0),b=this.elements.$viewport.get(0),c=a.getBoundingClientRect(),d=b.getBoundingClientRect(),e=d.left-c.left,f=d.top-c.top,g=e+d.width,h=f+d.height,i=parseInt(100*this._currentZoom)/100||1;e=Math.max(0,e/i),f=Math.max(0,f/i),g=Math.max(0,g/i),h=Math.max(0,h/i);var j=parseFloat(e).toFixed(4),k=parseFloat(f).toFixed(4),l=parseFloat(g).toFixed(4),m=parseFloat(h).toFixed(4);return{points:[j,k,l,m],zoom:i}};var o={type:"canvas",format:"png",quality:1},p=["jpeg","webp","png"];n.prototype._result=function(b){{var c,d=this,e=this._get(),f=a.extend(!0,{},o,b||{}),g="string"==typeof b?b:f.type||"base64",h=f.format,i=f.quality,j=f.backgroundColor,k=this.elements.$viewport.get(0);k.getBoundingClientRect()}return p.indexOf(h)>-1&&(e.format="image/"+h,e.quality=i),e.url=this.data.url,e.backgroundColor=j,c=new Promise(function(a){switch(g.toLowerCase()){case"rawcanvas":a(d._getCanvas(e));break;case"canvas":case"base64":a(d._getBase64Result(e));break;case"blob":d._getBlobResult(e).then(a);break;default:a(d._getHtmlResult(e))}})},n.prototype.getExifOrientation=function(a,b){window.EXIF||b(0),EXIF.getData(a,function(){var a=EXIF.getTag(this,"Orientation");b(a)})},n.prototype.drawCanvas=function(a,b,c){var d=b.width,e=b.height,f=a.getContext("2d");switch(a.width=b.width,a.height=b.height,f.save(),c){case 2:f.translate(d,0),f.scale(-1,1);break;case 3:f.translate(d,e),f.rotate(180*Math.PI/180);break;case 4:f.translate(0,e),f.scale(1,-1);break;case 5:a.width=e,a.height=d,f.rotate(90*Math.PI/180),f.scale(1,-1);break;case 6:a.width=e,a.height=d,f.rotate(90*Math.PI/180),f.translate(0,-e);break;case 7:a.width=e,a.height=d,f.rotate(-90*Math.PI/180),f.translate(-d,e),f.scale(1,-1);break;case 8:a.width=e,a.height=d,f.translate(0,d),f.rotate(-90*Math.PI/180)}f.drawImage(b,0,0,d,e),f.restore()},n.prototype._transferImageToCanvas=function(a){a=this.options.enableOrientation&&a;var b=this.elements.$canvas,c=b.get(0),d=this.elements.$img.get(0),e=c.get(0).getContext("2d"),f=this.options.enableExif&&window.EXIF;e.clearRect(0,0,c.width,c.height),c.width=d.width,c.height=d.height,f?this.getExifOrientation(d,function(b){this.drawCanvas(c,d,parseInt(b,10)),a&&this.drawCanvas(c,d,a)}):a&&this.drawCanvas(c,d,a)},n.prototype._onCropSuccess=function(a){this.success(a)},n.prototype.success=function(a){this.successCallback&&this.successCallback(a)},n.prototype._resetData=function(){this.weight=0,this.originalWidth=null,this.originalHeight=null,this.actualWidth=null,this.actualHeight=null,this.croppedWidth=null,this.croppedHeight=null,this.croppedLeft=null,this.croppedTop=null},n.prototype._destroy=function(){},n.prototype._updateViewportSizes=function(){var a=this.elements.$img.get(0).getBoundingClientRect(),b=this.elements.$img.parent().get(0).getBoundingClientRect(),c=a&&b&&a.left-b.left,d=a&&b&&a.top-b.top,e=a&&a.width||this.originalWidth,f=a&&a.height||this.originalHeight;this.actualWidth=e,this.actualHeight=f,this.offsetLeft=c,this.offsetTop=d,this._currentZoom=parseInt(this.actualWidth/this.originalWidth*100)/100},n.prototype._refreshViewportPosition=function(a){this._updateViewportSizes();var b={width:this.croppedWidth?this.croppedWidth:this.actualWidth,height:this.croppedHeight?this.croppedHeight:this.actualHeight,"max-width":this.actualWidth,"max-height":this.actualHeight,left:this.croppedLeft?this.croppedLeft:this.offsetLeft||0,top:this.croppedTop?this.croppedTop:this.offsetTop||0};a?this.elements.$viewport.attr("style",a):this.elements.$viewport.css(b)},n.prototype.undoCrop=function(){var a=this.prevImages.pop();a&&this._bind(a)},n.prototype._setupCropElements=function(){var b,d=c.getDrawerFolderUrl()+"assets/",e='style="background: url('+d+'border.gif);"';b='<div class="imager-crop-container"><div class="crop-corner crop-top-left"></div><div class="crop-corner crop-top-right"></div><div class="crop-corner crop-bottom-right"></div><div class="crop-corner crop-bottom-left"></div><div class="crop-border crop-border-top" '+e+'></div><div class="crop-border crop-border-right" '+e+'></div><div class="crop-border crop-border-bottom" '+e+'></div><div class="crop-border crop-border-left" '+e+"></div></div>",this.elements=this.elements||{},this.elements.$viewport=a(b),this.elements.$img=a('<img class="cr-image">'),this.elements.$fullsizePreview=a('<img class="cr-image-fullsize">'),this.elements.$overlay=a('<div class="cr-overlay">'),this.elements.$preview=this.elements.$img,this.$element.append(this.elements.$fullsizePreview),this.$element.append(this.elements.$preview),this.$element.append(this.elements.$overlay),this.$element.append(this.elements.$viewport)},n.prototype._init=function(){this._setupCropElements()},n.prototype._save=function(){this.prevImages.push({viewportStyleAttr:this.elements.$viewport.attr("style"),points:this._get(),url:this.currentImage})},n.prototype.applyCrop=function(a){var b=this;b._result().then(function(c){a?(b._save(),b._bind(c)):b._onCropSuccess(c)})},n.prototype.startCropping=function(b){var d=this;b.style.opacity=1,d.enableRendering=!1,d.renderCropped=!1;var e=a("body");d.originalWidth=b.naturalWidth,d.originalHeight=b.naturalHeight,d.makePreview(),d._refreshViewportPosition(d.data&&d.data.viewportStyleAttr),d.viewportStyleAttr=!1;var f=d.elements.$viewport.find(".crop-corner");f.css(d.drawer.touchDevice?d.options.controlsTouchCss:d.options.controlsCss),f.on(h,function(b){var f=this,g=this.getBoundingClientRect().width/2;d.drawer.croppingNow=!0;var h=c.getEventPosition(b),k=d.elements.$viewport.get(0).getBoundingClientRect(),l=d.elements.$viewport.parent().get(0).getBoundingClientRect(),m=k.left-l.left,n=k.top-l.top,o=k.width,p=k.height,q=a(f).hasClass("crop-top-left"),r=a(f).hasClass("crop-top-right"),s=a(f).hasClass("crop-bottom-left"),t=a(f).hasClass("crop-bottom-right");e.on(j,function(a){var b=c.getEventPosition(a),e=b.left-h.left,f=b.top-h.top;return q&&(d.croppedLeft=m+e,d.croppedTop=n+f,d.croppedWidth=o-e,d.croppedHeight=p-f),r&&(d.croppedLeft=m,d.croppedTop=n+f,d.croppedWidth=o- -1*e,d.croppedHeight=p-f),t&&(d.croppedLeft=m,d.croppedTop=n,d.croppedWidth=o- -1*e,d.croppedHeight=p+f),s&&(d.croppedLeft=m+e,d.croppedTop=n,d.croppedWidth=o-e,d.croppedHeight=p+f),d.croppedLeft<d.offsetLeft&&(d.croppedLeft=d.offsetLeft),d.croppedLeft+g>d.offsetLeft+d.actualWidth&&(d.croppedLeft=d.offsetLeft+d.actualWidth-d.options.minSize,d.croppedWidth=d.options.minSize),d.croppedTop<d.offsetTop&&(d.croppedTop=d.offsetTop),d.croppedTop+g>d.offsetTop+d.actualHeight&&(d.croppedTop=d.offsetTop+d.actualHeight-d.options.minSize,d.croppedHeight=d.options.minSize),d.croppedLeft+d.croppedWidth>d.actualWidth+d.offsetLeft&&(d.croppedWidth=d.actualWidth-d.croppedLeft+d.offsetLeft),d.croppedTop+d.croppedHeight>d.actualHeight+d.offsetTop&&(d.croppedHeight=d.actualHeight-d.croppedTop+d.offsetTop),d.elements.$viewport.css({left:d.croppedLeft,top:d.croppedTop,width:d.croppedWidth,height:d.croppedHeight}),a.preventDefault(),a.stopPropagation(),!1}),e.on(i,function(){c.setTimeout(function(){d.drawer.croppingNow=!1},50),e.off(j),e.off(i)})})},n.prototype.makePreview=function(b,c){var d=this;d.$preview=a('<div class="imager-crop-preview-container"><canvas class="imager-crop-preview"></canvas></div>').css("position","absolute").css("top","50px").css({width:b,height:c,position:"absolute",right:"50px",top:"50px"}),d.previewCanvas=d.$preview.find("canvas.imager-crop-preview")[0],d.previewCanvas.__previewCanvas=!0,d.previewCanvas.width=1.5*b,d.previewCanvas.height=1.5*c,a(d.previewCanvas).css({height:"400px"}),d.$element.append(this.$preview)},n.prototype.reset=function(){this.croppedLeft=null,this.croppedTop=null,this.croppedWidth=null,this.croppedHeight=null,this.sizeBeforeCrop=null};var q={translate3d:{suffix:", 0px"},translate:{suffix:""}},r=function(a,b,c){this.x=parseFloat(a),this.y=parseFloat(b),this.scale=parseFloat(c)};r.parse=function(a){if(a){var b=a&&a instanceof jQuery&&a.length,c=a instanceof Node,d=b?a.get(0):c&&a,e=d&&d.style;return e?r.parse(e[f]):a.indexOf("matrix")>-1||a.indexOf("none")>-1?r.fromMatrix(a):r.fromString(a)}},r.fromMatrix=function(a){var b=a.substring(7).split(",");b.length&&"none"!==a||(b=[1,0,0,1,0,0]);var c=parseInt(b[4],10),d=parseInt(b[5],10),e=parseFloat(b[0]);return new r(c,d,e)},r.fromString=function(a){var b=a.split(") "),c=b[0].substring(n.prototype.globals.translate.length+1).split(","),d=b.length>1?b[1].substring(6):1,e=c.length>1?c[0]:0,f=c.length>1?c[1]:0;return new r(e,f,d)},r.prototype.toString=function(){var a=q[n.prototype.globals.translate].suffix||"",b=n.prototype.globals.translate,c="("+this.x+"px, "+this.y+"px"+a+") scale("+this.scale+")",d=b+c;return d};var s=function(a){var b=a instanceof jQuery;if(a=b?a.get(0):a,!a||!a.style[e])return this.x=0,void(this.y=0);var c=a.style[e].split(" ");this.x=parseFloat(c[0]),this.y=parseFloat(c[1])};s.prototype.toString=function(){return this.x+"px "+this.y+"px"},b.ImageCropPlugin=n}(jQuery,DrawerJs.plugins,DrawerJs.util),function(a,b,c,d){"use strict";var e=function(a,b){this.name="MinimizeButton",this.drawer=a,this._setupOptions(b),a.on(a.EVENT_CONFIG_TOOLBAR_CREATED,this._onConfigToolbarCreated.bind(this)),a.on(a.EVENT_MINIMIZED_TOOLBAR_CREATED,this._onMinimizedToolbarCreated.bind(this))};e.prototype._setupOptions=function(b,c,d){c=c||this.name;var e=this.drawerInstance||this.drawer,f=e&&e.getPluginConfig(c),g=a.extend(!0,{},this._defaultOptions||{},f||{},b||{});return d||(this.options=g),g},e.prototype._onConfigToolbarCreated=function(a,b){this._createAndAddButton_minimize(b)},e.prototype._onMinimizedToolbarCreated=function(b,c){var d=this.drawer.options.captionText,e=a('<li class="canvas-caption">'+d+"</li>");c.$toolbar.find(".toolbar-content-wrapper").prepend(e),this._createAndAddButton_restore(c)},e.prototype.removeTool=function(a){this.deleteControls&&this.deleteControls(),a&&this.drawer.off(this.drawer.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},e.prototype.minimizeCanvas=function(){var a=this.drawer.$canvasEditContainer,b=a.hasClass("animated");a.removeClass("animated"),a.addClass("minimized"),c.setTimeout(function(){a.toggleClass("animated",!!b)},0)},e.prototype.restoreCanvas=function(){var a=this.drawer.$canvasEditContainer,b=a.hasClass("animated");a.removeClass("animated"),a.removeClass("minimized"),c.setTimeout(function(){a.toggleClass("animated",!!b)},0)},e.prototype._createAndAddButton_restore=function(a){var b={buttonOrder:this.options.buttonOrder,additionalClass:"btn-restore-canvas",iconClass:"fa-expand",tooltipText:this.drawer.t("Restore canvas"),clickHandler:this._onRestoreSizeButtonClick.bind(this)},c=a.addButton(b);this.$restoreButton=c},e.prototype._createAndAddButton_minimize=function(a){var b={buttonOrder:this.options.buttonOrder,additionalClass:"btn-minimize-canvas",iconClass:"fa-compress",tooltipText:this.drawer.t("Minimize canvas"),clickHandler:this._onMinimizeButtonClick.bind(this)},c=a.addButton(b);this.$minimizeButton=c},e.prototype._onMinimizeButtonClick=function(){this.minimizeCanvas()},e.prototype._onRestoreSizeButtonClick=function(){this.restoreCanvas()},d.prototype.minimizeCanvas=function(){this.drawer.api.checkIsActive();var a=this.drawer.getPluginInstance("MinimizeButton");a.minimizeCanvas()},d.prototype.restoreCanvas=function(){this.drawer.api.checkIsActive();var a=this.drawer.getPluginInstance("MinimizeButton");a.restoreCanvas()},b.MinimizeButton=e}(jQuery,DrawerJs.plugins,DrawerJs.util,DrawerJs.DrawerApi),function(a,b,c){"use strict";var d=c.mouseDown("MovableFloatingMode"),e=c.mouseMove("MovableFloatingMode"),f=c.mouseUp("MovableFloatingMode"),g=function(a,b){this.drawer=a,this._setupOptions(b),this._bindedOnToolbarCreated=this._onToolbarCreated.bind(this),a.on(a.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated),a.on(a.EVENT_MINIMIZED_TOOLBAR_CREATED,this._bindedOnToolbarCreated),a.options.align&&"floating"!==a.options.align&&console.warn("MovableFloatingMode plugin: options.align is set and it is not 'floating', so canvas will not move. Please use MovableFloatingMode plugin with 'floating' align"),a.options.align||(a.options.align="floating"),this.drawer.on(this.drawer.EVENT_CANVAS_READY,this.onOptionsChanged.bind(this)),this.drawer.on(this.drawer.EVENT_OPTIONS_CHANGED,this.onOptionsChanged.bind(this))};g.prototype._setupOptions=function(b,c,d){c=c||this.name;var e=this.drawerInstance||this.drawer,f=e&&e.getPluginConfig(c),g=a.extend(!0,{},this._defaultOptions||{},f||{},b||{});return d||(this.options=g),g},g.prototype._onToolbarCreated=function(a,b){this.toolbar=b,this.createControls(b)},g.prototype.removeTool=function(a){this.deleteControls&&this.deleteControls(),a&&(this.drawer.off(this.drawer.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated),this.drawer.off(this.drawer.EVENT_MINIMIZED_TOOLBAR_CREATED,this._bindedOnToolbarCreated))},g.prototype.createControls=function(a){this.makeMoveButton(a)},g.prototype.makeMoveButton=function(a){var b={buttonOrder:this.options.buttonOrder,additionalClass:"btn-move",iconClass:"fa-arrows",tooltipText:this.drawer.t("Move canvas")},c=a.addButton(b);this.$moveButton=c,this.$moveButton.on(d,this.buttonOnMouseDown.bind(this))},g.prototype.buttonOnMouseDown=function(b){b.type.indexOf("touch")>-1&&(b=b.originalEvent),a(".tooltip-btn-move").css("display","none"),this.startLeft=0|this.drawer.$imageElement.css("left").replace("px",""),this.startTop=0|this.drawer.$imageElement.css("top").replace("px",""),this.mouseStartLeft=b.pageX,this.mouseStartTop=b.pageY;var c=a("body"),d=a(window.document);return c.addClass("drawer-moving"),d.on(e,this.buttonOnMouseMove.bind(this)),d.on(f,this.buttonOnMouseUp.bind(this)),!1},g.prototype.buttonOnMouseMove=function(a){var b=this,d=c.getEventPosition(a),e=function(){b.moveDrawer(d.left,d.top)};return c.requestAnimationFrame(e),a.preventDefault(),a.stopPropagation(),!1},g.prototype.buttonOnMouseUp=function(){a(".tooltip-btn-move").css("display","block");var b=a("body"),c=a(window.document);return b.removeClass("drawer-moving"),c.off(e),c.off(f),!1},g.prototype.moveDrawer=function(a,b){var c=a-this.mouseStartLeft,d=b-this.mouseStartTop,e=this.startLeft+c,f=this.startTop+d;e=0>e?0:e,f=0>f?0:f;var g=this.drawer;g.$imageElement.css({left:e,top:f}),g.updateAligmentCss(),g.adjustEditContainer(!1,!0)},g.prototype.onOptionsChanged=function(){var a;try{a=this.drawer.getPluginInstance("Fullscreen")}catch(b){}var c=a&&a.isInFullscreenMode();c||"floating"!=this.drawer.options.align?this.hideMoveButton():this.showMoveButton()},g.prototype.showMoveButton=function(){return this.$moveButton?void this.$moveButton.show():void console.warn("MovableFloatingMode.removeMoveButton() : no button 'Move' present")},g.prototype.hideMoveButton=function(){return this.$moveButton?void this.$moveButton.hide():void console.warn("MovableFloatingMode.removeMoveButton() : no button 'Move' present")},b.MovableFloatingMode=g}(jQuery,DrawerJs.plugins,DrawerJs.util),function(a,b,c){"use strict";var d=c.mouseUp("OpenPopupButton"),e=c.mouseDown("OpenPopupButton"),f=c.mouseMove("OpenPopupButton"),g=function(a,b){this.drawer=a,this._setupOptions(b),a.on(a.EVENT_OPTIONS_TOOLBAR_CREATED,this._onToolbarCreated.bind(this)),a.on(a.EVENT_FLOATING_TOOLBAR_CREATED,this._init.bind(this))};g.prototype._setupOptions=function(b,c,d){c=c||this.name;var e=this.drawerInstance||this.drawer,f=e&&e.getPluginConfig(c),g=a.extend(!0,{},this._defaultOptions||{},f||{},b||{});return d||(this.options=g),g},g.prototype._init=function(a,b){this.needToInitButton&&(this.createControls(b),this.drawer.off(this.drawer.EVENT_OBJECT_SELECTED,this._onObjectSelected.bind(this)),this.drawer.on(this.drawer.EVENT_OBJECT_SELECTED,this._onObjectSelected.bind(this)),this.drawer.off(this.drawer.EVENT_SELECTION_CLEARED,this._onSelectionCleared.bind(this)),this.drawer.on(this.drawer.EVENT_SELECTION_CLEARED,this._onSelectionCleared.bind(this)),this.drawer.off(this.drawer.EVENT_DO_ACTIVATE_TOOL,this._onActivateTool.bind(this)),this.drawer.on(this.drawer.EVENT_DO_ACTIVATE_TOOL,this._onActivateTool.bind(this)),this.drawer.off(this.drawer.EVENT_DO_DEACTIVATE_TOOL,this._onDeactivateTool.bind(this)),this.drawer.on(this.drawer.EVENT_DO_DEACTIVATE_TOOL,this._onDeactivateTool.bind(this)),this.drawer.off(this.drawer.EVENT_DO_DEACTIVATE_ALL_TOOLS,this._onDeactivateAllTools.bind(this)),this.drawer.on(this.drawer.EVENT_DO_DEACTIVATE_ALL_TOOLS,this._onDeactivateAllTools.bind(this)),this.drawer.off(this.drawer.EVENT_CANVAS_START_RESIZE,this.hideButton.bind(this)),this.drawer.on(this.drawer.EVENT_CANVAS_START_RESIZE,this.hideButton.bind(this)),this.drawer.off(this.drawer.EVENT_CANVAS_STOP_RESIZE,this.refreshPosition.bind(this)),this.drawer.on(this.drawer.EVENT_CANVAS_STOP_RESIZE,this.refreshPosition.bind(this)),this.drawer.off(this.drawer.EVENT_OVERCANVAS_BUTTON_HIDE,this.hideButton.bind(this)),this.drawer.on(this.drawer.EVENT_OVERCANVAS_BUTTON_HIDE,this.hideButton.bind(this)),this.drawer.off(this.drawer.EVENT_OVERCANVAS_BUTTON_SHOW,this.showButton.bind(this)),this.drawer.on(this.drawer.EVENT_OVERCANVAS_BUTTON_SHOW,this.showButton.bind(this)),this.drawer.off(this.drawer.EVENT_IMAGE_CROP,this.hideButton.bind(this)),this.drawer.on(this.drawer.EVENT_IMAGE_CROP,this.hideButton.bind(this)))},g.prototype._onToolbarCreated=function(a,b){this.toolbar=b;var c=b.options.compactType===b.POPUP,d=b.options.hidden,e=c&&!d;this.needToInitButton=e},g.prototype._onObjectSelected=function(){this.showButton()},g.prototype._onActivateTool=function(){this.showButton()},g.prototype._onDeactivateTool=function(){this.hideButton()},g.prototype._onDeactivateAllTools=function(a,b){var c=b&&b.beforeActivateTool,d=!c;d&&this.hideButton()},g.prototype._onSelectionCleared=function(){var a=!this.drawer.activeDrawingTool;a&&this.hideButton()},g.prototype.createControls=function(a){this._createAndAddButton(a),this._setInitialPosition(),this.showButton()},g.prototype.removeTool=function(a){this.deleteControls&&this.deleteControls(),a&&this.drawer.off(this.drawer.EVENT_FLOATING_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},g.prototype._setInitialPosition=function(){var b=0,c=0,d=this.drawer.toolbars.toolbarPlaceholders.inside,e=d&&d.top&&d.top.$element,f=d&&d.left&&d.left.$element;e&&e.length&&e.find("ul.editable-canvas-toolbar:visible").each(function(b,d){var e=a(d);c+=e.height()}),f&&f.length&&f.find("ul.editable-canvas-toolbar:visible").each(function(c,d){var e=a(d);b+=e.width()}),this.positionInitialized=!0,this.moveButton(b,c)},g.prototype.moveButton=function(a,b){this.positionLimit||this.refreshPositionLimits(),a=a>this.positionLimit.left?this.positionLimit.left:a,b=b>this.positionLimit.top?this.positionLimit.top:b,a=0>a?0:a,b=0>b?0:b,this.latestState={left:a||0,top:b||0},this.$button[0].style.left=a+"px",this.$button[0].style.top=b+"px"},g.prototype.refreshPosition=function(){var a=this.latestState&&this.latestState.left||0,b=this.latestState&&this.latestState.top||0;this.showButton(),this.refreshPositionLimits(),this.moveButton(a,b)},g.prototype._createAndAddButton=function(b){var c,g=a("body"),h={buttonOrder:this.options.buttonOrder,additionalClass:"btn-popup-canvas hidden",iconClass:"fa-cogs",tooltipText:this.drawer.t("Open options tools")};c=b.addButton(h),this.$button=c;var i=this.latestState&&this.latestState.left||0,j=this.latestState&&this.latestState.top||0;this.moveButton(i,j),g.off(f).on(f,this._onMouseMove.bind(this)),c.off(e).on(e,this._onMouseDown.bind(this)),g.off(d).on(d,this._onMouseUp.bind(this))},g.prototype._onMouseDown=function(a){
var b=this;this.moveNow=!0,this.triggerClick=!0,this.clickPosition=c.getEventPosition(a),this.refreshSizes(),this.refreshPositionLimits(),c.setTimeout(function(){b.triggerClick=!1},200)},g.prototype._onMouseUp=function(a){this.moveNow=!1,this.dragNow=!1,this.clickPosition={};var b=a.target===this.$button.get(0)||this.$button.find(a.target).length;this.$button.removeClass("dragging"),b&&this.triggerClick&&this.drawer.trigger(this.drawer.EVENT_OVERCANVAS_POPUP_SHOW,[this.$button])},g.prototype._onMouseMove=function(a){if(this.moveNow){var b=c.getEventPosition(a),d=this.clickPosition&&this.clickPosition.left===b.left,e=this.clickPosition&&this.clickPosition.top===b.top,f=!d||!e;if(f){this.dragNow||(this.$button.addClass("dragging"),this.dragNow=!0),this.latestSizes=this.latestSizes||this.refreshSizes();var g=c.getEventPosition(a),h=this.latestSizes,i=h.canvas,j=g.left-i.left-h.button.width/2-h.scroll.left,k=g.top-i.top-h.button.height/2-h.scroll.top;this.triggerClick=!1,this.moveButton(j,k),a.preventDefault(),a.stopPropagation()}}},g.prototype.refreshSizes=function(){var a={},b=this.drawer.fCanvas,d=b.upperCanvasEl.getBoundingClientRect(),e=this.$button[0].getBoundingClientRect();return a.canvas=d,a.button=e,a.scroll=c.getScrollTopFromElement(this.$button),this.latestSizes=a,a},g.prototype.refreshPositionLimits=function(){var a=this.$button.get(0).getBoundingClientRect(),b=2;this.positionLimit={left:this.drawer.width-a.width-b,top:this.drawer.height-a.height-b}},g.prototype.showButton=function(){this.$button.removeClass("hidden")},g.prototype.hideButton=function(a,b){var c=this.drawer.options.toolbars.popupButtonAlwaysVisible;(b||!c)&&this.$button.addClass("hidden")},b.OpenPopupButton=g}(jQuery,DrawerJs.plugins,DrawerJs.util),function(a,b,c){var d=function(a){this.drawerInstance=a,this.LOGTAG=this.name,this._attachDrawerEvents()};d.prototype.drawerInstance=null,d.prototype.namespace="OvercanvasPopup",d.prototype.name="DrawerPluginOvercanvasPopup",d.prototype.popupClass="popup-wrapper",d.prototype.defaultPosition="bottom",d.prototype.positions=["bottom","left","right","top"],d.prototype.toolbarBehavior="overlay",d.prototype._attachDrawerEvents=function(){this.drawerInstance.on(this.drawerInstance.BEFORE_CREATE_TOOLBARS,this._onBeforeCreateToolbars.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_OVERCANVAS_POPUP_SHOW,this.showPopup.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_OVERCANVAS_POPUP_HIDE,this.hidePopup.bind(this))},d.prototype._onBeforeCreateToolbars=function(){this._createHelperElements(),this._attachHelperEvents()},d.prototype._attachHelperEvents=function(){var b=this.$popup.find(".popup-close-btn"),d=this.$popup.find(".popup-overlay"),e=a("body");c.bindClick(b,this.namespace,this._triggerPopupHide.bind(this)),c.bindClick(d,this.namespace,this._triggerPopupHide.bind(this)),c.bindClick(e,this.namespace,this._onBodyClick.bind(this))},d.prototype._triggerPopupHide=function(){this.drawerInstance.trigger(this.drawerInstance.EVENT_OVERCANVAS_POPUP_HIDE)},d.prototype._triggerPopupShow=function(){this.drawerInstance.trigger(this.drawerInstance.EVENT_OVERCANVAS_POPUP_SHOW)},d.prototype._onBodyClick=function(a){if(this.popupIsVisible){var b=this.$button&&this.$button.length,c=b&&(a.target===this.$button.get(0)||this.$button.find(a.target).length),d=a.target===this.$popup.get(0)||this.$popup.find(a.target).length;c||d||this.drawerInstance.trigger(this.drawerInstance.EVENT_OVERCANVAS_POPUP_HIDE)}},d.prototype._createHelperElements=function(){this._removeHelperElements();var b='<div class="'+this.popupClass+' hidden"><div class="popup-content-wrapper"><div class="popup-arrow"></div><div class="popup-content"></div></div><div class="popup-overlay"></div><div class="popup-close-btn"><div class="fa fa-close"></div></div></div>',c=a(b),d=this.drawerInstance.$canvasEditContainer;d.append(c),this.drawerInstance.$popupWrapper=c,this.$popup=c,this.$arrow=c.find(".popup-arrow"),this.$popupContentWrapper=c.find(".popup-content-wrapper")},d.prototype._removeHelperElements=function(){this.drawerInstance.$popupWrapper&&this.drawerInstance.$popupWrapper.length&&this.drawerInstance.$popupWrapper.remove();var a=this.drawerInstance.$canvasEditContainer.find("."+this.popupClass);a&&a.length&&a.remove(),this.drawerInstance.$popupWrapper=void 0,this.$popup=void 0},d.prototype._getAvailableSpace=function(a){var b;if(a&&a.length){var c=this.drawerInstance.$canvasEditContainer,d=c.get(0).getBoundingClientRect(),e=a.get(0).getBoundingClientRect(),f=this.$popupContentWrapper.get(0).getBoundingClientRect(),g=10,h=e.left-d.left,i=e.top-d.top;b={},b.top=i,b.left=h,b.right=d.width-h-e.width,b.bottom=d.height-i-e.height,b.centerX=h+e.width/2,b.centerY=i+e.height/2,b.popup={arrowSize:g,top:f.height,bottom:f.height,left:f.width,right:f.width},b.popupSizes=f,b.canvasSizes=d,b.triggerSizes=e}return this.sizes=b,b},d.prototype._movePopup=function(a){var b,c,d,e,f=this.sizes,g={},h=f.popupSizes.width/2,i=f.popupSizes.height/2;switch(a){case"left":c=f.left-f.popupSizes.width-f.popup.arrowSize,d=f.centerY-f.popupSizes.height/2;break;case"right":c=f.canvasSizes.width-f.right+f.popup.arrowSize,d=f.centerY-f.popupSizes.height/2;break;case"top":b=!0,c=f.centerX-f.popupSizes.width/2,d=f.top-f.popupSizes.height-f.popup.arrowSize;break;case"bottom":b=!0,c=f.centerX-f.popupSizes.width/2,d=f.canvasSizes.height-f.bottom+f.popup.arrowSize}b?(g.top=d,e=c+f.popupSizes.width-f.canvasSizes.width,e>0?(h+=e,g.right=0):(0>c&&(h+=c,c=0),g.left=c)):(g.left=c,e=d+f.popupSizes.height-f.canvasSizes.height,e>0?(i+=e,g.bottom=0):(0>d&&(i+=d,d=0),g.top=d)),this.$popupContentWrapper.attr("data-position",a),this.$popupContentWrapper.removeAttr("style"),this.$popupContentWrapper.css(g),this._moveArrow(h,i)},d.prototype._moveArrow=function(a,b){this.$arrow.css({left:a,top:b})},d.prototype._adjustPosition=function(a){var b,c=this._getAvailableSpace(a);this.positions.forEach(function(a){var d=c[a]&&c.popup[a];if(!b&&d){var e=c.popup[a]+c.popup.arrowSize,f=c[a]-e>0;b=f&&a}}),b&&this._movePopup(b)},d.prototype.showPopup=function(b,c){this.popupIsVisible=!0,this.$popup.removeClass("hidden"),this._adjustPosition(c),this.$popupContentWrapper.removeClass("popup-transparent"),this.drawerInstance.trigger(this.drawerInstance.EVENT_TOOLBAR_CHANGE_STATE,[{excludeElements:a().add(this.$popup).add(c),turnOn:!0,state:this.toolbarBehavior}])},d.prototype.hidePopup=function(){this.drawerInstance.trigger(this.drawerInstance.EVENT_TOOLBAR_CLEAR_STATE),this.popupIsVisible=!1,this.$popup.addClass("hidden"),this.$popupContentWrapper.addClass("popup-transparent")},b.OvercanvasPopup=d}(jQuery,DrawerJs.plugins,DrawerJs.util),function(a,b,c){var d=function(a){this.drawerInstance=a,this.name="DrawerPluginResize",this.LOGTAG=this.name,this.MOUSEDOWN=c.mouseDown("drawerPluginResize"),this.MOUSEUP=c.mouseUp("drawerPluginResize"),this.MOUSEMOVE=c.mouseMove("drawerPluginResize"),this._bindedOnToolbarCreated=this._onToolbarCreated.bind(this),a.on(this.drawerInstance.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated),a.on(this.drawerInstance.EVENT_RESIZER_HIDE,this.resizerHide.bind(this)),a.on(this.drawerInstance.EVENT_RESIZER_SHOW,this.resizerShow.bind(this))};d.prototype._onToolbarCreated=function(){this.createControls()},d.prototype.removeTool=function(a){this.deleteControls&&this.deleteControls(),a&&this.drawerInstance.off(this.drawerInstance.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},d.prototype.createControls=function(){this.deleteControls(),this.appendResizeControl()},d.prototype.deleteControls=function(){this.$canvasResizer&&this.$canvasResizer.length&&this.$canvasResizer.remove()},d.prototype.appendResizeControl=function(){var b=this,d=a(window.document),e=(a("body"),d),f=b.drawerInstance.$canvasEditContainer;this.$canvasResizer=a('<span class="redactor-drawer-resizer"><span class="resizer-box"></span></span>'),this.drawerInstance.touchDevice&&this.$canvasResizer.find(".resizer-box").addClass("touch"),f.append(this.$canvasResizer),this.$canvasResizer.find(".resizer-box").on(this.MOUSEDOWN,function(d){var f=c.getEventPosition(d);b.drawerInstance.log(b.LOGTAG,"resize start"),b.resizeOriginalWidth=b.drawerInstance.width,b.resizeOriginalHeight=b.drawerInstance.height,b.resizeStartX=f.left,b.resizeStartY=f.top;var g=a("body");g.addClass("drawer-resizing"),b.drawerInstance.trigger(b.drawerInstance.EVENT_CANVAS_START_RESIZE),b.drawerInstance.resizingNow=!0,e.on(b.MOUSEMOVE,function(a){a.stopPropagation(),a.preventDefault();var d=c.getEventPosition(a),e=b.resizeStartX-d.left,f=b.resizeStartY-d.top,g=function(){b.drawerInstance.setSize(b.resizeOriginalWidth-e,b.resizeOriginalHeight-f),b.drawerInstance.trigger(b.drawerInstance.EVENT_CANVAS_RESIZING)};return c.requestAnimationFrame(g),!1}),e.on(b.MOUSEUP,function(){g.removeClass("drawer-resizing"),e.off(b.MOUSEMOVE),e.off(b.MOUSEUP),b.drawerInstance.log(b.LOGTAG,"resize finished by mouseup"),b.resizeFinished()})})},d.prototype.resizerHide=function(){this.$canvasResizer&&this.$canvasResizer.length&&this.$canvasResizer.addClass("hidden")},d.prototype.resizerShow=function(){this.$canvasResizer&&this.$canvasResizer.length&&this.$canvasResizer.removeClass("hidden")},d.prototype.resizeFinished=function(){this.drawerInstance.onCanvasModified(),this.drawerInstance.resizingNow=!1,console.log("[resize]","EVENT_CANVAS_STOP_RESIZE"),this.drawerInstance.trigger(this.drawerInstance.EVENT_CANVAS_STOP_RESIZE)},b.Resize=d}(jQuery,DrawerJs.plugins,DrawerJs.util),function(a){a.prototype.contextMenuShow=function(){this.drawer.api.checkIsActive();var a=this.drawer.getPluginInstance("ShapeContextMenu");a.showContextMenu()},a.prototype.contextMenuHide=function(){this.drawer.api.checkIsActive();var a=this.drawer.getPluginInstance("ShapeContextMenu");a.hideContextMenu()},a.prototype.contextMenuSetPosition=function(a,b,c){this.drawer.api.checkIsActive();var d=this.drawer.getPluginInstance("ShapeContextMenu");if(c){var e=d._calcCoordsToFitViewport(a,b);a=e.left,b=e.top}d.setMenuPosition(a,b)}}(DrawerJs.DrawerApi),function(a,b,c){var d=c.mouseDown("ShapeContextMenu"),e=function(b,c){var d=this;d.drawerInstance=b,this.options=a.extend(!0,{},this._defaultOptions||{},c||{}),this.left=this.top=0,this._bindedOnContextMenu=this._onContextMenu.bind(this),this._bindedSetHandlers=this._setHandlers.bind(this),b.on(b.EVENT_OPTIONS_TOOLBAR_CREATED,this._bindedSetHandlers),b.on(b.EVENT_EDIT_STOP,this._onEditStop.bind(this)),b.on(b.EVENT_OBJECT_MOVING,this._onObjectMoved.bind(this))};e.prototype.eventsNamespace="shapeContextMenu",e.prototype._defaultOptions={position:{touch:"shapeRightBottom",mouse:"cursor"}},e.prototype._setHandlers=function(){if(this.options.customMenuRenderer)this.drawerInstance.on(this.drawerInstance.EVENT_CONTEXTMENU+"."+this.eventsNamespace,this.options.customMenuRenderer);else{this.drawerInstance.on(this.drawerInstance.EVENT_CONTEXTMENU+"."+this.eventsNamespace,this._bindedOnContextMenu);var b=this;c.bindClick(a("body"),"shapeContextMenu",function(){b.hideContextMenu()})}this.drawerInstance.$canvasEditContainer.off(d).on(d,this._onMouseDown.bind(this))},e.prototype._unsetHandlers=function(b){this.options.customMenuRenderer?this.drawerInstance.off(this.drawerInstance.EVENT_CONTEXTMENU+"."+this.eventsNamespace):(c.unbindClick(a("body"),"shapeContextMenu"),this.drawerInstance.off(this.drawerInstance.EVENT_CONTEXTMENU+"."+this.eventsNamespace),b&&this.drawerInstance.off(this.drawerInstance.EVENT_OPTIONS_TOOLBAR_CREATED,this._bindedSetHandlers))},e.prototype.removeTool=function(a){this._unsetHandlers(a)},e.prototype._onObjectMoved=function(){this.objectWasMoved=!0},e.prototype._onEditStop=function(){this._unsetHandlers()},e.prototype._onMouseDown=function(){this.objectWasMoved=!1},e.prototype._onContextMenu=function(a,b){var c=this.drawerInstance.drawingInProgress,d=this.drawerInstance.isBrushDrawing,e=this.objectWasMoved,f=c||d||e;f||(b.type.indexOf("touch")>-1&&(b=b.originalEvent),this.handleContextMenuEvent(b))},e.prototype.handleContextMenuEvent=function(b){var c=this,d=a(b.target).hasClass("upper-canvas"),e=d&&c.drawerInstance.fCanvas.findTarget(b),f=e&&e.isMoving,g=e&&e.__corner,h=e&&!f&&!g;h&&(c.drawerInstance.fCanvas.setActiveObject(e),c.showContextMenu(e,b))},e.prototype.showContextMenu=function(b,d){var e=this;e.hideContextMenu();var f=e.eventsNamespace;e.$contextMenu=a('<ul class="editable-canvas-shape-context-menu"></ul>');var g=a("<li><a>"+e.drawerInstance.t("Bring forward")+"</a></li>");c.bindClick(g.find("a"),f,this._bringObjectForward.bind(this,b)),e.$contextMenu.append(g);var h=a("<li><a>"+e.drawerInstance.t("Send backwards")+"</a></li>");c.bindClick(h.find("a"),f,this._sendObjectBackwards.bind(this,b)),e.$contextMenu.append(h);var i=a("<li><a>"+e.drawerInstance.t("Bring to front")+"</a></li>");c.bindClick(i.find("a"),f,this._bringObjectToFront.bind(this,b)),e.$contextMenu.append(i);var j=a("<li><a>"+e.drawerInstance.t("Send to back")+"</a></li>");c.bindClick(j.find("a"),f,this._sendObjectToBack.bind(this,b)),e.$contextMenu.append(j);var k=a("<li><a>"+e.drawerInstance.t("Duplicate")+"</a></li>");c.bindClick(k.find("a"),f,this._duplicateObject.bind(this,b)),e.$contextMenu.append(k);var l=a("<li><a>"+e.drawerInstance.t("Remove")+"</a></li>");c.bindClick(l.find("a"),f,this._removeObject.bind(this,b)),e.$contextMenu.append(l);var m=20;m=e.drawerInstance.touchDevice?e.drawerInstance.options.toolbarSizeTouch:e.drawerInstance.options.toolbarSize,m/=3,e.$contextMenu.find("li > a").each(function(b,c){a(c).css({"padding-top":m+"px","padding-bottom":m+"px"})}),e.drawerInstance.$canvasEditContainer.append(e.$contextMenu),this._positionMenu(b,c.getEventPosition(d))},e.prototype.hideContextMenu=function(){this.$contextMenu&&this.$contextMenu.remove()},e.prototype.setMenuPosition=function(a,b){this.left=Number(a),this.top=Number(b),this.$contextMenu.css("left",a+"px"),this.$contextMenu.css("top",b+"px")},e.prototype.getMenuPosition=function(){return{left:this.left,top:this.top}},e.prototype._positionMenu=function(b,c){var d=a(this.drawerInstance.fCanvas.upperCanvasEl).offset(),e=0,f=0,g=this.drawerInstance.touchDevice?"touch":"mouse",h=this.options.position[g];"shapeRightBottom"==h?(e=b.left+b.width,f=b.top+b.height):"cursor"==h&&(e=c.left-d.left+10,f=c.top-d.top+10);var i={};i=this.options.customFitViewportMethod?this.options.customFitViewportMethod(e,f):this._calcCoordsToFitViewport(e,f),e=i.left,f=i.top,this.setMenuPosition(e,f)},e.prototype._calcCoordsToFitViewport=function(a,b){a=Number(a),b=Number(b);var c=this.$contextMenu.height(),d=this.drawerInstance.fCanvas.height,e=b+c;e>d&&(b=d-c-10);var f=this.$contextMenu.width(),g=this.drawerInstance.fCanvas.width,h=a+f;return h>g&&(a=g-f-10),{left:a,top:b}},e.prototype._bringObjectForward=function(a){return this.drawerInstance.api.bringObjectForward(a),this.hideContextMenu(),!1},e.prototype._sendObjectBackwards=function(a){return this.drawerInstance.api.sendObjectBackwards(a),this.hideContextMenu(),!1},e.prototype._bringObjectToFront=function(a){return this.drawerInstance.api.bringObjectToFront(a),this.hideContextMenu(),!1},e.prototype._sendObjectToBack=function(a){return this.drawerInstance.api.sendObjectToBack(a),this.hideContextMenu(),!1},e.prototype._removeObject=function(a){return this.drawerInstance.api.removeObject(a),this.hideContextMenu(),!1},e.prototype._duplicateObject=function(a){return this.drawerInstance.api.duplicateObject(a),this.hideContextMenu(),!1},b.ShapeContextMenu=e}(jQuery,DrawerJs.plugins,DrawerJs.util),function(a,b,c){"use strict";var d=c.mouseUp("ToggleVisibilityButton"),e=c.mouseDown("ToggleVisibilityButton"),f=c.mouseMove("ToggleVisibilityButton"),g=function(a,b){this.drawer=a,this._setupOptions(b),this.drawer.on(this.drawer.EVENT_FLOATING_TOOLBAR_CREATED,this._onToolbarCreated.bind(this))};g.prototype._setupOptions=function(b,c,d){c=c||this.name;var e=this.drawerInstance||this.drawer,f=e&&e.getPluginConfig(c),g=a.extend(!0,{},this._defaultOptions||{},f||{},b||{});return d||(this.options=g),g},g.prototype._onOverCanvasMode=function(){this.showNextItem(),this.positionInitialized||this._setInitialPosition()},g.prototype._onToolbarCreated=function(a,b){this.toolbar=b;var c=this.checkConfigForButton();c&&(this.createControls(b),this._onOverCanvasMode())},g.prototype._checkToolbarForButton=function(a){var b=!1;if(a){var c=a.options.toggleVisibilityButton,d="popup"===a.options.compactType;b=c&&!d}return b},g.prototype.checkConfigForButton=function(){var a=this.drawer.toolbars.drawingToolsToolbar,b=this.drawer.toolbars.toolOptionsToolbar,c=this.drawer.toolbars.settingsToolbar,d=this._checkToolbarForButton(a),e=this._checkToolbarForButton(b),f=this._checkToolbarForButton(c),g=d||e||f,h=[];return d&&h.push(a),e&&h.push(b),f&&h.push(c),this.toolbarsForToggle=h,g},g.prototype.createControls=function(a){this._createAndAddButton(a),this.showButton()},g.prototype.removeTool=function(a){this.deleteControls&&this.deleteControls(),a&&this.drawer.off(this.drawer.EVENT_FLOATING_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},g.prototype.moveButton=function(a,b){this.positionLimit||this.refreshPositionLimits(),a=a>this.positionLimit.left?this.positionLimit.left:a,b=b>this.positionLimit.top?this.positionLimit.top:b,a=0>a?0:a,b=0>b?0:b,this.latestState={left:a||0,top:b||0},this.$button.css({left:a+"px",top:b+"px"})},g.prototype._setInitialPosition=function(){var a=0,b=0,c=this.drawer.toolbars.toolbarPlaceholders.inside,d=c&&c.top&&c.top.$element,e=c&&c.left&&c.left.$element;d&&d.length&&(b+=d.height()),e&&e.length&&(a+=e.width()),this.positionInitialized=!0,this.moveButton(a,b)},g.prototype._createAndAddButton=function(b){var c,g=a("body"),h={buttonOrder:this.options.buttonOrder,additionalClass:"btn-toggle-canvas hidden",iconClass:"fa-eye",tooltipText:this.drawer.t("Toggle toolbar vision")};c=b.addButton(h),this.$button=c;var i=this.latestState&&this.latestState.left||0,j=this.latestState&&this.latestState.top||0;this.moveButton(i,j),g.off(f).on(f,this._onMouseMove.bind(this)),c.off(e).on(e,this._onMouseDown.bind(this)),g.off(d).on(d,this._onMouseUp.bind(this))},g.prototype._onMouseDown=function(){var a=this;this.moveNow=!0,this.triggerClick=!0,this.refreshSizes(),this.refreshPositionLimits(),c.setTimeout(function(){a.triggerClick=!1},200)},g.prototype._onMouseUp=function(a){var b=this,d=a.target===this.$button.get(0)||this.$button.find(a.target).length;this.moveNow=!1,this.dragNow=!1,this.$button.removeClass("dragging"),d&&this.triggerClick&&!this.touchRightNow&&(this.triggerClick=!1,this.touchRightNow=!0,c.setTimeout(function(){b.touchRightNow=!1},400),this.showNextItem())},g.prototype._onMouseMove=function(a){if(this.moveNow){this.dragNow||(this.$button.addClass("dragging"),this.dragNow=!0),this.latestSizes||this.refreshSizes();var b=c.getEventPosition(a),d=this.latestSizes,e=d.canvas,f=b.left-e.left-d.button.width/2-d.scroll.left,g=b.top-e.top-d.button.height/2-d.scroll.top;this.triggerClick=!1,this.moveButton(f,g),a.preventDefault(),a.stopPropagation()}},g.prototype.refreshSizes=function(){var a={},b=this.drawer.fCanvas,d=b.upperCanvasEl.getBoundingClientRect(),e=this.$button[0].getBoundingClientRect();return a.canvas=d,a.button=e,a.scroll=c.getScrollTopFromElement(this.$button),this.latestSizes=a,a},g.prototype.refreshPositionLimits=function(){var a=this.$button.get(0).getBoundingClientRect(),b=2;this.positionLimit={left:this.drawer.width-a.width-b,top:this.drawer.height-a.height-b}},g.prototype.showButton=function(){this.$button.removeClass("hidden")},g.prototype.hideButton=function(){this.$button.addClass("hidden")},g.prototype.showNextItem=function(){var a,b,c=this,d=this.toolbarsForToggle[0];this.toolbarsForToggle.forEach(function(d,e){if(!d.invisible){var f=e+1;a=!0,b=c.toolbarsForToggle[f]}d.hideToolbar()}),a?b&&b.showToolbar():d.showToolbar()},b.ToggleVisibilityButton=g}(jQuery,DrawerJs.plugins,DrawerJs.util),function(a,b,c,d,e){"use strict";var f=a.fabric||(a.fabric={}),g=e.mouseDown("Zoom"),h=e.mouseMove("Zoom"),i=e.mouseUp("Zoom"),j=e.checkBrowser("webkit"),k=j?"-webkit-":"",l=function(a,b){this.drawer=a,this._setupOptions(b),this._init()};l.prototype._defaultOptions={enabled:!0,enableWhenNoActiveTool:!0,enableButton:!0,showZoomTooltip:!0,enableMove:!0,useWheelEvents:!0,moveCanvasOnWheel:!0,moveCanvasOnWheelStep:0,zoomStep:1.05,defaultZoom:1,maxZoom:32,minZoom:1,buttonOrder:11},l.prototype._init=function(){this.viewport=new c.ZoomViewport(this.drawer),this.enabled=this.options.enabled,this.zoomIsOn=!0,this.currentZoom=1,this._updateProto(),this.enabled&&(this._attachDrawerEvents(),this._updateDrawerValues())},l.prototype._setupOptions=function(a,c,d){c=c||this.name;var e=this.drawerInstance||this.drawer,f=e&&e.getPluginConfig(c),g=b.extend(!0,{},this._defaultOptions||{},f||{},a||{});return d||(this.options=g),g},l.prototype._updateProto=function(){this.drawer.on(this.drawer.EVENT_CANVAS_READY,this._updateCanvasProto.bind(this)),this.drawer.on(this.drawer.EVENT_CANVAS_READY,this._updateObjectProto.bind(this))},l.prototype._attachDrawerEvents=function(){this.drawer.on(this.drawer.EVENT_CONFIG_TOOLBAR_CREATED,this._onToolbarCreated.bind(this)),this.drawer.on(this.drawer.EVENT_RESTORE_DEFAULT_ZOOM,this.restoreDefaultZoom.bind(this)),this.drawer.on(this.drawer.EVENT_DO_ACTIVATE_TOOL,this._onActivateTool.bind(this)),this.drawer.on(this.drawer.EVENT_DO_DEACTIVATE_TOOL,this._ctxUpperRestore.bind(this)),this.drawer.on(this.drawer.EVENT_BEFORE_RENDER,this._ctxSet.bind(this)),this.drawer.on(this.drawer.EVENT_AFTER_RENDER,this._ctxRestore.bind(this)),this.drawer.on(this.drawer.EVENT_ZOOM_SET,this._ctxSet.bind(this)),this.drawer.on(this.drawer.EVENT_ZOOM_UNSET,this._ctxUnset.bind(this)),this.drawer.on(this.drawer.EVENT_ZOOM_RESTORE,this._ctxRestore.bind(this)),this.drawer.on(this.drawer.EVENT_ZOOM_UPPER_SET,this._ctxUpperSet.bind(this)),this.drawer.on(this.drawer.EVENT_ZOOM_UPPER_UNSET,this._ctxUpperUnset.bind(this)),this.drawer.on(this.drawer.EVENT_ZOOM_UPPER_RESTORE,this._ctxUpperRestore.bind(this)),this.drawer.on(this.drawer.EVENT_CANVAS_START_RESIZE,this._ctxSet.bind(this)),this.drawer.on(this.drawer.EVENT_CANVAS_STOP_RESIZE,this._ctxRestore.bind(this)),this.drawer.on(this.drawer.EVENT_SELECTION_CLEARED,this._refreshButton.bind(this)),this.drawer.on(this.drawer.EVENT_OBJECT_SELECTED,this._refreshButton.bind(this)),this.drawer.on(this.drawer.EVENT_TOOL_ACTIVATED,this._refreshButton.bind(this)),this.drawer.on(this.drawer.EVENT_TOOL_DEACTIVATED,this._refreshButton.bind(this))},l.prototype._refreshButton=function(){this._refreshMoveButtonState()},l.prototype._ctxUpperSet=function(){var a=this.drawer.fCanvas,b=a.contextTop;b.save(),b.scale(this.viewport.zoom,this.viewport.zoom),b.translate(this.viewport.position.x,this.viewport.position.y)},l.prototype._ctxUpperUnset=function(){var a=this.drawer.fCanvas,b=a.contextTop;b.save(),b.scale(1/this.viewport.zoom,1/this.viewport.zoom),b.translate(-this.viewport.position.x,-this.viewport.position.y)},l.prototype._ctxUpperRestore=function(){var a=this.drawer.fCanvas,b=a.contextTop;b.restore()},l.prototype._ctxSet=function(){var a=this.drawer.fCanvas,b=a.contextContainer;b.save(),b.scale(this.viewport.zoom,this.viewport.zoom),b.translate(this.viewport.position.x,this.viewport.position.y)},l.prototype._ctxUnset=function(){var a=this.drawer.fCanvas,b=a.contextContainer;b.save(),b.scale(1/this.viewport.zoom,1/this.viewport.zoom),b.translate(-this.viewport.position.x,-this.viewport.position.y)},l.prototype._ctxRestore=function(){var a=this.drawer.fCanvas,b=a.contextContainer;b.restore()},l.prototype._onActivateTool=function(a,b){b.doNotZoomOnActivate||this._ctxUpperSet()},l.prototype._onDeactivateTool=function(a,b){b.doNotZoomOnActivate||this._ctxUpperRestore()},l.prototype._onToolbarCreated=function(a,b){this.toolbar=b;var c=!0;c&&(this.createControls(b),this._createHelperElements(),this._attachEvents())},l.prototype._removeHelperElements=function(){this.$zoomTooltip&&this.$zoomTooltip.length&&(this.$zoomTooltip.remove(),delete this.$zoomTooltip)},l.prototype._createHelperElements=function(){this._removeHelperElements();var a='<div class="zoom-tooltip transparent-tooltip"></div>',c=b(a),d=this.drawer.$canvasEditContainer;this.$zoomTooltip=c,d.append(c)},l.prototype._attachEvents=function(){var a=this;if(this.options.showZoomTooltip){var b=function(){a.$zoomTooltip.addClass("transparent-tooltip")},c=e.debounce(b,1e3);this.drawer.on(this.drawer.EVENT_ZOOM_CHANGE,function(b,d){var e=parseInt(100*d.zoom,10)+"%";a.$zoomTooltip.text(e),a.$zoomTooltip.removeClass("transparent-tooltip"),c()})}this.options.enableButton&&this.drawer.on(this.drawer.EVENT_ZOOM_CHANGE,function(b,c){var d=1===c.prevValues.zoom&&1!==c.zoom||1===c.zoom&&1!==c.prevValues.zoom;d&&a._refreshMoveButtonState()})},l.prototype.createControls=function(a){this._createAndAddButton(a),this._attachWheelEvents(),this._attachMoveEvents(),this._attachTouchEvents()},l.prototype._createAndAddButton=function(a){var b,c,d,e={buttonOrder:this.options.buttonOrder,additionalClass:"btn-zoom-in",iconClass:"fa-search-plus",tooltipText:this.drawer.t("Zoom in"),clickHandler:this._onZoomIn.bind(this)},f={buttonOrder:this.options.buttonOrder,additionalClass:"btn-zoom-out",iconClass:"fa-search-minus",tooltipText:this.drawer.t("Zoom out"),clickHandler:this._onZoomOut.bind(this)},g={buttonOrder:this.options.buttonOrder,additionalClass:"btn-zoom-move",iconClass:"fa-search",tooltipText:this.drawer.t("Move canvas"),clickHandler:this._onMoveButtonClick.bind(this)};b=a.addButton(e),c=a.addButton(f),this.options.enableMove&&this.options.enableButton&&(d=a.addButton(g)),this.toolbar=a,this.$zoomInButton=b,this.$zoomOutButton=c,this.$moveCanvasButton=d},l.prototype._onMoveButtonClick=function(){var a=this.$moveCanvasButton.hasClass("disabled");a||(this.moveButtonIsActive=!this.moveButtonIsActive,this._refreshMoveButtonState(!0))},l.prototype._getZoomPopertiesFromEvent=function(a,b,c){var d,e,f={},g=this.currentZoom*(c?this.options.zoomStep:1/this.options.zoomStep);if(b){var h=this.drawer.getRelativeEventPosition(a,!0),i=h.left/g-this.viewport.position.x,j=h.top/g-this.viewport.position.y,k=i-this.zoomCenterX,l=j-this.zoomCenterY;d=this.zoomCenterX+k*this.options.moveCanvasOnWheelStep,e=this.zoomCenterY+l*this.options.moveCanvasOnWheelStep}else d=this.zoomCenterX,e=this.zoomCenterY;return f.zoom=g,f.zoomCenterX=d,f.zoomCenterY=e,f},l.prototype._onZoomIn=function(a,b){if(this.zoomIsOn){var c=this._getZoomPopertiesFromEvent(a,b,!0);this.setZoom(c.zoom,c.zoomCenterX,c.zoomCenterY,!0)}},l.prototype._onZoomOut=function(a,b){if(this.zoomIsOn){var c=this._getZoomPopertiesFromEvent(a,b,!1);this.setZoom(c.zoom,c.zoomCenterX,c.zoomCenterY,!0)}},l.prototype._attachWheelEvents=function(){if(this.options.useWheelEvents){this.wheelEventsAttached=!0;var a=this.drawer.$canvasEditContainer.find(".canvas-container").get(0);e.addWheelListener(a,this._onWheelEvent.bind(this),!0)}},l.prototype._attachMoveEvents=function(){if(this.options.enableMove){var a=b(window.document),c=this.drawer.$canvasEditContainer.find(".canvas-container");c.off(g).on(g,this._moveOnMouseDown.bind(this)),a.off(h).on(h,this._moveOnMouseMove.bind(this)),a.off(i).on(i,this._moveOnMouseUp.bind(this))}},l.prototype._moveOnMouseDown=function(a){var c=this.drawer.fCanvas.getActiveObject(),d=this.drawer.activeDrawingTool,e=this.moveButtonIsActive,f=this.options.enableButton&&e,g=this.options.enableWhenNoActiveTool&&(!this.options.enableButton||f),h=1===this.currentZoom||c||d,i=!h&&(f||g);if(i){var j=this.drawer.getRelativeEventPosition(a);this.drawer.movingNow=!0,this.isMoving=!0,this.moveStartPoint=j,this.moveLastPoint=j;var l=b("body");return this.drawer.fCanvas.defaultCursor=k+"grabbing",this.drawer.fCanvas.setCursor(k+"grabbing"),l.addClass("drawer-dragging drawer-zoom-moving"),a.preventDefault(),a.stopPropagation(),!1}},l.prototype._refreshMoveButtonState=function(a){if(this.savedDefaultCursor=this.savedDefaultCursor||this.drawer.fCanvas.defaultCursor,this.options.enableButton)if(1===this.currentZoom)this.$moveCanvasButton.addClass("disabled"),this.drawer.fCanvas.defaultCursor=this.savedDefaultCursor,this.drawer.fCanvas.setCursor(this.savedDefaultCursor);else{if(!a){var c=this._checkMovePermission(!a);this.moveButtonIsActive=c}this.$moveCanvasButton.removeClass("disabled"),this.moveButtonIsActive?(this._prepareDrawerForZoom(),this.drawer.fCanvas.defaultCursor=k+"grab",this.drawer.fCanvas.setCursor(k+"grab"),b("body").addClass("drawer-zoom-move-available"),this.toolbar.setActiveButton("btn-zoom-move")):(this.drawer.fCanvas.defaultCursor=this.savedDefaultCursor,this.drawer.fCanvas.setCursor(this.savedDefaultCursor),b("body").removeClass("drawer-zoom-move-available"),this.toolbar.clearActiveButton())}else this.drawer.fCanvas.defaultCursor=k+"grab",this.drawer.fCanvas.setCursor(k+"grab"),b("body").addClass("drawer-zoom-move-available")},l.prototype._prepareDrawerForZoom=function(){this.drawer.trigger(this.drawer.EVENT_DO_DEACTIVATE_ALL_TOOLS),this.drawer.fCanvas._clearSelection(),this.drawer.fCanvas.renderAll()},l.prototype._checkMovePermission=function(a){var b=this.drawer.fCanvas.getActiveObject(),c=this.drawer.activeDrawingTool,d=a&&this.moveButtonIsActive,e=!b&&!c&&(this.options.enableWhenNoActiveTool||d);return e},l.prototype._moveOnMouseMove=function(a){if(this.isMoving&&1!==this.currentZoom){var b=this,c=this.drawer.getRelativeEventPosition(a),d=this.moveLastPoint,f=d.left-c.left,g=d.top-c.top,h=this.zoomCenterX+f,i=this.zoomCenterY+g,j=function(){b.setZoom(b.currentZoom,h,i,!0)};return this.moveLastPoint=c,e.requestAnimationFrame(j),a.preventDefault(),a.stopPropagation(),!1}},l.prototype._moveOnMouseUp=function(a){if(this.isMoving){var c=b("body"),d=this;return e.setTimeout(function(){d.drawer.movingNow=!1},0),this.isMoving=!1,this.drawer.fCanvas.defaultCursor=k+"grab",this.drawer.fCanvas.setCursor(k+"grab"),c.removeClass("drawer-dragging drawer-zoom-moving"),a.preventDefault(),a.stopPropagation(),!1}},l.prototype._attachTouchEvents=function(){function a(a,b){var c;return c=Math.sqrt(Math.pow(a.left-b.left,2)+Math.pow(a.top-b.top,2))}var b,c,d=this,f=this.drawer.$canvasEditContainer;f.off("touchstart.drawerZoom").on("touchstart.drawerZoom",function(e){var f=e.touches?e.touches:e.originalEvent.touches;if(d.zoomIsOn&&f&&f.length>1){var g=getEventPosition(e,0),h=getEventPosition(e,1);g.left&&g.top||(g=getEventPosition(window.event,0),h=getEventPosition(window.event,1)),b=a(g,h),c=b,d._prepareDrawerForZoom()}}),f.off("touchmove.drawerZoom").on("touchmove.drawerZoom",function(b){var g=b.touches?b.touches:b.originalEvent.touches,h=d.zoomIsOn&&g&&g.length>1;if(h){var i=e.getEventPosition(b,0),j=e.getEventPosition(b,1);i.left&&i.top||(i=e.getEventPosition(window.event,0),j=e.getEventPosition(window.event,1));var k=a(i,j),l=k>c,m=d.currentZoom*(l?d.options.zoomStep:1/d.options.zoomStep),n=e.getScrollOffset(f),o=f.get(0),p=o.getBoundingClientRect(),q=i.left-(i.left-j.left)/2,r=i.top-(i.top-j.top)/2,s=q-p.left-n.left,t=r-p.top-n.top;d.setZoom(m,s,t,!0),c=k,b.stopPropagation(),b.preventDefault()}})},l.prototype._onWheelEvent=function(a){if(this.zoomIsOn){var b=a.deltaY||a.detail||a.wheelDelta;this._prepareDrawerForZoom(),b>0?this._onZoomOut(a,!0):this._onZoomIn(a,!0),a.stopPropagation(),a.preventDefault()}},l.prototype._updateDrawerValues=function(a){a=a||{};var b=this.drawer.width,c=this.drawer.height,d=this.viewport.getZoomCenter();this.zoomCenterX=void 0!==this.zoomCenterX?this.zoomCenterX:d.x,this.zoomCenterY=void 0!==this.zoomCenterY?this.zoomCenterY:d.y;var e=void 0!==a.zoomCenterX?a.zoomCenterX:this.zoomCenterX,f=void 0!==a.zoomCenterY?a.zoomCenterY:this.zoomCenterY,g=a.zoom;"number"==typeof g&&isFinite(g)||(g=this.currentZoom,"number"==typeof g&&isFinite(g)||(g=this.options.defaultZoom)),e>b&&(e=b),f>c&&(f=b),0>e&&(e=0),0>f&&(f=0),"number"==typeof this.options.minZoom&&(g=Math.max(g,this.options.minZoom)),"number"==typeof this.options.maxZoom&&(g=Math.min(g,this.options.maxZoom)),
this.drawer.currentZoom=this.currentZoom=g,this.drawer.zoomCenterX=this.zoomCenterX=e,this.drawer.zoomCenterY=this.zoomCenterY=f},l.prototype.setZoom=function(a,b,c,d){var e,f,g="number"==typeof a&&isFinite(a),h=void 0!==d?d:!this.options.moveCanvasOnWheel;g?(e={zoom:this.currentZoom,zoomCenterX:this.zoomCenterX,zoomCenterY:this.zoomCenterY},this._updateDrawerValues({zoom:a,zoomCenterX:b,zoomCenterY:c}),f=this.viewport.setViewport(this.currentZoom,this.zoomCenterX,this.zoomCenterY,h),f.prevValues=e,this._updateDrawerValues(f),this.drawer.trigger(this.drawer.EVENT_ZOOM_CHANGE,[f])):console.info("invalid zoom value")},l.prototype._updateObjectProto=function(){var a=this,b=(f.Object.prototype._drawControl,f.Object.prototype.drawControls,f.Object.prototype.getPointByOrigin),c=f.Object.prototype._setCornerCoords;f.Object.prototype._setCornerCoords=function(){var b,d=a.viewport,e=d?d.zoom:1;return this.cornerSize=this.cornerSize/e,b=c.apply(this,arguments),this.cornerSize=this.cornerSize*e,b},f.Object.prototype.getPointByOrigin=function(){var c,d=a.viewport,e=d?d.zoom:1;return this.cornerSize=this.cornerSize/e,c=b.apply(this,arguments),this.cornerSize=this.cornerSize*e,c}},l.prototype._updateCanvasProto=function(){var a=this,b=this.drawer.fCanvas,c=b.getPointer,d=b._drawSelection;b.getPointer=function(){var b=c.apply(this,arguments);if(!isFinite(b.x)||!isFinite(b.y)){var d=a.drawer.$canvasEditContainer,f=d.get(0).getBoundingClientRect(),g=e.getEventPosition(window.event),h=e.getScrollOffset(a.drawer.$canvasEditContainer),i=g.left-h.left-f.left,j=g.top-h.top-f.top;b={x:i,y:j}}var k=a.viewport.position.x,l=a.viewport.position.y,m=parseInt(b.x/a.viewport.zoom-k,10),n=parseInt(b.y/a.viewport.zoom-l,10);return b.oldX=b.x,b.oldY=b.y,b.newX=m,b.newY=n,b.x=m,b.y=n,b},b._drawSelection=function(){var a;return a=this.contextTop,a.save(),a.scale(this.viewport.zoom,this.viewport.zoom),a.translate(this.viewport.position.x,this.viewport.position.y),d.apply(this,arguments),a.restore(),a}},l.prototype.restoreDefaultZoom=function(){var a,b=this.options.defaultZoom,c=this.viewport.getZoomCenter();this.setZoom(b,c.x,c.y,!0),this.viewport.setToCenterOfCanvas(1),a=this.viewport.getData(),this._updateDrawerValues(a)},d.prototype.setZoom=function(a,b,c){var d=this.drawer.getPluginInstance("Zoom");d&&d.setZoom(a,b,c,!0)},d.prototype.restoreDefaultZoom=function(){var a=this.drawer.getPluginInstance("Zoom");a&&a.restoreDefaultZoom()},c.Zoom=l}(this,jQuery,DrawerJs.plugins,DrawerJs.DrawerApi,DrawerJs.util),function(a,b,c){"use strict";var d=a.fabric||(a.fabric={}),e=function(a){return this.drawer=a,this.i=0,this.position=new d.Point(0,0),this.zoom=1,this};e.prototype.setViewport=function(a,b,c,d){return this._adjustPosition(a,b,c,d),this._render(),this.getData()},e.prototype.getData=function(){var a={},b=this.getZoomCenter();return a.zoom=this.zoom,a.position={x:this.position.x,y:this.position.y},a.zoomCenterX=b.x,a.zoomCenterY=b.y,a},e.prototype.getZoomCenter=function(){var a={},b=this.drawer.width,c=this.drawer.height,d=b/this.zoom,e=c/this.zoom,f=d/2-this.position.x,g=e/2-this.position.y;return a.x=f,a.y=g,a},e.prototype._validatePosition=function(a,b,c){b=b||0,c=c||0;var d=this.drawer.width,e=this.drawer.height,f=d/a,g=e/a,h=d-f,i=e-g;return-h>b&&(b=-h),-i>c&&(c=-i),b>0&&(b=0),c>0&&(c=0),{x:b,y:c}},e.prototype.setToCenterOfCanvas=function(a){a=a||this.zoom;var b=this.drawer.width/2,c=this.drawer.height/2;this._adjustPosition(a,b,c,!0),this._render()},e.prototype._render=function(){this.drawer.fCanvas.renderAll()},e.prototype.setPosition=function(a,b,c){a=a||this.zoom;var d=this._validatePosition(a,b,c);this.position.x=d.x,this.position.y=d.y,this.zoom=a},e.prototype._adjustPosition=function(a,b,c,d){this.position.x=this.position.x||0,this.position.y=this.position.y||0;var e,f,g=this.drawer.width,h=this.drawer.height,i=a/this.zoom,j=g/this.zoom,k=h/this.zoom,l=g/a,m=h/a;if(d)e=l/2-b,f=m/2-c;else if(void 0!==b&&void 0!==c){var n=(b-g/2)/this.zoom,o=(c-g/2)/this.zoom;e=this.position.x-n-(j-l)/2,f=this.position.y-o-(k-m)/2}else e=g/2-i*(g/2-this.position.x),f=h/2-i*(h/2-this.position.y);return this.setPosition(a,e,f),this.position},c.ZoomViewport=e}(this,jQuery,DrawerJs.plugins),function(a,b,c){"use strict";var d=function(a){c.call(this,a),this.name="BrushSize",this.optionName="brushSize",this.$sizeControl=null,a.on(a.EVENT_BRUSH_SIZE_CHANGED,this.updateValue.bind(this)),a.on(a.EVENT_BRUSH_CHANGED,this.updateValue.bind(this))};d.prototype=Object.create(c.prototype),d.prototype.constructor=c,d.prototype.createControls=function(a){this.createSizeControl(a)},d.prototype.removeTool=function(a){this.$sizeControl.remove(),a&&this.drawer.off(this.drawer.EVENT_OPTIONS_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},d.prototype.createSizeControl=function(b){var c=this;c.$sizeControl=a('<li style="display:none" class="editable-canvas-brushsize toolbar-item-range"><div class="toolbar-item-description"><span class="toolbar-label">'+this.drawer.t("Size:")+' </span><span class="toolbar-label toolbar-label-indicator editable-canvas-brushsize-indicator">0px</span></div><input class="editable-canvas-brushsize-input" type="range" name="drawer-size" min="1"value="0" /></li>'),b.addControl(c.$sizeControl,this.options.buttonOrder),a(c.$sizeControl).on("change",function(){var b=a(c.$sizeControl).find("input").val();a(c.$sizeControl).find(".editable-canvas-brushsize-indicator").text(b+"px"),c.drawer.setBrushSize(b)})},d.prototype.showControls=function(){this.updateValue(),this.$sizeControl.show()},d.prototype.hideControls=function(){this.$sizeControl.hide()},d.prototype.updateValue=function(){var a=this.drawer.getBrushSize();this.$sizeControl.find("input").val(a),this.$sizeControl.find(".editable-canvas-brushsize-indicator").text(a+"px")},b.BrushSize=d}(jQuery,DrawerJs.plugins,DrawerJs.plugins.BaseToolOptions),function(a,b,c){"use strict";var d=function(a,d){c.call(this,a),this._setupOptions(d),this.colorControl=new b.ColorpickerControl(this.drawer,this.options),this.opacityControl=new b.OpacityControl(this.drawer,this.options)};d.prototype=Object.create(c.prototype),d.prototype.constructor=c,d.prototype.optionName="color",d.prototype._defaultOptions={showOpacityControl:!1,alwaysVisible:!0,colorText:"Fill:"},d.prototype.createControls=function(a){this.colorControl.createControl(a,this._onColorSelected.bind(this)),this.opacityControl.createControl(a,this._onOpacityControlChanged.bind(this))},d.prototype._onColorSelected=function(a){if("transparent"==a){var b=this.opacityControl.getOpacity(),c=this._hexToRgba(a,b);this.drawer.setColor(c)}else this.drawer.setColor(a)},d.prototype._onOpacityControlChanged=function(a){var b=this.drawer.activeColor,c=this._hexToRgba(b,a);this.drawer.setColor(c)},d.prototype.updateControlsFromObject=function(a){var b=null;a.path?(b=a.get("stroke"),this.colorControl.disableTransparent()):(b=a.get("fill"),this.colorControl.enableTransparent()),b&&(this.updateControlsWithColor(b),this.drawer.activeColor=b)},d.prototype.updateControlsWithColor=function(a){this.colorControl.setColor(a);var b=new fabric.Color(a),c=b._source,d=c[3];this.opacityControl.setOpacity(d)},d.prototype.showControls=function(a){a=void 0!==a?a:!this.options.showOpacityControl,this.colorControl.showControls(),a?this.opacityControl.hideControls():this.opacityControl.showControls()},d.prototype.hideControls=function(a){var b=this.drawer.options.toolbars.popupButtonAlwaysVisible||this.options.alwaysVisible;(a||!b)&&(this.colorControl.hideControls(),this.opacityControl.hideControls())},d.prototype._hexToRgba=function(a,b){var c=new fabric.Color(a);return c._source[3]=b,c.toRgba()},b.Color=d}(jQuery,DrawerJs.plugins,DrawerJs.plugins.BaseToolOptions,DrawerJs.util),function(a,b,c){"use strict";var d=375,e=function(b,d){this.drawer=b,d=d||{},this.options=a.extend(!0,{},this._defaultOptions||{},d||{}),this.hideOnEditMode=!0,this.assetsUrl=c.getDrawerFolderUrl()+"assets/",this.shouldDisplayTransparent=!1,this.colors=this.options.colors,this.colorsInRow=this.options.colorsInRow};e.prototype._defaultOptions={colors:["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],colorsInRow:11,minSwatchSize:10,buttonOrder:6},e.prototype.TRANSPARENT="rgba(0, 0, 0, 0)",e.prototype.defaultPosition="bottom",e.prototype.positions=["bottom","top","left","right"],e.prototype.remove=function(){this.$colorButton&&this.$colorButton.remove()},e.prototype.hideControls=function(){this.$colorButton&&this.$colorButton.addClass("hidden")},e.prototype.showControls=function(){this.$colorButton&&this.$colorButton.removeClass("hidden")},e.prototype.getColor=function(){return this.currentColor},e.prototype.setColor=function(a){this.currentColor=a instanceof fabric.Color?a:new fabric.Color(a);var b=a,c=""===a||a==this.TRANSPARENT||"transparent"==a;c&&(b="url("+this.assetsUrl+"transparent.png)",this.currentColor=this.TRANSPARENT),this.$colorButton.$colorIndicator.css("background",b)},e.prototype.disableTransparent=function(){this.shouldDisplayTransparent=!1,this.$colorButton&&this.$colorButton.find(".transparent").hide()},e.prototype.enableTransparent=function(){this.shouldDisplayTransparent=!0,this.$colorButton&&this.$colorButton.find(".transparent").show()},e.prototype.onColorSelected=function(a){this.hideColorDropdown(),this.setColor(a),this.colorChangeHandler&&this.colorChangeHandler(a)},e.prototype._setGlobalClickHandler=function(){var b=this;a("html").click(function(a){return b.colorDropdownVisible&&a.target!=b.$colorButton.$colorIndicator.get(0)&&b.hideColorDropdown(),!0})},e.prototype.createControl=function(b,c){return this.$colorButton=a(this._getControlHtml()),this._collectDataFromToolbar(b),this.$colorButton.$colorIndicator=this.$colorButton.find(".color-indicator"),this.$colorButton.$colorDropdown=this.$colorButton.find(".color-dropdown"),this.$colorButton.$colorIndicator.css("background-color",this.drawer.activeColor),this.colorDropdownVisible=!1,this.$colorButton.$colorIndicator.click(this._onButtonClick.bind(this)),this.colorChangeHandler=c,this._buildPicker(this.$colorButton.$colorDropdown),this._setGlobalClickHandler(),b.addControl(this.$colorButton,this.options.buttonOrder),this.$colorButton},e.prototype._onButtonClick=function(b){var c=a(b.currentTarget);this.$lastTrigger=c,this.toggleColorDropdown(c)},e.prototype._collectDataFromToolbar=function(a){if(a){var b=a.options.position;this.isVertical="left"===b||"right"===b,this.$toolbar=a.$toolbar,this.toolbar=a}},e.prototype._buildPicker=function(a){for(var b=0;b<this.colors.length;b++){var c=this.colors[b],d=this._createSwatch(c);a.append(d)}var e=this._createTransparentSwatch();a.append(e)},e.prototype._updateControlsSize=function(){var a=this._calcSwatchSize();this.$colorButton.$colorDropdown.css("fontSize",a+"px");var b=a*this.colorsInRow;this.$colorButton.$colorDropdown.css("width",b+"px")},e.prototype._calcSwatchSize=function(){var a=this.drawer.touchDevice?this.drawer.options.toolbarSize:this.drawer.options.toolbarSizeTouch;a=a||this.options.minSwatchSize;var b=Math.floor(.95*this.drawer.width/this.colorsInRow),c=this.drawer.height+this.drawer.toolbars.toolOptionsToolbar.height(),d=Math.floor(c/(this.colors.length/this.colorsInRow)),e=Math.min(b,d);return a>e&&(a=Math.max(e,this.options.minSwatchSize)),a},e.prototype._getAvailableSpace=function(a){var b;if(a&&a.length){var c=this.drawer.$canvasEditContainer,d=this.$colorButton.$colorDropdown.closest(".popup-content-wrapper"),e=this.$colorButton.$colorDropdown.closest(".toolbar-content-wrapper"),f=c.get(0).getBoundingClientRect(),g=a.get(0).getBoundingClientRect(),h=e.get(0).getBoundingClientRect(),i=d.get(0).getBoundingClientRect(),j=this.$colorButton.$colorDropdown.get(0).getBoundingClientRect(),k=0,l=g.left-f.left,m=g.top-f.top;b={},b.top=m,b.left=l,b.right=f.width-l-g.width,b.bottom=f.height-m-g.height,b.centerX=l+g.width/2,b.centerY=m+g.height/2,b.palette={arrowSize:k,top:j.height,bottom:j.height,left:j.width,right:j.width},b.popupSizes=i,b.toolbarSizes=h,b.paletteSizes=j,b.canvasSizes=f,b.triggerSizes=g}return this.sizes=b,b},e.prototype._resetPalette=function(){this.$colorButton.$colorDropdown.removeClass("palette-with-scroll"),this.$colorButton.$colorDropdown.removeAttr("style"),this.$colorButton.$colorDropdown.removeAttr("data-position")},e.prototype._setFullSize=function(){var a=this.sizes,b=a.toolbarSizes.left-a.canvasSizes.left,c=a.toolbarSizes.top-a.canvasSizes.top,d={};d.top=-c,d.left=-b,d.width=a.canvasSizes.width,d.height=a.canvasSizes.height,this.$colorButton.$colorDropdown.css(d)},e.prototype._adjustPosition=function(a){this._resetPalette();var b,c=this._getAvailableSpace(a);this.positions.forEach(function(a){var d=c[a]&&c.palette[a];if(!b&&d){var e=c.palette[a]+c.palette.arrowSize,f=c[a]-e>0;b=f&&a}}),b?this._movePalette(b):this._setFullSize()},e.prototype._cropSizeOfPalette=function(){var a,b=this.$colorButton.$colorDropdown.get(0).getBoundingClientRect(),c=this.sizes.canvasSizes,d={},e=c.height-(b.height+b.top-c.top),f=b.top-c.top,g=c.width-(b.width+b.left-c.left),h=b.left-c.left,i=Math.min(e,f),j=Math.min(g,h);0>i&&(a=!0,d.height=b.height+i),0>j&&(a=!0,d.width=b.width+j),a&&this.$colorButton.$colorDropdown.addClass("palette-with-scroll"),this.$colorButton.$colorDropdown.css(d)},e.prototype._movePalette=function(a){var b,c,d,e,f,g,h=this.sizes,i=this.sizes.toolbarSizes.left-this.sizes.canvasSizes.left,j=this.sizes.toolbarSizes.top-this.sizes.canvasSizes.top,k={},l=h.paletteSizes.width/2,m=h.paletteSizes.height/2;switch(a){case"left":c=h.left-h.paletteSizes.width-h.palette.arrowSize,d=h.centerY-h.paletteSizes.height/2,k.right=h.toolbarSizes.width-(h.left-i);break;case"right":c=h.canvasSizes.width-h.right+h.palette.arrowSize,d=h.centerY-h.paletteSizes.height/2,k.left=h.left-i+h.triggerSizes.width;break;case"top":b=!0,c=h.centerX-h.paletteSizes.width/2,d=h.top-h.paletteSizes.height-h.palette.arrowSize,k.bottom=h.toolbarSizes.height-(h.top-j);break;case"bottom":b=!0,c=h.centerX-h.paletteSizes.width/2,d=h.canvasSizes.height-h.bottom+h.palette.arrowSize,k.top=h.top-j+h.triggerSizes.height}b?(e=c+h.paletteSizes.width-h.canvasSizes.width,f=h.canvasSizes.width-h.paletteSizes.width>0,e>0&&c>0&&!f?(l+=e,k.right=0-i):(0>c&&(l+=c,c=0),g=!0,k.width=h.canvasSizes.width,k.left=c-i)):(e=d+h.paletteSizes.height-h.canvasSizes.height,f=h.canvasSizes.height-h.paletteSizes.height>0,e>0&&d>0&&!f?(m+=e,k.bottom=0-j):(g=!0,0>d&&(m+=d,d=0),k.height=h.canvasSizes.width,k.top=d-j)),g&&this.$colorButton.$colorDropdown.addClass("palette-with-scroll"),this.$colorButton.$colorDropdown.attr("data-position",a),this.$colorButton.$colorDropdown.css(k),this._cropSizeOfPalette()},e.prototype._adjustControlsPosition=function(){var a,b=this.drawer.width<d,c=this.drawer.height<d,e=this.isVertical?c:b,f=this.drawer.$canvasEditContainer.get(0).getBoundingClientRect(),g=this.$colorButton.get(0).getBoundingClientRect(),h=10;if(this.$colorButton.$colorDropdown.removeAttr("style"),a=this.$colorButton.$colorDropdown.get(0).getBoundingClientRect(),this.isVertical)if(e)this.$colorButton.$colorDropdown.css("top",0);else{var i=g.top-f.top,j=i+g.height/2-a.height/2;this.$colorButton.$colorDropdown.css("top",j)}else if(e)this.$colorButton.$colorDropdown.css("left",0);else{var k=g.left-f.left,l=k+g.width/2-a.width/2;this.$colorButton.$colorDropdown.css("left",l)}if(!e)if(a=this.$colorButton.$colorDropdown.get(0).getBoundingClientRect(),this.isVertical){e=d-a.height>h;var m=a.top>f.top,n=a.top+a.height<f.top+f.height,o=m,p=n&&!e;o||(this.$colorButton.$colorDropdown.removeAttr("style"),this.$colorButton.$colorDropdown.css("top",0)),p||(this.$colorButton.$colorDropdown.removeAttr("style"),this.$colorButton.$colorDropdown.css({bottom:0,top:"auto"}))}else{e=d-a.width>h;var q=a.left>f.left,r=a.left+a.width<f.left+f.width,s=q,t=r&&!e;s||(this.$colorButton.$colorDropdown.removeAttr("style"),this.$colorButton.$colorDropdown.css("left",0)),t||(this.$colorButton.$colorDropdown.removeAttr("style"),this.$colorButton.$colorDropdown.css({right:0,left:"auto"}))}},e.prototype._getControlHtml=function(){var a=this.options.colorText||"";return'<li class="colorpicker-control" data-editable-canvas-sizeable="toolbar-button" ><span class="toolbar-label" data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="line-height">'+this.drawer.t(a)+' </span><span class="color-indicator" data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="width"></span><span class="color-dropdown control-hidden hidden" data-editable-canvas-sizeable="toolbar-button"></span></li>'},e.prototype._createSwatch=function(b,d){var e=a('<a href="#"></a>');return e.attr("rel",b).addClass("color-swatch").css({"background-color":b}),d&&e.addClass(d),c.bindClick(e,"colorpicker",this._swatchClickHandler.bind(this)),e},e.prototype._swatchClickHandler=function(b){b.preventDefault(),b.stopPropagation();var c=a(b.target).attr("rel");return this.onColorSelected(c),!1},e.prototype._createTransparentSwatch=function(){var a=this._createSwatch(this.TRANSPARENT,"transparent");return a.text(this.drawer.t("Transparent")),this.shouldDisplayTransparent||a.hide(),a},e.prototype.showColorDropdown=function(b){this.colorDropdownVisible=!0,this._updateControlsSize();var c=this.$toolbar.closest(".popup-content-wrapper").length;this.$colorButton.$colorDropdown.removeClass("hidden"),c?this._adjustPosition(b):this._adjustControlsPosition(),this.$colorButton.$colorDropdown.removeClass("control-hidden"),"scrollable"===this.toolbar.options.compactType&&(this.$cloneControl=a('<div class="colorpicker-control"></div>'),this.$cloneDropdown=this.$colorButton.$colorDropdown.clone(!0),this.$cloneControl.append(this.$cloneDropdown),this.$toolbar.closest(".toolbar-placeholder").append(this.$cloneControl))},e.prototype.hideColorDropdown=function(){this.colorDropdownVisible=!1,this.$colorButton.$colorDropdown.addClass("hidden"),this.$colorButton.$colorDropdown.addClass("control-hidden"),this.$cloneControl&&this.$cloneControl.remove()},e.prototype.toggleColorDropdown=function(a){this.colorDropdownVisible?this.hideColorDropdown():this.showColorDropdown(a)},b.ColorpickerControl=e}(jQuery,DrawerJs.plugins,DrawerJs.util),function(a,b){"use strict";var c=function(b,c){this.drawer=b,this.options=a.extend(!0,{},this._defaultOptions||{},c||{}),this._opacity=this.options.defaultOpacity,this.drawer.on(this.drawer.AFTER_CREATE_TOOLBARS,this._moveControlToEnd.bind(this))};c.prototype._defaultOptions={defaultOpacity:1},c.prototype.remove=function(){this.$opacityControl&&this.$opacityControl.remove()},c.prototype._moveControlToEnd=function(){var a="popup"===this.toolbar.options.compactType;if(a){var b=this.$opacityControl.parent();b.append(this.$opacityControl)}},c.prototype.hideControls=function(){this.$opacityControl&&this.$opacityControl.addClass("hidden")},c.prototype.showControls=function(){this.$opacityControl&&this.$opacityControl.removeClass("hidden")},c.prototype.getOpacity=function(){return this._opacity},c.prototype.setOpacity=function(a){this._opacity=a,this.$opacityControl.find("input").val(100*a),this.$opacityControl.find(".editable-canvas-opacity-indicator").text(100*a+"%")},c.prototype.onOpacityChange=function(){var b=a(this.$opacityControl).find("input"),c=parseInt(b.val(),10),d="number"==typeof c&&isFinite(c),e=d?c:this.options.defaultOpacity,f=parseInt(e,10)+"%";this._opacity=e/100,this.$opacityIndicator.text(f),this.opacityChangeCallback&&this.opacityChangeCallback(this._opacity)},c.prototype.createControl=function(b,c){return this.toolbar=b,this.opacityChangeCallback=c,this.$opacityControl=a('<li class="editable-canvas-opacity toolbar-item-range"><div class="toolbar-item-description"><span class="toolbar-label editable-canvas-opacity-label">'+this.drawer.t("Fill opacity:")+' </span><span class="toolbar-label toolbar-label-indicator editable-canvas-opacity-indicator">100%</span></div><input class="editable-canvas-opacity-input" type="range" name="drawer-size" min="0" max="100"value="100" /></li>'),this.$opacityIndicator=this.$opacityControl.find(".editable-canvas-opacity-indicator"),b.addControl(this.$opacityControl,this.options.buttonOrder),a(this.$opacityControl).on("change",this.onOpacityChange.bind(this)),this.$opacityControl},c.prototype.showControls=function(){this.$opacityControl.show()},c.prototype.hideControls=function(){this.$opacityControl.hide()},b.OpacityControl=c}(jQuery,DrawerJs.plugins,DrawerJs.util),function(a,b){var c=function(a){var b=this;this.drawerInstance=a,this.name="BrushSize",a.on(a.EVENT_OPTIONS_TOOLBAR_CREATED,function(a,c){b.createColorControl(c)})};c.prototype.createColorControl=function(b){var c=this,d=a('<li class="editable-canvas-plugin-color"data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="height"><span class="toolbar-label"data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="height,line-height">Color: </span><input class="editable-canvas-colorpicker" type="color" value="'+this.drawerInstance.activeColor+'" data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="height,width"/></li>');b.addControl(d,this.options.buttonOrder);var e=function(a){if(a){var b=a.target.value;c.drawerInstance.setColor(b)}};d.find("input").change(e)},b.ColorpickerHtml5=c}(jQuery,DrawerJs.plugins),function(a,b,c){"use strict";var d=function(a,b){c.call(this,a),this._setupOptions(b)};d.prototype=Object.create(c.prototype),d.prototype.constructor=c,d.prototype.name="LineWidth",d.prototype.optionName="lineWidth",d.prototype.useCombobox=!1,d.prototype.preventHightlight=!1,d.prototype.buttonMode=!1,d.prototype.buttonIconClass="fa-arrows-h",d.prototype._defaultOptions={digitsAfterDecimalPoint:0},d.prototype.onSelectionCleared=function(){this.data=!1},d.prototype.createControls=function(a){this.createControl(a),this._attachEvents()},d.prototype._generateHtml=function(){var a,b;b='<select class="editable-canvas-line-width-input controls-value-item" name="drawer-size"data-name="lineWidth"></select>';var c="toolbar-item-wrapper toolbar-item-range editable-canvas-line-width hidden",d=""+(this.buttonMode?" toolbar-button-item ":"")+(this.preventHightlight?" prevent-highlight ":""),e=c+d;return a='<li class="'+e+'"><div class="toolbar-item-description"><span class="toolbar-label editable-canvas-line-width-label">'+this.drawer.t("Line width:")+' </span><span class="toolbar-label toolbar-label-indicator editable-canvas-line-width-indicator"></span></div><input class="editable-canvas-line-width-input controls-value-item" name="drawer-line-width"data-name="lineWidth"type="range"min="1"max="1000"></li>'},d.prototype.createControl=function(b){var c=this._generateHtml();return this.$toolControl=a(c),this.$valueIndicator=this.$toolControl.find(".editable-canvas-line-width-indicator"),b.addControl(this.$toolControl,this.options.buttonOrder),this.$toolControl},d.prototype._attachEvents=function(){this.$toolControl&&this.$toolControl.on("input change toolbarOptionChange",this.onInputChange.bind(this))},d.prototype.validateValue=function(a){a=parseInt(a,10);var b,c="number"==typeof a&&isFinite(a)&&a;if(c){var d=Math.pow(10,this.options.digitsAfterDecimalPoint),e=parseInt(a*d,10)/d;b=e}return b},d.prototype.setLineWidth=function(a){var b=this.drawer.fCanvas,c=b.getActiveObject();if(c){this.data||this.collectDataFromObject(c);var d=parseInt(a/this.data.initialWidth*100,10)/100;c.x1=this.data.x1*d*c.scaleX,c.x2=this.data.x2*d*c.scaleX,c.y1=this.data.y1*d*c.scaleY,c.y2=this.data.y2*d*c.scaleY,c.set("x1",c.x1),c.set("x2",c.x2),c.set("y1",c.y1),c.set("y2",c.y2),c.set("top",this.data.top),c.set("left",this.data.left),b.renderAll()}},d.prototype.onInputChange=function(){var b=a(this.$toolControl).find("input"),c=b.val(),d=this.validateValue(c);this.$valueIndicator.text(d+"px"),this.setLineWidth(d)},d.prototype.collectDataFromObject=function(a){var b={},c=Math.pow(10,this.options.digitsAfterDecimalPoint),d=function(a,b){var d,e=Math.pow(a,2)+Math.pow(b,2),f=Math.sqrt(e),g=parseInt(f*c)/c;return d=g},e=a.x2-a.x1,f=a.y2-a.y1,g=e*a.scaleX,h=f*a.scaleY,i=e,j=f,k=Math.atan(f/e),l=Math.abs(fabric.util.radiansToDegrees(k));return b.lineWidth=d(g,h),b.initialWidth=d(i,j),b.angleRad=k,b.angleDeg=l,b.top=a.top,b.left=a.left,b.x1=a.x1,b.x2=a.x2,b.y1=a.y1,b.y2=a.y2,this.data=b,b},d.prototype.updateControls=function(a){a=a||this.data;var b=a.lineWidth,c=this.validateValue(b);this.$toolControl.find("input").val(c),this.$valueIndicator.text(c+"px")},d.prototype.showControls=function(){this.$toolControl.removeClass("hidden")},d.prototype.hideControls=function(){this.$toolControl.addClass("hidden")},b.LineWidth=d}(jQuery,DrawerJs.plugins,DrawerJs.plugins.BaseToolOptions,DrawerJs.util),function(a,b,c){"use strict";var d=function(a,b){c.call(this,a),this._setupOptions(b)};d.prototype=Object.create(c.prototype),d.prototype.constructor=c,d.prototype.optionName="opacity",d.prototype._defaultOptions={defaultValue:1,alwaysVisible:!0},d.prototype.createControls=function(a){this.createControl(a,this.setOpacity.bind(this))},d.prototype.createControl=function(b,c){return this.toolbar=b,this.opacityChangeCallback=c,this.$opacityControl=a('<li class="editable-canvas-opacity-option toolbar-item-range"><div class="toolbar-item-description"><span class="toolbar-label editable-canvas-opacity-option-label">'+this.drawer.t("Opacity :")+' </span><span class="toolbar-label toolbar-label-indicator editable-canvas-opacity-option-indicator">100%</span></div><input class="editable-canvas-opacity-option-input" type="range" name="drawer-size" min="0" max="100"value="100" /></li>'),this.$opacityIndicator=this.$opacityControl.find(".editable-canvas-opacity-option-indicator"),b.addControl(this.$opacityControl,this.options.buttonOrder),this.$opacityControl.on("change",this._onOpacityChange.bind(this)),this.$opacityControl},d.prototype.setOpacity=function(a){var b=this.drawer.fCanvas,c=b.getActiveObject();this.drawer.setOpacity(a),c&&(c.setOpacity(a),b.renderAll())},d.prototype._onOpacityChange=function(){var b=a(this.$opacityControl).find("input"),c=parseInt(b.val(),10),d="number"==typeof c&&isFinite(c),e=d?c:this.options.defaultOpacity,f=parseInt(e,10)+"%";this._opacity=e/100,this.$opacityIndicator.text(f),this.opacityChangeCallback&&this.opacityChangeCallback(this._opacity)},d.prototype.collectDataFromObject=function(a){var b={};return b.opacity=a.get("opacity"),this.data=b,b},d.prototype.updateControls=function(a){a=a||this.data;var b=a.opacity,c="number"==typeof b&&isFinite(b),d=c?b:this.options.defaultOpacity,e=parseInt(100*d,10)+"%";this.drawer.activeOpacity=d,this.$opacityControl.find("input").val(100*d),this.$opacityControl.find(".editable-canvas-opacity-option-indicator").text(e)},d.prototype.showControls=function(){this.$opacityControl.removeClass("hidden")},d.prototype.hideControls=function(a){var b=this.drawer.options.toolbars.popupButtonAlwaysVisible||this.options.alwaysVisible;(a||!b)&&this.$opacityControl.addClass("hidden")},b.OpacityOption=d}(jQuery,DrawerJs.plugins,DrawerJs.plugins.BaseToolOptions,DrawerJs.util),function(a,b,c){"use strict";var d=function(a,b){c.call(this,a),this._setupOptions(b)};d.prototype=Object.create(c.prototype),d.prototype.constructor=c,d.prototype.name="StrokeWidth",d.prototype.optionName="strokeWidth",d.prototype.useCombobox=!1,d.prototype.preventHightlight=!1,d.prototype.buttonMode=!1,d.prototype.buttonIconClass="fa-arrows-h",d.prototype._defaultOptions={digitsAfterDecimalPoint:0},d.prototype.onSelectionCleared=function(){this.data=!1},d.prototype.createControls=function(a){this.createControl(a),this._attachEvents()},d.prototype._generateHtml=function(){var a,b;b='<select class="editable-canvas-stroke-width-input controls-value-item" name="drawer-size"data-name="strokeWidth"></select>';var c="toolbar-item-wrapper toolbar-item-range editable-canvas-stroke-width hidden",d=""+(this.buttonMode?" toolbar-button-item ":"")+(this.preventHightlight?" prevent-highlight ":""),e=c+d;return a='<li class="'+e+'"><div class="toolbar-item-description"><span class="toolbar-label editable-canvas-stroke-width-label">'+this.drawer.t("Stroke width:")+' </span><span class="toolbar-label toolbar-label-indicator editable-canvas-stroke-width-indicator"></span></div><input class="editable-canvas-stroke-width-input controls-value-item" name="drawer-stroke-width"data-name="strokeWidth"type="range"min="1"max="50"></li>'},d.prototype.createControl=function(b){var c=this._generateHtml();return this.$toolControl=a(c),this.$valueIndicator=this.$toolControl.find(".editable-canvas-stroke-width-indicator"),b.addControl(this.$toolControl,this.options.buttonOrder),this.$toolControl},d.prototype._attachEvents=function(){this.$toolControl&&this.$toolControl.on("input change toolbarOptionChange",this.onInputChange.bind(this))},d.prototype.validateValue=function(a){a=parseInt(a,10);var b,c="number"==typeof a&&isFinite(a)&&a;if(c){var d=Math.pow(10,this.options.digitsAfterDecimalPoint),e=parseInt(a*d,10)/d;b=e}return b},d.prototype.setStrokeWidth=function(a){a=parseInt(a,10);var b=this.drawer.fCanvas,c=b.getActiveObject();this.drawer.lineStrokeWidth=a,c&&(this.data||this.collectDataFromObject(c),c.set("left",this.data.left),c.set("top",this.data.top),c.set("strokeWidth",parseInt(a,10)),b.renderAll())},d.prototype.onInputChange=function(){var b=a(this.$toolControl).find("input"),c=b.val(),d=this.validateValue(c);this.$valueIndicator.text(d+"px"),this.setStrokeWidth(d)},d.prototype.collectDataFromObject=function(a){var b={},c=(Math.pow(10,this.options.digitsAfterDecimalPoint),a.strokeWidth);return b.strokeWidth=c,b.top=a.top,b.left=a.left,this.data=b,b},d.prototype.updateControls=function(a){a=a||this.data;var b=a.strokeWidth,c=this.validateValue(b);this.drawer.lineStrokeWidth=c,this.$toolControl.find("input").val(c),this.$valueIndicator.text(c+"px")},d.prototype.showControls=function(){this.$toolControl.removeClass("hidden")},d.prototype.hideControls=function(){this.$toolControl.addClass("hidden")},b.StrokeWidth=d}(jQuery,DrawerJs.plugins,DrawerJs.plugins.BaseToolOptions,DrawerJs.util),function(a,b,c,d){"use strict";var e=function(a,b){d.call(this,a),this._setupOptions(b)};e.prototype=Object.create(d.prototype),e.prototype.constructor=d,e.prototype.name="TextAlign",e.prototype.optionName="TextAlign",e.prototype.useCombobox=!0,e.prototype.buttonMode=!0,e.prototype.focusTextOnChange=!0,e.prototype.preventHightlight=!0,e.prototype.showOnEditMode=!1,e.prototype.hideOnEditMode=!0,e.prototype.stylesToObject=!0,e.prototype.onlyPredefined=!0,e.prototype.buttonIconClass="fa-align-left",e.prototype.valueType={textAlign:"string"},e.prototype._defaultOptions={defaultValues:{textAlign:"left"},predefined:{textAlign:["left","center","right","justify"]},valueMap:{left:{value:"left",classString:"fa fa-align-left"},center:{value:"center",classString:"fa fa-align-center"},right:{value:"right",classString:"fa fa-align-right"},justify:{value:"justify",classString:"fa fa-align-justify"}}},e.prototype.controlTemplate=function(){var a,b,c;b=this.options.predefined.textAlign.map(function(a){return'<option value="'+a+'">'+a+"</option>"}).join(""),c='<select class="editable-canvas-text-textalign-input controls-value-item" name="drawer-size"data-name="textAlign"value="'+this.options.defaultValues.textAlign+'">'+b+"</select>";var d="toolbar-item-wrapper editable-canvas-text-option editable-canvas-text-textalign hidden",e=""+(this.buttonMode?" toolbar-button-item ":"")+(this.preventHightlight?" prevent-highlight ":""),f=d+e;

return a='<li class="'+f+'"><div class="toolbar-item-description"><span class="toolbar-item-label">'+this.drawer.t("Font size:")+' </span><span class="toolbar-item-valueholder"></span><span class="toolbar-item-icon fa '+this.buttonIconClass+'"></span></div><div class="toolbar-dropdown-block collapsed">'+c+"</div></li>"},b.TextAlign=e}(jQuery,DrawerJs.plugins,DrawerJs.util,DrawerJs.plugins.BaseTextOptionTool),function(a,b,c,d){"use strict";var e=function(a,c){d.call(this,a),this._setupOptions(c),this.colorControl=new b.ColorpickerControl(this.drawer,this.options)};e.prototype=Object.create(d.prototype),e.prototype.constructor=d,e.prototype.name="TextBackgroundColor",e.prototype.optionName="TextBackgroundColor",e.prototype.focusTextOnChange=!0,e.prototype.useCombobox=!1,e.prototype.buttonMode=!1,e.prototype._defaultOptions={colorText:"Text background:",defaultValues:{textBackgroundColor:""}},e.prototype.onlyPredefined=!0,e.prototype.valueType={textBackgroundColor:"color"},e.prototype.updateSingleControl=function(a,b){"textBackgroundColor"===a&&this.colorControl.setColor(b)},e.prototype.getStylesFromControls=function(){},e.prototype.getStylesFromChangeEvent=function(a){var b;return a&&("object"==typeof a&&(b=a.styles),"string"==typeof a&&(b={textBackgroundColor:a})),this._lastData=b,b},e.prototype.setupControl=function(a,b,c){this.colorChangeHandler=c,this.$toolControl=this.colorControl.createControl(a,this.onInputChange.bind(this)),this.$toolControl.$colorIndicator=this.$toolControl.find(".color-indicator"),this.$toolControl.$colorDropdown=this.$toolControl.find(".color-dropdown"),this.$toolControl.$colorIndicator.attr("data-name","textBackgroundColor"),this.$toolControl.$colorIndicator.addClass("controls-value-item"),this.$toolControl.addClass("editable-canvas-text-option editable-canvas-text-backgroundcolor"),this.colorDropdownVisible=!1},b.TextBackgroundColor=e}(jQuery,DrawerJs.plugins,DrawerJs.util,DrawerJs.plugins.BaseTextOptionTool),function(a,b,c,d){"use strict";var e=function(a,c){d.call(this,a),this._setupOptions(c),this.colorControl=new b.ColorpickerControl(this.drawer,this.options)};e.prototype=Object.create(d.prototype),e.prototype.constructor=d,e.prototype.name="TextColor",e.prototype.optionName="TextColor",e.prototype.focusTextOnChange=!0,e.prototype.onlyPredefined=!0,e.prototype._defaultOptions={colorText:"Font color:",defaultValues:{fill:""}},e.prototype.valueType={fill:"color"},e.prototype.updateSingleControl=function(a,b){"fill"===a&&this.colorControl.setColor(b)},e.prototype.getStylesFromControls=function(){},e.prototype.getStylesFromChangeEvent=function(a){var b;return a&&("object"==typeof a&&(b=a.styles),"string"==typeof a&&(b={fill:a})),this._lastData=b,b},e.prototype.setupControl=function(a,b,c){this.colorChangeHandler=c,this.$toolControl=this.colorControl.createControl(a,this.onInputChange.bind(this)),this.$toolControl.$colorIndicator=this.$toolControl.find(".color-indicator"),this.$toolControl.$colorDropdown=this.$toolControl.find(".color-dropdown"),this.$toolControl.$colorIndicator.attr("data-name","fill"),this.$toolControl.$colorIndicator.addClass("controls-value-item"),this.$toolControl.addClass("editable-canvas-text-option editable-canvas-text-color"),this.colorDropdownVisible=!1},b.TextColor=e}(jQuery,DrawerJs.plugins,DrawerJs.util,DrawerJs.plugins.BaseTextOptionTool),function(a,b,c,d){"use strict";var e=function(a,b){d.call(this,a),this._setupOptions(b)};e.prototype=Object.create(d.prototype),e.prototype.constructor=d,e.prototype.name="TextDecoration",e.prototype.optionName="TextDecoration",e.prototype.focusTextOnChange=!0,e.prototype.onlyPredefined=!0,e.prototype.buttonIconClass="fa-strikethrough",e.prototype.valueType={textDecoration:"string"},e.prototype._defaultOptions={defaultValues:{textDecoration:""},predefined:{textDecoration:["underline","overline","line-through"]}},e.prototype.controlTemplate=function(){var a,b,c;b=this.options.predefined.textDecoration.map(function(a){return'<option value="'+a+'">'+a+"</option>"}).join(""),c='<select class="editable-canvas-text-decoration-input controls-value-item" name="drawer-size"data-name="textDecoration"value="'+this.options.defaultValues.textDecoration+'">'+b+"</select>";var d="toolbar-item-wrapper editable-canvas-text-option editable-canvas-text-decoration hidden",e=this.buttonMode?" toolbar-button-item ":"",f=d+e;return a='<li class="'+f+'"><div class="toolbar-item-description"><span class="toolbar-item-label">'+this.drawer.t("Text Decoration:")+' </span><span class="toolbar-item-valueholder"></span><span class="toolbar-item-icon fa '+this.buttonIconClass+'"></span></div><div class="toolbar-dropdown-block collapsed">'+c+"</div></li>"},b.TextDecoration=e}(jQuery,DrawerJs.plugins,DrawerJs.util,DrawerJs.plugins.BaseTextOptionTool),function(a,b,c,d){"use strict";var e=function(a,b){d.call(this,a),this._setupOptions(b),this.activeFont=this.options.fonts[this.options.defaultFont],this.drawer.on(this.drawer.EVENT_TEXT_GET_STYLES,this._onGetStyles.bind(this))};e.prototype=Object.create(d.prototype),e.prototype.constructor=d,e.prototype.name="TextFontFamily",e.prototype.optionName="TextFontFamily",e.prototype.buttonIconClass="fa-font",e.prototype.focusTextOnChange=!0,e.prototype.onlyPredefined=!0,e.prototype.valueType={fontFamily:"string"},e.prototype._defaultOptions={defaultValues:{fontFamily:"Georgia"},fonts:{Georgia:"Georgia, serif",Palatino:"'Palatino Linotype', 'Book Antiqua', Palatino, serif","Times New Roman":"'Times New Roman', Times, serif",Arial:"Arial, Helvetica, sans-serif","Arial Black":"'Arial Black', Gadget, sans-serif","Comic Sans MS":"'Comic Sans MS', cursive, sans-serif",Impact:"Impact, Charcoal, sans-serif","Lucida Grande":"'Lucida Sans Unicode', 'Lucida Grande', sans-serif",Tahoma:"Tahoma, Geneva, sans-serif","Trebuchet MS":"'Trebuchet MS', Helvetica, sans-serif",Verdana:"Verdana, Geneva, sans-serif","Courier New":"'Courier New', Courier, monospace","Lucida Console":"'Lucida Console', Monaco, monospace"},defaultFont:"Georgia"},e.prototype.changeFont=function(a,b){var c=this;c.activeFont=c.options.fonts[a],b||c.setStyles({fontFamily:c.activeFont}),c.$toolControl.find(".editable-canvas-fontfamily").css("font-family",c.activeFont),c.$toolControl.find(".editable-canvas-fontfamily").text(a||""),c.$toolControl.find(".fonts-dropdown").addClass("hidden")},e.prototype.updateSingleControl=function(a,b){if("fontFamily"===a){var c=this.getFontByCss(b);this.changeFont(c,!0)}},e.prototype._collectDefaultOptions=function(){var b=this.drawer.getPluginConfig("Text"),c={fonts:a.extend(!0,{},b.fonts||{}),defaultFont:b.defaultFont};return c},e.prototype._onGetStyles=function(a,b,c){c=c||{},c.defaultValues=c.defaultValues||{},c.defaultValues.fontFamily=this.options.fonts[this.options.defaultFont]},e.prototype.getFontByCss=function(b){var c=null;return a.each(this.options.fonts,function(a,d){d==b&&(c=a)}),c},e.prototype.setupControl=function(b,d){var e=this;c.bindClick(d.find(".toolbar-label"),"fontFamily",function(){d.find(".fonts-dropdown").toggleClass("hidden")}),d.find("li a").each(function(b,d){var f=a(d);c.bindClick(f,"fontFamily",function(){var b=a(this).data("fontName");e.changeFont(b)})})},e.prototype.controlTemplate=function(){var b,c,d="";a.each(this.options.fonts,function(a,b){var c='<option style="font-family: '+b+';"value="'+a+'"data-font-name="'+a+'">'+a+"</option>";d+=c}),c='<select class="editable-canvas-text-fontfamily-input controls-value-item" name="drawer-size"data-name="fontFamily"value="'+this.options.defaultValues.fontFamily+'">'+d+"</select>";var e="toolbar-item-wrapper editable-canvas-text-option editable-canvas-text-fontfamily hidden",f=this.buttonMode?" toolbar-button-item ":"",g=e+f;return b='<li class="'+g+'"><div class="toolbar-item-description"><span class="toolbar-item-label">'+this.drawer.t("Font family:")+' </span><span class="toolbar-item-valueholder"></span><span class="toolbar-item-icon fa '+this.buttonIconClass+'"></span></div><div class="toolbar-dropdown-block collapsed">'+c+"</div></li>"},b.TextFontFamily=e}(jQuery,DrawerJs.plugins,DrawerJs.util,DrawerJs.plugins.BaseTextOptionTool),function(a,b,c,d){"use strict";var e=function(a,b){d.call(this,a),this._setupOptions(b)};e.prototype=Object.create(d.prototype),e.prototype.constructor=d,e.prototype.name="TextFontSize",e.prototype.optionName="TextFontSize",e.prototype.buttonIconClass="fa-text-height",e.prototype.valueType={fontSize:"number"},e.prototype._defaultOptions={defaultValues:{fontSize:48},predefined:{fontSize:[6,12,14,16,20,24,32,40,48,72]}},e.prototype.controlTemplate=function(){var a,b,c;b=this.options.predefined.fontSize.map(function(a){return'<option value="'+a+'">'+a+"</option>"}).join(""),c='<select class="editable-canvas-text-fontsize-input controls-value-item" name="drawer-size"data-name="fontSize"value="'+this.options.defaultValues.fontSize+'">'+b+"</select>";var d="toolbar-item-wrapper editable-canvas-text-option editable-canvas-text-fontsize hidden",e=this.buttonMode?" toolbar-button-item ":"",f=d+e;return a='<li class="'+f+'"><div class="toolbar-item-description"><span class="toolbar-item-label">'+this.drawer.t("Font size:")+' </span><span class="toolbar-item-valueholder"></span><span class="toolbar-item-icon fa '+this.buttonIconClass+'"></span></div><div class="toolbar-dropdown-block collapsed">'+c+"</div></li>"},b.TextFontSize=e}(jQuery,DrawerJs.plugins,DrawerJs.util,DrawerJs.plugins.BaseTextOptionTool),function(a,b,c,d){"use strict";var e=function(a,b){d.call(this,a),this._setupOptions(b)};e.prototype=Object.create(d.prototype),e.prototype.constructor=d,e.prototype.name="TextFontStyle",e.prototype.optionName="TextFontStyle",e.prototype.onlyPredefined=!0,e.prototype.focusTextOnChange=!0,e.prototype.buttonIconClass="fa-italic",e.prototype.valueType={fontStyle:"string"},e.prototype._defaultOptions={defaultValues:{fontStyle:""},predefined:{fontStyle:["normal","italic","oblique"]}},e.prototype.controlTemplate=function(){var a,b,c;b=this.options.predefined.fontStyle.map(function(a){return'<option value="'+a+'">'+a+"</option>"}).join(""),c='<select class="editable-canvas-text-fontstyle-input controls-value-item" name="drawer-size"data-name="fontStyle"value="'+this.options.defaultValues.fontStyle+'">'+b+"</select>";var d="toolbar-item-wrapper editable-canvas-text-option editable-canvas-text-fontstyle hidden",e=this.buttonMode?" toolbar-button-item ":"",f=d+e;return a='<li class="'+f+'"><div class="toolbar-item-description"><span class="toolbar-item-label">'+this.drawer.t("Font style:")+' </span><span class="toolbar-item-valueholder"></span><span class="toolbar-item-icon fa '+this.buttonIconClass+'"></span></div><div class="toolbar-dropdown-block collapsed">'+c+"</div></li>"},b.TextFontStyle=e}(jQuery,DrawerJs.plugins,DrawerJs.util,DrawerJs.plugins.BaseTextOptionTool),function(a,b,c,d){"use strict";var e=function(a,b){d.call(this,a),this._setupOptions(b)};e.prototype=Object.create(d.prototype),e.prototype.constructor=d,e.prototype.name="TextFontWeight",e.prototype.optionName="TextFontWeight",e.prototype.focusTextOnChange=!0,e.prototype.onlyPredefined=!0,e.prototype.buttonIconClass="fa-bold",e.prototype._defaultOptions={defaultValues:{fontWeight:"normal"},predefined:{fontWeight:["normal","bold","light",100,200,300,400,500,600,700,800,900]}},e.prototype.controlTemplate=function(){var a,b,c;b=this.options.predefined.fontWeight.map(function(a){return'<option value="'+a+'">'+a+"</option>"}).join(""),c='<select class="editable-canvas-text-fontweight-input controls-value-item" name="drawer-size"data-name="fontWeight"value="'+this.options.defaultValues.fontWeight+'">'+b+"</select>";var d="toolbar-item-wrapper editable-canvas-text-option editable-canvas-text-fontweight hidden",e=this.buttonMode?" toolbar-button-item ":"",f=d+e;return a='<li class="'+f+'"><div class="toolbar-item-description"><span class="toolbar-item-label">'+this.drawer.t("Font Weight:")+' </span><span class="toolbar-item-valueholder"></span><span class="toolbar-item-icon fa '+this.buttonIconClass+'"></span></div><div class="toolbar-dropdown-block collapsed">'+c+"</div></li>"},b.TextFontWeight=e}(jQuery,DrawerJs.plugins,DrawerJs.util,DrawerJs.plugins.BaseTextOptionTool),function(a,b,c,d){"use strict";var e=1.16,f=fabric.Text.prototype.lineHeight||e,g=function(a,b){d.call(this,a),this._setupOptions(b)};g.prototype=Object.create(d.prototype),g.prototype.constructor=d,g.prototype.name="TextLineHeight",g.prototype.optionName="TextLineHeight",g.prototype.showOnEditMode=!1,g.prototype.hideOnEditMode=!0,g.prototype.stylesToObject=!0,g.prototype.preventHightlight=!0,g.prototype.buttonIconClass="fa-arrows-v",g.prototype.onlyPredefined=!0,g.prototype.valueType={lineHeight:"number"},g.prototype._defaultOptions={defaultValues:{lineHeight:f},predefined:{lineHeight:[1,1.16,1.25,1.5,1.75,2,3]}},g.prototype.collectDataFromObject=function(b){var c={lineHeight:b.lineHeight};return this._lastData=this._lastData||{},a.extend(!0,this._lastData,c),c},g.prototype.controlTemplate=function(){var a,b,c;b=this.options.predefined.lineHeight.map(function(a){var b=parseInt(Math.round(100*a),10);return'<option value="'+a+'">'+b+"%</option>"}).join(""),c='<select class="editable-canvas-text-lineheight-input controls-value-item" name="drawer-size"data-name="lineHeight"value="'+this.options.defaultValues.lineHeight+'">'+b+"</select>";var d="toolbar-item-wrapper editable-canvas-text-option editable-canvas-text-lineheight hidden",e=""+(this.buttonMode?" toolbar-button-item ":"")+(this.preventHightlight?" prevent-highlight ":""),f=d+e;return a='<li class="'+f+'"><div class="toolbar-item-description"><span class="toolbar-item-label">'+this.drawer.t("Line height:")+' </span><span class="toolbar-item-valueholder"></span><span class="toolbar-item-icon fa '+this.buttonIconClass+'"></span></div><div class="toolbar-dropdown-block collapsed">'+c+"</div></li>"},b.TextLineHeight=g}(jQuery,DrawerJs.plugins,DrawerJs.util,DrawerJs.plugins.BaseTextOptionTool),function(a,b,c,d){"use strict";var e=function(a){this.optionName="border",this.name="ShapeBorder",c.call(this,a),this.assetsFolder=d.getDrawerFolderUrl()+"assets/",this._setGlobalClickHandler(),this._completeDefaultOptionsPaths(),this.colorpicker=new b.ColorpickerControl(this.drawer,this.options),this.currentColor=this.options.color,this.currentBorder=this.options.borderTypes[this.options.defaultBorder],this.activeToolIsShape=!1,this.drawer.on(this.drawer.EVENT_CANVAS_START_RESIZE,this.hideStyleDropdown.bind(this))};e.prototype=Object.create(c.prototype),e.prototype.constructor=c,e.prototype._defaultOptions={color:"rgba(0, 0, 0, 0)",borderTypes:{None:{width:0,description:"None",color:"transparent"},"Solid thin":{width:1,preview:"border-solid-thin.png"},"Solid bold":{width:5,preview:"border-solid-bold.png"},"Dashed thin":{width:1,dashArray:[8,8],preview:"border-dashed-thin.png"},"Dashed bold":{width:5,dashArray:[8,8],preview:"border-dashed-bold.png"}},defaultBorder:"None"},e.prototype._completeDefaultOptionsPaths=function(){for(var a in this.options.borderTypes){var b=this.options.borderTypes[a];b.preview&&(b.preview=this.assetsFolder+b.preview)}},e.prototype._setGlobalClickHandler=function(){var b=this;a(window.document).off("click.DrawerShapeBorder").on("click.DrawerShapeBorder",function(c){var d=a(c.target),e=d.hasClass("border-type-indicator");b.isDropdownVisible&&!e&&b.hideStyleDropdown()})},e.prototype.updateControlsFromObject=function(a){this.updateColorFromObject(a),this.updateStrokeFromObject(a),this.updateControls()},e.prototype.updateColorFromObject=function(a){var c=null;c=a.get("stroke"),this.currentColor=c?c:b.ColorpickerControl.TRANSPARENT},e.prototype.updateStrokeFromObject=function(a){var b=a.get("strokeDashArray"),c=a.get("strokeWidth");for(var d in this.options.borderTypes)if(this.options.borderTypes.hasOwnProperty(d)){var e=this.options.borderTypes[d],f=JSON.stringify(e.dashArray)===JSON.stringify(b);e.dashArray||b||(f=!0),f&&e.width==c&&(this.currentBorder=e)}},e.prototype._onObjectAdded=function(a,b){if(this.drawer.mode==this.drawer.MODE_ACTIVE){var c=b.target;this.applyBorderStyle(c),this.drawer.fCanvas.renderAll()}},e.prototype.onActivateTool=function(a){a instanceof b.Line||a instanceof b.ArrowOneSide||a instanceof b.ArrowTwoSide?(this.colorBeforeLineShape=this.currentColor,this.borderBeforeLineShape=this.currentBorder,this.currentColor=this.drawer.activeColor,this.currentBorder=this.options.borderTypes["Solid thin"],this.updateControls()):void 0!==this.colorBeforeLineShape&&(this.currentColor=this.colorBeforeLineShape,this.currentBorder=this.borderBeforeLineShape,delete this.colorBeforeLineShape,delete this.borderBeforeLineShape,this.updateControls())},e.prototype.createControls=function(b){var c=this;this.colorButton=this.colorpicker.createControl(b,this.onColorSelected.bind(this)),this.colorpicker.setColor(this.options.color),this.colorButton.css("display","inline-block"),this.colorButton.find(".toolbar-label").text(this.drawer.t("Border:")),c.$borderTypeButton=a('<li class="editable-canvas-border-type" data-editable-canvas-sizeable="toolbar-button" ><span class="toolbar-label editable-canvas-border-type-label">'+this.drawer.t("Border type:")+' </span><span class="border-type-indicator" data-editable-canvas-sizeable="toolbar-button" ></span><span class="border-type-dropdown toolbar-dropdown-block hidden" data-editable-canvas-sizeable="toolbar-button" ></span></li>'),c.isDropdownVisible=!1,c.$borderTypeButton.$dropdown=c.$borderTypeButton.find(".border-type-dropdown"),c.$borderTypeButton.$indicator=c.$borderTypeButton.find(".border-type-indicator"),d.bindClick(c.$borderTypeButton,"border-type-dropdown",c.toggleStyleDropdown.bind(c));var e=a("<ul></ul>");c.$borderTypeButton.$dropdown.append(e);var f=function(b){var d=a(b.target),e=d.attr("data-border-type");e&&(c.currentBorder=c.options.borderTypes[e],c.onColorSelected(),b.stopPropagation(),b.preventDefault())};for(var g in this.options.borderTypes)if(this.options.borderTypes.hasOwnProperty(g)){var h=this.options.borderTypes[g],i=a('<li data-border-type="'+g+'"data-editable-canvas-sizeable="toolbar-button" </li>');h.preview&&i.css("background-image","url("+h.preview+")"),h.description&&i.text(h.description),d.bindClick(i,"border-type",f),e.append(i)}b.addControl(c.$borderTypeButton,this.options.buttonOrder),c.onColorSelected(),c.hideControls()},e.prototype.onColorSelected=function(a){if(a&&(this.currentColor=a),this.updateControls(),this.drawer.fCanvas){var b=this.drawer.fCanvas.getActiveObject();b&&this.applyBorderStyle(b),this.drawer.fCanvas.renderAll()}},e.prototype.applyBorderStyle=function(a){(d.isShape(a)||a instanceof fabric.Line)&&(this.currentBorder.color?a.set("stroke",this.currentBorder.color):a.set("stroke",this.currentColor),a.set("strokeWidth",this.currentBorder.width),this.currentBorder.dashArray?a.set("strokeDashArray",this.currentBorder.dashArray):a.set("strokeDashArray",null))},e.prototype.updateControls=function(){this.colorpicker.setColor(this.currentColor),this.hideStyleDropdown(),"None"==this.currentBorder.description?this.colorpicker.hideControls():this.colorpicker.showControls();var a=this.$borderTypeButton.find(".border-type-indicator"),b=this.currentBorder.preview?"url("+this.currentBorder.preview+")":"none";a.css("background-image",b),a.text(this.currentBorder.description?this.drawer.t(this.currentBorder.description):"")},e.prototype.showControls=function(){this.colorpicker.showControls(),this.$borderTypeButton.show()},e.prototype.hideControls=function(){this.colorpicker.hideControls(),this.$borderTypeButton.hide()},e.prototype.toggleStyleDropdown=function(){var a=!this.isDropdownVisible;a?this.showStyleDropdown():this.hideStyleDropdown()},e.prototype.hideStyleDropdown=function(){this.$borderTypeButton.$dropdown.addClass("hidden"),this.isDropdownVisible=!1,this.$clonedDropdown&&this.$clonedDropdown.remove()},e.prototype.showStyleDropdown=function(){this.$borderTypeButton.$dropdown.removeClass("hidden"),this.isDropdownVisible=!0;var a=this.drawer&&this.drawer.toolbars&&this.drawer.toolbars.toolOptionsToolbar,b=a&&a.options,c=b&&"popup"!==b.position,e=b&&"outside"===b.positionType,f=b&&"scrollable"===b.compactType,g=c&&e&&f;if(g){var h,i=this.$borderTypeButton.$dropdown;i.removeClass("hidden"),h=i.clone(!0),this.$borderTypeButton.$dropdown.closest(".toolbar-placeholder").append(h),h.addClass("border-type-dropdown-cloned"),this.$clonedDropdown=h;var j=d.getScrollOffset(this.drawer.$canvasEditContainer),k=d.getScrollOffset(this.$borderTypeButton),l=this.drawer.$canvasEditContainer.get(0).getBoundingClientRect(),m=this.$borderTypeButton.get(0).getBoundingClientRect(),n=m.left+m.width/2,o=(n-l.left-(k.left-j.left)-this.$clonedDropdown.width()/2,12),p=m.left+m.width-l.left-(k.left-j.left)-this.$clonedDropdown.width()-o;this.$clonedDropdown.css({left:p}),i.addClass("hidden")}},b.ShapeBorder=e}(jQuery,DrawerJs.plugins,DrawerJs.plugins.BaseToolOptions,DrawerJs.util),function(a,b,c){var d=function(a){b.call(this,a),this.name="ArrowOneSide",this.toolOptionsList=["border","opacity","lineWidth","strokeWidth"],this.btnClass="btn-arrow-one-side",this.faClass="fa-long-arrow-right",this.tooltip=a.t("Draw an arrow"),this.group={name:"lines",tooltip:a.t("Lines and arrows")},this._setupOptions({}),$.extend(!0,this.options.lineAngleTooltip,a.options.lineAngleTooltip||{}),this.options.lineAngleTooltip.fontFamily+=", "+this._defaultOptions.lineAngleTooltip.fontFamily};d.prototype=Object.create(b.prototype),d.prototype.constructor=d,d.prototype.checkOnlyWidth=!0,d.prototype._defaultOptions={lineAngleTooltip:{enabled:!1,fontSize:11,fontFamily:"Arial, sans serif",color:"black"}},d.prototype.createShape=function(a,b){var c=new fabric.ErasableArrow([a,b,a+1,b+1],{oneSided:!0});return c.set("strokeWidth",this.drawerInstance.lineStrokeWidth||1),c.set("stroke",this.drawerInstance.activeColor),c.set("opacity",this.drawerInstance.activeOpacity),c.set("oneSided",!0),this.createAngleTooltip(c),c},d.prototype.updateShape=function(a,b,c){a.set("y2",c),a.set("x2",b),this.updateAngleTooltip(a)},d.prototype.finishShape=function(){this.removeAngleTooltip()},d.prototype.createAngleTooltip=function(a){this.options.lineAngleTooltip.enabled&&(this.angleTooltip=new fabric.IText("Text"),this.angleTooltip.set("fontFamily",this.options.lineAngleTooltip.fontFamily),this.angleTooltip.set("fontSize",this.options.lineAngleTooltip.fontSize),this.angleTooltip.set("left",a.x1-10),this.angleTooltip.set("top",a.y1-10),this.angleTooltip.set("stroke",this.options.lineAngleTooltip.color),this.angleTooltip.set("fill",this.options.lineAngleTooltip.color),this.angleTooltip.set("text",""),this.drawerInstance.fCanvas.add(this.angleTooltip),this.updateAngleTooltip(a))},d.prototype.updateAngleTooltip=function(a){if(this.options.lineAngleTooltip.enabled){var b=Math.atan((a.y2-a.y1)/(a.x2-a.x1)),c=Math.abs(fabric.util.radiansToDegrees(b));this.angleTooltip.setText(c.toFixed().toString());var d=this.options.lineAngleTooltip.fontSize,e=-this.options.lineAngleTooltip.fontSize;a.x2<a.x1&&(d=-(this.options.lineAngleTooltip.fontSize+10)),a.y2>a.y1&&(e=2),this.angleTooltip.set("left",a.x1+d),this.angleTooltip.set("top",a.y1+e),this.angleTooltip.set("stroke",this.options.lineAngleTooltip.color),this.angleTooltip.set("fill",this.options.lineAngleTooltip.color)}},d.prototype.removeAngleTooltip=function(){this.options.lineAngleTooltip.enabled&&this.angleTooltip&&(this.angleTooltip.remove(),delete this.tooltip)},c.ArrowOneSide=d}(jQuery,DrawerJs.plugins.BaseShape,DrawerJs.plugins),function(a,b,c){var d=function(a){b.call(this,a),this.name="ArrowTwoSide",this.toolOptionsList=["border","opacity","lineWidth","strokeWidth"],this.btnClass="btn-arrow-two-side",this.faClass="fa-arrows-h",this.tooltip=a.t("Draw a two-sided arrow"),this.group={name:"lines",tooltip:a.t("Lines and arrows")},this._setupOptions({}),$.extend(!0,this.options.lineAngleTooltip,a.options.lineAngleTooltip||{}),this.options.lineAngleTooltip.fontFamily+=", "+this._defaultOptions.lineAngleTooltip.fontFamily};d.prototype=Object.create(b.prototype),d.prototype.constructor=d,d.prototype.checkOnlyWidth=!0,d.prototype._defaultOptions={lineAngleTooltip:{enabled:!1,fontSize:11,fontFamily:"Arial, sans serif",color:"black"}},d.prototype.createShape=function(a,b){var c=new fabric.ErasableArrow([a,b,a+1,b+1],{oneSided:!1});return c.set("strokeWidth",this.drawerInstance.lineStrokeWidth||1),c.set("stroke",this.drawerInstance.activeColor),c.set("opacity",this.drawerInstance.activeOpacity),c.set("oneSided",!1),this.createAngleTooltip(c),c},d.prototype.updateShape=function(a,b,c){a.set("y2",c),a.set("x2",b),this.updateAngleTooltip(a)},d.prototype.finishShape=function(){this.removeAngleTooltip()},d.prototype.createAngleTooltip=function(a){this.options.lineAngleTooltip.enabled&&(this.angleTooltip=new fabric.IText("Text"),this.angleTooltip.set("fontFamily",this.options.lineAngleTooltip.fontFamily),this.angleTooltip.set("fontSize",this.options.lineAngleTooltip.fontSize),this.angleTooltip.set("left",a.x1-this.options.lineAngleTooltip.fontSize),this.angleTooltip.set("top",a.y1-this.options.lineAngleTooltip.fontSize),this.angleTooltip.set("stroke",this.options.lineAngleTooltip.color),this.angleTooltip.set("fill",this.options.lineAngleTooltip.color),this.angleTooltip.set("text",""),this.drawerInstance.fCanvas.add(this.angleTooltip),this.updateAngleTooltip(a))},d.prototype.updateAngleTooltip=function(a){if(this.options.lineAngleTooltip.enabled){var b=Math.atan((a.y2-a.y1)/(a.x2-a.x1)),c=Math.abs(fabric.util.radiansToDegrees(b));this.angleTooltip.setText(c.toFixed().toString());var d=this.options.lineAngleTooltip.fontSize,e=-this.options.lineAngleTooltip.fontSize;a.x2<a.x1&&(d=-(this.options.lineAngleTooltip.fontSize+10)),a.y2>a.y1&&(e=2),this.angleTooltip.set("left",a.x1+d),this.angleTooltip.set("top",a.y1+e),this.angleTooltip.set("stroke",this.options.lineAngleTooltip.color),this.angleTooltip.set("fill",this.options.lineAngleTooltip.color)}},d.prototype.removeAngleTooltip=function(){this.options.lineAngleTooltip.enabled&&this.angleTooltip&&(this.angleTooltip.remove(),delete this.tooltip)},c.ArrowTwoSide=d}(jQuery,DrawerJs.plugins.BaseShape,DrawerJs.plugins),function(a,b,c){var d=function(a,c){var d=this;b.call(d,a),this.name="Circle",this.btnClass="btn-circle",this.faClass="fa-circle",this.tooltip=a.t("Draw a circle"),this.options=c||{},this.centeringMode=this.options.centeringMode||b.CENTERING_MODE.NORMAL};d.prototype=Object.create(b.prototype),d.prototype.constructor=d,d.prototype.minShapeSize=5,d.prototype.createShape=function(a,b){this.startLeft=a,this.startTop=b;var c=new fabric.PCircle({left:a,top:b,radius:1,fill:this.drawerInstance.activeColor,opacity:this.drawerInstance.activeOpacity});return c},d.prototype.updateShape=function(a,c,d){var e=c-this.startLeft,f=d-this.startTop,g=Math.abs(e),h=Math.abs(f),i=h>g?g:h;i=Math.abs(i),i/=2,this.centeringMode==b.CENTERING_MODE.FROM_CENTER&&(i*=2,a.set("left",this.startLeft-i),a.set("top",this.startTop-i)),this.centeringMode==b.CENTERING_MODE.NORMAL&&(0>e?a.set("left",this.startLeft-2*i):a.set("left",this.startLeft),0>f?a.set("top",this.startTop-2*i):a.set("top",this.startTop)),a.set("radius",i)},c.Circle=d}(jQuery,DrawerJs.plugins.BaseShape,DrawerJs.plugins),function(a,b,c,d){var e=function(a,c){var d=this;b.call(d,a),this.drawer=a,this.name="Image",this.btnClass="btn-image",this.faClass="fa-image",this.tooltip=a.t("Insert an image"),this._setupOptions(c)};e.prototype=Object.create(b.prototype),e.prototype.constructor=e,e.prototype._defaultOptions={maxImageSizeKb:5120,scaleDownLargeImage:!0,centerImage:!0,cropIsActive:!0,acceptedMIMETypes:["image/jpeg","image/png","image/gif"]},e.prototype._activateTool=function(){var a=this;this.drawerInstance.log("TOOL","Image._activateTool()"),b.prototype._activateTool.call(this),this._showDialog(),d.setTimeout(function(){a.drawerInstance.trigger(a.drawerInstance.EVENT_DO_DEACTIVATE_TOOL,[a])},300)},e.prototype._showDialog=function(){var b=this.options.acceptedMIMETypes.join(",");$el=a('<input type="file" accept="'+b+'">'),$el.on("change",this._processFileInput.bind(this)),$el.click()},e.prototype._processFileInput=function(a){var b=this,c=a.target.files;if(c.length<1)return void b.drawerInstance.showError(this.drawerInstance.t("No file was selected!"));var d=c[0];if(this._checkFile(d)){var e=new FileReader;e.onload=function(){b.drawerInstance.log("IMAGE LOADED:",d.name);var a=b.options.cropIsActive&&b.drawer._pluginsInstances.ImageCrop;a?b._triggerImageCrop(e.result):b.loadImage(e.result)},e.readAsDataURL(d)}},e.prototype._checkFile=function(a){var b=this;if(a.type.indexOf("image")<0)return b.drawerInstance.showError(this.drawerInstance.t("Incorrect file type!")),!1;if(this.options.maxImageSizeKb>0&&a.size>1024*this.options.maxImageSizeKb){var c=this.drawerInstance.t("File is to big!. Maximum file size is ");return c=c+this.options.maxImageSizeKb+" KB",b.drawerInstance.showError(c),!1}return!0},e.prototype.loadImage=function(a,b){var c=this,d=new Image;d.onload=function(){c.addImage(d,b)},d.onerror=function(){var a=c.drawerInstance.t("Image failed to create!");c.drawerInstance.showError(a)},d.src=a},e.prototype._triggerImageCrop=function(a){var b={url:a,callback:this.loadImage.bind(this)};this.drawerInstance.trigger(this.drawerInstance.EVENT_IMAGE_CROP,b)},e.prototype.addImage=function(a,b){var c=this.drawerInstance.fCanvas,d=new fabric.ErasableImage(a);b=b?b:this.options,b.scaleDownLargeImage?this._fitLargeImage(d):(d.left=b.left?b.left:0,d.top=b.top?b.top:0,d.scaleX=b.scaleX?b.scaleX:1,d.scaleY=b.scaleY?b.scaleY:1),d.opacity=this.drawerInstance.activeOpacity,b.centerImage&&c.centerObject(d),c.add(d),c.setActiveObject(d)},e.prototype._fitLargeImage=function(a){var b=this.drawerInstance.fCanvas,c=.95*b.width,d=.95*b.height,e=1,f=1;a.width>c&&(e=c/a.width),a.height>d&&(f=d/a.height);var g=Math.min(e,f);a.set({scaleX:g,scaleY:g})},c.Image=e}(jQuery,DrawerJs.plugins.BaseTool,DrawerJs.plugins,DrawerJs.util),function(a){a.prototype.addImageFromUrl=function(a,b){this.drawer.api.checkIsActive();var c=this.drawer.getPluginInstance("Image");c.loadImage(a,b)},a.prototype.addImage=function(a,b){this.drawer.api.checkIsActive();var c=this.drawer.getPluginInstance("Image");c.addImage(a,b)}}(DrawerJs.DrawerApi),function(a,b,c){var d=function(c){b.call(this,c),this.name="Line",this.toolOptionsList=["border","opacity","lineWidth","strokeWidth"],this.btnClass="btn-line",this.faClass="fa-line",this.tooltip=c.t("Draw a line"),this.group={name:"lines",tooltip:c.t("Lines and arrows")},this._setupOptions({}),a.extend(!0,this.options.lineAngleTooltip,c.options.lineAngleTooltip||{}),this.options.lineAngleTooltip.fontFamily+=", "+this._defaultOptions.lineAngleTooltip.fontFamily};d.prototype=Object.create(b.prototype),d.prototype.constructor=d,d.prototype.checkOnlyWidthOrHeight=!0,d.prototype._defaultOptions={lineAngleTooltip:{enabled:!1,fontSize:11,fontFamily:"Arial, sans serif",color:"black"}},d.prototype.createShape=function(a,b){var c=new fabric.ErasableLine;return c.set("x1",a),c.set("x2",a+1),c.set("y1",b),c.set("y2",b+1),c.set("stroke",this.drawerInstance.activeColor),c.set("opacity",this.drawerInstance.activeOpacity),c.set("strokeWidth",this.drawerInstance.lineStrokeWidth||2),this.createAngleTooltip(c),c},d.prototype.updateShape=function(a,b,c){a.set("x2",b),a.set("y2",c),this.updateAngleTooltip(a)},d.prototype.finishShape=function(){this.removeAngleTooltip()},d.prototype.createAngleTooltip=function(a){this.options.lineAngleTooltip.enabled&&(this.angleTooltip=new fabric.IText("Text"),this.angleTooltip.set("fontFamily",this.options.lineAngleTooltip.fontFamily),this.angleTooltip.set("fontSize",this.options.lineAngleTooltip.fontSize),this.angleTooltip.set("left",a.x1-10),this.angleTooltip.set("top",a.y1-10),this.angleTooltip.set("stroke",this.options.lineAngleTooltip.color),this.angleTooltip.set("fill",this.options.lineAngleTooltip.color),
this.angleTooltip.set("text",""),this.drawerInstance.fCanvas.add(this.angleTooltip),this.updateAngleTooltip(a))},d.prototype.updateAngleTooltip=function(a){if(this.options.lineAngleTooltip.enabled){var b=Math.atan((a.y2-a.y1)/(a.x2-a.x1)),c=Math.abs(fabric.util.radiansToDegrees(b));this.angleTooltip.setText(c.toFixed().toString());var d=this.options.lineAngleTooltip.fontSize,e=-this.options.lineAngleTooltip.fontSize;a.x2<a.x1&&(d=-(this.options.lineAngleTooltip.fontSize+10)),a.y2>a.y1&&(e=2),this.angleTooltip.set("left",a.x1+d),this.angleTooltip.set("top",a.y1+e),this.angleTooltip.set("stroke",this.options.lineAngleTooltip.color),this.angleTooltip.set("fill",this.options.lineAngleTooltip.color)}},d.prototype.removeAngleTooltip=function(){this.options.lineAngleTooltip.enabled&&this.angleTooltip&&(this.angleTooltip.remove(),delete this.tooltip)},c.Line=d}(jQuery,DrawerJs.plugins.BaseShape,DrawerJs.plugins),function(a,b,c,d){"use strict";var e=d.mouseDown("Polygon"),f=d.mouseMove("Polygon"),g=d.mouseUp("Polygon"),h=function(a,c){var d=this;b.call(d,a),this.name="Polygon",this.btnClass="btn-polygon",this.faClass="fa-star",this.tooltip=a.t("Draw a Polygon"),this.helpTooltipText=a.t("Click to start a new line"),this.options=c||{},this.centeringMode=this.options.centeringMode||b.CENTERING_MODE.NORMAL,a.on(a.EVENT_EDIT_STOP,function(){d.finishDraw()}),a.on(a.EVENT_DO_ACTIVATE_TOOL,function(a,b){b instanceof h||d.finishDraw()})};h.prototype=Object.create(b.prototype),h.prototype.constructor=h,h.prototype.setUpHandlers=function(){var b=this;b.drawerInstance.fCanvas._oldSelectionState=b.drawerInstance.fCanvas.selection,b.drawerInstance.fCanvas.selection=!1,b.$stopButton=a('<button class="stop-polygon">'+b.drawerInstance.t("Stop drawing a polygon")+"</button>"),b.drawerInstance.$canvasEditContainer.append(b.$stopButton),b.$stopButton.click(function(){b.finishDraw()}),b.drawerInstance.on(b.drawerInstance.EVENT_KEYDOWN,function(a,c){27==c.which&&b.finishDraw()});var c=a(this.drawerInstance.fCanvas.upperCanvasEl),d=function(a){b.addNewPoint(a),b.poly.__mouseEventSet||(b.setUpMoveEvent(),b.poly.__mouseEventSet=!0),b.drawerInstance.fCanvas.renderAll()};b.drawerInstance.touchDevice?(c.on(e,function(a){return d(a),a.preventDefault(),a.stopPropagation(),!1}),c.on(g,function(a){return c.off(f),b.poly.__mouseEventSet=!1,a.preventDefault(),a.stopPropagation(),!1})):c.on(e,function(a){return d(a),a.preventDefault(),a.stopPropagation(),!1})},h.prototype.addNewPoint=function(a){var b=this,c=this.drawer.fCanvas.getPointer(a),d=c.x,e=c.y;b.poly||(b.startLeft=d,b.startTop=e,b.poly=new fabric.SegmentablePolygon([[{x:0,y:0}]]),b.poly.set("fill",b.drawerInstance.activeColor),b.poly.set("opacity",b.drawerInstance.activeOpacity),b.poly.set("left",d),b.poly.set("top",e),b.poly.set("evented",!1),b.poly.set("selectable",!1),b.drawerInstance.fCanvas.add(b.poly));var f=b.poly.get("points"),g=b.poly.getCenterPoint();d-=g.x,e-=g.y,f[0].push({x:d,y:e}),b.poly.set("points",f),b.fixPosition()},h.prototype.setUpMoveEvent=function(){var b=this,c=a(this.drawerInstance.fCanvas.upperCanvasEl);c.on(f,function(a){var c=b.poly.get("points"),d=b.drawerInstance.fCanvas.getPointer(a),e=b.poly.getCenterPoint(),f=d.x-e.x,g=d.y-e.y;c[0].length>=2&&(c[0][c[0].length-1].x=f,c[0][c[0].length-1].y=g,b.poly.set("points",c),b.fixPosition(),b.drawerInstance.fCanvas.renderAll())})},h.prototype.fixPosition=function(){var a=this;a.poly._fixPoints(),a.poly.setCoords();var b=a.poly.get("points"),c=a.poly.getCenterPoint(),d=c.x+b[0][0].x,e=c.y+b[0][0].y,f=d,g=e,h=a.startLeft-f,i=a.startTop-g;a.poly.set("left",a.poly.get("left")+h),a.poly.set("top",a.poly.get("top")+i)},h.prototype.finishDraw=function(){var b=this;b.drawerInstance.fCanvas.selection=b.drawerInstance.fCanvas._oldSelectionState;var c=a(this.drawerInstance.fCanvas.upperCanvasEl);if(c.off(f),c.off(e),c.off(g),d.unbindLongPress(c,"polygon"),b.poly){if(!b.drawerInstance.touchDevice){var h=this.poly.get("points");h[0].splice(h[0].length-1,1),this.poly.set("points",h)}this.fixPosition(),b.poly.set("evented",!0),b.poly.set("selectable",!0);var i=this.poly.clone();this.drawerInstance.fCanvas.add(i),this.drawerInstance.fCanvas.remove(this.poly)}this.poly=null,this.drawerInstance.fCanvas.renderAll(),b.$stopButton&&d.setTimeout(function(){b.$stopButton.remove()},1),this._deactivateTool()},c.Polygon=h}(jQuery,DrawerJs.plugins.BaseShape,DrawerJs.plugins,DrawerJs.util),function(a,b,c){var d=function(a,c){var d=this;b.call(d,a),this.name="Rectangle",this.btnClass="btn-rectangle",this.faClass="fa-stop",this.tooltip=a.t("Draw a rectangle"),this.options=c||{},this.centeringMode=this.options.centeringMode||b.CENTERING_MODE.NORMAL};d.prototype=Object.create(b.prototype),d.prototype.constructor=d,d.prototype.createShape=function(a,b){this.startLeft=a,this.startTop=b;var c=new fabric.PRect({left:a,top:b,height:1,width:1,fill:this.drawerInstance.activeColor,opacity:this.drawerInstance.activeOpacity});return c},d.prototype.updateShape=function(a,c,d){var e=c-this.startLeft,f=d-this.startTop;this.centeringMode==b.CENTERING_MODE.FROM_CENTER&&(e*=2,f*=2,a.set("left",c-e),a.set("top",d-f)),e>0?a.set("width",e):(a.set("left",c),a.set("width",-1*e)),f>0?a.set("height",f):(a.set("top",d),a.set("height",-1*f))},c.Rectangle=d}(jQuery,DrawerJs.plugins.BaseShape,DrawerJs.plugins),function(a,b,c){"use strict";var d=function(a,c){b.call(this,a),this._setupOptions(c),this.tooltip=this.drawerInstance.t("Draw a text"),this.helpTooltipText=this.drawerInstance.t("Click to place a text"),this.drawerInstance.on(this.drawerInstance.EVENT_OPTIONS_TOOLBAR_CREATED+this.eventNs,this._onOptionsToolbarCreated.bind(this))};d.prototype=Object.create(b.prototype),d.prototype.constructor=d,d.prototype.name="Text",d.prototype.toolOptionsList=["color","border","opacity"],d.prototype.eventNs=".textTool",d.prototype.name="Text",d.prototype.btnClass="btn-text",d.prototype.faClass="fa-font",d.prototype._onOptionsToolbarCreated=function(){this.drawerInstance.on(this.drawerInstance.EVENT_TEXT_SELECTION_CHANGED,this._onTextSelectionChanged.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_TEXT_EDITING_ENTERED,this._onTextEditingEntered.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_TEXT_EDITING_EXITED,this._onTextEditingExited.bind(this))},d.prototype._deactivateTool=function(){this.active&&b.prototype._deactivateTool.call(this)},d.prototype.removeTool=function(a){a&&this.drawerInstance.off(this.drawerInstance.EVENT_OPTIONS_TOOLBAR_CREATED+this.eventNs),b.prototype.removeTool.call(this,a)},d.prototype._onTextEditingEntered=function(a,b){console.info("EVENT_TEXT_EDITING_ENTERED"),this._onTextSelectionChanged(a,b)},d.prototype._onTextEditingExited=function(a,b){b&&b.target&&(b.target._lastSelection=void 0,b.target._lastStyles=void 0)},d.prototype._onTextSelectionChanged=function(b,c){var d=c&&c.target||this.drawerInstance.getActiveObject(),e={start:d.selectionStart,end:d.selectionEnd},f=d._lastSelection||{},g=e.start===e.end,h=0===e.start,i=e.start===f.start&&void 0!==e.start,j=e.end===f.end&&void 0!==e.end,k=i&&j;if(!k){d._lastSelection=e;var l=d.getObjStyles(),m=d._lastStyles||{},n=g&&!h,o=n&&d.getSelectionStyles(e.start-1),p=o||d.getSelectionStyles(),q=d._hasStyleChanged(m,o||p),r=[];if(!g){p=a.extend(!0,{},p);var s=d.getSelectionStyles(e.start,e.end),t=a.extend(!0,{},s[0]);s.forEach(function(a){for(var b in l){var c=a[b]!==t[b],d=-1!==r.indexOf(b);c&&!d&&(r.push(b),p[b]=void 0)}}),q=r.length||d._hasStyleChanged(m,p)}if(this.drawerInstance.setTemporaryStyles(p),q){d._lastStyles=p;var u=this.drawerInstance;u.trigger(u.EVENT_TEXT_STYLES_CHANGED,[p,l,r])}}},d.prototype.addShape=function(a,b,c,d){d=d||{},a=parseInt(a,10),a=a||0===a?a:0,b=parseInt(b,10),b=b||0===b?b:0;var e=this.createShape(a,b,c,d);e.set("left",a),e.set("top",b),this.shape=e,this.finishItemDraw(),this.onlyOneItem&&this.drawerInstance.trigger(this.drawerInstance.EVENT_DO_DEACTIVATE_TOOL,this)},d.prototype.createShape=function(a,b,c,d){d=d||{},c=c||"Text",this.startLeft=a,this.startTop=b,this.text=new fabric.ErasableText(c,{editIconMode:this.options.editIconMode,editIconSize:this.options.editIconSize});var e=this.drawerInstance,f=this.options.defaultValues||{},g={};return e.trigger(e.EVENT_TEXT_GET_STYLES,[this,g]),g=g||{},g.defaultValues=g.defaultValues||{},this.text.set("fontFamily",d.fontFamily||f.fontFamily||g.defaultValues.fontFamily),this.text.set("fontSize",d.fontSize||f.fontSize||g.defaultValues.fontSize),this.text.set("lineHeight",d.lineHeight||f.lineHeight||g.defaultValues.lineHeight),this.text.set("fill",d.fill||f.fill||g.defaultValues.fill||this.drawerInstance.activeColor),this.text.set("opacity",d.opacity||f.opacity||g.defaultValues.opacity||this.drawerInstance.activeOpacity),this.text.set("left",a-this.text.width/2),this.text.set("top",b-this.text.height/2),this.text},d.prototype.updateShape=function(){},d.prototype.isObjectText=function(a){return a instanceof fabric.IText},c.Text=d}(jQuery,DrawerJs.plugins.BaseShape,DrawerJs.plugins,DrawerJs.util),function(a,b,c){var d=function(a,c){var d=this;b.call(d,a),this.name="Triangle",this.btnClass="btn-triangle",this.faClass="fa-play",this.tooltip=a.t("Draw a triangle"),this.options=c||{},this.centeringMode=this.options.centeringMode||b.CENTERING_MODE.NORMAL};d.prototype=Object.create(b.prototype),d.prototype.constructor=d,b.prototype.minShapeSize=8,d.prototype.createShape=function(a,b){this.startLeft=a,this.startTop=b;var c=new fabric.PTriangle({width:1,height:1,left:a,top:b,fill:this.drawerInstance.activeColor,opacity:this.drawerInstance.activeOpacity});return c},d.prototype.updateShape=function(a,c,d){var e=c-this.startLeft,f=d-this.startTop;this.centeringMode===b.CENTERING_MODE.NORMAL?(e>0?(a.set("width",e),a.set("left",c)):(a.set("width",-1*e),a.set("left",c)),f>0?(a.set("angle",0),a.set("height",f),e>0?a.set("left",c-e):a.set("left",c)):(a.set("angle",180),a.set("height",-1*f),a.set("top",d+-1*f),e>0?a.set("left",c):a.set("left",c+-1*e))):this.centeringMode===b.CENTERING_MODE.FROM_CENTER&&(e*=2,f*=2,a.set("left",c-e),a.set("top",d-f),a.set("width",e),a.set("height",f))},c.Triangle=d}(jQuery,DrawerJs.plugins.BaseShape,DrawerJs.plugins);